<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Data Science for Political Science</title>
  <meta name="description" content="Data Science for Political Science" />
  <meta name="generator" content="bookdown #bookdown:version# and GitBook 2.6.7" />

  <meta property="og:title" content="Data Science for Political Science" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Data Science for Political Science" />
  
  
  

<meta name="author" content="Instructor: Katherine McCabe" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<!--bookdown:link_prev-->
<!--bookdown:link_next-->
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<link href="libs/vembedr-0.1.4/css/vembedr.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="css/style.css" type="text/css" />
</head>

<body>



<!--bookdown:title:start-->
<div id="header">
<h1 class="title">Data Science for Political Science</h1>
<p class="author"><em>Instructor: Katherine McCabe</em></p>
</div>
<!--bookdown:title:end-->

<!--bookdown:toc:start-->
  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">
<!--bookdown:toc2:start-->
<ul>
<li><a href="#course-notes"><span class="toc-section-number">1</span> Course Notes</a>
<ul>
<li><a href="#what-have-i-signed-up-for"><span class="toc-section-number">1.1</span> What have I signed up for?</a>
<ul>
<li><a href="#data-science-can-help-social-scientists"><span class="toc-section-number">1.1.1</span> Data Science Can Help Social Scientists</a></li>
<li><a href="#course-goals"><span class="toc-section-number">1.1.2</span> Course Goals</a></li>
</ul></li>
<li><a href="#rsetup"><span class="toc-section-number">1.2</span> Setup in R</a></li>
<li><a href="#first-time-working-in-r-and-rstudio"><span class="toc-section-number">1.3</span> First Time Working in R and RStudio</a>
<ul>
<li><a href="#open-rstudio"><span class="toc-section-number">1.3.1</span> Open RStudio</a></li>
<li><a href="#using-r-as-a-calculator"><span class="toc-section-number">1.3.2</span> Using R as a Calculator</a></li>
<li><a href="#working-in-an-r-script"><span class="toc-section-number">1.3.3</span> Working in an R Script</a></li>
<li><a href="#preparing-your-r-script"><span class="toc-section-number">1.3.4</span> Preparing your R script</a></li>
<li><a href="#executing-commands-in-your-r-script"><span class="toc-section-number">1.3.5</span> Executing Commands in your R script</a></li>
<li><a href="#objects"><span class="toc-section-number">1.3.6</span> Objects</a></li>
</ul></li>
<li><a href="#assignment-1"><span class="toc-section-number">1.4</span> Assignment 1</a></li>
<li><a href="#r-markdown"><span class="toc-section-number">1.5</span> R Markdown</a>
<ul>
<li><a href="#how-to-get-setup-in-rmarkdown"><span class="toc-section-number">1.5.1</span> How to get setup in RMarkdown</a></li>
<li><a href="#additional-rmarkdown-resources"><span class="toc-section-number">1.5.2</span> Additional RMarkdown resources</a></li>
</ul></li>
<li><a href="#wait-a-second-why-r"><span class="toc-section-number">1.6</span> Wait a second why R?</a></li>
</ul></li>
<li><a href="#description"><span class="toc-section-number">2</span> Description</a>
<ul>
<li><a href="#process-of-describing"><span class="toc-section-number">2.1</span> Process of Describing</a>
<ul>
<li><a href="#example-process"><span class="toc-section-number">2.1.1</span> Example Process</a></li>
</ul></li>
<li><a href="#summarizing-univariate-data"><span class="toc-section-number">2.2</span> Summarizing univariate data</a></li>
<li><a href="#functions-to-summarize-univariate-data"><span class="toc-section-number">2.3</span> Functions to summarize univariate data</a>
<ul>
<li><a href="#using-functions-in-r-overview"><span class="toc-section-number">2.3.1</span> Using functions in R (overview)</a></li>
</ul></li>
<li><a href="#loading-data-into-r"><span class="toc-section-number">2.4</span> Loading data into R</a>
<ul>
<li><a href="#working-with-datasets-in-r"><span class="toc-section-number">2.4.1</span> Working with datasets in R</a></li>
<li><a href="#measuring-the-turnout-in-the-us-elections"><span class="toc-section-number">2.4.2</span> Measuring the Turnout in the US Elections</a></li>
<li><a href="#getting-to-know-your-data"><span class="toc-section-number">2.4.3</span> Getting to know your data</a></li>
</ul></li>
<li><a href="#comparing-vep-and-vap-turnout"><span class="toc-section-number">2.5</span> Comparing VEP and VAP turnout</a>
<ul>
<li><a href="#creating-new-variables-in-r"><span class="toc-section-number">2.5.1</span> Creating new variables in R</a></li>
</ul></li>
<li><a href="#comparing-presidential-vs.-midterm-turnout"><span class="toc-section-number">2.6</span> Comparing Presidential vs. Midterm turnout</a>
<ul>
<li><a href="#r-shortcut-for-writing-vectors"><span class="toc-section-number">2.6.1</span> R shortcut for writing vectors</a></li>
</ul></li>
</ul></li>
<li><a href="#causation1"><span class="toc-section-number">3</span> Causation with Experiments</a>
<ul>
<li><a href="#what-separates-causation-from-correlation"><span class="toc-section-number">3.1</span> What separates causation from correlation?</a>
<ul>
<li><a href="#potential-outcomes-framework"><span class="toc-section-number">3.1.1</span> Potential Outcomes Framework</a></li>
<li><a href="#causal-effects"><span class="toc-section-number">3.1.2</span> Causal Effects</a></li>
<li><a href="#fundamental-problem-of-causal-inference"><span class="toc-section-number">3.1.3</span> Fundamental Problem of Causal Inference</a></li>
</ul></li>
<li><a href="#randomized-controlled-trials"><span class="toc-section-number">3.2</span> Randomized Controlled Trials</a>
<ul>
<li><a href="#experiments-why-randomize"><span class="toc-section-number">3.2.1</span> Experiments: Why Randomize?</a></li>
<li><a href="#experiments-how-to-analyze"><span class="toc-section-number">3.2.2</span> Experiments: How to Analyze</a></li>
<li><a href="#ingredients-of-an-experiment"><span class="toc-section-number">3.2.3</span> Ingredients of an Experiment</a></li>
</ul></li>
<li><a href="#application-is-there-racial-discrimination-in-the-labor-market"><span class="toc-section-number">3.3</span> Application: Is there racial discrimination in the labor market?</a>
<ul>
<li><a href="#variable-classes"><span class="toc-section-number">3.3.1</span> Variable classes</a></li>
</ul></li>
<li><a href="#making-tables"><span class="toc-section-number">3.4</span> Making tables</a>
<ul>
<li><a href="#crosstabulation"><span class="toc-section-number">3.4.1</span> Crosstabulation</a></li>
</ul></li>
<li><a href="#conditional-means"><span class="toc-section-number">3.5</span> Conditional Means</a></li>
<li><a href="#relational-operators-in-r"><span class="toc-section-number">3.6</span> Relational Operators in R</a></li>
<li><a href="#subsetting-data-in-r"><span class="toc-section-number">3.7</span> Subsetting data in R</a>
<ul>
<li><a href="#getting-booooooooolean"><span class="toc-section-number">3.7.1</span> Getting Booooooooolean</a></li>
</ul></li>
<li><a href="#creating-new-variables-using-conditional-statements"><span class="toc-section-number">3.8</span> Creating New Variables using Conditional statements</a>
<ul>
<li><a href="#ifelse-statements"><span class="toc-section-number">3.8.1</span> ifelse statements</a></li>
</ul></li>
<li><a href="#types-of-experiments"><span class="toc-section-number">3.9</span> Types of Experiments</a></li>
</ul></li>
<li><a href="#visualization"><span class="toc-section-number">4</span> Visualization</a>
<ul>
<li><a href="#application-social-status-and-economic-views"><span class="toc-section-number">4.1</span> Application: Social Status and Economic Views</a></li>
<li><a href="#boxplots"><span class="toc-section-number">4.2</span> Boxplots</a>
<ul>
<li><a href="#data-summary-boxplot"><span class="toc-section-number">4.2.1</span> Data Summary: Boxplot</a></li>
</ul></li>
<li><a href="#barplots"><span class="toc-section-number">4.3</span> Barplots</a>
<ul>
<li><a href="#saving-plots"><span class="toc-section-number">4.3.1</span> Saving Plots</a></li>
<li><a href="#creating-new-variables"><span class="toc-section-number">4.3.2</span> Creating New Variables</a></li>
</ul></li>
<li><a href="#application-changing-minds-on-gay-marriage"><span class="toc-section-number">4.4</span> Application: Changing Minds on Gay Marriage</a>
<ul>
<li><a href="#creating-new-variable"><span class="toc-section-number">4.4.1</span> Creating new variable</a></li>
<li><a href="#using-ifelse-to-create-new-variable"><span class="toc-section-number">4.4.2</span> Using ifelse to create new variable</a></li>
<li><a href="#calculating-the-average-treatment-effect"><span class="toc-section-number">4.4.3</span> Calculating the Average Treatment Effect</a></li>
<li><a href="#visualize-means-in-a-barplot"><span class="toc-section-number">4.4.4</span> Visualize means in a barplot</a></li>
</ul></li>
<li><a href="#scatterplots"><span class="toc-section-number">4.5</span> Scatterplots</a></li>
<li><a href="#histograms"><span class="toc-section-number">4.6</span> Histograms</a>
<ul>
<li><a href="#happy-research-ending"><span class="toc-section-number">4.6.1</span> Happy research ending</a></li>
</ul></li>
<li><a href="#application-trends-during-covid"><span class="toc-section-number">4.7</span> Application: Trends during COVID</a></li>
<li><a href="#line-plots-in-r"><span class="toc-section-number">4.8</span> Line Plots in R</a></li>
<li><a href="#causal-claims-from-before-vs.-after-comparisons"><span class="toc-section-number">4.9</span> Causal claims from before vs. after comparisons</a></li>
<li><a href="#visual-tips-and-tricks"><span class="toc-section-number">4.10</span> Visual tips and tricks</a></li>
<li><a href="#common-r-plotting-functions-and-arguments"><span class="toc-section-number">4.11</span> Common R plotting functions and arguments</a></li>
<li><a href="#a-note-on-ggplot"><span class="toc-section-number">4.12</span> A note on <code>ggplot</code></a></li>
</ul></li>
<li><a href="#causalityii"><span class="toc-section-number">5</span> Causality with Non-Experimental Data</a>
<ul>
<li><a href="#why-cant-we-always-experiment"><span class="toc-section-number">5.1</span> Why can’t we always experiment?</a>
<ul>
<li><a href="#what-can-we-do-instead"><span class="toc-section-number">5.1.1</span> What can we do instead?</a></li>
</ul></li>
<li><a href="#causal-identification-strategies"><span class="toc-section-number">5.2</span> Causal Identification Strategies</a>
<ul>
<li><a href="#three-common-identification-strategies"><span class="toc-section-number">5.2.1</span> Three Common Identification Strategies</a></li>
<li><a href="#threats-to-cross-section-designs"><span class="toc-section-number">5.2.2</span> Threats to Cross-Section Designs</a></li>
<li><a href="#threats-to-before-after-designs"><span class="toc-section-number">5.2.3</span> Threats to Before-After Designs</a></li>
<li><a href="#threats-to-diff-in-diff-designs"><span class="toc-section-number">5.2.4</span> Threats to Diff-in-Diff Designs</a></li>
</ul></li>
<li><a href="#application-economic-effects-of-basque-terrorism"><span class="toc-section-number">5.3</span> Application: Economic Effects of Basque Terrorism</a>
<ul>
<li><a href="#applying-3-identification-strategies"><span class="toc-section-number">5.3.1</span> Applying 3 Identification Strategies</a></li>
</ul></li>
<li><a href="#placebo-tests"><span class="toc-section-number">5.4</span> Placebo Tests</a></li>
<li><a href="#wrapping-up-causality"><span class="toc-section-number">5.5</span> Wrapping Up Causality</a></li>
</ul></li>
<li><a href="#loops"><span class="toc-section-number">6</span> Loops in R</a>
<ul>
<li><a href="#the-anatomy-of-a-loop"><span class="toc-section-number">6.1</span> The anatomy of a loop</a>
<ul>
<li><a href="#the-key-parts-of-a-loop"><span class="toc-section-number">6.1.1</span> The key parts of a loop</a></li>
<li><a href="#a-short-example"><span class="toc-section-number">6.1.2</span> A short example</a></li>
<li><a href="#troubleshooting-a-loop"><span class="toc-section-number">6.1.3</span> Troubleshooting a loop</a></li>
<li><a href="#your-turn"><span class="toc-section-number">6.1.4</span> Your turn</a></li>
</ul></li>
<li><a href="#application-u.s.-supreme-court"><span class="toc-section-number">6.2</span> Application: U.S. Supreme Court</a>
<ul>
<li><a href="#troubleshooting-the-loop"><span class="toc-section-number">6.2.1</span> Troubleshooting the loop</a></li>
<li><a href="#visualizing-the-results"><span class="toc-section-number">6.2.2</span> Visualizing the Results</a></li>
<li><a href="#enhancing-the-plot"><span class="toc-section-number">6.2.3</span> Enhancing the plot</a></li>
<li><a href="#wrapping-up"><span class="toc-section-number">6.2.4</span> Wrapping Up</a></li>
</ul></li>
</ul></li>
<li><a href="#prediction"><span class="toc-section-number">7</span> Prediction</a>
<ul>
<li><a href="#prediction-overview"><span class="toc-section-number">7.1</span> Prediction Overview</a></li>
<li><a href="#process-of-prediction"><span class="toc-section-number">7.2</span> Process of Prediction</a></li>
<li><a href="#example-forecasting-2020-us-election-based-on-2016-results"><span class="toc-section-number">7.3</span> Example: Forecasting 2020 US Election based on 2016 Results</a>
<ul>
<li><a href="#choose-approach"><span class="toc-section-number">7.3.1</span> Choose Approach</a></li>
<li><a href="#assess-accuracy"><span class="toc-section-number">7.3.2</span> Assess Accuracy</a></li>
<li><a href="#iterate-to-improve-predictions"><span class="toc-section-number">7.3.3</span> Iterate to improve predictions</a></li>
</ul></li>
<li><a href="#example-using-polls-to-predict-the-2020-election-results"><span class="toc-section-number">7.4</span> Example: Using polls to predict the 2020 election results</a>
<ul>
<li><a href="#choose-an-approach-lets-analyze-some-polls"><span class="toc-section-number">7.4.1</span> Choose an approach: Let’s analyze some polls</a></li>
<li><a href="#loop-through-all-states"><span class="toc-section-number">7.4.2</span> Loop through all states</a></li>
<li><a href="#check-accuracy"><span class="toc-section-number">7.4.3</span> Check Accuracy</a></li>
</ul></li>
</ul></li>
<li><a href="#regression"><span class="toc-section-number">8</span> Prediction with Regression</a>
<ul>
<li><a href="#regression-in-the-wild."><span class="toc-section-number">8.1</span> Regression in the wild.</a></li>
<li><a href="#application-baseball-predictions"><span class="toc-section-number">8.2</span> Application: Baseball Predictions</a></li>
<li><a href="#step-1-approach--regression-in-r"><span class="toc-section-number">8.3</span> Step 1: Approach- Regression in R</a>
<ul>
<li><a href="#visualizing-a-regression"><span class="toc-section-number">8.3.1</span> Visualizing a regression</a></li>
<li><a href="#making-predictions-with-regression"><span class="toc-section-number">8.3.2</span> Making predictions with regression</a></li>
</ul></li>
<li><a href="#step-2-checking-accuracy-of-model"><span class="toc-section-number">8.4</span> Step 2: Checking accuracy of model</a>
<ul>
<li><a href="#root-mean-squared-error"><span class="toc-section-number">8.4.1</span> Root Mean Squared Error</a></li>
</ul></li>
<li><a href="#step-3-iterate-and-compare-models"><span class="toc-section-number">8.5</span> Step 3: Iterate and Compare Models</a>
<ul>
<li><a href="#regression-with-multiple-predictors"><span class="toc-section-number">8.5.1</span> Regression with Multiple Predictors</a></li>
</ul></li>
<li><a href="#application-predicting-campaign-donations"><span class="toc-section-number">8.6</span> Application: Predicting Campaign Donations</a>
<ul>
<li><a href="#visualizing-the-results-1"><span class="toc-section-number">8.6.1</span> Visualizing the results</a></li>
<li><a href="#step-1-calculate-predictions"><span class="toc-section-number">8.6.2</span> Step 1: Calculate Predictions</a></li>
<li><a href="#step-2-check-accuracy"><span class="toc-section-number">8.6.3</span> Step 2: Check Accuracy</a></li>
<li><a href="#step-3-iterate"><span class="toc-section-number">8.6.4</span> Step 3: Iterate</a></li>
<li><a href="#adding-model-predictors"><span class="toc-section-number">8.6.5</span> Adding Model Predictors</a></li>
</ul></li>
<li><a href="#uncertainty-with-prediction"><span class="toc-section-number">8.7</span> Uncertainty with Prediction</a>
<ul>
<li><a href="#example-butterfly-ballot-in-florida"><span class="toc-section-number">8.7.1</span> Example: Butterfly Ballot in Florida</a></li>
<li><a href="#multiple-predictors"><span class="toc-section-number">8.7.2</span> Multiple Predictors</a></li>
<li><a href="#confidence-intervals"><span class="toc-section-number">8.7.3</span> Confidence Intervals</a></li>
</ul></li>
<li><a href="#cross-validation"><span class="toc-section-number">8.8</span> Cross-Validation</a>
<ul>
<li><a href="#cross-validation-process"><span class="toc-section-number">8.8.1</span> Cross-Validation Process</a></li>
<li><a href="#application-forecasting-election-results"><span class="toc-section-number">8.8.2</span> Application: Forecasting Election Results</a></li>
</ul></li>
</ul></li>
<li><a href="#fairness"><span class="toc-section-number">9</span> Fairness and Ethics</a>
<ul>
<li><a href="#application-criminal-justice"><span class="toc-section-number">9.1</span> Application: Criminal Justice</a>
<ul>
<li><a href="#load-data"><span class="toc-section-number">9.1.1</span> Load data</a></li>
<li><a href="#predictionclassification-process"><span class="toc-section-number">9.1.2</span> Prediction/Classification process</a></li>
<li><a href="#step-1-regression-model"><span class="toc-section-number">9.1.3</span> Step 1: Regression Model</a></li>
<li><a href="#step-2-check-accuracy-1"><span class="toc-section-number">9.1.4</span> Step 2: Check Accuracy</a></li>
</ul></li>
<li><a href="#taking-fairness-seriously"><span class="toc-section-number">9.2</span> Taking Fairness Seriously</a>
<ul>
<li><a href="#extended-learning"><span class="toc-section-number">9.2.1</span> Extended Learning</a></li>
</ul></li>
</ul></li>
<li><a href="#uncertainty"><span class="toc-section-number">10</span> Uncertainty</a>
<ul>
<li><a href="#hypothesis-testing-overview-of-process"><span class="toc-section-number">10.1</span> Hypothesis Testing Overview of Process</a></li>
<li><a href="#sampling-and-uncertainty"><span class="toc-section-number">10.2</span> Sampling and Uncertainty</a>
<ul>
<li><a href="#sampling-distribution"><span class="toc-section-number">10.2.1</span> Sampling Distribution</a></li>
</ul></li>
<li><a href="#z-scores-and-p-values"><span class="toc-section-number">10.3</span> Z-scores and p-values</a>
<ul>
<li><a href="#relationship-to-confidence-intervals"><span class="toc-section-number">10.3.1</span> Relationship to Confidence Intervals</a></li>
</ul></li>
<li><a href="#wrapping-up-the-process"><span class="toc-section-number">10.4</span> Wrapping up the Process</a></li>
<li><a href="#application-health-savings-study"><span class="toc-section-number">10.5</span> Application: Health Savings Study</a></li>
<li><a href="#additional-applications"><span class="toc-section-number">10.6</span> Additional Applications</a>
<ul>
<li><a href="#example-using-regression"><span class="toc-section-number">10.6.1</span> Example Using Regression</a></li>
<li><a href="#example-using-prop.test"><span class="toc-section-number">10.6.2</span> Example Using prop.test()</a></li>
</ul></li>
<li><a href="#in-class-exercise-questions"><span class="toc-section-number">10.7</span> In-Class Exercise Questions</a></li>
</ul></li>
<li><a href="#text"><span class="toc-section-number">11</span> Text as Data</a>
<ul>
<li><a href="#why-text"><span class="toc-section-number">11.1</span> Why text?</a></li>
<li><a href="#r-packages-for-text"><span class="toc-section-number">11.2</span> R Packages for text</a></li>
<li><a href="#application-state-of-the-union"><span class="toc-section-number">11.3</span> Application: State of the Union</a>
<ul>
<li><a href="#cleaning-text"><span class="toc-section-number">11.3.1</span> Cleaning Text</a></li>
<li><a href="#preparing-a-corpus"><span class="toc-section-number">11.3.2</span> Preparing a Corpus</a></li>
<li><a href="#word-frequency"><span class="toc-section-number">11.3.3</span> Word Frequency</a></li>
</ul></li>
<li><a href="#word-importance"><span class="toc-section-number">11.4</span> Word Importance</a></li>
<li><a href="#additional-descriptive-statistics"><span class="toc-section-number">11.5</span> Additional Descriptive Statistics</a>
<ul>
<li><a href="#dictionary-analysis"><span class="toc-section-number">11.5.1</span> Dictionary Analysis</a></li>
</ul></li>
<li><a href="#application-programming-interfaces"><span class="toc-section-number">11.6</span> Application Programming Interfaces</a>
<ul>
<li><a href="#twitter-api-v1"><span class="toc-section-number">11.6.1</span> Twitter API v1</a></li>
<li><a href="#saving-r-objects"><span class="toc-section-number">11.6.2</span> Saving R Objects</a></li>
</ul></li>
<li><a href="#application-sentiment-analysis"><span class="toc-section-number">11.7</span> Application: Sentiment Analysis</a>
<ul>
<li><a href="#searching-tweets-for-keywords"><span class="toc-section-number">11.7.1</span> Searching tweets for keywords</a></li>
<li><a href="#sentiment-analysis-overview"><span class="toc-section-number">11.7.2</span> Sentiment Analysis Overview</a></li>
<li><a href="#implementing-sentiment-analysis"><span class="toc-section-number">11.7.3</span> Implementing sentiment analysis</a></li>
<li><a href="#your-twitter-analysis"><span class="toc-section-number">11.7.4</span> Your Twitter Analysis</a></li>
</ul></li>
</ul></li>
<li><a href="#maps"><span class="toc-section-number">12</span> Mapping</a>
<ul>
<li><a href="#why-maps"><span class="toc-section-number">12.1</span> Why maps</a>
<ul>
<li><a href="#to-map-or-not-to-map"><span class="toc-section-number">12.1.1</span> To map or not to map?</a></li>
</ul></li>
<li><a href="#mapping-in-r"><span class="toc-section-number">12.2</span> Mapping in R</a>
<ul>
<li><a href="#using-ggplot2-with-maps"><span class="toc-section-number">12.2.1</span> Using ggplot2 with maps</a></li>
</ul></li>
<li><a href="#choropleth-maps"><span class="toc-section-number">12.3</span> Choropleth Maps</a></li>
<li><a href="#application-2021-nj-election-results"><span class="toc-section-number">12.4</span> Application: 2021 NJ Election Results</a></li>
<li><a href="#application-voter-identification-laws"><span class="toc-section-number">12.5</span> Application: Voter Identification Laws</a>
<ul>
<li><a href="#using-the-in-function"><span class="toc-section-number">12.5.1</span> Using the <code>%in%</code> function</a></li>
</ul></li>
<li><a href="#your-turn-to-map"><span class="toc-section-number">12.6</span> Your turn to map</a></li>
<li><a href="#application-terrorist-attacks-in-france"><span class="toc-section-number">12.7</span> Application: Terrorist Attacks in France</a>
<ul>
<li><a href="#adding-points-to-a-map"><span class="toc-section-number">12.7.1</span> Adding points to a map</a></li>
</ul></li>
<li><a href="#animating-data"><span class="toc-section-number">12.8</span> Animating Data</a></li>
<li><a href="#application-spread-of-coronavirus"><span class="toc-section-number">12.9</span> Application: Spread of Coronavirus</a>
<ul>
<li><a href="#mapping-animation-with-world-map"><span class="toc-section-number">12.9.1</span> Mapping Animation with World Map</a></li>
</ul></li>
<li><a href="#application-territorial-control-of-syria"><span class="toc-section-number">12.10</span> Application: Territorial Control of Syria</a></li>
</ul></li>
<li><a href="#choose"><span class="toc-section-number">13</span> Choose Your Own Adventure</a>
<ul>
<li><a href="#get-to-know-new-data"><span class="toc-section-number">13.1</span> Get to know new data</a>
<ul>
<li><a href="#dealing-with-uninformative-variable-names"><span class="toc-section-number">13.1.1</span> Dealing with Uninformative Variable Names</a></li>
<li><a href="#dealing-with-missing-data"><span class="toc-section-number">13.1.2</span> Dealing with Missing Data</a></li>
<li><a href="#dealing-with-variable-codings-that-arent-quite-right"><span class="toc-section-number">13.1.3</span> Dealing with Variable Codings that Aren’t Quite Right</a></li>
<li><a href="#dealing-with-parts-of-datasets"><span class="toc-section-number">13.1.4</span> Dealing with Parts of Datasets</a></li>
</ul></li>
</ul></li>
</ul>
<!--bookdown:toc2:end-->
      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Data Science for Political Science</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<!--bookdown:toc:end-->
<!--bookdown:body:start-->
<div id="course-notes" class="section level1" number="1">
<h1><span class="header-section-number">1</span> Course Notes</h1>
<p>This document will include important links and course notes for 01:790:391:01: Data Science for Political Science.</p>
<ul>
<li>This site will be updated throughout the semester with new content.</li>
<li>The Canvas modules will provide links to the relevant sections to review for a given week of the course.</li>
<li>The primary text for the course is <a href="https://qss.princeton.press/qss-an-introduction/">Quantitative Social Science: An Introduction</a> by Kosuke Imai. We will refer to this as QSS in the notes.</li>
<li>This is a new and living document. If you spot errors or have questions or suggestions, please email me at <a href="mailto:k.mccabe@rutgers.edu" class="email">k.mccabe@rutgers.edu</a> or post to the course Piazza site.</li>
<li>Occasionally the notes are updated with embedded video explainers of the code in different sections. A list of these is <a href="https://www.youtube.com/watch?v=80tbdiWuljc&amp;list=PLx0unV_UpWcXDDBO2Bg5Cf6N4m0_LKULl&amp;ab_channel=kt2mccabe">here</a>.</li>
</ul>
<!-- If you need PDF output, uncomment bookdown::pdf_book above in YAML. You will need a LaTeX installation, e.g., https://yihui.name/tinytex/ -->
<!-- Instructions: https://ontheline.trincoll.edu/bookdown.html -->
<div id="what-have-i-signed-up-for" class="section level2" number="1.1">
<h2><span class="header-section-number">1.1</span> What have I signed up for?</h2>
<p>First: What is Data Science?</p>
<ul>
<li>Data Science involves a combination of math/statistics and programming/coding skills, which, for our purposes, we will combine with social science knowledge.
<ul>
<li><a href="http://drewconway.com/zia/2013/3/26/the-data-science-venn-diagram">Drew Conway</a> has a nice venn diagram of how these different skill sets intersect.</li>
<li>Note: This course will not assume prior familiarity with data science in general or coding, specifically. For those brand new to data science, the idea of learning to code may seem intimidating, but anyone can succeed with a bit of patience and an open mind.</li>
</ul></li>
</ul>
<p><img src="images/venn.png" /></p>
<p>Next: What is political science?</p>
<ul>
<li>The science of politics, of course! Politics focuses on studying governance and the distribution of power in society, broadly conceived.
<ul>
<li>How else might you define politics and political science? What do we study in political science?</li>
</ul></li>
</ul>
<div id="data-science-can-help-social-scientists" class="section level3" number="1.1.1">
<h3><span class="header-section-number">1.1.1</span> Data Science Can Help Social Scientists</h3>
<p><strong><em>Example: Mapping poverty using mobile phone and satellite data</em></strong></p>
<p>Researchers used modern data sources, including mobile phone data, as a way to <strong><em>predict</em></strong> and <strong><em>describe</em></strong> poverty in different geographic regions. These tools helped social scientists come up with methods that are much more cost-effective and efficient, but still as accurate as traditional methods for this type of measurement.</p>
<ul>
<li>How might measures of global poverty be useful to political scientists?</li>
</ul>
<p><img src="images/blum.jpg" style="width:90.0%" /></p>
<p><em><a href="https://royalsocietypublishing.org/doi/full/10.1098/rsif.2016.0690">Steele et al. 2017</a>: Poverty is one of the most important determinants of adverse health outcomes globally, a major cause of societal instability and one of the largest causes of lost human potential. Traditional approaches to measuring and targeting poverty rely heavily on census data, which in most low- and middle-income countries (LMICs) are unavailable or out-of-date. Alternate measures are needed to complement and update estimates between censuses. This study demonstrates how public and private data sources that are commonly available for LMICs can be used to provide novel insight into the spatial distribution of poverty.</em></p>
<p><strong><em>Social Science Goals</em></strong></p>
<p>We have several goals in social science. Here are four that data science can help us pursue:</p>
<ul>
<li><strong>Describe</strong> and measure
<ul>
<li>Has the U.S. population increased?</li>
</ul></li>
<li><strong>Explain</strong>, evaluate, and recommend (study of causation)
<ul>
<li>Does expanding Medicaid improve health outcomes?</li>
</ul></li>
<li><strong>Predict</strong>
<ul>
<li>Who will win the next election?</li>
</ul></li>
<li><strong>Discover</strong>
<ul>
<li>How do policies diffuse across states?</li>
</ul></li>
</ul>
<p>What are other examples of these goals?</p>
<p>Note: In this course, we are exploiting the benefits of quantitative data to help achieve goals of social science. However, quantitative data have their shortcomings, too. We will also discuss the limitations of various applications of social science data, and we encourage you to always think critically about how we are using data.</p>
</div>
<div id="course-goals" class="section level3" number="1.1.2">
<h3><span class="header-section-number">1.1.2</span> Course Goals</h3>
<p>This course will provide you with a taste of each of these social science goals, and how the use of data can help achieve these goals. By the end of the course, you should be able to</p>
<ul>
<li>Provide examples of how quantitative data may be used to help answer social science research questions.</li>
<li>Compare and contrast the goals of description, causation, prediction, and discovery in social science research.</li>
<li>Use the programming language R to import and explore social science data and conduct basic statistical analyses.</li>
<li>Interpret and describe visual displays of social science data, such as graphs and maps.</li>
<li>Develop your own analyses and visualizations to understand social science phenomena.</li>
</ul>
<p>If you are someone that loves data, we hope you will find this course engaging. If you are someone who loathes or finds the idea of working with data and statistics alarming, we hope you keep an open mind. We will meet you where you are. This course will not assume knowledge of statistical software, and there will be plenty of opportunities to ask questions and seek help from classmates and the instructor throughout the semester.</p>
<p>The first section of course will walk people through how to use the statistical program– R– that we will employ this semester.</p>
<p><strong><em>Will this course help me in the future?</em></strong></p>
<p>Even if you do not plan on becoming a social scientist or a data scientist, an introduction to these skills may prove helpful throughout your academic and professional careers.</p>
<ul>
<li>To become an informed consumer of news articles and research involving quantitative analyses.</li>
<li>To practice analytical thinking to make informed arguments and decisions.</li>
<li>To expand your toolkit for getting a job that may involve consuming or performing some data analysis, even if that is not the traditional role.
<ul>
<li>Example: Journalism- <a href="https://www.nytimes.com/2019/06/12/reader-center/data-reporting-spreadsheets.html">How 5 Data Dynamos Do Their Jobs</a></li>
</ul></li>
</ul>
</div>
</div>
<div id="rsetup" class="section level2" number="1.2">
<h2><span class="header-section-number">1.2</span> Setup in R</h2>
<p><strong>Goal</strong></p>
<p>By the end of the first week of the course, you will want to have R and RStudio installed on your computer (both free) and feel comfortable using R as a calculator.</p>
<p>R is an application that processes the R programming language in a statistical computing environment. RStudio is also an application, which serves as a user interface that makes working in R easier. We will primarily open and use RStudio to work with R.</p>
<p>In other classes, you may come across Stata, SPSS, Excel, or SAS, which are programs that also conduct data analysis. R has the advantage of being free and open-source. Even after you leave the university setting, you will be able to use R/RStudio for free. As an open-source program, it is very flexible, and a community of active R/RStudio users is constantly adding to and improving the program.</p>
<p><strong>R and RStudio Installation</strong></p>
<p>This content follows and reinforces QSS 1.3. Additional resources are also linked below.</p>
<ul>
<li>This <a href="http://www.youtube.com/embed/ulIv0NiVTs4?rel=0">video</a> from Professor Christopher Bail explains why many social scientists use R and describes the R and RStudio installation process. This involves
<ol style="list-style-type: decimal">
<li>Going to <a href="https://cran.r-project.org/">cran</a>, select the link that matches your operating system, and
then follow the installation instructions, and</li>
<li>Visiting <a href="http://www.rstudio.com/">RStudio</a> and follow the download and installation instructions. R is the statistical software and programming language used for analysis. RStudio provides a convenient user interface for running R code.</li>
</ol></li>
</ul>
<div class="vembedr">
<div>
<iframe src="https://www.youtube.com/embed/ulIv0NiVTs4" width="533" height="300" frameborder="0" allowfullscreen=""></iframe>
</div>
</div>
</div>
<div id="first-time-working-in-r-and-rstudio" class="section level2" number="1.3">
<h2><span class="header-section-number">1.3</span> First Time Working in R and RStudio</h2>
<p>This next section provides a few notes on using R and RStudio now that you have installed it. In this section, we cover the following materials:</p>
<ul>
<li>Using R as a calculator and assigning objects using <code>&lt;-</code></li>
<li>Setting your working directory and the <code>setwd()</code> function.</li>
<li>Creating and saving an R script</li>
</ul>
<p>This section highlights important concepts from QSS chapter 1.</p>
<div id="open-rstudio" class="section level3" number="1.3.1">
<h3><span class="header-section-number">1.3.1</span> Open RStudio</h3>
<p>RStudio is an open-source and free program that greatly facilitates the use of R, especially for users new to programming. Once you have downloaded and installed R and RStudio, to work in R, all you need to do now is <strong><em>open RStudio</em></strong> (it will open R). It should look like this, though your version numbers will be different:</p>
<p><img src="images/rconsole1.png" /></p>
<p><strong>Note:</strong> The first time you open RStudio, you likely only have the three windows above. We will want to create a fourth window by <strong>opening an R script</strong> to create the fourth window.</p>
<ul>
<li>To do this, in RStudio, click on File -&gt; New -&gt; R script in your computer’s toolbar. This will open a blank document for text editing in the upper left of the RStudio window. We will return to this window in a moment.
<ul>
<li>You can alternatively click on the green + sign indicator in the top-left corner of the RStudio window, which should give you the option to create a new R script document.</li>
</ul></li>
</ul>
<p>Now you should have something that looks like this, similar to Figure 1.1. in QSS:</p>
<p><img src="images/rconsole2.png" /></p>
<ul>
<li>The upper-left window has our script document that will contain code.</li>
<li>The lower-left window is the console. This will show the output of the code we run. We will also be able to type directly in the console.</li>
<li>The upper-right window shows the environment (and other tabs, such as the history of commands). When we load and store data in RStudio, we will see a summary of that in the environment.</li>
<li>The lower-right window will enable us to view plots and search help files, among other things.</li>
</ul>
</div>
<div id="using-r-as-a-calculator" class="section level3" number="1.3.2">
<h3><span class="header-section-number">1.3.2</span> Using R as a Calculator</h3>
<p>The <em>bottom left</em> window in your RStudio is the Console. You can type in this window to use R as a calculator or to try out commands. It will show the raw output of any commands you type. For example, we can try to use R as a calculator. Type the following in the Console (the bottom left window) and hit “enter” or “return” on your keyboard:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span> <span class="sc">+</span> <span class="dv">3</span></span></code></pre></div>
<pre><code>## [1] 8</code></pre>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span> <span class="sc">-</span> <span class="dv">3</span></span></code></pre></div>
<pre><code>## [1] 2</code></pre>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span><span class="sc">^</span><span class="dv">2</span></span></code></pre></div>
<pre><code>## [1] 25</code></pre>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span> <span class="sc">*</span> <span class="dv">3</span></span></code></pre></div>
<pre><code>## [1] 15</code></pre>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span><span class="sc">/</span><span class="dv">3</span></span></code></pre></div>
<pre><code>## [1] 1.666667</code></pre>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>(<span class="dv">5</span> <span class="sc">+</span> <span class="dv">3</span>) <span class="sc">*</span> <span class="dv">2</span></span></code></pre></div>
<pre><code>## [1] 16</code></pre>
<p>In the other RStudio windows, the upper right will show a history of commands that you have sent from the text editor to the R console, along with other items. The lower right will show graphs, help documents and other features. These will be useful later in the course.</p>
</div>
<div id="working-in-an-r-script" class="section level3" number="1.3.3">
<h3><span class="header-section-number">1.3.3</span> Working in an R Script</h3>
<p>Earlier, I asked you to open an R script in the upper left window by doing File, then New File, then R Script. Let’s go back to working in that window.</p>
<p><strong>Set your working directory <code>setwd()</code></strong></p>
<p>(Almost) every time you work in RStudio, the first thing you will do is set your working directory. This is a designated folder in your computer where you will save your R scripts and datasets.</p>
<p>There are many ways to do this.</p>
<ul>
<li>An easy way is to go to Session -&gt; Set Working Directory -&gt; Choose Directory. I suggest choosing a folder in your computer that you can easily find and that you will routinely use for this class. Go ahead and create/select it.</li>
<li>Note: when you selected your directory, code came out in the bottom left Console window. This is the <code>setwd()</code> command which can also be used directly to set your working directory in the future.</li>
<li>If you aren’t sure where your directory has been set, you can also type <code>getwd()</code> in your Console. Try it now</li>
</ul>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Example of where my directory was</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">getwd</span>()</span></code></pre></div>
<p>If I want to change the working directory, I can go to the top toolbar of my computer and use Session -&gt; Set Working Directory -&gt; Choose Directory or just type my file pathway using the <code>setwd()</code> below:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Example of setting the working directory using setwd().</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Your computer will have your own file path.</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(<span class="st">&quot;/Users/ktmccabe/Dropbox/Rutgers Teaching/&quot;</span>)</span></code></pre></div>
<p><strong>Saving the R Script</strong></p>
<p>Let’s now save our R script to our working directory and give it an informative name. To do so, go to File, then Save As, make sure you are in the same folder on your computer as the folder you chose for your working directory.</p>
<p>Give the file an informative name, such as: “McCabeWeek1.R”. Note: all of your R scripts will have the .R extension.</p>
</div>
<div id="preparing-your-r-script" class="section level3" number="1.3.4">
<h3><span class="header-section-number">1.3.4</span> Preparing your R script</h3>
<p>Now that we have saved our R script, let’s work inside of it. Remember, we are in the top-left RStudio window now.</p>
<ul>
<li>Just like the beginning of a paper, you will want to title your R script. In R, any line that you start with a # will not be treated as a programming command. You can use this to your advantage to write titles/comments. Below is a screenshot example of a template R script.</li>
<li>You can specify your working directory at the top, too. Add your own filepath inside <code>setwd()</code></li>
</ul>
<p><img src="images/templateR.png" /></p>
<ul>
<li>Then you can start answering problems in the rest of the script.</li>
<li>Think of the R script as where you write the final draft of your paper. In the Console (the bottom-left window), you can mess around and try different things, like you might when you are taking notes or outlining an essay. Then, write the final programming steps that lead you to your answer in the R script. For example, if I wanted to add 5 + 3, I might try different ways of typing it in the Console, and then when I found out <code>5 + 3</code> is the right approach, I would type that into my script.</li>
</ul>
</div>
<div id="executing-commands-in-your-r-script" class="section level3" number="1.3.5">
<h3><span class="header-section-number">1.3.5</span> Executing Commands in your R script</h3>
<p>The last thing we will note in this initial handout is how to execute commands in your R script.</p>
<p>To run / execute a command in your R script (the upper left window), you can</p>
<ol style="list-style-type: decimal">
<li>Highlight the code you want to run, and then hold down “command + return” on a Mac or “control + enter” on Windows</li>
<li>Place your cursor at the end of the line of code (far right), and hit “command + return” on a Mac or “control + return” on Windows, or</li>
<li>Do 1 or 2, but instead of using the keyboard to execute the commands, click “Run” in the top right corner of the upper-left window.</li>
</ol>
<p>Try it: Type <code>5 + 3</code> in the R script. Then, try to execute <code>5 + 3</code>. It should look something like this:</p>
<p><img src="images/rtemplate2.png" /></p>
<p>After you executed the code, you should see it pop out in your Console:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span> <span class="sc">+</span> <span class="dv">3</span></span></code></pre></div>
<pre><code>## [1] 8</code></pre>
<p><img src="images/runningcode.png" style="width:90.0%" /></p>
<p>Note: The symbol # also allows for annotation behind commands or on a separate line. Everything that follows # will be ignored by R. You can annotate your own code so that you and others can understand what each part of the code is designed to do.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Example</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>sum53 <span class="ot">&lt;-</span> <span class="dv">5</span> <span class="sc">+</span> <span class="dv">3</span> <span class="co"># example of assigning an addition calculation</span></span></code></pre></div>
</div>
<div id="objects" class="section level3" number="1.3.6">
<h3><span class="header-section-number">1.3.6</span> Objects</h3>
<p>Sometimes we will want to store our calculations as “objects” in R. We use <code>&lt;-</code> to assign objects by placing it <a href="https://www.youtube.com/watch?v=vLZA67L7gIo&amp;ab_channel=BeyonceSasha1">to the left</a> of what we want to store. For example, let’s store the calculation <code>5 + 3</code> as an object named <code>sum53</code>:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>sum53 <span class="ot">&lt;-</span> <span class="dv">5</span> <span class="sc">+</span> <span class="dv">3</span></span></code></pre></div>
<p>After we execute this code, <code>sum53 now stores the calculation. This means, that if we execute a line of code that just has</code>sum53`, it will output 8. Try it:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>sum53</span></code></pre></div>
<pre><code>## [1] 8</code></pre>
<p>Now we no longer have to type <code>5 + 3</code>, we can just type <code>sum53</code>. For example, let’s say we wanted to subtract 2 from this calculation. We could do:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>sum53 <span class="sc">-</span> <span class="dv">2</span></span></code></pre></div>
<pre><code>## [1] 6</code></pre>
<p>Let’s say we wanted to divide two stored calculations:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>ten <span class="ot">&lt;-</span> <span class="dv">5</span> <span class="sc">+</span> <span class="dv">5</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>two <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>ten <span class="sc">/</span> two</span></code></pre></div>
<pre><code>## [1] 5</code></pre>
<p>The information stored does not have to be numeric. For example, it can be a word, or what we would call a character string, in which case you need to use quotation marks.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>mccabe <span class="ot">&lt;-</span> <span class="st">&quot;professor for this course&quot;</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>mccabe</span></code></pre></div>
<pre><code>## [1] &quot;professor for this course&quot;</code></pre>
<p><em>Note:</em> Object names cannot begin with numbers and no spacing is allowed. Avoid using special characters such as % and $, which have specific meanings in R. Finally, use concise and intuitive object names.</p>
<ul>
<li>GOOD CODE: <code>practice.calc &lt;- 5 + 3</code></li>
<li>BAD CODE: <code>meaningless.and.unnecessarily.long.name &lt;- 5 + 3</code></li>
</ul>
<p>While these are simple examples, we will use objects all the time for more complicated things to store (e.g., like full datasets!) throughout the course.</p>
<p>We can also store an array or “vector” of information using <code>c()</code></p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>somenumbers <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">6</span>, <span class="dv">8</span>, <span class="dv">9</span>)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>somenumbers</span></code></pre></div>
<pre><code>## [1] 3 6 8 9</code></pre>
<p><strong>Importance of Clean Code</strong></p>
<p>Ideally, when you are done with your R script, you should be able to highlight the entire script and execute it without generating any error messages. This means your code is clean. Code with typos in it may generate a red error message in the Console upon execution. This can happen when there are typos or commands are misused.</p>
<p>For example, R is case sensitive. Let’s say we assigned our object like before:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>sum53 <span class="ot">&lt;-</span> <span class="dv">5</span> <span class="sc">+</span> <span class="dv">3</span></span></code></pre></div>
<p>However, when we went to execute <code>sum53</code>, we accidentally typed <code>Sum53</code>:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>Sum53</span></code></pre></div>
<pre><code>## Error in eval(expr, envir, enclos): object &#39;Sum53&#39; not found</code></pre>
<p>Only certain types of objects can be used in mathematical calculations. Let’s say we tried to divide <code>mccabe</code> by 2:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>mccabe <span class="sc">/</span> <span class="dv">2</span></span></code></pre></div>
<pre><code>## Error in mccabe/2: non-numeric argument to binary operator</code></pre>
<p>A big part of learning to use R will be learning how to troubleshoot and detect typos in your code that generate error messages.</p>
<p><img src="images/punctuation.png" style="width:80.0%" /></p>
</div>
</div>
<div id="assignment-1" class="section level2" number="1.4">
<h2><span class="header-section-number">1.4</span> Assignment 1</h2>
<p>Below is an exercise that will demonstrate you are able to use R as a calculator and create R scripts, as well as locate important course platforms.</p>
<p>We will walk through this assignment together during class, but you are welcome to try to do this ahead of time on your own. You will submit, on Canvas, two documents prior to the deadline.</p>
<ul>
<li>An R script (.R) file with your code. Follow the best practices by titling your script and using # comments to explain your steps. This code should be clean. I should be able to run your code to verify that the code produces the answers you write down.</li>
<li>A Word document / Google Docs document or pdf with answers to the written questions (Problems 3-6 below). This document should also have a title with your name on it.
<ul>
<li>You may also alternatively submit a compiled RMarkdown document. We will discuss what RMarkdown is during class.</li>
</ul></li>
</ul>
<p><strong><em>Assignment Exercises</em></strong></p>
<ol style="list-style-type: decimal">
<li>Create an R script saved as ``LastnameSetup1.R” (use your last name). Within the R script, follow the example from this handout and title the script.</li>
<li>Set your working directory, and include the file pathway (within <code>setwd()</code>) at the top of your .R script.</li>
<li>Do the calculation 8 + 3 - 2 in R. Store it as an object with an informative name. Report the answer.</li>
<li>Do the calculation 5 x 3 in R. Store it as an object with an informative name. Report the answer.</li>
<li>Add these two calculations together. Note: do this by adding together the objects you created, not the underlying raw calculations. Report the answer.</li>
<li>Write down how you will complete your R assignments this semester. For example, if you have a personal laptop with R and RStudio on it, you will simply write “I will use my personal laptop.” If you don’t have a personal computer or laptop, please indicate where on campus or off-campus you will have regular access to a computer with R/RStudio to do your work. It is essential that you have regular access to a computer so that you will not fall behind in this course.</li>
<li>Navigate to the course Piazza site and post a message. This can be as simple as “hello” or a reply to another person’s post. (No need to report this in your submission.)</li>
</ol>
</div>
<div id="r-markdown" class="section level2" number="1.5">
<h2><span class="header-section-number">1.5</span> R Markdown</h2>
<p>An R Markdown document, which you can create in RStudio, allows you to weave together regular text, R code, and the output of R code in the same document. This can be very convenient when conducting data analysis because it allows you more space to explain what you are doing in each step. It can also be an effective platform for writing a report on a data analysis, similar to what you do when you write up a problem set.</p>
<p><strong><em>Note: RMarkdown is not required for this course. It is up to you if you would like to write your problem sets in RMarkdown</em></strong></p>
<p>R Markdown documents can be “compiled” into html, pdf, or docx documents. Below is an example of what a compiled html file looks like.</p>
<ul>
<li>Note that the image has both written text and a gray chunk, within which there is some R code, as well as the output of the R code (e.g., the number 8 and the image of the histogram plot)</li>
</ul>
<center>
<img src="images/rmarkdownscreenshot.png" style="width:60.0%" />
</center>
<p>We say this is a “compiled” RMarkdown document because it differs from the raw version of the file, which is a .Rmd file format. Below is an example of what the raw .Rmd version looks like, compared to the compiled html version.</p>
<p><img src="images/rmarkdownraw.png" style="width:45.0%" /> <img src="images/rmarkdownscreenshot.png" style="width:40.0%" /></p>
<div id="how-to-get-setup-in-rmarkdown" class="section level3" number="1.5.1">
<h3><span class="header-section-number">1.5.1</span> How to get setup in RMarkdown</h3>
<p>Just like with a regular R script, to work in RMarkdown, you will open up RStudio.</p>
<p>The <strong>first time</strong> you will be working in RMarkdown, you will want to install two packages: <code>rmarkdown</code> and <code>knitr</code>. You can do this in the Console window in RStudio.</p>
<p>Type the following into the Console window and hit enter/return.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;rmarkdown&quot;</span>)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;knitr&quot;</span>)</span></code></pre></div>
<p>Once you have those installed, now, each time you want to create an RMarkdown document, you will open up a .Rmd R Markdown file and get to work.</p>
<ol style="list-style-type: decimal">
<li>Go to File -&gt; New File -&gt; R Markdown in RStudio
<ul>
<li>Alternatively, you can click the green + symbol at the top left of your RStudio window</li>
</ul></li>
<li>This should open up a window with several options, similar to the image below
<ul>
<li>Create an informative title and change the author name to match your own</li>
<li>For now, we will keep the file type as html. In the future, you can create pdf or .doc documents. However, these require additional programs installed on your computer.</li>
</ul></li>
</ol>
<p><img src="images/rmarkdownnewfile.png" /></p>
<ol start="3" style="list-style-type: decimal">
<li>After you hit “OK” a new .Rmd script file will open in your top-left window with some template language and code chunks, similar to the image below.</li>
</ol>
<p><img src="images/rmarkdowntemplate.png" /></p>
<ol start="4" style="list-style-type: decimal">
<li><strong><em>Save as .Rmd file.</em></strong> Save the file by going to “File -&gt; Save as” in RStudio
<ul>
<li>Give the file an informative name like your LastnamePractice1.Rmd</li>
</ul></li>
<li><strong><em>Key Components.</em></strong> Now you are ready to work within the Rmd script file. We will point to four basic components of this file, and you can build your knowledge of RMarkdown from there.
<ol style="list-style-type: decimal">
<li>The top part bracketed by <code>---</code> on top and bottom is the YAML component. This tells RStudio the pertinent information about how to “compile” the Rmd file. Most of the time you can leave this alone, but you can always edit the title, author, or date as you wish.</li>
<li>The next component are the global options for the document. It is conveniently labeled “setup.” By default what this is saying is that the compiled version will “echo” (i.e., display all code chunks and output) unless you specifically specify otherwise. For example, note that it says <code>include = FALSE</code> for the setup chunk. That setting means that this code chunk will “run” but it will not appear in the nicely compiled .html file. Most of the time you will not need to edit those settings.</li>
<li>The third component I want to bring attention to is the body text. The # symbol in RMarkdown is used to indicate that you have a new section of the document. For example, in the compiled images at the beginning, this resulted in the text being larger and bolded when it said “Problem 2.” In addition to just using a single #, using ## or ### can indicate subsections or subsubsections. Other than that symbol, you can generally write text just as you would in any word processing program, with some exceptions, such as how to make text bold or italicized. (See bottom of section for resources on the Markdown language.)</li>
<li>The final component I want to call attention to are the other main body code chunks. These are specific parts of the document where you want to create a mini R script. To create these, you can simply click the + C symbol toward the top of the top left window of RStudio and indicate you want an R chunk.</li>
</ol>
<center>
<img src="images/rmarkdownnewchunk.png" style="width:20.0%" />
</center>
<ul>
<li>For example, in the image above, there is an R code chunk labeled <code>cars</code>. The <code>cars</code> component is just a label for the code chunk. Labeling code chunks is not necessary. By default, a new R code chunk will just have <code>r</code> in the brackets, and that is sufficient.</li>
</ul></li>
<li><strong><em>Writing R Code.</em></strong> Within a code chunk, you can type R code just like you would in any R script. To run (“execute”) the R code, you can run a single line the exact same way you do in a regular R script by moving the cursor to the end of a line of code or highlighting a portion of code and hitting “Run.” However, in RMarkdown, you also have the option of running an entire code chunk at once by hitting the green triangle at the top-right of a given code chunk.</li>
</ol>
<p><img src="images/codechunkexample.png" style="width:70.0%" /></p>
<ol start="7" style="list-style-type: decimal">
<li><strong><em>Knitting the document.</em></strong> Once you have added a code chunk and/or some text, you are ready to compile or “Knit” the document. This is what generates the .html document.
<ul>
<li>To do so, click on the Knit button toward the top of the top-left window of Rstudio. After a few moments, this should open up a preview window displaying the compiled html file.</li>
<li>It will also save an actual .html file in your working directory (the same location on your computer where you have saved the .Rmd file)</li>
<li>Try to locate this compiled .html file on your computer and open it. For most computers, .html files will open in your default web browser, such as Google Chrome or Safari.</li>
<li>This step is a common place where errors are detected and generated. Sometimes the compiling process fails due to errors in the R code in your code chunks or an error in the Markdown syntax. If your document fails to knit, the next step is to try to troubleshoot the error messages the compiling process generates. The best way to reduce and more easily detect errors is to “knit as you go.” Try to knit your document after each chunk of code you create.</li>
</ul></li>
</ol>
</div>
<div id="additional-rmarkdown-resources" class="section level3" number="1.5.2">
<h3><span class="header-section-number">1.5.2</span> Additional RMarkdown resources</h3>
<p>Here are a few additional resources for working with RMarkdown.</p>
<ul>
<li>This <a href="https://monashbioinformaticsplatform.github.io/2017-11-16-open-science-training/topics/rmarkdown.html">website</a> provides some basic syntax for the Markdown language, such as how to display bulleted lists and how to bold or italicize text.</li>
<li>This <a href="https://rpubs.com/brandonkopp/RMarkdown">page</a> walks through the setup of RMarkdown documents similar to what the course notes just did. This provides a second set of instructions and additional examples of settings you can use to customize your RMarkdown output (e.g., how large figures are when they are displayed).</li>
<li>This <a href="https://rmarkdown.rstudio.com/articles_intro.html">page</a> talks more about compiling aka rendering aka knitting Rmd documents into different formats, such as html, pdf, or Word doc files.</li>
</ul>
<p>See the course Canvas page for additional templates for working with RMarkdown in problem sets.</p>
</div>
</div>
<div id="wait-a-second-why-r" class="section level2" number="1.6">
<h2><span class="header-section-number">1.6</span> Wait a second why R?</h2>
<p>R is a free and open-source program.</p>
<ul>
<li>This means anyone can use R. In the future, if you are not at a university that provides licenses for software or at an organization that can afford to buy very expensive softwares (e.g., SPSS, Stata), you can still use R!!</li>
<li>This means anyone can access the underlying code to understand how different functions and capabilities work.</li>
</ul>
<p>R has a very large community of users and developers.</p>
<ul>
<li>People are constantly expanding R’s capabilities. This means that as the tools and methods change, R will also adapt very quickly to expand with new capabilities.</li>
<li>Google will be your friend. Multiple websites are devoted to helping people troubleshoot R problems and providing tutorials for using R.</li>
</ul>
<p>R is very versatile</p>
<ul>
<li>R can
<ul>
<li>Manage multiple datasets at once, subset, append, and merge data</li>
<li>Be used for descriptive analyses, as well more complicated statistical methods,</li>
<li>Employ APIs to communicate with external databases,</li>
<li>Map data,</li>
<li>Conduct text analyses,</li>
<li>And create interactive visualizations, among other capabilities.</li>
</ul></li>
<li>With RStudio, users can also directly integrate their R code and written text to automatically generate data reports, presentations, interactive dashboards, and more.</li>
<li>R also has a reputation of having terrific visualization tools, again with a lot of flexibility</li>
</ul>
<p>R facilitates reproducibility</p>
<ul>
<li>(While some other softwares also provide this ability), R encourages the use of scripts, which help researchers keep track of every modification they have made to data and every analysis they have run. This helps future researchers replicate, verify, and build on previous research.
<ul>
<li>Imagine if you accidentally enter the wrong number in a spreadsheet cell in Excel/google sheets. You may have no record you ever did that. In R, you can track all of the modifications you make so that months later you can review your steps to check them for accuracy.</li>
</ul></li>
</ul>
<p>R is popular</p>
<ul>
<li>While there is no guarantee R will remain popular forever, it is commonly employed in many different industries and organizations. Learning R can be a useful skill when applying for jobs. Moreover, even if jobs don’t require R, in learning R, it will be easier to learn how to use other statistical programs and languages, such as SPSS, Stata, or Python, as well as visualization tools like Tableau, or database tools like SQL.</li>
</ul>
<p>R has some distinct advantages compared to other programs, but all programs have benefits and weaknesses</p>
<ul>
<li>Here are a couple of articles comparing R to Excel <a href="https://www.northeastern.edu/graduate/blog/r-vs-excel/">here</a> and <a href="https://blog.revolutionanalytics.com/2014/10/why-r-is-better-than-excel.html">here</a></li>
<li>Here is an article making a case for R over multiple other programs from <a href="https://www.r-bloggers.com/2019/07/whats-the-best-statistical-software-a-comparison-of-r-python-sas-spss-and-stata/">R Bloggers</a></li>
</ul>
<p>Rgghhhh</p>
<ul>
<li>With all this, R does come with a learning curve. It is a programming language. In other softwares, such as Stata or SPSS, there are more “point and click” capabilities.</li>
<li>Especially as you first work with R, you may find it is easier to do some tasks outside of R, such as with Excel or another spreadsheet software. That’s fine. Ultimately, in political science, R is one tool we can use to pursue research goals. There are many other tools, and you may find each has their own strengths and weaknesses.</li>
<li>For this class, R provides a one-stop-shop for the wide range of types of data wrangling and analyses used across data science.</li>
</ul>
<!--chapter:end:index.Rmd-->
</div>
</div>
<div id="description" class="section level1" number="2">
<h1><span class="header-section-number">2</span> Description</h1>
<p>What are things we want to describe in political science?</p>
<ul>
<li>Unemployment rate, GDP</li>
<li>Voter turnout, vote share for a party in an election</li>
<li>Percentage of women in the labor force</li>
<li>Poverty rates over time</li>
</ul>
<p>What else? What does description help us achieve?</p>
<ul>
<li>Identify tendencies</li>
<li>Identify patterns or trends</li>
<li>Identify relationships between two or more factors</li>
<li>Help us generalize from anecdotes, what is common vs. what is uncommon?</li>
<li>Diagnose demand, needs, potential problems, likely outcomes</li>
</ul>
<p>Generate ideas for other goals, such as explanation and prediction</p>
<div id="process-of-describing" class="section level2" number="2.1">
<h2><span class="header-section-number">2.1</span> Process of Describing</h2>
<p>How do we go about a descriptive quantitative analysis?</p>
<ol style="list-style-type: decimal">
<li>Substantive Expertise: Start with a topic, puzzle, or question (e.g., How is the economy doing?)</li>
<li>Find outcome data relevant to that question (e.g., GDP)
<ul>
<li>Start from a concept: what we want to describe (i.e., health of the economy)</li>
<li>Move toward an “operationalization” (i.e., a way to measure it)</li>
<li>Easy! except… social science is messy. Our concepts are rich, while
our measures may be very narrow or concrete.
<ul>
<li>For example, GDP is one way to measure economic health, but is it
the only measure?</li>
<li>Choose measures based on validity, reliability, cost</li>
</ul></li>
</ul></li>
<li>Find multiple relevant units or “data points”
<ul>
<li>E.g., Multiple years of data (e.g., U.S., from 1900 to 2020)</li>
<li>E.g., Multiple countries from one year (e.g., U.S. to Germany to other
countries)</li>
</ul></li>
<li>Summarize the data to help answer the question</li>
</ol>
<div id="example-process" class="section level3" number="2.1.1">
<h3><span class="header-section-number">2.1.1</span> Example Process</h3>
<ol style="list-style-type: decimal">
<li>How is the economy doing?</li>
<li>Find outcome data relevant to that question
<ul>
<li>Let’s ask people</li>
</ul></li>
<li>Find multiple relevant units or data points
<ul>
<li>We will ask several people. Each person will be a data point.</li>
</ul></li>
<li>Summarize the data
<ul>
<li>Let’s take the mean</li>
</ul></li>
</ol>
<p><img src="images/economysurvey.png" style="width:50.0%" /></p>
<p>How would you summarize information in explaining it to another person? You would probably want to describe how most people feel about the economy. In other words, you would describe the “central tendency” of people’s responses (the central tendency of the data).</p>
</div>
</div>
<div id="summarizing-univariate-data" class="section level2" number="2.2">
<h2><span class="header-section-number">2.2</span> Summarizing univariate data</h2>
<p>For a video explainer of the code in this section, see below. The video only discusses the code. Use the notes and lecture discussion for additional context. (Via youtube, you can speed up the playback to 1.5 or 2x speed.)</p>
<div class="vembedr">
<div>
<iframe src="https://www.youtube.com/embed/80tbdiWuljc" width="533" height="300" frameborder="0" allowfullscreen=""></iframe>
</div>
</div>
<p>Univariate data refers to data coming from one “variable,” where a variable captures the values of a changing characteristic.</p>
<p>Our set of values is Outcome = {0,0,0,0,1,1,0,1,0,1}.</p>
<ul>
<li>We will call this a vector of values, where a vector is just a collection of things.</li>
<li>Because our vector contains only numbers, we will call it a <em>numeric</em> vector.</li>
<li>Each value can be indexed by <code>i</code>, denoting the position of the value in the</li>
<li>For example, Jesse is in position <code>i=10</code> of the vector, and his value is 1</li>
</ul>
<p>We can create vectors in R by using <code>c()</code> and assigning <code>&lt;-</code> it to an object we will call <code>Outcome</code>.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>Outcome <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>) <span class="co"># Use commas to separate values</span></span></code></pre></div>
<p>We can extract a particular value within our vector using brackets</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>Outcome[<span class="dv">10</span>]</span></code></pre></div>
<pre><code>## [1] 1</code></pre>
<p>We can label our outcomes using <code>names()</code></p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(Outcome) <span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">&quot;Joe&quot;</span>,<span class="st">&quot;Sally&quot;</span>, <span class="st">&quot;Trevor&quot;</span>, <span class="st">&quot;Emily&quot;</span>, <span class="st">&quot;Mark&quot;</span>,</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>                   <span class="st">&quot;Sarah Jane&quot;</span>, <span class="st">&quot;Stacey&quot;</span>, <span class="st">&quot;Steve&quot;</span>, <span class="st">&quot;Phoebe&quot;</span>, <span class="st">&quot;Jesse&quot;</span>)</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>Outcome[<span class="dv">10</span>]</span></code></pre></div>
<pre><code>## Jesse 
##     1</code></pre>
<p>We can overwrite whole vectors or values within a vector</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>Outcome <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">0</span>,<span class="dv">2</span>, <span class="dv">6</span>,<span class="dv">1</span>,<span class="dv">1</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">0</span>, <span class="dv">1</span>) <span class="co"># oops we put the wrong numbers</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>Outcome</span></code></pre></div>
<pre><code>##  [1] 5 0 2 6 1 1 7 8 0 1</code></pre>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>Outcome <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>) <span class="co"># no problem, just overwrite it</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>Outcome</span></code></pre></div>
<pre><code>##  [1] 0 0 0 0 1 1 0 1 0 1</code></pre>
<p>Oops we accidentally type a 0 for Jesse.</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>Outcome <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>) <span class="co"># oops typo for Jesse</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>Outcome</span></code></pre></div>
<pre><code>##  [1] 0 0 0 0 1 1 0 1 0 0</code></pre>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>Outcome[<span class="dv">10</span>] <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="co"># no prob bob. Assign a 1 in position 10</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>Outcome</span></code></pre></div>
<pre><code>##  [1] 0 0 0 0 1 1 0 1 0 1</code></pre>
<p>Vectors do not have to be numeric. Character vectors contain a collection of words and phrases. In R, we use quotations around character values</p>
<p>Example: let’s create a vector of names that we will call <code>People</code>.</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>People <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Joe&quot;</span>,<span class="st">&quot;Sally&quot;</span>, <span class="st">&quot;Trevor&quot;</span>, <span class="st">&quot;Emily&quot;</span>, <span class="st">&quot;Mark&quot;</span>, <span class="st">&quot;Sarah Jane&quot;</span>, <span class="st">&quot;Stacey&quot;</span>, <span class="st">&quot;Steve&quot;</span>, <span class="st">&quot;Phoebe&quot;</span>, <span class="st">&quot;Jesse&quot;</span>)</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>People[<span class="dv">10</span>]</span></code></pre></div>
<pre><code>## [1] &quot;Jesse&quot;</code></pre>
<p>We can use the R function <code>class()</code> to tell us the type of object we have.</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(Outcome)</span></code></pre></div>
<pre><code>## [1] &quot;numeric&quot;</code></pre>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(People)</span></code></pre></div>
<pre><code>## [1] &quot;character&quot;</code></pre>
</div>
<div id="functions-to-summarize-univariate-data" class="section level2" number="2.3">
<h2><span class="header-section-number">2.3</span> Functions to summarize univariate data</h2>
<p>For univariate data, often we are interested in describing the range of the values and their central tendency.</p>
<ul>
<li>range: the minimum (<code>min()</code>) and maximum (<code>max()</code>) values</li>
<li>mean: the average value (<code>mean()</code>)</li>
</ul>
<p>The average is the sum of the values divided by the number of values:</p>
<p><span class="math inline">\(\bar{X} = \frac{\text{sum of values}}{\text{number of values}} = \frac{x_1 + x_2 + ... + x_N}{N}=\frac{1}{N}\sum_{i=1}^{i=N} x_i\)</span></p>
<p>Let’s do this in R for our set of 10 values</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>(<span class="dv">0</span> <span class="sc">+</span> <span class="dv">0</span> <span class="sc">+</span> <span class="dv">0</span> <span class="sc">+</span> <span class="dv">0</span> <span class="sc">+</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">0</span> <span class="sc">+</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">0</span> <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">/</span><span class="dv">10</span></span></code></pre></div>
<pre><code>## [1] 0.4</code></pre>
<p>The average outcome is .4. Note: when a variable contains only 0’s and 1’s its mean is the proportion of 1’s. 40% of people think the economy is doing well.</p>
<div id="using-functions-in-r-overview" class="section level3" number="2.3.1">
<h3><span class="header-section-number">2.3.1</span> Using functions in R (overview)</h3>
<p>A function is an action(s) that you request R to perform on an object or set of objects. For example, we will use the <code>mean()</code> function to ask R to take the mean or “average” of a vector.</p>
<ul>
<li>Inside the function you place inputs or “arguments.”</li>
</ul>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(Outcome)</span></code></pre></div>
<pre><code>## [1] 0.4</code></pre>
<p>R also has functions that take the sum <code>sum()</code> of a vector of values.</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>sumofvalues <span class="ot">&lt;-</span> <span class="fu">sum</span>(Outcome)</span></code></pre></div>
<p>And that count the total number of values or “length” <code>length()</code> of the vector.</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>numberofvalues <span class="ot">&lt;-</span> <span class="fu">length</span>(Outcome)</span></code></pre></div>
<p>Note that the below is also equivalent to the mean</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>sumofvalues <span class="sc">/</span> numberofvalues</span></code></pre></div>
<pre><code>## [1] 0.4</code></pre>
<p>Returning to our example, we found that 40% of people surveyed thought the economy was doing well. Surveying people about their opinions on how the country doing is a common way that social scientists use description. We could extend this exercise in many ways going forward, even with the same question.</p>
<ul>
<li>Start with a question: How is the economy doing?</li>
<li>Let’s find a measure: Ask people if the economy is doing well.</li>
<li>Find data points: Multiple people (we could stop there with the average!), or add more variables:
<ul>
<li>Across time: Survey people across multiple years</li>
<li>Across type of people: Survey different partisan groups</li>
</ul></li>
</ul>
<p>These types of survey trends are often used by news organizations and public opinion organizations like, Gallup.</p>
<p><img src="images/economyconf.png" style="width:70.0%" /></p>
<p>This was just a first example of description in political science. There are many other ways to describe how the economy is doing and many other topics we might want to describe in politics.</p>
</div>
</div>
<div id="loading-data-into-r" class="section level2" number="2.4">
<h2><span class="header-section-number">2.4</span> Loading data into R</h2>
<p>For this section, our motivating example will be methods to measure voter turnout in the United States.</p>
<p>Describing voter turnout</p>
<ul>
<li>What is a typical level of voter turnout?</li>
<li>How has turnout changed over time?</li>
<li>Is turnout higher in presidential years or in midterm years?</li>
</ul>
<p>How can we measure turnout? Think about the validity, reliability, and cost of different approaches.</p>
<p>Example: Dataset on Voter Turnout in the U.S. across multiple years</p>
<p><img src="images/turnoutframe.png" style="width:80.0%" /></p>
<p>In this dataset, each row is an election year. Each column contains information about the population, potential voters, or voter turnout. These will help us compute the turnout rate in a given year. To work with this dataset, we need to load it into R.</p>
<div id="working-with-datasets-in-r" class="section level3" number="2.4.1">
<h3><span class="header-section-number">2.4.1</span> Working with datasets in R</h3>
<p>For a video explainer of the code in this section, see below. The video only discusses the code. Use the notes and lecture discussion for additional context. (Via youtube, you can speed up the playback to 1.5 or 2x speed.)</p>
<div class="vembedr">
<div>
<iframe src="https://www.youtube.com/embed/rm_g0rrglEQ" width="533" height="300" frameborder="0" allowfullscreen=""></iframe>
</div>
</div>
<p>Often the variables we care about are stored inside of rectangular datasets</p>
<ul>
<li>These have a number of rows <code>nrow()</code> and columns <code>ncol()</code></li>
<li>Each row is an “observation,” representing the information collected from an individual or entity</li>
<li>Each column is a variable, representing a changing characteristic across multiple observations</li>
</ul>
<p>When we import a dataset into R, we have a few options.</p>
<p>Option 1: Download dataset to your computer</p>
<ul>
<li>Move the dataset to your working directory</li>
<li>Identify the file type (e.g., csv, dta, RData, txt)</li>
<li>Pick the appropriate R function to match the type (e.g., <code>read.csv(), read.dta(), load(), read.table()</code>)</li>
<li>Assign the dataset to an object. This object will now be <code>class()</code> of <code>data.frame</code></li>
</ul>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>turnout <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;turnout.csv&quot;</span>)</span></code></pre></div>
<p>Option 2: Read file from a url provided</p>
<ul>
<li>Need an active internet connection for this to work</li>
<li>URL generally must be public</li>
<li>Include the url inside the function used to read the data</li>
</ul>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>turnout <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;https://raw.githubusercontent.com/ktmccabe/teachingdata/main/turnout.csv&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(turnout)</span></code></pre></div>
<pre><code>## [1] &quot;data.frame&quot;</code></pre>
<p>You can also open up a window to view the data:</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">View</span>(turnout)</span></code></pre></div>
</div>
<div id="measuring-the-turnout-in-the-us-elections" class="section level3" number="2.4.2">
<h3><span class="header-section-number">2.4.2</span> Measuring the Turnout in the US Elections</h3>
<p>Relevant questions with voter turnout</p>
<ul>
<li>What is a typical level of voter turnout?</li>
<li>Is turnout higher in presidential years or in midterm years?</li>
<li>Is turnout higher or lower based on voting-eligible (VEP) or voting-age (VAP) populations?
We have a lot of people who are citizens 18 and older who are ineligible to vote. This makes the VEP denominator smaller than the VAP.</li>
</ul>
<p>Voter Turnout in the U.S.</p>
<ul>
<li>Numerator: <code>total</code>: Total votes cast (in thousands)</li>
<li>Denominator:
<ul>
<li>VAP: (voting-age population) from Census</li>
<li>VEP (voting-eligible population) VEP = VAP + overseas voters - ineligible voters</li>
</ul></li>
<li>Additional Variables and Descriptions
<ul>
<li><code>year</code>: election year</li>
<li><code>ANES</code>: ANES self-reported estimated turnout rate</li>
<li><code>VEP</code>: Voting Eligible Population (in thousands)</li>
<li><code>VAP</code>: Voting Age Population (in thousands)</li>
<li><code>total</code>: total ballots cast for highest office (in thousands)</li>
<li><code>felons</code>: total ineligible felons (in thousands)</li>
<li><code>noncitizens</code>: total non-citizens (in thousands)</li>
<li><code>overseas</code>: total eligible overseas voters (in thousands)</li>
<li><code>osvoters</code>: total ballots counted by overseas voters (in thousands)</li>
</ul></li>
</ul>
</div>
<div id="getting-to-know-your-data" class="section level3" number="2.4.3">
<h3><span class="header-section-number">2.4.3</span> Getting to know your data</h3>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="do">## How many observations (the rows)?</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(turnout)</span></code></pre></div>
<pre><code>## [1] 14</code></pre>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="do">## How many variables (the columns)?</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ncol</span>(turnout)</span></code></pre></div>
<pre><code>## [1] 9</code></pre>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="do">## What are the variable names?</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(turnout)</span></code></pre></div>
<pre><code>## [1] &quot;year&quot;     &quot;VEP&quot;      &quot;VAP&quot;      &quot;total&quot;    &quot;ANES&quot;     &quot;felons&quot;   &quot;noncit&quot;  
## [8] &quot;overseas&quot; &quot;osvoters&quot;</code></pre>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Show the first six rows</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(turnout)</span></code></pre></div>
<pre><code>##   year    VEP    VAP total ANES felons noncit overseas osvoters
## 1 1980 159635 164445 86515   71    802   5756     1803       NA
## 2 1982 160467 166028 67616   60    960   6641     1982       NA
## 3 1984 167702 173995 92653   74   1165   7482     2361       NA
## 4 1986 170396 177922 64991   53   1367   8362     2216       NA
## 5 1988 173579 181955 91595   70   1594   9280     2257       NA
## 6 1990 176629 186159 67859   47   1901  10239     2659       NA</code></pre>
<p>Extract a particular column (vector) from the data using the $.</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>turnout<span class="sc">$</span>year</span></code></pre></div>
<pre><code>##  [1] 1980 1982 1984 1986 1988 1990 1992 1994 1996 1998 2000 2002 2004 2008</code></pre>
<p>Extract the 10th year. Just like before! We use 10 to indicate the value of the <code>year</code> column in position (row 10) of the data.</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>turnout<span class="sc">$</span>year[<span class="dv">10</span>]</span></code></pre></div>
<pre><code>## [1] 1998</code></pre>
<p>We can take the <code>mean()</code> of a particular column, too. Let’s take it of the total number of voters.</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(turnout<span class="sc">$</span>total)</span></code></pre></div>
<pre><code>## [1] 89778.29</code></pre>
<p>And get the <code>class()</code> (Note: integer is just a type of numeric variable)</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(turnout<span class="sc">$</span>total)</span></code></pre></div>
<pre><code>## [1] &quot;integer&quot;</code></pre>
<p>We can also use brackets in the full data frame, but because our data frame has BOTH rows and columns, we cannot just supply one position <code>i</code>. Instead, we have to tell R which row AND which column by using a comma between the positions.</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>turnout[<span class="dv">1</span>,<span class="dv">2</span>] <span class="co"># value in row 1, column 2</span></span></code></pre></div>
<pre><code>## [1] 159635</code></pre>
<p>We can use the column name instead</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>turnout[<span class="dv">1</span>, <span class="st">&quot;VEP&quot;</span>]</span></code></pre></div>
<pre><code>## [1] 159635</code></pre>
<p>If we leave the second entry blank, it will return all columns for the specified row</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>turnout[<span class="dv">1</span>,] <span class="co"># All variable values for row 1</span></span></code></pre></div>
<pre><code>##   year    VEP    VAP total ANES felons noncit overseas osvoters
## 1 1980 159635 164445 86515   71    802   5756     1803       NA</code></pre>
<p>The opposite is true if we leave the first entry blank.</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>turnout[,<span class="dv">2</span>] <span class="co"># VEP for all rows</span></span></code></pre></div>
<pre><code>##  [1] 159635 160467 167702 170396 173579 176629 179656 182623 186347 190420
## [11] 194331 198382 203483 213314</code></pre>
</div>
</div>
<div id="comparing-vep-and-vap-turnout" class="section level2" number="2.5">
<h2><span class="header-section-number">2.5</span> Comparing VEP and VAP turnout</h2>
<div id="creating-new-variables-in-r" class="section level3" number="2.5.1">
<h3><span class="header-section-number">2.5.1</span> Creating new variables in R</h3>
<p>Let’s create a new variable that is VAP that adds overseas voters.</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Use $ to add a new variable (i.e., column) to a dataframe</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>turnout<span class="sc">$</span>VAPplusoverseas <span class="ot">&lt;-</span> turnout<span class="sc">$</span>VAP <span class="sc">+</span> turnout<span class="sc">$</span>overseas</span></code></pre></div>
<p>Under the hood, what this is doing is taking each value of <code>turnout$VAP</code> and adding it to its corresponding values of <code>turnout$overseas</code>.</p>
<p>And, yes, this new variable shows up as a new column in <code>turnout</code>. Go ahead, <code>View()</code> it</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="fu">View</span>(turnout)</span></code></pre></div>
<p>This does not change the underlying <code>turnout.csv</code> file, only the <code>turnout data.frame</code> we are working with in the current R session.</p>
<ul>
<li>This is an advantage of using an R script.</li>
<li>You don’t have to worry about overwriting/messing up the raw data.</li>
<li>You start from the original raw data when you load {}, and then everything else is done within R.</li>
</ul>
<p>This is our new denominator. Now we can calculate turnout based on this denominator.</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>turnout<span class="sc">$</span>newVAPturnout <span class="ot">&lt;-</span> turnout<span class="sc">$</span>total <span class="sc">/</span> turnout<span class="sc">$</span>VAPplusoverseas</span></code></pre></div>
<p>Just like with adding two vectors, when we divide, each value in the first vector is divided by its corresponding value in the second vector.</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>turnout<span class="sc">$</span>newVAPturnout</span></code></pre></div>
<pre><code>##  [1] 0.5203972 0.4024522 0.5253748 0.3607845 0.4972260 0.3593884 0.5404097
##  [8] 0.3803086 0.4753376 0.3483169 0.4934211 0.3582850 0.5454777 0.5567409</code></pre>
<p>Let’s calculate the VEP turnout rate and turn it into a percentage. This time, we do it in one step.</p>
<ul>
<li>(total votes / VEP) <span class="math inline">\(\times\)</span> 100:</li>
</ul>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>turnout<span class="sc">$</span>newVEPturnout <span class="ot">&lt;-</span> (turnout<span class="sc">$</span>total <span class="sc">/</span> turnout<span class="sc">$</span>VEP) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>turnout<span class="sc">$</span>newVEPturnout</span></code></pre></div>
<pre><code>##  [1] 54.19551 42.13701 55.24860 38.14115 52.76848 38.41895 58.11384 41.12625
##  [9] 51.65793 38.09316 54.22449 39.51064 60.10084 61.55433</code></pre>
<p>Let’s change it from a proportion to a percentage. How? Multiply each value of <code>turnout$newVAP</code> by 100</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>turnout<span class="sc">$</span>newVAPturnout <span class="ot">&lt;-</span> turnout<span class="sc">$</span>newVAPturnout <span class="sc">*</span> <span class="dv">100</span></span></code></pre></div>
<p>This multiplies each number within the vector by 100.</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>turnout<span class="sc">$</span>newVAPturnout</span></code></pre></div>
<pre><code>##  [1] 52.03972 40.24522 52.53748 36.07845 49.72260 35.93884 54.04097 38.03086
##  [9] 47.53376 34.83169 49.34211 35.82850 54.54777 55.67409</code></pre>
<p>What is typical turnout?</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(turnout<span class="sc">$</span>newVAPturnout)</span></code></pre></div>
<pre><code>## [1] 45.45658</code></pre>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(turnout<span class="sc">$</span>newVEPturnout)</span></code></pre></div>
<pre><code>## [1] 48.94937</code></pre>
<p>We find that turnout based on the voting age population is lower than turnout based on the voting eligible population. This is a pattern that political scientists have examined, going back several decades. For example, in a 2001 article McDonald and Popkin show that is it the ineligible population that grew from the 1970s onward and not the population of people who simply prefer not to vote. (See more <a href="https://www.jstor.org/stable/3117725">here</a>.)</p>
<div class="figure">
<img src="images/VEP.png" alt="" />
<p class="caption">McDonald and Popkin 2001</p>
</div>
</div>
</div>
<div id="comparing-presidential-vs.-midterm-turnout" class="section level2" number="2.6">
<h2><span class="header-section-number">2.6</span> Comparing Presidential vs. Midterm turnout</h2>
<p>How does turnout compare in presidential vs. midterm years? Sometimes using a single summary of turnout may obscure important underlying differences in the data. To detect these differences, we may want to summarize different parts of the data.</p>
<p>Oh dear. We need to extract specific years from the turnout data frame. Which rows contain the years we want?</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>turnout<span class="sc">$</span>year</span></code></pre></div>
<pre><code>##  [1] 1980 1982 1984 1986 1988 1990 1992 1994 1996 1998 2000 2002 2004 2008</code></pre>
<p>Ok: rows 1,3,5,7,9,11,13,14 are the presidential. And rows 2,4,6,8,10,12 are midterms.</p>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="do">## we can extract all of these at once by using c()</span></span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>turnout<span class="sc">$</span>year[<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">5</span>,<span class="dv">7</span>,<span class="dv">9</span>,<span class="dv">11</span>,<span class="dv">13</span>,<span class="dv">14</span>)] <span class="co"># presidential</span></span></code></pre></div>
<pre><code>## [1] 1980 1984 1988 1992 1996 2000 2004 2008</code></pre>
<p>Let’s take the mean VEP turnout for presidential years.</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(turnout<span class="sc">$</span>newVEPturnout[<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">5</span>,<span class="dv">7</span>,<span class="dv">9</span>,<span class="dv">11</span>,<span class="dv">13</span>,<span class="dv">14</span>)])</span></code></pre></div>
<pre><code>## [1] 55.983</code></pre>
<p>Let’s take the mean VEP turnout for midterm years.</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(turnout<span class="sc">$</span>newVEPturnout[<span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">6</span>,<span class="dv">8</span>,<span class="dv">10</span>,<span class="dv">12</span>)])</span></code></pre></div>
<pre><code>## [1] 39.5712</code></pre>
<p>Let’s take the difference by storing each mean and then subtracting</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>mean.VEP.pres <span class="ot">&lt;-</span> <span class="fu">mean</span>(turnout<span class="sc">$</span>newVEPturnout[<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">5</span>,<span class="dv">7</span>,<span class="dv">9</span>,<span class="dv">11</span>,<span class="dv">13</span>,<span class="dv">14</span>)])</span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a>mean.VEP.mid <span class="ot">&lt;-</span> <span class="fu">mean</span>(turnout<span class="sc">$</span>newVEPturnout[<span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">6</span>,<span class="dv">8</span>,<span class="dv">10</span>,<span class="dv">12</span>)])</span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a>mean.VEP.pres <span class="sc">-</span>  mean.VEP.mid</span></code></pre></div>
<pre><code>## [1] 16.41181</code></pre>
<p>Presidential turnout, on average, is higher than midterm turnout.</p>
<div id="r-shortcut-for-writing-vectors" class="section level3" number="2.6.1">
<h3><span class="header-section-number">2.6.1</span> R shortcut for writing vectors</h3>
<p>Sometimes we write numbers that are in a predictable sequence (e.g., 1,2,3,4,5). In R, we have functions that prevent us from having to type each number when this is the case.</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>) <span class="co"># is equivalent to:</span></span></code></pre></div>
<pre><code>## [1] 1 2 3 4 5</code></pre>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="sc">:</span><span class="dv">5</span> <span class="co"># is equivalent to:</span></span></code></pre></div>
<pre><code>## [1] 1 2 3 4 5</code></pre>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">1</span>, <span class="at">to =</span> <span class="dv">5</span>, <span class="at">by =</span> <span class="dv">1</span>)</span></code></pre></div>
<pre><code>## [1] 1 2 3 4 5</code></pre>
<p>We can use the last one to our advantage to extract the midterm years, which go by 2</p>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(turnout<span class="sc">$</span>newVEPturnout[<span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">6</span>,<span class="dv">8</span>,<span class="dv">10</span>,<span class="dv">12</span>)]) <span class="co"># is the same as</span></span></code></pre></div>
<pre><code>## [1] 39.5712</code></pre>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(turnout<span class="sc">$</span>newVEPturnout[<span class="fu">seq</span>(<span class="dv">2</span>, <span class="dv">12</span>, <span class="dv">2</span>)])</span></code></pre></div>
<pre><code>## [1] 39.5712</code></pre>
<p>Not a big deal now, but imagine if you had to write 100 numbers or 1 MILLION NUMBERS!</p>
<p>In this section, we have described voter turnout using multiple measures and types of elections. There are several other questions that political scientists may be interested in when it comes to voter turnout.</p>
<p>For example, Texas and more than a dozen other states have passed new laws that change voting procedures in elections. What effect will these have on voter turnout? In the next section, we start to examine how to evaluate causal claims.</p>
<p><img src="images/texaslaw.png" style="width:60.0%" /></p>
<!--chapter:end:02-Description.Rmd-->
</div>
</div>
</div>
<div id="causation1" class="section level1" number="3">
<h1><span class="header-section-number">3</span> Causation with Experiments</h1>
<p>Recall that we said, four primary goals of social science include:</p>
<ul>
<li><strong>Describe</strong> and measure
<ul>
<li>Has the U.S. population increased?</li>
</ul></li>
<li><strong>Explain</strong>, evaluate, and recommend (study of causation)
<ul>
<li>Does expanding Medicaid improve health outcomes?</li>
</ul></li>
<li><strong>Predict</strong>
<ul>
<li>Who will win the next election?</li>
</ul></li>
<li><strong>Discover</strong>
<ul>
<li>How do policies diffuse across states?</li>
</ul></li>
</ul>
<p>In this section, we start to explore the goal of explanation–making causal claims.</p>
<div id="what-separates-causation-from-correlation" class="section level2" number="3.1">
<h2><span class="header-section-number">3.1</span> What separates causation from correlation?</h2>
<p>Here’s an example. In 2016, researchers at the <a href="https://www.nytimes.com/interactive/2016/12/26/upshot/duck-dynasty-vs-modern-family-television-maps.html">NY Times</a> noticed that areas in the country where the television show <em>Duck Dynasty</em> was popular also tended to support Donald Trump at higher rates.</p>
<p><img src="images/duckdynasty.png" /></p>
<p>If we put our social scientist hat on, we might want to distinguish whether this is a causal or, more likely, just a correlational relationship:</p>
<ul>
<li>Correlation: Areas that watch Duck Dynasty are more likely to support Trump (degree to which two variables “move together”)</li>
<li>Causality: Watching Duck Dynasty (vs. not watching) increases your support of Trump.</li>
</ul>
<p>Causal Question: Does the manipulation of one factor (the treatment), (holding everything else constant), cause a change in an outcome?</p>
<div id="potential-outcomes-framework" class="section level3" number="3.1.1">
<h3><span class="header-section-number">3.1.1</span> Potential Outcomes Framework</h3>
<p>When studying causal relationships, we distinguish two concepts:</p>
<ul>
<li>treatment: variable whose change may produce a change in the outcome</li>
<li>outcome (<span class="math inline">\(Y\)</span>): what may change as a result</li>
</ul>
<p>We imagine two states of the world or “potential outcomes.”</p>
<ul>
<li><span class="math inline">\(Y(1)\)</span>: the outcome if the treatment is administered</li>
<li><span class="math inline">\(Y(0)\)</span>: the outcome if the treatment is NOT administered (or maybe something else is)</li>
</ul>
<p>Example: How does voter turnout (<span class="math inline">\(Y\)</span>) change as a result of varying whether someone receives a mail-in ballot (the treatment)?</p>
<ul>
<li><span class="math inline">\(Y(\text{sent a mail-in ballot})\)</span>: do you vote or not</li>
<li><span class="math inline">\(Y(\text{not sent a mail-in ballot})\)</span>: do you vote or not</li>
</ul>
<p>We compare your likelihood of turning out to vote in a world where you did receive a mail-in ballot vs. a counterfactual state of the world in which you did not receive a mail-in ballot, generally assuming that this is the only thing that is different between these two potential states of the world.</p>
<p>In many cases in social science, we might start by observing some connection in the real world (a factual observation). To make a causal claim, we then have to imagine what that counterfactual state of the world would be. Examples:</p>
<ul>
<li>Causal Question: Does the minimum wage increase the unemployment rate?
<ul>
<li>(Hypothetical) Factual: An unemployment rate went up after the minimum wage increased</li>
<li>Implied Counterfactual: Would the unemployment rate have gone up, had the minimum wage increase not occurred?</li>
</ul></li>
<li>Causal Question: Does race affect one’s job prospects?
<ul>
<li>(Hypothetical) Factual: Jamal applied for a job but did not get it</li>
<li>Implied Counterfactual: Would Jamal have gotten a job if he were white?</li>
</ul></li>
</ul>
<p>We use causal logic all of the time outside of social science.</p>
<p>For example, many viewers get angry after watching the movie <a href="https://www.youtube.com/watch?v=3gK_2XdjOdY"><em>Titanic</em></a> because they believe Jack did not have to die. We can place their claims in our causal framework:</p>
<p><img src="images/titanicdoor.jpeg" /></p>
<ul>
<li>Outcome: Jack Surviving the Titanic</li>
<li>Potential Outcomes in two states of the world
<ul>
<li>Rose did not share the floating door, and Jack died.</li>
<li>Counterfactual question: If Rose had shared the floating door, would Jack have lived?</li>
</ul></li>
</ul>
<p>In <a href="https://www.bitbybitbook.com/en/1st-ed/running-experiments/"><em>Bit by Bit</em></a>, Matt Salganik notes that sometimes cause-and-effect questions are implicit. For example, in more general questions about maximization of some performance metric, we might want to compare several alternatives:</p>
<p>The question “What color should the donate button be on an NGO’s website?” is really lots of questions about the effect of different button colors on donations.</p>
<ul>
<li>Factual: A voter donates some amount with a black button</li>
<li>Counterfactual: What would a voter donate if the button were blue?</li>
<li>Counterfactual: What would a voter donate if the button were red?</li>
</ul>
<p>What other causal questions might social scientists or data scientists ask?</p>
</div>
<div id="causal-effects" class="section level3" number="3.1.2">
<h3><span class="header-section-number">3.1.2</span> Causal Effects</h3>
<p>When we are conducting a causal analysis, we will want to estimate a causal effect.</p>
<p>A causal effect is the change in the outcome Y that is caused by a change in the treatment variable.</p>
<ul>
<li><span class="math inline">\(Y(1) - Y(0)\)</span> = causal effect or “treatment effect”
<ul>
<li>e.g., Donation if contacted - Donation if not contacted</li>
</ul></li>
</ul>
<p>We often want to know the <strong>average treatment effect</strong> in some population, not just the causal effect for a single individual. Here, we might ask, on average, how much would our outcome change if our units were treated instead of untreated. To do so, we simply sum up all of the causal effects and divide them by the number of units in our population.</p>
<ul>
<li><span class="math inline">\(\frac{1}{N} \sum_{i=1}^N (Y_i (1)-Y_i (0))\)</span> = “average treatment effect” (ATE)
<ul>
<li>e.g., Average donations if contacted - Average donations if not contacted</li>
</ul></li>
</ul>
</div>
<div id="fundamental-problem-of-causal-inference" class="section level3" number="3.1.3">
<h3><span class="header-section-number">3.1.3</span> Fundamental Problem of Causal Inference</h3>
<p>The problem: Fundamental Problem of Causal Inference</p>
<p>What makes the evaluation of causal claims difficult, is that in the real world, we suffer from the fundamental problem of causal inference:</p>
<ul>
<li>For any individual, we only get to see (observe) the result from one state of the world
<ul>
<li>This makes that subtraction of potential outcomes impossible.</li>
</ul></li>
</ul>
<p>(Unless we are in <a href="https://www.youtube.com/watch?v=5E0M6Rh9qpg">Groundhog Day</a> or <em>Russian Doll</em>)</p>
</div>
</div>
<div id="randomized-controlled-trials" class="section level2" number="3.2">
<h2><span class="header-section-number">3.2</span> Randomized Controlled Trials</h2>
<p>One approach for addressing the fundamental problem of causal inference is to simulate two potential states of the world through random assignment: Randomized Controlled Trials / Experiments</p>
<p>Experiments approximate factual vs. counterfactual comparison</p>
<ul>
<li>We randomly assign one group to receive a “treatment” and another not to receive a treatment (the control)</li>
<li>When treatment assignment is <strong>randomized</strong>, the only thing that distinguishes the treatment group from the control group, besides the treatment itself, is chance.</li>
</ul>
<p>This allows us to compare the average outcomes between groups in order to estimate our causal effects (more on this below).</p>
<div id="experiments-why-randomize" class="section level3" number="3.2.1">
<h3><span class="header-section-number">3.2.1</span> Experiments: Why Randomize?</h3>
<p>Randomization is essential for being able to “identify” and isolate the causal effect of the treatment on the outcome. Without randomization, there may be several reasons why two groups differ beyond the treatment of interest.</p>
<p>For example, if we randomly assigned half of Rutgers seniors to watch the movie <em>Groundhog Day</em> and half to watch <em>Parasite</em> we would expect the groups to have about equal proportions of female students, average age, racial composition, majors, etc.</p>
<ul>
<li>(If we didn’t randomly assign, and just let people “select” into watching a particular movie, the groups could look very different.)</li>
</ul>
<p>But because we randomized assignment, on average, we’d expect the two groups to be identical except for the treatment– in this case, which movie they watched.</p>
<ul>
<li>Great news! This means any differences in the outcomes between the two groups can be attributed to the treatment. So if we wanted to see if <em>Parasite</em> leads people to have nightmares about people living in their basements, we could compare the average number of reported nightmares between the seniors that watched <em>Parasite</em> vs. <em>Groundhog Day</em></li>
</ul>
</div>
<div id="experiments-how-to-analyze" class="section level3" number="3.2.2">
<h3><span class="header-section-number">3.2.2</span> Experiments: How to Analyze</h3>
<p>Difference in Means: We compare each group’s average outcome by subtracting one from the other to estimate the average treatment effect (ATE) aka the average causal effect of the treatment.</p>
<ul>
<li><span class="math inline">\(\widehat{ATE} = \bar{Y}(treatment) - \bar{Y}(control)\)</span></li>
</ul>
<p>This is an estimate of, on average, how much our outcome would change if units went from being untreated to treated.</p>
<ul>
<li>E.g., on average how much a person donates to a campaign if contacted by phone compared to if not contacted by phone.</li>
</ul>
</div>
<div id="ingredients-of-an-experiment" class="section level3" number="3.2.3">
<h3><span class="header-section-number">3.2.3</span> Ingredients of an Experiment</h3>
<p>From <a href="https://www.bitbybitbook.com/en/1st-ed/running-experiments/"><em>Bit by Bit</em></a></p>
<p><img src="images/bitbybitexp.png" /></p>
<p>For every experiment, you should be able to</p>
<ul>
<li>State the causal question or relationship of interest</li>
<li>Describe how the experiment will be implemented (e.g., recruitment of subjects)</li>
<li>Identify and describe the randomization into treatment group(s) and control group and what happens in each group</li>
<li>Identify the outcome of interest, how it is measured</li>
<li>Evaluate the relevant comparison</li>
</ul>
<p>We will turn to an example in the next section.</p>
</div>
</div>
<div id="application-is-there-racial-discrimination-in-the-labor-market" class="section level2" number="3.3">
<h2><span class="header-section-number">3.3</span> Application: Is there racial discrimination in the labor market?</h2>
<p>Marianne Bertrand and Sendhil Mullainathan. 2004. “Are Emily and Greg more
employable than Lakisha and Jamal? A field experiment on labor market discrimination.”</p>
<p>“We perform a field experiment to measure racial discrimination in the labor market. We respond with fictitious resumes to help-wanted ads in Boston and Chicago newspapers.”</p>
<ul>
<li>Recruitment: Construct resumes to send to ads</li>
<li>Randomization: To manipulate perception of race, each resume is (randomly) assigned</li>
<li>Treatment: either a very African American sounding name</li>
<li>Control: or a very White sounding name</li>
<li>Outcome: Does the resume receive a callback?</li>
<li>Comparison: Callback rates for African American (sounding) names vs. White (sounding) names (the difference in means between groups)</li>
</ul>
<p><em>For a video explainer of the code in this section, see below. The video only discusses the code. Use the notes and lecture discussion for additional context. (Via youtube, you can speed up the playback to 1.5 or 2x speed.)</em></p>
<div class="vembedr">
<div>
<iframe src="https://www.youtube.com/embed/LeJkRydMruM" width="533" height="300" frameborder="0" allowfullscreen=""></iframe>
</div>
</div>
<p>Let’s load the data. Note: When we have variables that are text-based categories, we may want to tell R to treat these “strings” of text information as factor variables, a particular type of variable that represents data as a set of nominal (unordered) or ordinal (ordered) categories. We do this with the <code>stringsAsFactors</code> argument.</p>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a>resume <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;resume.csv&quot;</span>, <span class="at">stringsAsFactors =</span> T)</span></code></pre></div>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a>resume <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;https://raw.githubusercontent.com/ktmccabe/teachingdata/main/resume.csv&quot;</span>,</span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">stringsAsFactors =</span> T)</span></code></pre></div>
<p>Variables and Description</p>
<ul>
<li><code>firstname</code>: first name of the fictitious job applicant</li>
<li><code>sex</code>: sex of applicant (female or male)</li>
<li><code>race</code>: race of applicant (black or white)</li>
<li><code>call</code>: whether a callback was made (1 = yes, 0 = no)</li>
</ul>
<p>The data contain 4870 resumes and 4 variables.</p>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(resume) <span class="co"># number of rows</span></span></code></pre></div>
<pre><code>## [1] 4870</code></pre>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ncol</span>(resume) <span class="co"># number of columns</span></span></code></pre></div>
<pre><code>## [1] 4</code></pre>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(resume) <span class="co"># number of rows and columns</span></span></code></pre></div>
<pre><code>## [1] 4870    4</code></pre>
<p>Note: These data look a little different from what we used last week. For example, the <code>sex</code> and <code>race</code> variables contain words, not numbers.</p>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(resume)</span></code></pre></div>
<pre><code>##   firstname    sex  race call
## 1   Allison female white    0
## 2   Kristen female white    0
## 3   Lakisha female black    0
## 4   Latonya female black    0
## 5    Carrie female white    0
## 6       Jay   male white    0</code></pre>
<div id="variable-classes" class="section level3" number="3.3.1">
<h3><span class="header-section-number">3.3.1</span> Variable classes</h3>
<p>We can check the class of each variable: Look, we have a new type, a “factor” variable.</p>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(resume<span class="sc">$</span>firstname)</span></code></pre></div>
<pre><code>## [1] &quot;factor&quot;</code></pre>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(resume<span class="sc">$</span>sex)</span></code></pre></div>
<pre><code>## [1] &quot;factor&quot;</code></pre>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(resume<span class="sc">$</span>race)</span></code></pre></div>
<pre><code>## [1] &quot;factor&quot;</code></pre>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(resume<span class="sc">$</span>call)</span></code></pre></div>
<pre><code>## [1] &quot;integer&quot;</code></pre>
<p>We have now encountered <code>numeric, character</code>, and <code>factor</code> vectors and/or variables in R. Note: This is simply how R understands them. Sometimes R can get it wrong. For example, if we write:</p>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a>somenumbers <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;1&quot;</span>, <span class="st">&quot;3&quot;</span>, <span class="st">&quot;4&quot;</span>)</span>
<span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(somenumbers)</span></code></pre></div>
<pre><code>## [1] &quot;character&quot;</code></pre>
<p>Because we put our numbers in quotation marks, R thinks the values in <code>somenumbers</code> are text. The number “3” might as well be the word “blue” for all R knows. Fortunately, we can easily switch between classes.</p>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a>somenumbers <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(somenumbers)</span>
<span id="cb145-2"><a href="#cb145-2" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(somenumbers)</span></code></pre></div>
<pre><code>## [1] &quot;numeric&quot;</code></pre>
<p>Here, we used <code>as.numeric()</code> to overwrite and change the character vector into a numeric vector.</p>
<p>Rules of Thumb</p>
<ul>
<li>Usually, we want <code>character</code> variables to store text (e.g., open-ended survey responses)</li>
<li>We want <code>numeric</code> variables to store numbers.</li>
<li>Usually, we want <code>factor</code> variables to store categories.
<ul>
<li>Within R, factor variables assign a number to each category, which is given a label or <code>level</code> in the form of text.</li>
<li>Categories might be ordinal or “ordered” (e.g., Very likely, Somewhat likely, Not likely) or</li>
<li>Unordered (e.g., “male”, “female”)</li>
<li>R won’t know if a factor variable is ordered or unordered. Alas, we have to be smarter than R.</li>
<li>R might think you have a character variable when you want it to be a factor or the reverse.
<ul>
<li>That’s when <code>as.factor()</code> and <code>as.character()</code> are useful.</li>
</ul></li>
</ul></li>
<li>Always check <code>class()</code> to find out the variable type</li>
</ul>
</div>
</div>
<div id="making-tables" class="section level2" number="3.4">
<h2><span class="header-section-number">3.4</span> Making tables</h2>
<p>A nice thing about numeric and factor variables is we can use the <code>table</code> command to see how many observations in our data fall into each category or numerical value.</p>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Example: how many black vs. white sounding resumes</span></span>
<span id="cb147-2"><a href="#cb147-2" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(resume<span class="sc">$</span>race)</span></code></pre></div>
<pre><code>## 
## black white 
##  2435  2435</code></pre>
<p>As mentioned, <code>factor</code> variables have levels:</p>
<div class="sourceCode" id="cb149"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(resume<span class="sc">$</span>race)</span></code></pre></div>
<pre><code>## [1] &quot;black&quot; &quot;white&quot;</code></pre>
<div id="crosstabulation" class="section level3" number="3.4.1">
<h3><span class="header-section-number">3.4.1</span> Crosstabulation</h3>
<p>We can also use the <code>table</code> command to show a crosstabulation: a table that displays the frequency of observations across two variables.</p>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Example: how many black vs. white sounding resumes by call backs</span></span>
<span id="cb151-2"><a href="#cb151-2" aria-hidden="true" tabindex="-1"></a><span class="do">## We can label the two dimensions of the table with the =</span></span>
<span id="cb151-3"><a href="#cb151-3" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(<span class="at">calledback =</span> resume<span class="sc">$</span>call, <span class="at">race =</span> resume<span class="sc">$</span>race)</span></code></pre></div>
<pre><code>##           race
## calledback black white
##          0  2278  2200
##          1   157   235</code></pre>
<p>Sometimes we will want to show the proportion instead of the frequency using <code>prop.table</code></p>
<div class="sourceCode" id="cb153"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Example: proportion black vs. white sounding resumes by call backs</span></span>
<span id="cb153-2"><a href="#cb153-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Convert to proportion</span></span>
<span id="cb153-3"><a href="#cb153-3" aria-hidden="true" tabindex="-1"></a><span class="fu">prop.table</span>(<span class="fu">table</span>(<span class="at">calledback =</span> resume<span class="sc">$</span>call, <span class="at">race =</span> resume<span class="sc">$</span>race), <span class="at">margin =</span> <span class="dv">2</span>) <span class="co"># 1 for row sum, 2 for col</span></span></code></pre></div>
<pre><code>##           race
## calledback      black      white
##          0 0.93552361 0.90349076
##          1 0.06447639 0.09650924</code></pre>
<p><strong><em>How can we interpret this crosstabulation? It should let us see the causal effect– the callback rate for each group</em></strong></p>
</div>
</div>
<div id="conditional-means" class="section level2" number="3.5">
<h2><span class="header-section-number">3.5</span> Conditional Means</h2>
<p>Another thing we can do with factor variables is to find how the average of one variable (e.g., our outcome- the callback rate) varies across different categories of our factor variable. For this, we use <code>tapply()</code>.</p>
<div class="sourceCode" id="cb155"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a><span class="do">## take the mean of input1 by categories of input2</span></span>
<span id="cb155-2"><a href="#cb155-2" aria-hidden="true" tabindex="-1"></a><span class="do">## mean of call by race</span></span>
<span id="cb155-3"><a href="#cb155-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tapply</span>(resume<span class="sc">$</span>call, <span class="at">INDEX=</span>resume<span class="sc">$</span>race, mean)</span></code></pre></div>
<pre><code>##      black      white 
## 0.06447639 0.09650924</code></pre>
</div>
<div id="relational-operators-in-r" class="section level2" number="3.6">
<h2><span class="header-section-number">3.6</span> Relational Operators in R</h2>
<p>Goal: Compare callback rates for white sounding names to black sounding names, so we need to be able to filter by race.</p>
<p>Good news: We have several relational operators in R that evaluate logical statements:</p>
<ul>
<li><code>==, &lt;, &gt;, &lt;=, &gt;=, !=</code></li>
<li>We have a statement and R evaluates it as <code>TRUE</code> or <code>FALSE</code></li>
</ul>
<div class="sourceCode" id="cb157"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a><span class="do">## for each observation, does the value of race equal &quot;black&quot;?</span></span>
<span id="cb157-2"><a href="#cb157-2" aria-hidden="true" tabindex="-1"></a>resume<span class="sc">$</span>race <span class="sc">==</span> <span class="st">&quot;black&quot;</span></span></code></pre></div>
<p>By putting this logical statement within <code>[ ]</code>, we are asking R to take the <code>mean()</code> of the variable <code>resume$call</code> for the subset of observations for which this logical statement is <code>TRUE</code>.</p>
<div class="sourceCode" id="cb158"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(resume<span class="sc">$</span>call[resume<span class="sc">$</span>race <span class="sc">==</span> <span class="st">&quot;black&quot;</span>])</span></code></pre></div>
<pre><code>## [1] 0.06447639</code></pre>
<p>Ultimately, each of these paths has led us to a place where we can estimate the average treatment effect by calculation the difference in means: the difference in callback rates for black and white applicants.</p>
<p>We said the ATE = <span class="math inline">\(\bar{Y}(treatment) - \bar{Y}(control)\)</span></p>
<div class="sourceCode" id="cb160"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a>ate <span class="ot">&lt;-</span> <span class="fu">mean</span>(resume<span class="sc">$</span>call[resume<span class="sc">$</span>race <span class="sc">==</span> <span class="st">&quot;black&quot;</span>]) <span class="sc">-</span> </span>
<span id="cb160-2"><a href="#cb160-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean</span>(resume<span class="sc">$</span>call[resume<span class="sc">$</span>race <span class="sc">==</span> <span class="st">&quot;white&quot;</span>])</span>
<span id="cb160-3"><a href="#cb160-3" aria-hidden="true" tabindex="-1"></a>ate</span></code></pre></div>
<pre><code>## [1] -0.03203285</code></pre>
<p>How can we interpret this? Do white applicants have an advantage?</p>
</div>
<div id="subsetting-data-in-r" class="section level2" number="3.7">
<h2><span class="header-section-number">3.7</span> Subsetting data in R</h2>
<p>Subsetting Dataframes in R</p>
<p>Maybe we are interested in differences in callbacks for females. One approach for looking at the treatment effect for female applicants, only, is to subset our data to include only female names.</p>
<ul>
<li>To do this, we will assign a new <code>data.frame</code> object that keeps only those rows where <code>sex == "female"</code> and retains all columns</li>
<li>Below are two approaches for this subsetting, one that uses brackets and one that uses the <code>subset</code> function</li>
</ul>
<div class="sourceCode" id="cb162"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a><span class="do">## option one</span></span>
<span id="cb162-2"><a href="#cb162-2" aria-hidden="true" tabindex="-1"></a>females <span class="ot">&lt;-</span> resume[resume<span class="sc">$</span>sex <span class="sc">==</span> <span class="st">&quot;female&quot;</span>, ]</span>
<span id="cb162-3"><a href="#cb162-3" aria-hidden="true" tabindex="-1"></a><span class="do">## option two using subset()- preferred</span></span>
<span id="cb162-4"><a href="#cb162-4" aria-hidden="true" tabindex="-1"></a>females <span class="ot">&lt;-</span> <span class="fu">subset</span>(resume, sex <span class="sc">==</span> <span class="st">&quot;female&quot;</span>)</span></code></pre></div>
<p>Now that we have subset the data, this simplifies estimating the ATE for female applicants only.</p>
<p>We said the ATE = <span class="math inline">\(\bar{Y}(treatment) - \bar{Y}(control)\)</span></p>
<div class="sourceCode" id="cb163"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a>ate.females <span class="ot">&lt;-</span> <span class="fu">mean</span>(females<span class="sc">$</span>call[females<span class="sc">$</span>race <span class="sc">==</span> <span class="st">&quot;black&quot;</span>]) <span class="sc">-</span></span>
<span id="cb163-2"><a href="#cb163-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean</span>(females<span class="sc">$</span>call[females<span class="sc">$</span>race <span class="sc">==</span> <span class="st">&quot;white&quot;</span>])</span>
<span id="cb163-3"><a href="#cb163-3" aria-hidden="true" tabindex="-1"></a>ate.females</span></code></pre></div>
<pre><code>## [1] -0.03264689</code></pre>
<div id="getting-booooooooolean" class="section level3" number="3.7.1">
<h3><span class="header-section-number">3.7.1</span> Getting Booooooooolean</h3>
<p>We can make this slightly more complex by adding more criteria. Let’s say we wanted to know the callback rates for just female black (sounding) names.</p>
<ul>
<li>R allows use to use <code>&amp;</code> (and) and <code>|</code> (or)</li>
</ul>
<div class="sourceCode" id="cb165"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb165-1"><a href="#cb165-1" aria-hidden="true" tabindex="-1"></a>femaleblack <span class="ot">&lt;-</span> <span class="fu">subset</span>(resume, sex <span class="sc">==</span> <span class="st">&quot;female&quot;</span> <span class="sc">&amp;</span> race <span class="sc">==</span> <span class="st">&quot;black&quot;</span>)</span></code></pre></div>
<p>We could now find the callback rate for Black females using the tools from above:</p>
<div class="sourceCode" id="cb166"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(femaleblack<span class="sc">$</span>call)</span></code></pre></div>
<pre><code>## [1] 0.06627784</code></pre>
</div>
</div>
<div id="creating-new-variables-using-conditional-statements" class="section level2" number="3.8">
<h2><span class="header-section-number">3.8</span> Creating New Variables using Conditional statements</h2>
<p>We can instead create a new variable in our main dataframe. Let’s make a variable that takes the value 1 if a name is female and black sounding and 0, otherwise</p>
<div class="sourceCode" id="cb168"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb168-1"><a href="#cb168-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize a new variable called femaleblackname</span></span>
<span id="cb168-2"><a href="#cb168-2" aria-hidden="true" tabindex="-1"></a>resume<span class="sc">$</span>femaleblackname <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb168-3"><a href="#cb168-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Assign a 1 to our new variable where sex is female and race is black</span></span>
<span id="cb168-4"><a href="#cb168-4" aria-hidden="true" tabindex="-1"></a>resume<span class="sc">$</span>femaleblackname[resume<span class="sc">$</span>sex <span class="sc">==</span> <span class="st">&quot;female&quot;</span> <span class="sc">&amp;</span> resume<span class="sc">$</span>race <span class="sc">==</span> <span class="st">&quot;black&quot;</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb168-5"><a href="#cb168-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Assign a 0 if sex is not female OR if race is not black</span></span>
<span id="cb168-6"><a href="#cb168-6" aria-hidden="true" tabindex="-1"></a>resume<span class="sc">$</span>femaleblackname[resume<span class="sc">$</span>sex <span class="sc">!=</span> <span class="st">&quot;female&quot;</span> <span class="sc">|</span> resume<span class="sc">$</span>race <span class="sc">!=</span> <span class="st">&quot;black&quot;</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span></code></pre></div>
<p>We can check our work</p>
<div class="sourceCode" id="cb169"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb169-1"><a href="#cb169-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(<span class="at">name =</span> resume<span class="sc">$</span>firstname, <span class="at">femaleblack =</span> resume<span class="sc">$</span>femaleblackname)</span></code></pre></div>
<pre><code>##           femaleblack
## name         0   1
##   Aisha      0 180
##   Allison  232   0
##   Anne     242   0
##   Brad      63   0
##   Brendan   65   0
##   Brett     59   0
##   Carrie   168   0
##   Darnell   42   0
##   Ebony      0 208
##   Emily    227   0
##   Geoffrey  59   0
##   Greg      51   0
##   Hakim     55   0
##   Jamal     61   0
##   Jay       67   0
##   Jermaine  52   0
##   Jill     203   0
##   Kareem    64   0
##   Keisha     0 183
##   Kenya      0 196
##   Kristen  213   0
##   Lakisha    0 200
##   Latonya    0 230
##   Latoya     0 226
##   Laurie   195   0
##   Leroy     64   0
##   Matthew   67   0
##   Meredith 187   0
##   Neil      76   0
##   Rasheed   67   0
##   Sarah    193   0
##   Tamika     0 256
##   Tanisha    0 207
##   Todd      68   0
##   Tremayne  69   0
##   Tyrone    75   0</code></pre>
<p>Let’s say we wanted to know the callback rates for just female black (sounding) names.</p>
<div class="sourceCode" id="cb171"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb171-1"><a href="#cb171-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(femaleblack<span class="sc">$</span>call)</span></code></pre></div>
<pre><code>## [1] 0.06627784</code></pre>
<div class="sourceCode" id="cb173"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb173-1"><a href="#cb173-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(resume<span class="sc">$</span>call[resume<span class="sc">$</span>femaleblackname <span class="sc">==</span> <span class="dv">1</span>])</span></code></pre></div>
<pre><code>## [1] 0.06627784</code></pre>
<p>BINGO: two ways to do the same thing.</p>
<div id="ifelse-statements" class="section level3" number="3.8.1">
<h3><span class="header-section-number">3.8.1</span> ifelse statements</h3>
<p>Remember how we created the variable <code>femaleblack</code>, well there is another way to do that in R using what are called conditional statements with <code>ifelse()</code>.</p>
<ul>
<li>Can be read: If this relational statement is <code>TRUE</code>, I assign you A, otherwise I assign you B</li>
</ul>
<div class="sourceCode" id="cb175"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb175-1"><a href="#cb175-1" aria-hidden="true" tabindex="-1"></a>resume<span class="sc">$</span>femaleblackname <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(resume<span class="sc">$</span>sex <span class="sc">==</span> <span class="st">&quot;female&quot;</span> <span class="sc">&amp;</span></span>
<span id="cb175-2"><a href="#cb175-2" aria-hidden="true" tabindex="-1"></a>                                   resume<span class="sc">$</span>race <span class="sc">==</span> <span class="st">&quot;black&quot;</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span></code></pre></div>
<p>Can be read: If sex is female and race is black, give the observation in the new variable a 1, otherwise give it a 0.</p>
<p>Like most things, we can also get more complicated here. Let’s say we wanted to create a variable that indicated both race and sex.</p>
<ul>
<li>Can be read: If this relational statement is <code>TRUE</code>, I assign you A,</li>
<li>Otherwise if this second relational statement is <code>TRUE</code>, I assign you B,</li>
<li>Otherwise if this third relational statement is <code>TRUE</code>, I assign you C,</li>
<li>Otherwise I assign you D</li>
</ul>
<div class="sourceCode" id="cb176"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a>resume<span class="sc">$</span>racesex <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(resume<span class="sc">$</span>sex <span class="sc">==</span> <span class="st">&quot;female&quot;</span> <span class="sc">&amp;</span></span>
<span id="cb176-2"><a href="#cb176-2" aria-hidden="true" tabindex="-1"></a>                                   resume<span class="sc">$</span>race <span class="sc">==</span> <span class="st">&quot;black&quot;</span>, <span class="st">&quot;FemaleBlack&quot;</span>, </span>
<span id="cb176-3"><a href="#cb176-3" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">ifelse</span>(resume<span class="sc">$</span>sex <span class="sc">==</span> <span class="st">&quot;female&quot;</span> <span class="sc">&amp;</span></span>
<span id="cb176-4"><a href="#cb176-4" aria-hidden="true" tabindex="-1"></a>                                   resume<span class="sc">$</span>race <span class="sc">==</span> <span class="st">&quot;white&quot;</span>, <span class="st">&quot;FemaleWhite&quot;</span>,</span>
<span id="cb176-5"><a href="#cb176-5" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">ifelse</span>(resume<span class="sc">$</span>sex <span class="sc">==</span> <span class="st">&quot;male&quot;</span> <span class="sc">&amp;</span></span>
<span id="cb176-6"><a href="#cb176-6" aria-hidden="true" tabindex="-1"></a>                                   resume<span class="sc">$</span>race <span class="sc">==</span> <span class="st">&quot;white&quot;</span>, <span class="st">&quot;MaleWhite&quot;</span>, <span class="st">&quot;MaleBlack&quot;</span>)))</span></code></pre></div>
<p>Note: what you assign can be numeric or text.</p>
</div>
</div>
<div id="types-of-experiments" class="section level2" number="3.9">
<h2><span class="header-section-number">3.9</span> Types of Experiments</h2>
<p>Experiments can vary:</p>
<ul>
<li>Setting: Lab, Survey, Field</li>
<li>Mode: Analog vs. Digital</li>
<li>And in Validity
<ul>
<li>Internal: were the processes conducted in a correct, reliable way?</li>
<li>External: can we generalize from the experiment to the real world, or would the results change?</li>
<li>Context: Would people act the same way outside of the experiment?</li>
<li>Recruitment: Are the people in our experiment representative of the people we care about?</li>
<li>Construct
<ul>
<li>Treatment: Is the experimental treatment similar to what people see in the real world?</li>
<li>Outcome: Is the outcome something we care about in the real world? Are we measuring it in a realistic, accurate way?</li>
</ul></li>
</ul></li>
</ul>
<p>Review <a href="https://www.bitbybitbook.com/en/1st-ed/running-experiments/"><em>Bit by Bit</em></a> chapter 4 for more examples of social science experiments.</p>
<!--chapter:end:03-CausalityI.Rmd-->
</div>
</div>
<div id="visualization" class="section level1" number="4">
<h1><span class="header-section-number">4</span> Visualization</h1>
<p>In this section, we discuss a set of tools for data visualization in R.</p>
<p>Goals of data visualization</p>
<ul>
<li>Communicate information
<ul>
<li>Transparently (show me the data!)</li>
<li>Quickly</li>
<li>Simply</li>
<li>Accurately</li>
<li>And with a little work: beautifully</li>
</ul></li>
</ul>
<p>There are many resources for ideas and best practices for data visualization. See <a href="https://www.tableau.com/learn/articles/best-data-visualization-blogs">here</a> and <a href="https://serialmentor.com/dataviz/index.html">here</a>.</p>
<p>We will cover many types of visuals, each typically designed for a different purpose.</p>
<p>What to communicate?</p>
<ul>
<li>Data summary
<ul>
<li>Central tendency (e.g., mean, median)</li>
<li>Spread (e.g., standard deviation, IQR)</li>
</ul></li>
<li>Comparison
<ul>
<li>e.g., Callback rates for black vs. white sounding names</li>
</ul></li>
<li>Trend
<ul>
<li>e.g., Economic confidence over time</li>
</ul></li>
<li>Relationship
<ul>
<li>e.g., Correlation</li>
</ul></li>
</ul>
<div id="application-social-status-and-economic-views" class="section level2" number="4.1">
<h2><span class="header-section-number">4.1</span> Application: Social Status and Economic Views</h2>
<p>We are going to explore different types of visualizations through different social science examples. The first application we visit is a survey experiment.</p>
<p>Thal, A. (2020). The desire for social status and economic conservatism among affluent Americans. American Political Science Review, 114(2), 426-442.</p>
<p>In the experiment, affluent Americans are randomly assigned to encounter Facebook posts in which others broadcast their economic success. These posts are designed in a way that encourages affluent respondents to view economic success as a means of achieving social status.</p>
<p>Causal claims</p>
<ul>
<li>“I expect that exposure to these posts will cause affluent Americans to become more supportive of conservative economic policies.”</li>
<li>“I also expect that exposure to these posts will cause especially large increases in economic conservatism among affluent men.”</li>
</ul>
<p>The experiment includes a sample of 2010 affluent Americans– people who report household incomes in the top 10 percent of the U.S. income distribution.</p>
<p>Experiment Ingredients:</p>
<ul>
<li>Causal Question: Does desire for social status influence economic views of affluent Americans?</li>
<li>Recruitment: Ask affluent Americans to take a survey online</li>
<li>Randomization: Randomly assign respondents to view different fictional Facebook posts designed to signal different motivations</li>
<li>Outcome: an index based on respondents’ support for decreasing “taxes on households making $150,000 or more a year,” support for decreasing the “taxes on money people make from selling investments, also referred to as capital gains,” and support for decreasing “government regulation of business and industry.”</li>
<li>Comparison: Average economic views between experimental conditions.</li>
</ul>
<p>Snapshot of status conditions</p>
<p><img src="images/status1.png" style="width:70.0%" /></p>
<p>Snapshot of Concrete and Placebo comparison conditions</p>
<p><img src="images/status2.png" style="width:70.0%" /></p>
<p><strong>Can you put this into the potential outcomes framework?</strong></p>
</div>
<div id="boxplots" class="section level2" number="4.2">
<h2><span class="header-section-number">4.2</span> Boxplots</h2>
<p>For a video explainer of the code for boxplots and barplots, see below. The video only discusses the code. Use the notes and lecture discussion for additional context. (Via youtube, you can speed up the playback to 1.5 or 2x speed.)</p>
<div class="vembedr">
<div>
<iframe src="https://www.youtube.com/embed/QmQr4lfrmUc" width="533" height="300" frameborder="0" allowfullscreen=""></iframe>
</div>
</div>
<p>Let’s load the data! Here, note that the data file is in a .RData format instead of .csv. This means that instead of using <code>read.csv</code>, we should use a function to load the data that is suitable for the .RData format. This will be <code>load</code>. That function works the following way:</p>
<div class="sourceCode" id="cb177"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb177-1"><a href="#cb177-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">&quot;status.RData&quot;</span>)</span></code></pre></div>
<p>After running the above code, an object will show up in your R environment.</p>
<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb178-1"><a href="#cb178-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(status)</span></code></pre></div>
<pre><code>##         condition male   econcon
## 2        Concrete    1 0.7500000
## 3     Self-Esteem    1 1.0000000
## 4         Placebo    1 0.6666667
## 5     Self-Esteem    0 0.2500000
## 6     Self-Esteem    0 1.0000000
## 7 Social Approval    0 0.8333333</code></pre>
<p>The data include the following variables</p>
<ul>
<li><code>condition</code>: Placebo, Concrete, Self-Esteem, Social Approval, Conspicuous Consumption</li>
<li><code>gender</code>: 1= male; 0= otherwise</li>
<li><code>econcon</code>: Economic views. Numeric variable from 0 to 1, with higher values reflecting more conservative views</li>
</ul>
<div id="data-summary-boxplot" class="section level3" number="4.2.1">
<h3><span class="header-section-number">4.2.1</span> Data Summary: Boxplot</h3>
<p>Characterize the distributions of continuous numeric variables at once</p>
<ul>
<li>Features: box, whiskers, outliers</li>
<li>We will supply the function with a column in our data, and the boxplot displays the distribution of that variable.</li>
</ul>
<p><img src="images/agebox.png" style="width:80.0%" /></p>
<p><em>Figure from Will Lowe</em></p>
<p>Here is an example of the <code>boxplot</code> using our <code>econcon</code> variable.</p>
<ul>
<li>We have added a title and y-axis label to the plot through the <code>main</code> and <code>ylab</code> arguments. Play around with changing the words in those arguments.</li>
</ul>
<div class="sourceCode" id="cb180"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb180-1"><a href="#cb180-1" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(status<span class="sc">$</span>econcon,</span>
<span id="cb180-2"><a href="#cb180-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">main=</span><span class="st">&quot;Economic Views in the Survey Sample&quot;</span>,</span>
<span id="cb180-3"><a href="#cb180-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">ylab=</span><span class="st">&quot;Economic Views&quot;</span>)</span></code></pre></div>
<p><img src="datasciforpolisci_files/figure-html/unnamed-chunk-88-1.svg" width="672" /></p>
<p>After you execute the plot code, a preview of the plot should appear in the bottom-right window of RStudio.</p>
<p>Boxplots are also useful for data summary across multiple distribution: <code>boxplot(y ~ x, data = d)</code></p>
<div class="sourceCode" id="cb181"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb181-1"><a href="#cb181-1" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(econcon <span class="sc">~</span> condition, <span class="at">data=</span>status,</span>
<span id="cb181-2"><a href="#cb181-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">main=</span><span class="st">&quot;Economic Views by Experimental Condition&quot;</span>,</span>
<span id="cb181-3"><a href="#cb181-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">ylab=</span><span class="st">&quot;Economic Views&quot;</span>,</span>
<span id="cb181-4"><a href="#cb181-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">names =</span> <span class="fu">c</span>(<span class="st">&quot;Placebo&quot;</span>, <span class="st">&quot;Concrete&quot;</span>, <span class="st">&quot;Conspicuous&quot;</span>, </span>
<span id="cb181-5"><a href="#cb181-5" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&quot;Self-Esteem&quot;</span>, <span class="st">&quot;Social&quot;</span>),</span>
<span id="cb181-6"><a href="#cb181-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">xlab =</span> <span class="st">&quot;Experimental Condition&quot;</span>,</span>
<span id="cb181-7"><a href="#cb181-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;red3&quot;</span>, <span class="fu">rep</span>(<span class="st">&quot;dodgerblue&quot;</span>, <span class="dv">4</span>)))</span></code></pre></div>
<p><img src="datasciforpolisci_files/figure-html/unnamed-chunk-89-1.svg" width="1056" /></p>
<p>The additional arguments are just aesthetics. Play around with different settings.</p>
<ul>
<li>For example, can you change the code to make the first two boxes red? Colors are supplied as a vector using the <code>col =</code> argument.
<ul>
<li>To explore colors in R, run this function <code>colors()</code> in your R console.</li>
</ul></li>
</ul>
<p>How should we interpret these results? Does status or social approval motivation, specifically, influence economic views? What about other potential motivations?</p>
</div>
</div>
<div id="barplots" class="section level2" number="4.3">
<h2><span class="header-section-number">4.3</span> Barplots</h2>
<p>Comparing frequencies (raw N), proportions, and/or means across categories</p>
<p><img src="datasciforpolisci_files/figure-html/unnamed-chunk-90-1.svg" width="672" /></p>
<p>We will use the <code>barplot()</code> function.</p>
<ul>
<li>In contrast to the boxplot, the barplot function takes a vector of values that will serve as the top of the bars in the plot– it does not summarize a variable from within the function
<ul>
<li>E.g., we could supply it a set of means to plot, not a raw variable</li>
</ul></li>
<li>Many of the other arguments are aesthetics that will give you <a href="https://www.youtube.com/watch?v=cii6ruuycQA&amp;ab_channel=OliviaRodrigoVEVO">deja vu</a> after working with boxplot.</li>
<li>This means that barplots are pretty easy to create in R. We can supply it a short vector of any values (e.g., <code>valuesbar &lt;- c(20, 40, 50, 10, 60)</code>), and we could also supply it a vector of any names to label those values.
<ul>
<li>For real applications, this means we could supply a barplot with the output of a <code>tapply()</code> function, a <code>table()</code> summarizing a single variable, or a set of <code>mean()</code> values we have combined into a vector.</li>
</ul></li>
</ul>
<p>For example, in experiments, we may use barplots to compare the mean from the treatment group(s) <span class="math inline">\(\bar{Y}(1)\)</span> to the control <span class="math inline">\(\bar{Y}(0)\)</span> on some outcome. Let’s do it!</p>
<ul>
<li>First, we need the means. Let’s find the conditional means of economic views.</li>
</ul>
<div class="sourceCode" id="cb182"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb182-1"><a href="#cb182-1" aria-hidden="true" tabindex="-1"></a>condmeans <span class="ot">&lt;-</span> <span class="fu">tapply</span>(status<span class="sc">$</span>econcon, status<span class="sc">$</span>condition, mean)</span>
<span id="cb182-2"><a href="#cb182-2" aria-hidden="true" tabindex="-1"></a>condmeans <span class="co"># save as object to supply to the barplot function</span></span></code></pre></div>
<pre><code>##                 Placebo                Concrete Conspicuous Consumption 
##               0.6340948               0.6647485               0.6724065 
##             Self-Esteem         Social Approval 
##               0.6564103               0.6904444</code></pre>
<p>The first input is the vector of means/proportions/frequency you want to plot.</p>
<div class="sourceCode" id="cb184"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb184-1"><a href="#cb184-1" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(condmeans,</span>
<span id="cb184-2"><a href="#cb184-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">ylim =</span>  <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="co"># y-axis dimensions</span></span>
<span id="cb184-3"><a href="#cb184-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">names =</span> <span class="fu">c</span>(<span class="st">&quot;Placebo&quot;</span>, <span class="st">&quot;Concrete&quot;</span>, <span class="st">&quot;Conspicuous&quot;</span>, </span>
<span id="cb184-4"><a href="#cb184-4" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&quot;Self-Esteem&quot;</span>, <span class="st">&quot;Social&quot;</span>),</span>
<span id="cb184-5"><a href="#cb184-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">col =</span> <span class="st">&quot;black&quot;</span>, <span class="co"># color of bars</span></span>
<span id="cb184-6"><a href="#cb184-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">&quot;Mean Economic Views by Condition&quot;</span>, <span class="co"># plot title</span></span>
<span id="cb184-7"><a href="#cb184-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">cex.main =</span> .<span class="dv">8</span>, <span class="co"># size of plot title</span></span>
<span id="cb184-8"><a href="#cb184-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">cex.names =</span> .<span class="dv">8</span>, <span class="co"># size of name labels</span></span>
<span id="cb184-9"><a href="#cb184-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">ylab =</span> <span class="st">&quot;Mean Views&quot;</span>, <span class="co"># yaxis label</span></span>
<span id="cb184-10"><a href="#cb184-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">cex.lab =</span> .<span class="dv">8</span>,<span class="co"># size of yaxis label</span></span>
<span id="cb184-11"><a href="#cb184-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">las =</span> <span class="dv">1</span>) <span class="co"># controls angle of axis labels</span></span></code></pre></div>
<p><img src="datasciforpolisci_files/figure-html/unnamed-chunk-92-1.svg" width="672" /></p>
<p>The remaining arguments alter the look of the plot to make it more informative.</p>
<ul>
<li>How could we improve this plot to make the interpretation easier?</li>
</ul>
<div id="saving-plots" class="section level3" number="4.3.1">
<h3><span class="header-section-number">4.3.1</span> Saving Plots</h3>
<p>You can save an image of your plot as a <code>png()</code> to your working directory. Place <code>png()</code> just before your plot with a name in quotations, and then specify the dimensions. Place <code>dev.off()</code> at the bottom.</p>
<div class="sourceCode" id="cb185"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb185-1"><a href="#cb185-1" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="st">&quot;mybarplot.png&quot;</span>, <span class="at">width =</span> <span class="dv">7</span>, <span class="at">height =</span> <span class="dv">4</span>, <span class="at">res=</span><span class="dv">300</span>, <span class="at">units=</span><span class="st">&quot;in&quot;</span>)</span>
<span id="cb185-2"><a href="#cb185-2" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(condmeans,</span>
<span id="cb185-3"><a href="#cb185-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">ylim =</span>  <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="co"># y-axis dimensions</span></span>
<span id="cb185-4"><a href="#cb185-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">names =</span> <span class="fu">c</span>(<span class="st">&quot;Placebo&quot;</span>, <span class="st">&quot;Concrete&quot;</span>, <span class="st">&quot;Conspicuous&quot;</span>, </span>
<span id="cb185-5"><a href="#cb185-5" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&quot;Self-Esteem&quot;</span>, <span class="st">&quot;Social&quot;</span>),</span>
<span id="cb185-6"><a href="#cb185-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">col =</span> <span class="st">&quot;black&quot;</span>, <span class="co"># color of bars</span></span>
<span id="cb185-7"><a href="#cb185-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">&quot;Mean Economic Views by Condition&quot;</span>, <span class="co"># plot title</span></span>
<span id="cb185-8"><a href="#cb185-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">cex.main =</span> .<span class="dv">8</span>, <span class="co"># size of plot title</span></span>
<span id="cb185-9"><a href="#cb185-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">cex.names =</span> .<span class="dv">8</span>, <span class="co"># size of name labels</span></span>
<span id="cb185-10"><a href="#cb185-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">ylab =</span> <span class="st">&quot;Mean Views&quot;</span>, <span class="co"># yaxis label</span></span>
<span id="cb185-11"><a href="#cb185-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">cex.lab =</span> .<span class="dv">8</span>,<span class="co"># size of yaxis label</span></span>
<span id="cb185-12"><a href="#cb185-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">las =</span> <span class="dv">1</span>) <span class="co"># controls angle of axis labels</span></span>
<span id="cb185-13"><a href="#cb185-13" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code></pre></div>
</div>
<div id="creating-new-variables" class="section level3" number="4.3.2">
<h3><span class="header-section-number">4.3.2</span> Creating New Variables</h3>
<p>The author theorizes that social approval, self-esteem, and conspicuous consumption are all elements of “status motivation.” We could analyze the results by collapsing them into a single category called “status motivation” and compare it to the other experimental groups.</p>
<ul>
<li>Create a new variable <code>conditionnew</code></li>
<li>Code the variable into new categories based on the values in the original <code>condition</code> variable</li>
<li>Check the class of the new variable and convert if necessary</li>
<li>Verify new variable by exploring values</li>
</ul>
<div class="sourceCode" id="cb186"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb186-1"><a href="#cb186-1" aria-hidden="true" tabindex="-1"></a>status<span class="sc">$</span>conditionnew <span class="ot">&lt;-</span> <span class="cn">NA</span> <span class="co"># create new variable</span></span>
<span id="cb186-2"><a href="#cb186-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Code new variable</span></span>
<span id="cb186-3"><a href="#cb186-3" aria-hidden="true" tabindex="-1"></a>status<span class="sc">$</span>conditionnew[status<span class="sc">$</span>condition <span class="sc">==</span> <span class="st">&quot;Placebo&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;Placebo&quot;</span></span>
<span id="cb186-4"><a href="#cb186-4" aria-hidden="true" tabindex="-1"></a>status<span class="sc">$</span>conditionnew[status<span class="sc">$</span>condition <span class="sc">==</span> <span class="st">&quot;Concrete&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;Concrete&quot;</span></span>
<span id="cb186-5"><a href="#cb186-5" aria-hidden="true" tabindex="-1"></a>status<span class="sc">$</span>conditionnew[status<span class="sc">$</span>condition <span class="sc">==</span> <span class="st">&quot;Conspicuous Consumption&quot;</span> <span class="sc">|</span></span>
<span id="cb186-6"><a href="#cb186-6" aria-hidden="true" tabindex="-1"></a>                     status<span class="sc">$</span>condition <span class="sc">==</span> <span class="st">&quot;Self-Esteem&quot;</span> <span class="sc">|</span>  </span>
<span id="cb186-7"><a href="#cb186-7" aria-hidden="true" tabindex="-1"></a>                      status<span class="sc">$</span>condition <span class="sc">==</span> <span class="st">&quot;Social Approval&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;Status&quot;</span></span>
<span id="cb186-8"><a href="#cb186-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-9"><a href="#cb186-9" aria-hidden="true" tabindex="-1"></a><span class="co"># class(status$conditionnew) check the class</span></span>
<span id="cb186-10"><a href="#cb186-10" aria-hidden="true" tabindex="-1"></a>status<span class="sc">$</span>conditionnew <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(status<span class="sc">$</span>conditionnew) <span class="co"># convert</span></span></code></pre></div>
<p>An alternative way to create the new variable is through an <code>ifelse</code> statement.</p>
<ul>
<li>Can be read: If this relational statement is <code>TRUE</code>, I assign you A, otherwise I assign you B</li>
<li>This often works best when we change factor variables to character</li>
</ul>
<div class="sourceCode" id="cb187"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb187-1"><a href="#cb187-1" aria-hidden="true" tabindex="-1"></a>status<span class="sc">$</span>conditionnew2 <span class="ot">&lt;-</span> <span class="fu">as.character</span>(status<span class="sc">$</span>condition)</span>
<span id="cb187-2"><a href="#cb187-2" aria-hidden="true" tabindex="-1"></a>status<span class="sc">$</span>conditionnew2 <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(status<span class="sc">$</span>condition <span class="sc">==</span> <span class="st">&quot;Conspicuous Consumption&quot;</span> <span class="sc">|</span></span>
<span id="cb187-3"><a href="#cb187-3" aria-hidden="true" tabindex="-1"></a>                     status<span class="sc">$</span>condition <span class="sc">==</span> <span class="st">&quot;Self-Esteem&quot;</span> <span class="sc">|</span>  </span>
<span id="cb187-4"><a href="#cb187-4" aria-hidden="true" tabindex="-1"></a>                      status<span class="sc">$</span>condition <span class="sc">==</span> <span class="st">&quot;Social Approval&quot;</span>, </span>
<span id="cb187-5"><a href="#cb187-5" aria-hidden="true" tabindex="-1"></a>                     <span class="st">&quot;Status&quot;</span>, status<span class="sc">$</span>conditionnew2)</span>
<span id="cb187-6"><a href="#cb187-6" aria-hidden="true" tabindex="-1"></a>status<span class="sc">$</span>conditionnew2 <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(status<span class="sc">$</span>conditionnew2)</span>
<span id="cb187-7"><a href="#cb187-7" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(status<span class="sc">$</span>conditionnew2)</span></code></pre></div>
<pre><code>## 
## Concrete  Placebo   Status 
##      391      394     1157</code></pre>
<p>Note: Barplots don’t have to display means. We could also display frequencies. For example, let’s make a plot of the number of people in each condition using our new variable.</p>
<div class="sourceCode" id="cb189"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb189-1"><a href="#cb189-1" aria-hidden="true" tabindex="-1"></a>freqobs <span class="ot">&lt;-</span> <span class="fu">table</span>(status<span class="sc">$</span>conditionnew)</span>
<span id="cb189-2"><a href="#cb189-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-3"><a href="#cb189-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-4"><a href="#cb189-4" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(freqobs,</span>
<span id="cb189-5"><a href="#cb189-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1200</span>),</span>
<span id="cb189-6"><a href="#cb189-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">col =</span> <span class="st">&quot;black&quot;</span>, <span class="co"># color of bars</span></span>
<span id="cb189-7"><a href="#cb189-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">&quot;Number of People per Condition&quot;</span>, <span class="co"># plot title</span></span>
<span id="cb189-8"><a href="#cb189-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">cex.main =</span> .<span class="dv">8</span>, <span class="co"># size of plot title</span></span>
<span id="cb189-9"><a href="#cb189-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">cex.names =</span> .<span class="dv">8</span>, <span class="co"># size of name labels</span></span>
<span id="cb189-10"><a href="#cb189-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">ylab =</span> <span class="st">&quot;N of Observations&quot;</span>, <span class="co"># yaxis label</span></span>
<span id="cb189-11"><a href="#cb189-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">cex.lab =</span> .<span class="dv">8</span>,<span class="co"># size of yaxis label</span></span>
<span id="cb189-12"><a href="#cb189-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">las =</span> <span class="dv">1</span>) <span class="co"># controls angle of axis labels</span></span></code></pre></div>
<p><img src="datasciforpolisci_files/figure-html/unnamed-chunk-96-1.svg" width="672" /></p>
</div>
</div>
<div id="application-changing-minds-on-gay-marriage" class="section level2" number="4.4">
<h2><span class="header-section-number">4.4</span> Application: Changing Minds on Gay Marriage</h2>
<p>We now turn to a study that asks the question</p>
<ul>
<li>Research Question Can we effectively persuade people to change their minds?
<ul>
<li><em>Contact Hypothesis</em>: outgroup hostility diminishes through extended positive contact</li>
</ul></li>
</ul>
<p>The authors conduct two randomized control trials in Los Angeles</p>
<ul>
<li><em>Target population</em>: voters in Los Angeles</li>
<li><em>Recruitment</em>: select people from a registered voter list</li>
<li><em>Randomized treatment conditions</em>:
<ul>
<li>Canvassers have a conversation about same-sex marriage vs. </li>
<li>Recycling scripts (placebo)</li>
<li>Control group: no canvassing</li>
</ul></li>
<li><em>Outcome measures</em>:
<ul>
<li>Feeling towards gay couples (survey responses over multiple waves)</li>
</ul></li>
<li><em>Comparison</em>
<ul>
<li>Compare average change in feelings between treatment conditions</li>
</ul></li>
</ul>
<p>Let’s load the data. Data available through QSS. See QSS Chapter 2 for additional discussion.</p>
<ul>
<li><code>study</code>: Which study is the data from (<code>1</code> = Study1, <code>2</code> = Study2)</li>
<li><code>treatment</code>: Five possible treatment assignment options</li>
<li><code>therm1</code>: Survey thermometer rating of feeling towards gay couples in waves 1 (0–100) (asked before people were canvassed)</li>
<li><code>therm2</code>: Survey thermometer rating of feeling towards gay couples in waves 2 (0–100) (asked after people were canvassed)</li>
</ul>
<div class="sourceCode" id="cb190"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb190-1"><a href="#cb190-1" aria-hidden="true" tabindex="-1"></a>marriage <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;gayreshaped.csv&quot;</span>, <span class="at">stringsAsFactors =</span> T)</span></code></pre></div>
<div class="sourceCode" id="cb191"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb191-1"><a href="#cb191-1" aria-hidden="true" tabindex="-1"></a><span class="do">## How many rows and columns</span></span>
<span id="cb191-2"><a href="#cb191-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(marriage)</span></code></pre></div>
<pre><code>## [1] 11948     6</code></pre>
<div class="sourceCode" id="cb193"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb193-1"><a href="#cb193-1" aria-hidden="true" tabindex="-1"></a><span class="do">## How many observations in each treatment group, in each study</span></span>
<span id="cb193-2"><a href="#cb193-2" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(marriage<span class="sc">$</span>treatment, marriage<span class="sc">$</span>study)</span></code></pre></div>
<pre><code>##                                                 
##                                                     1    2
##   No Contact                                     5238 1203
##   Recycling Script by Gay Canvasser              1046    0
##   Recycling Script by Straight Canvasser         1039    0
##   Same-Sex Marriage Script by Gay Canvasser      1151 1238
##   Same-Sex Marriage Script by Straight Canvasser 1033    0</code></pre>
<p>For a video explainer of the code for the barplot, scatter plot and histogram created with this application, see below. The video only discusses the code. Use the notes and lecture discussion for additional context. (Via youtube, you can speed up the playback to 1.5 or 2x speed.)</p>
<div class="vembedr">
<div>
<iframe src="https://www.youtube.com/embed/ukexpAulAAk" width="533" height="300" frameborder="0" allowfullscreen=""></iframe>
</div>
</div>
<p>Let’s focus on study 1 only.</p>
<div class="sourceCode" id="cb195"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb195-1"><a href="#cb195-1" aria-hidden="true" tabindex="-1"></a>marriage1 <span class="ot">&lt;-</span> <span class="fu">subset</span>(marriage, study <span class="sc">==</span>  <span class="dv">1</span>)</span></code></pre></div>
<p>We have to do some work to prepare our outcome and treatment conditions.</p>
<p>In experiments, we compare the mean from the treatment group(s) <span class="math inline">\(\bar{Y}(1)\)</span> to the control <span class="math inline">\(\bar{Y}(0)\)</span> on some outcome</p>
<ul>
<li>Here are outcome is Change in Support for gay couples: Wave 2 - Wave 1 feeling thermometer scores</li>
</ul>
<div class="sourceCode" id="cb196"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb196-1"><a href="#cb196-1" aria-hidden="true" tabindex="-1"></a>marriage1<span class="sc">$</span>outcome <span class="ot">&lt;-</span> marriage1<span class="sc">$</span>therm2 <span class="sc">-</span> marriage1<span class="sc">$</span>therm1</span></code></pre></div>
<div id="creating-new-variable" class="section level3" number="4.4.1">
<h3><span class="header-section-number">4.4.1</span> Creating new variable</h3>
<p>Let’s create a new variable <code>treatmentnew</code> that collapses the two Recycling and Same-Sex marriage conditions.</p>
<div class="sourceCode" id="cb197"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb197-1"><a href="#cb197-1" aria-hidden="true" tabindex="-1"></a>marriage1<span class="sc">$</span>treatmentnew <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb197-2"><a href="#cb197-2" aria-hidden="true" tabindex="-1"></a>marriage1<span class="sc">$</span>treatmentnew[marriage1<span class="sc">$</span>treatment <span class="sc">==</span> <span class="st">&quot;No Contact&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;No Contact&quot;</span></span>
<span id="cb197-3"><a href="#cb197-3" aria-hidden="true" tabindex="-1"></a>marriage1<span class="sc">$</span>treatmentnew[marriage1<span class="sc">$</span>treatment <span class="sc">==</span> <span class="st">&quot;Recycling Script by Gay Canvasser&quot;</span> <span class="sc">|</span></span>
<span id="cb197-4"><a href="#cb197-4" aria-hidden="true" tabindex="-1"></a>                         marriage1<span class="sc">$</span>treatment <span class="sc">==</span> </span>
<span id="cb197-5"><a href="#cb197-5" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;Recycling Script by Straight Canvasser&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;Recycling&quot;</span></span>
<span id="cb197-6"><a href="#cb197-6" aria-hidden="true" tabindex="-1"></a>marriage1<span class="sc">$</span>treatmentnew[marriage1<span class="sc">$</span>treatment <span class="sc">==</span> <span class="st">&quot;Same-Sex Marriage Script by Gay Canvasser&quot;</span> <span class="sc">|</span></span>
<span id="cb197-7"><a href="#cb197-7" aria-hidden="true" tabindex="-1"></a>                         marriage1<span class="sc">$</span>treatment <span class="sc">==</span></span>
<span id="cb197-8"><a href="#cb197-8" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;Same-Sex Marriage Script by Straight Canvasser&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;Marriage&quot;</span></span>
<span id="cb197-9"><a href="#cb197-9" aria-hidden="true" tabindex="-1"></a>marriage1<span class="sc">$</span>treatmentnew <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(marriage1<span class="sc">$</span>treatmentnew)</span>
<span id="cb197-10"><a href="#cb197-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb197-11"><a href="#cb197-11" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(marriage1<span class="sc">$</span>treatmentnew)</span></code></pre></div>
<pre><code>## 
##   Marriage No Contact  Recycling 
##       2184       5238       2085</code></pre>
</div>
<div id="using-ifelse-to-create-new-variable" class="section level3" number="4.4.2">
<h3><span class="header-section-number">4.4.2</span> Using ifelse to create new variable</h3>
<p>An alternative way we could create a variable is to use <code>ifelse</code></p>
<p>Let’s try another way using the <code>ifelse</code> command.</p>
<ul>
<li>Can be read: If this relational statement is <code>TRUE</code>, I assign you A (in this case “No Contact”), otherwise (<code>ifelse()</code>)</li>
<li>if this alternative relational statement is <code>TRUE</code>, I assign you B (in this case “Recycling”), otherwise (<code>ifelse()</code>)</li>
<li>if this alternative relational statement is <code>TRUE</code>, I assign you C (in this case “Marriage”), otherwise</li>
<li>If all of those were <code>FALSE</code> I assign you D (in this case an <code>NA</code>)</li>
</ul>
<div class="sourceCode" id="cb199"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb199-1"><a href="#cb199-1" aria-hidden="true" tabindex="-1"></a>marriage1<span class="sc">$</span>treatmentnew2 <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(marriage1<span class="sc">$</span>treatment <span class="sc">==</span> <span class="st">&quot;No Contact&quot;</span>, <span class="st">&quot;No Contact&quot;</span>,</span>
<span id="cb199-2"><a href="#cb199-2" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">ifelse</span>(marriage1<span class="sc">$</span>treatment <span class="sc">==</span> </span>
<span id="cb199-3"><a href="#cb199-3" aria-hidden="true" tabindex="-1"></a>                                           <span class="st">&quot;Recycling Script by Gay Canvasser&quot;</span> <span class="sc">|</span></span>
<span id="cb199-4"><a href="#cb199-4" aria-hidden="true" tabindex="-1"></a>                                           marriage1<span class="sc">$</span>treatment <span class="sc">==</span>  </span>
<span id="cb199-5"><a href="#cb199-5" aria-hidden="true" tabindex="-1"></a>                                           <span class="st">&quot;Recycling Script by Straight Canvasser&quot;</span>,  </span>
<span id="cb199-6"><a href="#cb199-6" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">&quot;Recycling&quot;</span>,</span>
<span id="cb199-7"><a href="#cb199-7" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">ifelse</span>(marriage1<span class="sc">$</span>treatment <span class="sc">==</span></span>
<span id="cb199-8"><a href="#cb199-8" aria-hidden="true" tabindex="-1"></a>                                        <span class="st">&quot;Same-Sex Marriage Script by Gay Canvasser&quot;</span> <span class="sc">|</span>  </span>
<span id="cb199-9"><a href="#cb199-9" aria-hidden="true" tabindex="-1"></a>                                            marriage1<span class="sc">$</span>treatment <span class="sc">==</span></span>
<span id="cb199-10"><a href="#cb199-10" aria-hidden="true" tabindex="-1"></a>                                        <span class="st">&quot;Same-Sex Marriage Script by Straight Canvasser&quot;</span>,</span>
<span id="cb199-11"><a href="#cb199-11" aria-hidden="true" tabindex="-1"></a>                                        <span class="st">&quot;Marriage&quot;</span>, </span>
<span id="cb199-12"><a href="#cb199-12" aria-hidden="true" tabindex="-1"></a>                                        <span class="cn">NA</span>)))</span>
<span id="cb199-13"><a href="#cb199-13" aria-hidden="true" tabindex="-1"></a>marriage1<span class="sc">$</span>treatmentnew2 <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(marriage1<span class="sc">$</span>treatmentnew2)</span></code></pre></div>
</div>
<div id="calculating-the-average-treatment-effect" class="section level3" number="4.4.3">
<h3><span class="header-section-number">4.4.3</span> Calculating the Average Treatment Effect</h3>
<p>We now have our outcome and our treatment conditions. In an experiment, we want to look at the difference in means between conditions. Let’s calculate the means.</p>
<div class="sourceCode" id="cb200"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb200-1"><a href="#cb200-1" aria-hidden="true" tabindex="-1"></a>outs <span class="ot">&lt;-</span> <span class="fu">tapply</span>(marriage1<span class="sc">$</span>outcome, marriage1<span class="sc">$</span>treatmentnew, mean, <span class="at">na.rm=</span>T)</span></code></pre></div>
<p>Note: Sometimes data include missing cells. In R, these have an <code>NA</code>. To ignore these when calculating a mean, we add <code>na.rm = T</code> to the <code>mean()</code> or <code>tapply()</code> functions.</p>
</div>
<div id="visualize-means-in-a-barplot" class="section level3" number="4.4.4">
<h3><span class="header-section-number">4.4.4</span> Visualize means in a barplot</h3>
<p>Let’s also add a line at 0 using <code>abline()</code></p>
<div class="sourceCode" id="cb201"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb201-1"><a href="#cb201-1" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(outs,</span>
<span id="cb201-2"><a href="#cb201-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">col=</span><span class="st">&quot;black&quot;</span>,</span>
<span id="cb201-3"><a href="#cb201-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">ylim =</span>  <span class="fu">c</span>(<span class="sc">-</span><span class="dv">2</span>, <span class="dv">2</span>), <span class="co"># y-axis dimensions</span></span>
<span id="cb201-4"><a href="#cb201-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">border =</span> <span class="cn">NA</span>, <span class="co"># removes bar borders</span></span>
<span id="cb201-5"><a href="#cb201-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">&quot;Change in FT W2-W1 by Type of Treatment&quot;</span>, <span class="co"># plot title</span></span>
<span id="cb201-6"><a href="#cb201-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">cex.main =</span> .<span class="dv">8</span>, <span class="co"># size of plot title</span></span>
<span id="cb201-7"><a href="#cb201-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">ylab =</span> <span class="st">&quot;Mean Change in FT W2-W1&quot;</span>, <span class="co"># yaxis label</span></span>
<span id="cb201-8"><a href="#cb201-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">cex.lab =</span> .<span class="dv">8</span>,<span class="co"># size of yaxis label</span></span>
<span id="cb201-9"><a href="#cb201-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">las =</span> <span class="dv">1</span>) <span class="co"># controls angle of axis labels</span></span>
<span id="cb201-10"><a href="#cb201-10" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h=</span><span class="dv">0</span>, <span class="at">lty=</span><span class="dv">2</span>, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>, <span class="at">lwd=</span><span class="dv">2</span>) <span class="co"># adds horizontal line at 0 with dashes </span></span></code></pre></div>
<p><img src="datasciforpolisci_files/figure-html/unnamed-chunk-106-1.svg" width="672" /></p>
<p>How should we interpret these results?</p>
<ul>
<li>In the Marriage condition, it looks like on average, views toward gay couples became warmer (the bar is positive) after the conversations with canvassers about same-sex marriage.</li>
<li>In contrast, the views of people in the Recycling or No Contact conditions did not change much and if anything, became slightly colder.</li>
<li>Comparing between these bars, then, it seems like there is an “average treatment effect” given that the change in the Marriage condition was different from the Recycling an No Contact control groups.</li>
</ul>
</div>
</div>
<div id="scatterplots" class="section level2" number="4.5">
<h2><span class="header-section-number">4.5</span> Scatterplots</h2>
<p>It turns out that study was completely fabricated, and the article was eventually <a href="https://www.newyorker.com/science/maria-konnikova/how-a-gay-marriage-study-went-wrong">retracted</a>.</p>
<p>How did people know? Well a team of researchers became suspicious based on exploratory analyses they conducted with the data. Let’s do a few of these to learn about scatterplots and histograms.</p>
<p>Scatter plots show the relationship between two numeric variables.</p>
<p>A common way to describe and quantify a relationship is through correlation.</p>
<ul>
<li>Correlation: When <span class="math inline">\(x\)</span> changes, <span class="math inline">\(y\)</span> also changes by a fixed proportion
<ul>
<li>Asks: If you are a certain degree above the mean of <span class="math inline">\(x\)</span>, are you similarly that much above the mean of <span class="math inline">\(y\)</span>?</li>
<li>Positive correlation: data cloud slopes up;</li>
<li>Negative correlation: data cloud slopes down;</li>
<li>High positive or negative correlation: data cluster tightly around a sloped line</li>
<li>Not affected by changes of scale: cm vs. inch, etc.</li>
</ul></li>
</ul>
<p>Range of Correlation is between <span class="math inline">\(-1\)</span> and <span class="math inline">\(1\)</span></p>
<ul>
<li>Look at the graphs below for examples of high and low positive and negative correlations.</li>
</ul>
<div class="figure">
<img src="images/corrdummies.png" style="width:60.0%" alt="" />
<p class="caption"><em>R for Dummies</em></p>
</div>
<p>The <code>plot()</code> function in R works using x and y coordinates.</p>
<ul>
<li>We have to tell R precisely at which x- and y- coordinates to place points (e.g., place a point at <code>x=20</code> and <code>y=40</code>)</li>
<li>In practice, we will generally supply R with a vector of x-coordindates and a vector of corresponding y-coordinates.</li>
</ul>
<p>To illustrate a scatterplot, we will examine the relationship between the Wave 1 and Wave 2 feeling thermometer scores in the field experiment, for just the control “No Contact” condition.</p>
<div class="sourceCode" id="cb202"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb202-1"><a href="#cb202-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Subset data to look at control only</span></span>
<span id="cb202-2"><a href="#cb202-2" aria-hidden="true" tabindex="-1"></a>controlonly <span class="ot">&lt;-</span> <span class="fu">subset</span>(marriage1, treatment <span class="sc">==</span> <span class="st">&quot;No Contact&quot;</span>)</span></code></pre></div>
<p>In the <code>plot()</code>, we supply the x and y vectors.</p>
<ul>
<li><code>xlim</code> and <code>ylim</code> specify the range of the x and y axis.</li>
<li><code>pch</code> is the point type. You can play around with that number to view different plot types</li>
</ul>
<div class="sourceCode" id="cb203"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb203-1"><a href="#cb203-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x=</span>controlonly<span class="sc">$</span>therm1, <span class="at">y=</span>controlonly<span class="sc">$</span>therm2, </span>
<span id="cb203-2"><a href="#cb203-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">&quot;Relationship between W1 and  W2&quot;</span>,</span>
<span id="cb203-3"><a href="#cb203-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&quot;Wave 1&quot;</span>, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>),</span>
<span id="cb203-4"><a href="#cb203-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">&quot;Wave 2&quot;</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>),</span>
<span id="cb203-5"><a href="#cb203-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">pch =</span> <span class="dv">20</span>)</span></code></pre></div>
<p><img src="datasciforpolisci_files/figure-html/unnamed-chunk-108-1.svg" width="672" /></p>
<p>The correlation looks extremely high! It is positively sloped and tightly clustered.</p>
<p>In fact, if we use R’s function to quantify a correlation between two variables, we will see it is a correlation above .99, very close to the maximum value.</p>
<ul>
<li>By default, R calculate the “pearson” correlation coefficient, a number that will be between -1 and 1. It represents the strength of the linear association between two variables.</li>
</ul>
<div class="sourceCode" id="cb204"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb204-1"><a href="#cb204-1" aria-hidden="true" tabindex="-1"></a><span class="do">## use = &quot;pairwise&quot; means to use all observations where neither variable has missing NA data</span></span>
<span id="cb204-2"><a href="#cb204-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(marriage1<span class="sc">$</span>therm1, marriage1<span class="sc">$</span>therm2, <span class="at">use =</span> <span class="st">&quot;pairwise&quot;</span>)</span></code></pre></div>
<pre><code>## [1] 0.995313</code></pre>
<p>This high correlation was unusual for this type of data.</p>
<ul>
<li>Feeling thermometers suffer from low reliability. How a person answers the question at one point in time (perhaps 83) in Wave 1 often differs from the numbers they say when asked again at a future point in time in Wave 2. A person’s responses often aren’t that stable.</li>
<li>Because there was such a high correlation, it suggested that the data might not have been generated by real human responses</li>
</ul>
</div>
<div id="histograms" class="section level2" number="4.6">
<h2><span class="header-section-number">4.6</span> Histograms</h2>
<p>The researchers later discovered the Wave 1 data was suspiciously correlated with an existing survey: 2012 CCAP.</p>
<ul>
<li>They believe the researcher likely used CCAP for Wave 1 - used survey responses from real humans that took a real survey – but not the humans that the researcher claimed to interview in the experiment.</li>
<li>Then the researcher generated the Wave 2 data by adding random noise to the Wave 1 data</li>
<li>Part of why they believe this has to do with a histogram plot they generated to compare Waves 1 and 2</li>
</ul>
<p>A histogram is a useful plot for summarizing the distribution of a single variable.</p>
<ul>
<li>It shows the frequency of observations (e.g., the number of survey respondents) who give an answer within a particular interval of numeric values</li>
</ul>
<p>Because a histogram is a single variable summary, we just supply R with the numeric variable we want to summarize.</p>
<ul>
<li>The new argument here <code>breaks</code> tells R how many of the individual rectangles we want. You can play around with that number to see how the plot changes.</li>
</ul>
<div class="sourceCode" id="cb206"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb206-1"><a href="#cb206-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(<span class="at">x=</span>controlonly<span class="sc">$</span>therm1, <span class="at">breaks=</span><span class="dv">50</span>,</span>
<span id="cb206-2"><a href="#cb206-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">&quot;W1 Histogram&quot;</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1000</span>))</span></code></pre></div>
<p><img src="datasciforpolisci_files/figure-html/unnamed-chunk-110-1.svg" width="672" /></p>
<div class="sourceCode" id="cb207"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb207-1"><a href="#cb207-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(<span class="at">x=</span>controlonly<span class="sc">$</span>therm2,<span class="at">breaks=</span><span class="dv">50</span>,</span>
<span id="cb207-2"><a href="#cb207-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">&quot;W2 Histogram&quot;</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1000</span>))  </span></code></pre></div>
<p><img src="datasciforpolisci_files/figure-html/unnamed-chunk-110-2.svg" width="672" /></p>
<p>The researchers noticed that the heaping patterns were different between Wave 1 and Wave 2.</p>
<ul>
<li>When real humans answer these types of feeling thermometer questions, we often see heaping (tall spikes) at values of 0, 50, and 100. Humans tend to gravitate toward those nice round numbers to anchor their responses. In addition, often researchers might recode people with missing responses (people who skip a question), as having a score of 50, increasing the number at that point.
<ul>
<li>Wave 1 has a lot of this heaping– look at the higher bars around 0, 50, and 100, suggesting a lot of survey respondents gave those answers.</li>
<li>However, Wave 2 has less heaping, particularly at 50. This suggested to the researchers that the Wave 2 data were likely generated by a computer and not real humans</li>
</ul></li>
</ul>
<div id="happy-research-ending" class="section level3" number="4.6.1">
<h3><span class="header-section-number">4.6.1</span> Happy research ending</h3>
<p>While the original article was retracted</p>
<ul>
<li>Researchers who found irregularities received funding to conduct similar studies with real data this time</li>
<li>Multiple publications suggest the canvassing approach was effective:
<ul>
<li>Broockman and Kalla. 2016. “Durably reducing transphobia: A field experiment on door-to-door canvassing” Science 352 no. 6282.</li>
<li>Broockman and Kalla. 2020. “Reducing exclusionary attitudes through interpersonal conversation: evidence from three field experiments.” American Political Science Review</li>
<li>Kalla and Broockman. 2021. “Which narrative strategies durably reduce prejudice? Evidence from field and survey experiments supporting the efficacy of perspective-getting.” American Journal of Political Science. Forthcoming.</li>
</ul></li>
</ul>
</div>
</div>
<div id="application-trends-during-covid" class="section level2" number="4.7">
<h2><span class="header-section-number">4.7</span> Application: Trends during COVID</h2>
<p>For a video companion for sections 4.7-4.9 and the code for line/trend plots, see below. The video only discusses the notes and code. (Via youtube, you can speed up the playback to 1.5 or 2x speed.)</p>
<div class="vembedr">
<div>
<iframe src="https://www.youtube.com/embed/UNJximu2suM" width="533" height="300" frameborder="0" allowfullscreen=""></iframe>
</div>
</div>
<p>Since the onset of the pandemic in 2020, researchers have evaluated attitudinal and behavioral responses to policy changes, political messages, and COVID case/hospitalization/death rates.</p>
<ul>
<li>Survey data on attitudes and self-reported behavior</li>
<li>Health care provider administrative data</li>
<li>Mobile phone data to track locations</li>
<li>Social media data to track attitudes and mobility</li>
</ul>
<p><strong><em>Example: Using Survey data from over 1.1 million responses</em></strong> to measure concern about the coronavirus over time.</p>
<ul>
<li>Clinton, Joshua, et al. “<a href="https://www.science.org/doi/10.1126/sciadv.abd7204">Partisan pandemic: How partisanship and public health concerns affect individuals’ social mobility during COVID-19</a>.” Science advances 7.2 (2021): eabd7204.</li>
</ul>
<p><img src="images/covidsurvey.png" /></p>
<p><strong><em>Example: Using the geotracking data of 15 million smartphones</em></strong> per day to compute percentage reduction in general movement and visiting non-essential services relative to before COVID-19 (before March 9).</p>
<ul>
<li>Gollwitzer, Anton, et al. “<a href="https://www.nature.com/articles/s41562-020-00977-7">Partisan differences in physical distancing are linked to health outcomes during the COVID-19 pandemic</a>.” Nature human behaviour 4.11 (2020): 1186-1197.</li>
</ul>
<p><img src="images/covidphone.png" /></p>
<p><strong><em>Example: Using Twitter geolocation data</em></strong> to track how much movement users have by looking at the distances from all locations where a given user has tweeted.</p>
<ul>
<li>Paiheng Xu, Mark Dredze, David A Broniatowski. “<a href="https://socialmobility.covid19dataresources.org/">The Twitter Social Mobility Index: Measuring Social Distancing Practices from Geolocated Tweets</a>.” Journal of Medical Internet Research (JMIR), 2020.</li>
</ul>
<p><img src="images/covidtwitter.png" /></p>
<p>We will use the Twitter social mobility index to study how the movement of geo-located Twitter users changed from 2019 into September 2021.</p>
<ul>
<li>We will compare this movement for users located in the Northeast vs. South</li>
</ul>
<p>Each row of the dataset represents a week of the year. Each column represents a particular geography for which social mobility was calculated by the researchers.</p>
<ul>
<li><code>Dates</code> indicates the date</li>
<li><code>Northeast</code>: social mobility data for those in the northeast of the U.S.</li>
<li><code>South</code>: social mobility data for those in the south of the U.S.</li>
</ul>
<div class="sourceCode" id="cb208"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb208-1"><a href="#cb208-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Load the data from the author Mark Dredze&#39;s website</span></span>
<span id="cb208-2"><a href="#cb208-2" aria-hidden="true" tabindex="-1"></a>covid <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;https://raw.githubusercontent.com/mdredze/covid19_social_mobility.github.io/master/data/longitudinal_compiled.csv&quot;</span>)</span></code></pre></div>
<p>Just like we have encountered numeric, factor, and character variables, R also has the ability to treat variables specifically as dates. We will want R to treat the date variable we read in as a date, and not as raw text or some other variable type. To do this, we will use the <code>as.Date</code> function.</p>
<div class="sourceCode" id="cb209"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb209-1"><a href="#cb209-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Date variable original format and class</span></span>
<span id="cb209-2"><a href="#cb209-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(covid<span class="sc">$</span>Dates)</span></code></pre></div>
<pre><code>## [1] &quot;2019-01-01&quot; &quot;2019-01-07&quot; &quot;2019-01-14&quot; &quot;2019-01-21&quot; &quot;2019-01-28&quot;
## [6] &quot;2019-02-04&quot;</code></pre>
<div class="sourceCode" id="cb211"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb211-1"><a href="#cb211-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(covid<span class="sc">$</span>Dates)</span></code></pre></div>
<pre><code>## [1] &quot;character&quot;</code></pre>
<div class="sourceCode" id="cb213"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb213-1"><a href="#cb213-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Convert to class Date</span></span>
<span id="cb213-2"><a href="#cb213-2" aria-hidden="true" tabindex="-1"></a>covid<span class="sc">$</span>Dates <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(covid<span class="sc">$</span>Date)</span>
<span id="cb213-3"><a href="#cb213-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(covid<span class="sc">$</span>Dates)</span></code></pre></div>
<pre><code>## [1] &quot;2019-01-01&quot; &quot;2019-01-07&quot; &quot;2019-01-14&quot; &quot;2019-01-21&quot; &quot;2019-01-28&quot;
## [6] &quot;2019-02-04&quot;</code></pre>
<div class="sourceCode" id="cb215"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb215-1"><a href="#cb215-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(covid<span class="sc">$</span>Dates)</span></code></pre></div>
<pre><code>## [1] &quot;Date&quot;</code></pre>
<p>The researchers continue to add to these data. Let’s look at the portion of data from 2019 to September 2021.</p>
<ul>
<li>Note the use of <code>as.Date</code> again to make sure R knows our text should be treated as a date</li>
<li>Note the use of the greater than or equal to <code>&gt;=</code> and less than or equal signs <code>&lt;=</code> to specify which rows we want to keep in the data. We want rows that are in dates after January 1, 2019 and (<code>&amp;</code>) on or before September 1, 2021.</li>
</ul>
<div class="sourceCode" id="cb217"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb217-1"><a href="#cb217-1" aria-hidden="true" tabindex="-1"></a>covidsub <span class="ot">&lt;-</span> <span class="fu">subset</span>(covid, Dates <span class="sc">&gt;=</span> <span class="fu">as.Date</span>(<span class="st">&quot;2019-01-01&quot;</span>) <span class="sc">&amp;</span></span>
<span id="cb217-2"><a href="#cb217-2" aria-hidden="true" tabindex="-1"></a>                     Dates <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">&quot;2021-09-01&quot;</span>))</span></code></pre></div>
</div>
<div id="line-plots-in-r" class="section level2" number="4.8">
<h2><span class="header-section-number">4.8</span> Line Plots in R</h2>
<p>Where we are going …</p>
<p><img src="datasciforpolisci_files/figure-html/unnamed-chunk-115-1.svg" width="672" /></p>
<p>Starting from the bottom …</p>
<ul>
<li>Let’s first create a scatterplot by providing R with our two variables</li>
<li>In a trend/line plot, we want time on the x-axis, in this case the <code>Dates</code> column</li>
<li>We want our outcome on the y-axis, in this case, social mobility</li>
<li>Ultimately we will want to compare the Northeast with the South. We will plot one line at a time, starting with the Northeast</li>
</ul>
<div class="sourceCode" id="cb218"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb218-1"><a href="#cb218-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x=</span>covidsub<span class="sc">$</span>Dates,<span class="at">y=</span>covidsub<span class="sc">$</span>Northeast, <span class="at">pch=</span><span class="dv">16</span>) <span class="co"># pch is point type</span></span></code></pre></div>
<p><img src="datasciforpolisci_files/figure-html/unnamed-chunk-116-1.svg" width="672" /></p>
<p>We now transform it to a line by specifying <code>type="l"</code></p>
<ul>
<li>By default, R creates a plot with <code>type=p</code> for points. R also has <code>type=b</code> which has both a line and points.</li>
</ul>
<div class="sourceCode" id="cb219"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb219-1"><a href="#cb219-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x=</span>covidsub<span class="sc">$</span>Dates,<span class="at">y=</span>covidsub<span class="sc">$</span>Northeast,<span class="at">type=</span><span class="st">&quot;l&quot;</span>) <span class="co"># makes it a line</span></span></code></pre></div>
<p><img src="datasciforpolisci_files/figure-html/unnamed-chunk-117-1.svg" width="672" /></p>
<p>Let us change the aesthetics a bit by adding labels and removing the border with <code>bty="n"</code>.</p>
<div class="sourceCode" id="cb220"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb220-1"><a href="#cb220-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x=</span>covid<span class="sc">$</span>Dates,<span class="at">y=</span>covid<span class="sc">$</span>Northeast,</span>
<span id="cb220-2"><a href="#cb220-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">type=</span><span class="st">&quot;l&quot;</span>, </span>
<span id="cb220-3"><a href="#cb220-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="st">&quot;Social Mobility by Date and Region&quot;</span>,</span>
<span id="cb220-4"><a href="#cb220-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab=</span><span class="st">&quot;Twitter Social Mobility Index&quot;</span>,</span>
<span id="cb220-5"><a href="#cb220-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">&quot;&quot;</span>,</span>
<span id="cb220-6"><a href="#cb220-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">80</span>), <span class="co"># y-axis limits</span></span>
<span id="cb220-7"><a href="#cb220-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">las=</span><span class="dv">1</span>, <span class="co"># orientation of axis labels</span></span>
<span id="cb220-8"><a href="#cb220-8" aria-hidden="true" tabindex="-1"></a>     <span class="at">lwd=</span><span class="dv">2</span>, <span class="co"># line width</span></span>
<span id="cb220-9"><a href="#cb220-9" aria-hidden="true" tabindex="-1"></a>     <span class="at">bty=</span><span class="st">&quot;n&quot;</span>) <span class="co"># removes border</span></span></code></pre></div>
<p><img src="datasciforpolisci_files/figure-html/unnamed-chunk-118-1.svg" width="672" /></p>
<p>Let’s add a comparison line with the <code>lines()</code> function to look at trends for the south.</p>
<ul>
<li>Note that this is outside of the <code>plot()</code> function, but the inputs are very similar. We supply a set of x and y coordindates.</li>
</ul>
<div class="sourceCode" id="cb221"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb221-1"><a href="#cb221-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x=</span>covid<span class="sc">$</span>Dates,<span class="at">y=</span>covid<span class="sc">$</span>Northeast,</span>
<span id="cb221-2"><a href="#cb221-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">type=</span><span class="st">&quot;l&quot;</span>, <span class="at">pch=</span><span class="dv">15</span>,</span>
<span id="cb221-3"><a href="#cb221-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="st">&quot;Social Mobility by Date and Region&quot;</span>,</span>
<span id="cb221-4"><a href="#cb221-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab=</span><span class="st">&quot;Twitter Social Mobility Index&quot;</span>,</span>
<span id="cb221-5"><a href="#cb221-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">&quot;&quot;</span>,</span>
<span id="cb221-6"><a href="#cb221-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">80</span>), <span class="at">las=</span><span class="dv">1</span>,</span>
<span id="cb221-7"><a href="#cb221-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">lwd=</span><span class="dv">2</span>,</span>
<span id="cb221-8"><a href="#cb221-8" aria-hidden="true" tabindex="-1"></a>     <span class="at">bty=</span><span class="st">&quot;n&quot;</span>)</span>
<span id="cb221-9"><a href="#cb221-9" aria-hidden="true" tabindex="-1"></a><span class="do">## Add line to the plot </span></span>
<span id="cb221-10"><a href="#cb221-10" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x=</span>covid<span class="sc">$</span>Dates,<span class="at">y=</span>covid<span class="sc">$</span>South, <span class="at">col=</span><span class="st">&quot;red3&quot;</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span></code></pre></div>
<p><img src="datasciforpolisci_files/figure-html/unnamed-chunk-119-1.svg" width="672" /></p>
<p>Let’s create our own axis for the plot to add detail. To do this, we add <code>xaxt</code> to the <code>plot</code> function and then use <code>axis()</code> below the function.</p>
<div class="sourceCode" id="cb222"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb222-1"><a href="#cb222-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x=</span>covid<span class="sc">$</span>Dates,<span class="at">y=</span>covid<span class="sc">$</span>Northeast,</span>
<span id="cb222-2"><a href="#cb222-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">type=</span><span class="st">&quot;l&quot;</span>, <span class="at">pch=</span><span class="dv">15</span>,</span>
<span id="cb222-3"><a href="#cb222-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="st">&quot;Social Mobility by Date and Region&quot;</span>,</span>
<span id="cb222-4"><a href="#cb222-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab=</span><span class="st">&quot;Twitter Social Mobility Index&quot;</span>,</span>
<span id="cb222-5"><a href="#cb222-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">&quot;&quot;</span>,</span>
<span id="cb222-6"><a href="#cb222-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">80</span>), <span class="at">las=</span><span class="dv">1</span>,</span>
<span id="cb222-7"><a href="#cb222-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">lwd=</span><span class="dv">2</span>,</span>
<span id="cb222-8"><a href="#cb222-8" aria-hidden="true" tabindex="-1"></a>     <span class="at">bty=</span><span class="st">&quot;n&quot;</span>,</span>
<span id="cb222-9"><a href="#cb222-9" aria-hidden="true" tabindex="-1"></a>     <span class="at">xaxt=</span><span class="st">&quot;n&quot;</span>) <span class="co"># remove original x-axis</span></span>
<span id="cb222-10"><a href="#cb222-10" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x=</span>covid<span class="sc">$</span>Dates,<span class="at">y=</span>covid<span class="sc">$</span>South, <span class="at">col=</span><span class="st">&quot;red3&quot;</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb222-11"><a href="#cb222-11" aria-hidden="true" tabindex="-1"></a><span class="do">## create the numbers we want to add to the new x-axis</span></span>
<span id="cb222-12"><a href="#cb222-12" aria-hidden="true" tabindex="-1"></a>axisdates <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">as.Date</span>(<span class="st">&quot;2019-01-01&quot;</span>), <span class="fu">as.Date</span>(<span class="st">&quot;2021-09-01&quot;</span>), <span class="at">by=</span><span class="st">&quot;month&quot;</span>)</span>
<span id="cb222-13"><a href="#cb222-13" aria-hidden="true" tabindex="-1"></a><span class="do">## add the axis the &quot;1&quot; means x-axis. A &quot;2&quot; would create a y-axis</span></span>
<span id="cb222-14"><a href="#cb222-14" aria-hidden="true" tabindex="-1"></a><span class="do">## the format argument is unique to this date example</span></span>
<span id="cb222-15"><a href="#cb222-15" aria-hidden="true" tabindex="-1"></a><span class="do">### &quot;%b-%Y&quot; are telling R to display the month and year, with the month in words</span></span>
<span id="cb222-16"><a href="#cb222-16" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">1</span>, <span class="at">at =</span> axisdates, <span class="at">labels=</span><span class="fu">format</span>(axisdates, <span class="st">&quot;%b-%Y&quot;</span>), <span class="at">las=</span><span class="dv">2</span>)</span></code></pre></div>
<p><img src="datasciforpolisci_files/figure-html/unnamed-chunk-120-1.svg" width="672" /></p>
<p>Finally, let’s add a <code>legend()</code>. Now we’re here!</p>
<div class="sourceCode" id="cb223"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb223-1"><a href="#cb223-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x=</span>covid<span class="sc">$</span>Dates,<span class="at">y=</span>covid<span class="sc">$</span>Northeast,</span>
<span id="cb223-2"><a href="#cb223-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">type=</span><span class="st">&quot;l&quot;</span>, <span class="at">pch=</span><span class="dv">15</span>,</span>
<span id="cb223-3"><a href="#cb223-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="st">&quot;Social Mobility by Date and Region&quot;</span>,</span>
<span id="cb223-4"><a href="#cb223-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab=</span><span class="st">&quot;Twitter Social Mobility Index&quot;</span>,</span>
<span id="cb223-5"><a href="#cb223-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">&quot;&quot;</span>,</span>
<span id="cb223-6"><a href="#cb223-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">80</span>), <span class="at">las=</span><span class="dv">1</span>,</span>
<span id="cb223-7"><a href="#cb223-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">lwd=</span><span class="dv">2</span>,</span>
<span id="cb223-8"><a href="#cb223-8" aria-hidden="true" tabindex="-1"></a>     <span class="at">bty=</span><span class="st">&quot;n&quot;</span>,</span>
<span id="cb223-9"><a href="#cb223-9" aria-hidden="true" tabindex="-1"></a>     <span class="at">xaxt=</span><span class="st">&quot;n&quot;</span>)</span>
<span id="cb223-10"><a href="#cb223-10" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x=</span>covid<span class="sc">$</span>Dates,<span class="at">y=</span>covid<span class="sc">$</span>South, <span class="at">col=</span><span class="st">&quot;red3&quot;</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb223-11"><a href="#cb223-11" aria-hidden="true" tabindex="-1"></a>axisdates <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">as.Date</span>(<span class="st">&quot;2019-01-01&quot;</span>), <span class="fu">as.Date</span>(<span class="st">&quot;2021-09-01&quot;</span>), <span class="at">by=</span><span class="st">&quot;month&quot;</span>)</span>
<span id="cb223-12"><a href="#cb223-12" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">1</span>, <span class="at">at =</span> axisdates, <span class="fu">format</span>(axisdates, <span class="st">&quot;%b-%Y&quot;</span>), <span class="at">las=</span><span class="dv">2</span>)</span>
<span id="cb223-13"><a href="#cb223-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb223-14"><a href="#cb223-14" aria-hidden="true" tabindex="-1"></a><span class="do">## Add legend, &quot;bottomleft&quot; indicates where on the plot to locate it</span></span>
<span id="cb223-15"><a href="#cb223-15" aria-hidden="true" tabindex="-1"></a><span class="do">## Could use &quot;topright&quot; instead, for example</span></span>
<span id="cb223-16"><a href="#cb223-16" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;bottomleft&quot;</span>,  <span class="at">col=</span><span class="fu">c</span>(<span class="st">&quot;red3&quot;</span>, <span class="st">&quot;black&quot;</span>), </span>
<span id="cb223-17"><a href="#cb223-17" aria-hidden="true" tabindex="-1"></a>       <span class="fu">c</span>(<span class="st">&quot;South&quot;</span>, <span class="st">&quot;Northeast&quot;</span>), </span>
<span id="cb223-18"><a href="#cb223-18" aria-hidden="true" tabindex="-1"></a>       <span class="at">cex =</span> .<span class="dv">7</span>, <span class="co"># size of legend</span></span>
<span id="cb223-19"><a href="#cb223-19" aria-hidden="true" tabindex="-1"></a>       <span class="at">lwd=</span><span class="dv">2</span>,</span>
<span id="cb223-20"><a href="#cb223-20" aria-hidden="true" tabindex="-1"></a>       <span class="at">bty=</span><span class="st">&quot;n&quot;</span>)</span></code></pre></div>
<p><img src="datasciforpolisci_files/figure-html/unnamed-chunk-121-1.svg" width="672" /></p>
</div>
<div id="causal-claims-from-before-vs.-after-comparisons" class="section level2" number="4.9">
<h2><span class="header-section-number">4.9</span> Causal claims from before vs. after comparisons</h2>
<p><strong><em>What types of research questions could these trends generate?</em></strong></p>
<p><img src="datasciforpolisci_files/figure-html/unnamed-chunk-122-1.svg" width="672" /></p>
<p>What would you want to know about how movement has changed since the start of COVID?</p>
<ul>
<li>We will do an initial exploration to reveal some of the difficulties with making causal claims when we do not have the luxury of conducting an experiment. This discussion will continue in the next section.</li>
</ul>
<p>One thing that becomes apparent in the trend data is that mobility decreased substantially after mid-March of 2020. As many of us know all too well, that corresponds to shortly after the onset of the pandemic in the United States.</p>
<p>With that said, we may ask</p>
<ul>
<li>What specifically caused the sudden decrease in mobility?
<ul>
<li>Did the announcement of federal guidelines to “slow the spread” have a causal effect on mobility?</li>
<li>Did the rise in COVID cases during that time have a causal effect on mobility?</li>
<li>Did gubernatorial actions at the state level cause mobility to decrease?</li>
</ul></li>
</ul>
<p>For each of these questions, we could implement the potential outcomes framework.</p>
<ul>
<li>For example, we want to compare mobility (<span class="math inline">\(Y\)</span>) in the state of the world where a governor has announced social distancing and stay-at-home restrictions (<span class="math inline">\(Y(1)_{governor}\)</span>) to mobility in a state of the world where the governor has not announced those restrictions (<span class="math inline">\(Y(0)_{governor}\)</span>), holding everything else the same. Here we run into two problems.
<ul>
<li>Our friend, the fundamental problem of causal inference. We only get to observe one state of the world for any particular governor.</li>
<li>It would be hard to turn this into an experiment. We cannot go back in time and ask governors to come together for a field experiment that randomly assigns which states get restrictions and which do not.
<ul>
<li>While there is variation– not all states had restrictions, this was not random.</li>
</ul></li>
</ul></li>
<li>Likewise, if we wanted to compare mobility (<span class="math inline">\(Y\)</span>) in the state of the world where the federal government has announced social distancing and stay-at-home restrictions (<span class="math inline">\(Y(1)_{president}\)</span>) to mobility in a state of the world where the president has not announced those restrictions (<span class="math inline">\(Y(0)_{president}\)</span>), holding everything else the same. Here we run into the same two problems.
<ul>
<li>The fundamental problem of causal inference. We only get to observe one state of the world at any given point in time.</li>
<li>It may be hard to generate an experiment that simulates the idea of these two states of the world.</li>
</ul></li>
</ul>
<p>So what can we do?</p>
<ul>
<li>Researchers try to form comparison groups, in a strategic way, with the data they have (i.e., “observational” or “non-experimental” data).</li>
<li>Because they cannot randomly assign two different experiences of the world, instead they choose two cases or two groups of cases that
<ul>
<li>Seem extremely similar except</li>
<li>One has the treatment of interest, and one does not</li>
</ul></li>
</ul>
<p><strong>Example: Before vs. After Comparison</strong></p>
<p>Let’s examine social mobility just before vs. just after the federal announcement of social distancing guidelines to stop the spread of COVID-19.</p>
<ul>
<li>To do so, we will draw a verticle line at March 16, 2020
<ul>
<li>Note we use <code>abline(v=)</code> to indicate a vertical line at a location</li>
</ul></li>
<li>We will also add text to inform views what that line represents
<ul>
<li>Note we use <code>text(x= , y=, labels)</code> to indicate where to put text</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb224"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb224-1"><a href="#cb224-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x=</span>covid<span class="sc">$</span>Dates,<span class="at">y=</span>covid<span class="sc">$</span>Northeast,</span>
<span id="cb224-2"><a href="#cb224-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">type=</span><span class="st">&quot;l&quot;</span>, <span class="at">pch=</span><span class="dv">15</span>,</span>
<span id="cb224-3"><a href="#cb224-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="st">&quot;Social Mobility by Date and Region&quot;</span>,</span>
<span id="cb224-4"><a href="#cb224-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab=</span><span class="st">&quot;Twitter Social Mobility Index&quot;</span>,</span>
<span id="cb224-5"><a href="#cb224-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">&quot;&quot;</span>,</span>
<span id="cb224-6"><a href="#cb224-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">80</span>), <span class="at">las=</span><span class="dv">1</span>,</span>
<span id="cb224-7"><a href="#cb224-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">lwd=</span><span class="dv">2</span>,</span>
<span id="cb224-8"><a href="#cb224-8" aria-hidden="true" tabindex="-1"></a>     <span class="at">bty=</span><span class="st">&quot;n&quot;</span>,</span>
<span id="cb224-9"><a href="#cb224-9" aria-hidden="true" tabindex="-1"></a>     <span class="at">xaxt=</span><span class="st">&quot;n&quot;</span>)</span>
<span id="cb224-10"><a href="#cb224-10" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x=</span>covid<span class="sc">$</span>Dates,<span class="at">y=</span>covid<span class="sc">$</span>South, <span class="at">col=</span><span class="st">&quot;red3&quot;</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb224-11"><a href="#cb224-11" aria-hidden="true" tabindex="-1"></a>axisdates <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">as.Date</span>(<span class="st">&quot;2019-01-01&quot;</span>), <span class="fu">as.Date</span>(<span class="st">&quot;2021-09-01&quot;</span>), <span class="at">by=</span><span class="st">&quot;month&quot;</span>)</span>
<span id="cb224-12"><a href="#cb224-12" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">1</span>, <span class="at">at =</span> axisdates, <span class="fu">format</span>(axisdates, <span class="st">&quot;%b-%Y&quot;</span>), <span class="at">las=</span><span class="dv">2</span>, <span class="at">cex.axis=</span>.<span class="dv">7</span>)</span>
<span id="cb224-13"><a href="#cb224-13" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;bottomleft&quot;</span>,  <span class="at">col=</span><span class="fu">c</span>(<span class="st">&quot;red3&quot;</span>, <span class="st">&quot;black&quot;</span>), </span>
<span id="cb224-14"><a href="#cb224-14" aria-hidden="true" tabindex="-1"></a>       <span class="fu">c</span>(<span class="st">&quot;South&quot;</span>, <span class="st">&quot;Northeast&quot;</span>), <span class="at">cex =</span> .<span class="dv">7</span>, <span class="at">lty=</span><span class="dv">1</span>,<span class="at">lwd=</span><span class="dv">2</span>,</span>
<span id="cb224-15"><a href="#cb224-15" aria-hidden="true" tabindex="-1"></a>       <span class="at">bty=</span><span class="st">&quot;n&quot;</span>)</span>
<span id="cb224-16"><a href="#cb224-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-17"><a href="#cb224-17" aria-hidden="true" tabindex="-1"></a><span class="do">## add dashed blue vertical line</span></span>
<span id="cb224-18"><a href="#cb224-18" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span><span class="fu">as.Date</span>(<span class="st">&quot;2020-03-16&quot;</span>), <span class="at">lty=</span><span class="dv">2</span>, <span class="at">col=</span><span class="st">&quot;dodgerblue&quot;</span>, <span class="at">lwd=</span><span class="fl">1.5</span>)</span>
<span id="cb224-19"><a href="#cb224-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-20"><a href="#cb224-20" aria-hidden="true" tabindex="-1"></a><span class="do">## add text near the line</span></span>
<span id="cb224-21"><a href="#cb224-21" aria-hidden="true" tabindex="-1"></a><span class="do">## the \n breaks the text into different lines</span></span>
<span id="cb224-22"><a href="#cb224-22" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="at">x=</span><span class="fu">as.Date</span>(<span class="st">&quot;2020-05-01&quot;</span>), <span class="at">y=</span><span class="dv">65</span>, <span class="at">labels =</span> <span class="st">&quot;Federal </span><span class="sc">\n</span><span class="st"> Announcement&quot;</span>, <span class="at">cex=</span>.<span class="dv">6</span>)</span></code></pre></div>
<p><img src="datasciforpolisci_files/figure-html/unnamed-chunk-123-1.svg" width="672" /></p>
<p>We see mobility does appear to be lower after the announcement relative to before the announcement. Is this causal?</p>
<ul>
<li>Assumption: We would want to be able to argue that social mobility in the weeks following the announcement (after time period) would look similar to social mobility in the weeks prior to the announcement (before period) <strong>if not for the federal announcement</strong>
<ul>
<li>That the before vs. after time periods would be similar in any meaningful way if not for the presence of the treatment in the after period.</li>
</ul></li>
</ul>
<p>Does this seem like a plausible argument? Could other things (confounders) occurring around the time of the federal announcement also have caused the steep decline in social mobility?</p>
<ul>
<li>If we think something else happened around the same time that might have caused mobility to go down anyway, then we may be doubtful that this is a <em>causal</em> effect.</li>
</ul>
<p>We will continue to discuss similar causal designs in the next section.</p>
</div>
<div id="visual-tips-and-tricks" class="section level2" number="4.10">
<h2><span class="header-section-number">4.10</span> Visual tips and tricks</h2>
<p>Recall we said the goals of visualization are to communicate information</p>
<ul>
<li>Transparently (show me the data!)</li>
<li>Quickly</li>
<li>Simply</li>
<li>Accurately</li>
<li>And with a little work: beautifully</li>
</ul>
<p>What NOT to communicate?</p>
<p><img src="images/honestrunway.jpeg" style="width:70.0%" /></p>
<p>Claus Wilke provides an overview of rules of thumb to fall when creating a data visualization on the Serial Mentor <a href="https://serialmentor.com/dataviz/">website</a>.</p>
<p>An example is below</p>
<p><img src="images/ugbadwrong.png" /></p>
<p>Overall, the best thing to do is to look at your visual from a consumer’s <a href="https://www.youtube.com/watch?v=nQJEp-k-ogs&amp;ab_channel=ArianaGrandeVevo">point of view</a>. You want your visuals to be intuitive enough for a viewer to be able to interpret it without too much help from you or explanatory text elsewhere in a paper or presentation. Our goal is to help consumers of our data understand the main takeaways of our research easily and accurately.</p>
<ul>
<li>We want to make sure our visuals always have informative labels that a lay person can understand (instead of technical variable names, we can use plain language)
<ul>
<li>We may need to add a legend or additional text to a visual to help with this</li>
</ul></li>
<li>We want to choose colors to convey information. We want to avoid colors that are hard to see or might distract consumers.</li>
<li>The axis dimensions should not be misleading. If the goal is to compare two or more plots to each other, we would want them to have similar axes, for example.</li>
</ul>
</div>
<div id="common-r-plotting-functions-and-arguments" class="section level2" number="4.11">
<h2><span class="header-section-number">4.11</span> Common R plotting functions and arguments</h2>
<p>Here is a refresher of several of the functions and arguments we have come across.</p>
<p>Create a plot</p>
<ul>
<li><code>plot()</code>: for scatterplots and trend plots</li>
<li><code>barplot()</code>: for barplot comparisons across categories</li>
<li><code>boxplot()</code>: boxplot for summaries of numeric variables</li>
<li><code>hist()</code>: for histogram summaries of a single numeric variable</li>
</ul>
<p>Aesthetic arguments within a plot</p>
<ul>
<li><code>main =</code>: Specifies the main title of the plot. Supply text (e.g., <code>main = "my title"</code>)</li>
<li><code>ylab =</code>: Specifies the title of the y-axis. Supply text (e.g., <code>ylab = "Mean of variable"</code>)</li>
<li><code>xlab =</code>: Specifies the title of the x-axis. Supply text (e.g., <code>xlab = "X variable name"</code>)</li>
<li><code>ylim =</code>: Specifies the range of the y-axis. Supply vector of two numbers (e.g., <code>ylim = c(0, 100)</code>)</li>
<li><code>xlim =</code>: Specifies the range of the x-axis. Supply vector of two numbers (e.g., <code>xlim = c(0, 100)</code>)</li>
<li><code>bty="n"</code>: Removes the border box around the plot</li>
<li><code>cex</code>, <code>cex.main</code>, <code>cex.names</code>, <code>cex.lab</code>, <code>cex.axis</code>: Changes the size of different elements of a plot. Default is 1, so a value of .8 would be smaller than default, and 1.2 would be bigger than normal.</li>
<li><code>type =</code>: Specifies the type of plot (e.g., <code>type="l"</code> is a line plot, <code>type="b"</code> is a plot with points and lines connecting them)</li>
<li><code>lwd=</code>: Specifies the width of a line on a plot. Default is 1. E.g., <code>lwd=3</code> makes a line much thicker</li>
<li><code>pch=</code>: Specifies the point type. E.g., <code>pch=15</code></li>
<li><code>lty=</code>: Specifies the line type. E.g., <code>lty=2</code> is a dashed line</li>
<li><code>col=</code>: Specifies the color of the central element of the plot. Can take a single color or vector of colors. Use <code>colors()</code> in the console to see all R colors.</li>
<li><code>names</code>: Specifies a set of labels in a barplot</li>
</ul>
<p>Ways to annotate a plot (generally added below the initial plotting function)</p>
<ul>
<li><code>abline()</code>: Adds a line to the plot at a particular point on the x- or y- intercept, either horizontal, vertical, or of a particular slope
<ul>
<li>Example: Adding a horizontal line at a particular at a y value of 2 <code>abline(h=2)</code></li>
<li>Example: Adding a vertical line at a particular at a x value of 2 <code>abline(v=2)</code></li>
</ul></li>
<li><code>lines(x=, y=)</code>: Adds a line connecting pairs of x- and y-coordinates. We used this to add the South line to the social mobility plot.</li>
<li><code>axis()</code>: Used to replace the default x- or y- axis that R will create with a customized axis
<ul>
<li>To create an original y-axis, use <code>axis(2, vectorofvalues, labels)</code> and specify <code>yaxt="n"</code> inside the plotting function to remove the original y-axis.</li>
<li>To create an original x-axis, use <code>axis(1, vectorofvalues, labels)</code> and specify <code>xaxt="n"</code> inside the plotting function to remove the original x-axis.</li>
</ul></li>
<li><code>legend()</code>: Adds a legend to a plot. Can specify the location as the first argument (e.g., <code>"bottomleft"</code> or <code>"topright"</code>)</li>
<li><code>text()</code>: Adds text to a plot at specific x- and y- locations. (E.g., <code>text(x=3, y=4, "Here is a point"</code>). The x and y arguments can be single numbers or a vector of numbers. x and y need to be the same length.</li>
<li><code>points()</code>: Adds points to a plot at specific x- and y- locations. Inputs are much like <code>plot</code></li>
</ul>
</div>
<div id="a-note-on-ggplot" class="section level2" number="4.12">
<h2><span class="header-section-number">4.12</span> A note on <code>ggplot</code></h2>
<p>R has a number of open-source packages that people can use to expand the set of capabilities for visualization and analysis. These can be installed through RStudio. We will look at one of these packages: <code>ggplot2</code>.</p>
<p><strong><em>Using ggplot will be extra-credit at this point in the course. We may return to it later in the semester as part of the main curriculum. Reviewing this section of the notes is optional.</em></strong></p>
<p>The “gg” in ggplot2 stands for the “Grammar of Graphics.” This program provides another framework for creating figures in R. According to Hadley Wickham, “ggplot2 provides beautiful, hassle-free plots that take care of fiddly details like drawing legends.”</p>
<p>Practically speaking, <code>ggplot()</code> is another tool to plot the same types of figures we have been making in class. Some people prefer <code>ggplot2</code> because they find the logic of building figures more intuitive using this framework and/or more aesthetically pleasing. However, both <code>ggplot()</code> and the plots we have been making in class can accomplish the same ultimate goals of data visualization– to communicate information transparently, quickly, accurately, simply, and beautifully. Which types of plots you may prefer is up to your own taste.</p>
<p>Think of packages like apps on a smartphone.</p>
<ul>
<li>If RStudio is our smartphone, we install a package like you install an app on the phone. You only have to do this once, though occasionally you may want or need to update the installation to a new version.</li>
</ul>
<div class="sourceCode" id="cb225"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb225-1"><a href="#cb225-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Run this line in your R console</span></span>
<span id="cb225-2"><a href="#cb225-2" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;ggplot2&quot;</span>)</span></code></pre></div>
<ul>
<li>On a smartphone, every time you want to use an app after you have installed it, you have to open the app. Similarly, every time we want to open a package in RStudio, we have to open it by using the <code>library()</code> command</li>
</ul>
<div class="sourceCode" id="cb226"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb226-1"><a href="#cb226-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Add and run this line in your R script, above the code where you will use functions from the package</span></span>
<span id="cb226-2"><a href="#cb226-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span></code></pre></div>
<p>The main plotting function in <code>ggplot2</code> is the <code>ggplot()</code> function. It will give you access to barplots, boxplots, scatterplots, histograms, etc.</p>
<ul>
<li>The syntax within this package is a little different from the base R plotting functions. We will investigate below. For now, here is an example of using <code>ggplot</code> to create a boxplot using the experiment on social status from earlier in this section.</li>
</ul>
<div class="sourceCode" id="cb227"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb227-1"><a href="#cb227-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>status, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x=</span>condition, <span class="at">y=</span>econcon)) <span class="sc">+</span></span>
<span id="cb227-2"><a href="#cb227-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>()</span></code></pre></div>
<p><img src="datasciforpolisci_files/figure-html/unnamed-chunk-126-1.svg" width="672" /></p>
<p>The three primary components of a ggplot() are a dataframe (<code>data =</code>), a set of mapping aesthetics (<code>aes()</code>), and <code>geoms</code> (e.g., geom boxplot, geom bar, geom point, geom line, etc.).</p>
<ul>
<li>The function <code>ggplot()</code> first takes a dataframe that includes the values you would like to plot (e.g., <code>data = status</code>).</li>
<li>The aesthetics then include the variable names that you want to plot on the x and y axis (e.g., <code>aes(x=condition, y=econcon)</code>)
<ul>
<li>Additional mapping aesthetics can be specified. For example, a third variable (or a repeat of a previous variable) can also be specified (e.g., <code>fill =</code>, <code>colour =</code>, <code>shape =</code>), which acts as a grouping variable. If this is specified, <code>ggplot()</code> will create a corresponding legend for the plot and will color/make different shapes for different groups within this third variable (See the boxplot below for an example of grouping by condition).</li>
</ul></li>
<li>After closing out the first <code>ggplot()</code> parentheses, you then annotate the plot by adding (<code>+</code>) a geometric layer. This is essentially where you specify the type of plot (though it is possible to have multiple geometric layers).</li>
<li>Just like with the other plotting functions in R, you can also specify a number of other arguments to make your plot more informative and aesthetically pleasing. Here, you do this by adding (<code>+</code>) additional arguments. See examples below (e.g., <code>ggtitle</code>, <code>xlab</code>, <code>ylab</code> for titles, <code>ylim</code> for y-axis limits, etc.)</li>
<li>Likewise, just like with the other plotting functions, you can save your plots as a pdf or png. To do so here, you include the line <code>ggsave()</code> just below your plot.</li>
</ul>
<p>There are many more possibilities for plotting with <code>ggplot()</code>, but these should get you started. For additional resources on all that is gg, I recommend the <a href="https://%20r-graphics.org/">R Graphics Cookbook</a>.</p>
<p>Here is a second version of the boxplot with more aesthetics specified.</p>
<ul>
<li>We will color in the boxes based on the collapsed condition variable.</li>
</ul>
<div class="sourceCode" id="cb228"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb228-1"><a href="#cb228-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>status, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x=</span>condition, <span class="at">y=</span>econcon, <span class="at">fill=</span>conditionnew)) <span class="sc">+</span></span>
<span id="cb228-2"><a href="#cb228-2" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Specifies plot type. E.g., also have geom_point(), geom_bar()</span></span>
<span id="cb228-3"><a href="#cb228-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>()<span class="sc">+</span></span>
<span id="cb228-4"><a href="#cb228-4" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Note many arguments are similar to other R functions but the syntax is a little different</span></span>
<span id="cb228-5"><a href="#cb228-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Economic Views by Experimental Condition&quot;</span>)<span class="sc">+</span></span>
<span id="cb228-6"><a href="#cb228-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Economic Views&quot;</span>)<span class="sc">+</span></span>
<span id="cb228-7"><a href="#cb228-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Experimental Condition&quot;</span>)<span class="sc">+</span></span>
<span id="cb228-8"><a href="#cb228-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="dv">0</span>,<span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb228-9"><a href="#cb228-9" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Changes the overall theme (i.e., color scheme, borders, etc.)</span></span>
<span id="cb228-10"><a href="#cb228-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb228-11"><a href="#cb228-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">&quot;bottom&quot;</span>)</span></code></pre></div>
<p><img src="datasciforpolisci_files/figure-html/unnamed-chunk-127-1.svg" width="672" /></p>
<div class="sourceCode" id="cb229"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb229-1"><a href="#cb229-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">&quot;myboxplot.pdf&quot;</span>, <span class="at">width=</span><span class="dv">7</span>, <span class="at">height=</span><span class="dv">5</span>)</span></code></pre></div>
<p>Here is an example of a histogram from the application on views toward gay couples.</p>
<div class="sourceCode" id="cb230"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb230-1"><a href="#cb230-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(controlonly, <span class="fu">aes</span>(<span class="at">x=</span>therm1)) <span class="sc">+</span></span>
<span id="cb230-2"><a href="#cb230-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb230-3"><a href="#cb230-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;W1 Histogram&quot;</span>) <span class="sc">+</span></span>
<span id="cb230-4"><a href="#cb230-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<p><img src="datasciforpolisci_files/figure-html/unnamed-chunk-128-1.svg" width="672" /></p>
<p>Instead of displaying multiple categories through different shapes or colors, we could also create multiple mini plots instead. This is done through <code>facet</code>. Let’s look at a histogram for each condition for the thermometers in wave 2.</p>
<div class="sourceCode" id="cb231"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb231-1"><a href="#cb231-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(marriage1, <span class="fu">aes</span>(<span class="at">x=</span>therm2)) <span class="sc">+</span></span>
<span id="cb231-2"><a href="#cb231-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb231-3"><a href="#cb231-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;W2 Histogram by Condition&quot;</span>) <span class="sc">+</span></span>
<span id="cb231-4"><a href="#cb231-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Feeling Thermometer Wave 2&quot;</span>)<span class="sc">+</span></span>
<span id="cb231-5"><a href="#cb231-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb231-6"><a href="#cb231-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>treatmentnew)</span></code></pre></div>
<pre><code>## Warning: Removed 1042 rows containing non-finite values (stat_bin).</code></pre>
<p><img src="datasciforpolisci_files/figure-html/unnamed-chunk-129-1.svg" width="672" /></p>
<p>We can similarly create a scatter and line plot. Let’s use the social mobility data. Here we see <code>geom_point</code> and <code>geom_line</code>.</p>
<div class="sourceCode" id="cb233"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb233-1"><a href="#cb233-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Scatterplot</span></span>
<span id="cb233-2"><a href="#cb233-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(covidsub, <span class="fu">aes</span>(<span class="at">x=</span>Dates, <span class="at">y=</span>avg_USA)) <span class="sc">+</span></span>
<span id="cb233-3"><a href="#cb233-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb233-4"><a href="#cb233-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Average Social Mobility in US&quot;</span>) <span class="sc">+</span></span>
<span id="cb233-5"><a href="#cb233-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Date&quot;</span>)<span class="sc">+</span></span>
<span id="cb233-6"><a href="#cb233-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Avg Social Mobility&quot;</span>)</span></code></pre></div>
<pre><code>## Warning: Removed 4 rows containing missing values (geom_point).</code></pre>
<p><img src="datasciforpolisci_files/figure-html/unnamed-chunk-130-1.svg" width="672" /></p>
<div class="sourceCode" id="cb235"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb235-1"><a href="#cb235-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Line plot</span></span>
<span id="cb235-2"><a href="#cb235-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(covidsub, <span class="fu">aes</span>(<span class="at">x=</span>Dates, <span class="at">y=</span>avg_USA)) <span class="sc">+</span></span>
<span id="cb235-3"><a href="#cb235-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb235-4"><a href="#cb235-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Average Social Mobility in US&quot;</span>) <span class="sc">+</span></span>
<span id="cb235-5"><a href="#cb235-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Date&quot;</span>)<span class="sc">+</span></span>
<span id="cb235-6"><a href="#cb235-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Avg Social Mobility&quot;</span>)</span></code></pre></div>
<p><img src="datasciforpolisci_files/figure-html/unnamed-chunk-130-2.svg" width="672" /></p>
<!--chapter:end:04-Visualization.Rmd-->
</div>
</div>
<div id="causalityii" class="section level1" number="5">
<h1><span class="header-section-number">5</span> Causality with Non-Experimental Data</h1>
<p>In this section, we continue to evaluate causal claims, but this time we will not have the benefit of experiments.</p>
<p><strong><em>Recall: Why do we use experiments?</em></strong></p>
<p>We want to evaluate causal claims:</p>
<ul>
<li>Does manipulating one factor (a “treatment”) cause a change in an outcome? (<span class="math inline">\(Y_i(1) - Y_i(0)\)</span>)
<ul>
<li>But we have a problem: the fundamental problem of causal inference</li>
<li>(Can’t simultaneously both be treated and untreated - e.g., you can’t simultaneously be contacted and not contacted by a campaign)</li>
<li>So instead, we randomly assign some units to receive a treatment, and some not to, and then compare their average outcomes in an experiment</li>
</ul></li>
</ul>
<p>And because of random assignment of the treatment, we can be confident that the groups are similar EXCEPT for the treatment</p>
<ul>
<li>Therefore, any difference between the two groups in average outcomes can be attributed to the treatment</li>
</ul>
<p><strong><em>But what if we can’t randomize the treatment?</em></strong></p>
<div id="why-cant-we-always-experiment" class="section level2" number="5.1">
<h2><span class="header-section-number">5.1</span> Why can’t we always experiment?</h2>
<p>Example: Did the way President Biden went about troop removal in Afghanistan cause the government to fail?</p>
<ul>
<li>Our outcome: The stability of the Afghanistan government</li>
<li>Our causal effect of interest <span class="math inline">\(Y_i(1) - Y_i(0)\)</span>:
<ul>
<li>The Afghanistan government based on President Biden’s troop removal plan in 2021 vs.</li>
<li>The Afghanistan government based on an alternative troop removal plan.</li>
</ul></li>
</ul>
<p>What would be our ideal experimental design? We’d want to randomly assign the treatment: troop removal in Afghanistan?</p>
<ul>
<li>We probably would not want to randomize that.</li>
</ul>
<p>Example: Do political leaders tend to matter for democracy?</p>
<ul>
<li>Our outcome: how democratic nations are</li>
<li>Our causal effect of interest:
<ul>
<li>On average, how democratic nations are with their current leaders -</li>
<li>On average, how democratic nations would be with different leaders</li>
</ul></li>
<li>Possible Experimental Designs to randomly assign half of countries to receive a different political leader
<ul>
<li>Rig elections (I.e., Election fraud- Illegal, unethical)</li>
<li>Forcibly remove half from office (Probably illegal)</li>
<li>Assassinations (Illegal, Immoral, Unethical, etc.)</li>
</ul></li>
</ul>
<p>Again, we have problems!!</p>
<div id="what-can-we-do-instead" class="section level3" number="5.1.1">
<h3><span class="header-section-number">5.1.1</span> What can we do instead?</h3>
<p>Let’s say we want to make a causal claim about the effect of one variable on an outcome, but we can’t think of an experimental design that will help us estimate this.</p>
<p><img src="images/popquiz.png" /></p>
<p>What do you do?</p>
</div>
</div>
<div id="causal-identification-strategies" class="section level2" number="5.2">
<h2><span class="header-section-number">5.2</span> Causal Identification Strategies</h2>
<p>Our goal: Try to “identify” the causal effect of one variable on an outcome. As Montell Jordan once said, this is how we do it:</p>
<ul>
<li>Use data we have (that exist out in the world)</li>
<li>Compare those who are ``treated” to a relevant comparison group who is not treated</li>
</ul>
<p>However, we can’t randomize treatment so….</p>
<ul>
<li>We do our best to try to choose a good comparison (one very similar to the treatment group, but happens not to be treated)</li>
</ul>
<p>We want to rule out all possible confounding variables and “alternative explanations” for the outcomes we observed.</p>
<div id="three-common-identification-strategies" class="section level3" number="5.2.1">
<h3><span class="header-section-number">5.2.1</span> Three Common Identification Strategies</h3>
<p>Example: Does drinking Sprite make a person a better basketball player? (Inspired by 1990s commercial where a kid believes drinking Sprite will cause him to play basketball better.)</p>
<div class="vembedr">
<div>
<iframe src="https://www.youtube.com/embed/zbavu2Al-ME" width="533" height="300" frameborder="0" allowfullscreen=""></iframe>
</div>
</div>
<ul>
<li><strong>Cross-section comparison</strong>: Compare Grant Hill (who drinks Sprite) to others (who don’t)</li>
<li><strong>Before-and-after</strong>: Compare Grant Hill after he started drinking Sprite to Grant Hill before</li>
<li><strong>Difference-in-differences</strong>: Compare Grant Hill before and after drinking Sprite and subtract from this the difference for some other person (who never drank Sprite) during the same two periods</li>
</ul>
<p>(Note: “drinking Sprite” is our treatment.)</p>
</div>
<div id="threats-to-cross-section-designs" class="section level3" number="5.2.2">
<h3><span class="header-section-number">5.2.2</span> Threats to Cross-Section Designs</h3>
<p><strong><em>Assumption</em></strong>: Must assume no confounders and any alternative explanations related to differences between the treated and control subjects that also relate to the outcome. The Threat: Your two groups may differ in ways beyond the “treatment” in ways that are relevant to the outcome you care about.</p>
<ul>
<li>Compare Grant Hill, a tall NBA player who currently drinks Sprite (treatment group) to</li>
<li>Yourself, assuming you and they do not drink Sprite (control group)</li>
<li>Compare your basketball skill levels (the outcome).</li>
<li>Suppose Grant Hill is better (a positive treatment effect).
<ul>
<li>Can we conclude Sprite <em>causes</em> a person to be a better player?</li>
</ul></li>
</ul>
<p>Nope, because other things that affect basketball talent differ between you and Grant Hill, and these things, not Sprite, may explain the difference in basketball talent.</p>
<p>Moreover, even if we compared just among NBA players (Grant Hill vs. non-Sprite drinking players of his era), it’s possible that Sprite targeted all-stars to recruit to drink Sprite. In this way, pre-existing basketball talent (a <em>confounder</em>) both explains why Grant Hill drank Sprite (relates to the treatment) and explains his higher level of basketball talent (relates to the outcome) in the time period after drinking Sprite.</p>
<ul>
<li>For a cross-sectional comparison to be plausible, we need to choose a very similar comparison in order to isolate the treatment as the main variable that is causing a change in an outcome.</li>
</ul>
</div>
<div id="threats-to-before-after-designs" class="section level3" number="5.2.3">
<h3><span class="header-section-number">5.2.3</span> Threats to Before-After Designs</h3>
<p><strong><em>Assumption</em></strong>: Must assume no confounding time trend. Threat: Something else may be changing over time, aside from the treatment, that is affecting your outcome.</p>
<ul>
<li>Compare Grant Hill in the years after he started drinking Sprite (treated) to</li>
<li>Grant Hill the years before he started drinking Sprite (control)</li>
<li>Compare his basketball skill levels (outcome).</li>
<li>Suppose Grant Hill after Sprite is better (a positive treatment effect).</li>
<li>Can we conclude Sprite causes a person to be a better player?</li>
</ul>
<p>Not if something else Grant Hill started doing during that time period made him better (e.g., maybe during that time the NBA provided higher quality coaches and trainers, and everyone (including Grant Hill) got better).</p>
<ul>
<li>You want your treatment to be the only thing relevant to basketball talent changing over time.</li>
</ul>
</div>
<div id="threats-to-diff-in-diff-designs" class="section level3" number="5.2.4">
<h3><span class="header-section-number">5.2.4</span> Threats to Diff-in-Diff Designs</h3>
<p><strong><em>Assumption</em></strong>: Must assume parallel trends: That in the absence of treatment, your treatment group would have changed in the same way as your control</p>
<ul>
<li>Compare Grant Hill in the years before vs. after he started drinking Sprite to Grant Hill’s teammate, who never drank sprite, in the same two time periods (before Hill drinks Sprite vs. after Hill drinks Sprite)</li>
<li>Compare the <strong>change in each player’s basketball skill levels</strong>. Suppose Grant Hill’s skills increased to a greater degree than his teammate’s over the same time period.</li>
<li>Can we conclude Sprite causes a person to be a better player?</li>
</ul>
<p>If we are confident that Grant Hill did not have a unique (non-Sprite) advantage over that time period relative to other players, then our assumption might be plausible– that Grant Hill and other players would have experienced a similar growth in their skills if not for Grant Hill getting the extra benefit of Sprite.</p>
<p>Instead, if, for example, Grant Hill got a new trainer during this period AND his teammate did not, then we might have expected Grant Hill to see more improvement even if he didn’t start drinking Sprite. A violation of the parallel trends assumption!</p>
<ul>
<li>Causality is hard!</li>
</ul>
</div>
</div>
<div id="application-economic-effects-of-basque-terrorism" class="section level2" number="5.3">
<h2><span class="header-section-number">5.3</span> Application: Economic Effects of Basque Terrorism</h2>
<p>Research Question: What is the economic impact of terrorism?</p>
<ul>
<li>Factual (<span class="math inline">\(Y(1)\)</span>): Economy given Basque region hit with terrorism in early 1970s
<ul>
<li>From 1973 to late 1990s, ETA killed almost 800 people</li>
<li>Activity localized to Basque area</li>
</ul></li>
<li>Counterfactual (<span class="math inline">\(Y(0)\)</span>): How would Basque economy have fared in the absence of the terrorism?
<ul>
<li>Basque was the 3rd richest region in Spain at onset</li>
<li>Dropped to the 6th position by late 1990s</li>
<li>Would this fall have happened in the absence of terrorism?</li>
</ul></li>
</ul>
<p>Problem: We can’t observe the counterfactual. We can’t go back in time to manipulate the experience of terrorism.</p>
<div id="applying-3-identification-strategies" class="section level3" number="5.3.1">
<h3><span class="header-section-number">5.3.1</span> Applying 3 Identification Strategies</h3>
<ul>
<li>Compare Basque to others after 1973 (Cross-section comparison)</li>
<li>Compare Basque before and after 1973 (Before-and-after)</li>
<li>Compare others before and after 1973 and subtract the
difference from Basque’s difference (Difference-in-differences)</li>
</ul>
<p>For a video explainer of the code for this application, see below. (Via youtube, you can speed up the playback to 1.5 or 2x speed.)</p>
<div class="vembedr">
<div>
<iframe src="https://www.youtube.com/embed/E4PqZgcv5IQ" width="533" height="300" frameborder="0" allowfullscreen=""></iframe>
</div>
</div>
<div class="sourceCode" id="cb236"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb236-1"><a href="#cb236-1" aria-hidden="true" tabindex="-1"></a>basque <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;basque.csv&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb237"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb237-1"><a href="#cb237-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(basque)</span></code></pre></div>
<pre><code>##      region year   gdpcap
## 1 Andalucia 1955 1.688732
## 2 Andalucia 1956 1.758498
## 3 Andalucia 1957 1.827621
## 4 Andalucia 1958 1.852756
## 5 Andalucia 1959 1.878035
## 6 Andalucia 1960 2.010140</code></pre>
<p>Variables</p>
<ul>
<li><code>region</code>: 17 regions including Basque</li>
<li><code>year</code>: 1955 – 1997</li>
<li><code>gdpcap</code>: real GDP per capita (in 1986 USD, thousands)</li>
</ul>
<p>Subset Basque Data into Four Groups</p>
<div class="sourceCode" id="cb239"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb239-1"><a href="#cb239-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Basque before terrorism</span></span>
<span id="cb239-2"><a href="#cb239-2" aria-hidden="true" tabindex="-1"></a>basqueBefore <span class="ot">&lt;-</span> <span class="fu">subset</span>(basque, (year <span class="sc">&lt;</span> <span class="dv">1973</span>) <span class="sc">&amp;</span></span>
<span id="cb239-3"><a href="#cb239-3" aria-hidden="true" tabindex="-1"></a>                            (region <span class="sc">==</span> <span class="st">&quot;Basque Country&quot;</span>))</span>
<span id="cb239-4"><a href="#cb239-4" aria-hidden="true" tabindex="-1"></a><span class="do">## Basque after terrorism</span></span>
<span id="cb239-5"><a href="#cb239-5" aria-hidden="true" tabindex="-1"></a>basqueAfter <span class="ot">&lt;-</span> <span class="fu">subset</span>(basque, (year <span class="sc">&gt;=</span> <span class="dv">1973</span>) <span class="sc">&amp;</span></span>
<span id="cb239-6"><a href="#cb239-6" aria-hidden="true" tabindex="-1"></a>                           (region <span class="sc">==</span> <span class="st">&quot;Basque Country&quot;</span>))</span>
<span id="cb239-7"><a href="#cb239-7" aria-hidden="true" tabindex="-1"></a><span class="do">## others before terrorism</span></span>
<span id="cb239-8"><a href="#cb239-8" aria-hidden="true" tabindex="-1"></a>othersBefore <span class="ot">&lt;-</span> <span class="fu">subset</span>(basque, (year <span class="sc">&lt;</span> <span class="dv">1973</span>) <span class="sc">&amp;</span></span>
<span id="cb239-9"><a href="#cb239-9" aria-hidden="true" tabindex="-1"></a>                            (region <span class="sc">!=</span> <span class="st">&quot;Basque Country&quot;</span>))</span>
<span id="cb239-10"><a href="#cb239-10" aria-hidden="true" tabindex="-1"></a><span class="do">## others after terrorism</span></span>
<span id="cb239-11"><a href="#cb239-11" aria-hidden="true" tabindex="-1"></a>othersAfter <span class="ot">&lt;-</span> <span class="fu">subset</span>(basque, (year <span class="sc">&gt;=</span> <span class="dv">1973</span>) <span class="sc">&amp;</span></span>
<span id="cb239-12"><a href="#cb239-12" aria-hidden="true" tabindex="-1"></a>                           (region <span class="sc">!=</span> <span class="st">&quot;Basque Country&quot;</span>))</span></code></pre></div>
<p>What is the economic impact of terrorism?</p>
<p>Cross-section comparison</p>
<div class="sourceCode" id="cb240"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb240-1"><a href="#cb240-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(basqueAfter<span class="sc">$</span>gdpcap) <span class="sc">-</span> <span class="fu">mean</span>(othersAfter<span class="sc">$</span>gdpcap)</span></code></pre></div>
<pre><code>## [1] 1.132917</code></pre>
<p>Before-and-after design</p>
<div class="sourceCode" id="cb242"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb242-1"><a href="#cb242-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(basqueAfter<span class="sc">$</span>gdpcap) <span class="sc">-</span> <span class="fu">mean</span>(basqueBefore<span class="sc">$</span>gdpcap)</span></code></pre></div>
<pre><code>## [1] 2.678146</code></pre>
<p>Difference-in-Differences design</p>
<div class="sourceCode" id="cb244"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb244-1"><a href="#cb244-1" aria-hidden="true" tabindex="-1"></a>treatDiff <span class="ot">&lt;-</span> <span class="fu">mean</span>(basqueAfter<span class="sc">$</span>gdpcap) <span class="sc">-</span></span>
<span id="cb244-2"><a href="#cb244-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mean</span>(basqueBefore<span class="sc">$</span>gdpcap)</span>
<span id="cb244-3"><a href="#cb244-3" aria-hidden="true" tabindex="-1"></a>controlDiff <span class="ot">&lt;-</span> <span class="fu">mean</span>(othersAfter<span class="sc">$</span>gdpcap) <span class="sc">-</span></span>
<span id="cb244-4"><a href="#cb244-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mean</span>(othersBefore<span class="sc">$</span>gdpcap)</span>
<span id="cb244-5"><a href="#cb244-5" aria-hidden="true" tabindex="-1"></a>treatDiff <span class="sc">-</span> controlDiff</span></code></pre></div>
<pre><code>## [1] -0.48316</code></pre>
<p>Here is a way to visualize this difference-in-differences. Our estimated causal effect is the difference between the observed growth in the Basque region and what we assume the growth would have been in the absence of terrorism (the treatment).</p>
<p><img src="datasciforpolisci_files/figure-html/unnamed-chunk-140-1.svg" width="672" /></p>
<p>What should we conclude from each approach?</p>
<ul>
<li>Each approach resulted in a different estimate of the impact of terrorism on the economy. We should choose the approach for which we think the underlying assumptions are most plausible.</li>
</ul>
</div>
</div>
<div id="placebo-tests" class="section level2" number="5.4">
<h2><span class="header-section-number">5.4</span> Placebo Tests</h2>
<p>Which Results Should We Believe? Role of Placebo Tests</p>
<p>Cross-section comparison</p>
<div class="sourceCode" id="cb246"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb246-1"><a href="#cb246-1" aria-hidden="true" tabindex="-1"></a><span class="do">## were there pre-existing differences between the groups?</span></span>
<span id="cb246-2"><a href="#cb246-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(basqueBefore<span class="sc">$</span>gdpcap) <span class="sc">-</span> <span class="fu">mean</span>(othersBefore<span class="sc">$</span>gdpcap)</span></code></pre></div>
<pre><code>## [1] 1.616077</code></pre>
<p>Before-and-After design</p>
<div class="sourceCode" id="cb248"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb248-1"><a href="#cb248-1" aria-hidden="true" tabindex="-1"></a><span class="do">## was there a change in a group we don&#39;t think should have changed?</span></span>
<span id="cb248-2"><a href="#cb248-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(othersAfter<span class="sc">$</span>gdpcap) <span class="sc">-</span> <span class="fu">mean</span>(othersBefore<span class="sc">$</span>gdpcap)</span></code></pre></div>
<pre><code>## [1] 3.161306</code></pre>
<p>What about the Difference-in-Differences design?</p>
<div class="sourceCode" id="cb250"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb250-1"><a href="#cb250-1" aria-hidden="true" tabindex="-1"></a><span class="do">## here we go back in time even further to examine &quot;pre-treatment&quot; trends</span></span>
<span id="cb250-2"><a href="#cb250-2" aria-hidden="true" tabindex="-1"></a><span class="do">## we want them to be similar</span></span>
<span id="cb250-3"><a href="#cb250-3" aria-hidden="true" tabindex="-1"></a>(basqueBefore<span class="sc">$</span>gdpcap[basqueBefore<span class="sc">$</span>year <span class="sc">==</span> <span class="dv">1972</span>] <span class="sc">-</span></span>
<span id="cb250-4"><a href="#cb250-4" aria-hidden="true" tabindex="-1"></a> basqueBefore<span class="sc">$</span>gdpcap[basqueBefore<span class="sc">$</span>year <span class="sc">==</span> <span class="dv">1955</span>]) <span class="sc">-</span></span>
<span id="cb250-5"><a href="#cb250-5" aria-hidden="true" tabindex="-1"></a>    (<span class="fu">mean</span>(othersBefore<span class="sc">$</span>gdpcap[othersBefore<span class="sc">$</span>year <span class="sc">==</span> <span class="dv">1972</span>]) <span class="sc">-</span></span>
<span id="cb250-6"><a href="#cb250-6" aria-hidden="true" tabindex="-1"></a>     <span class="fu">mean</span>(othersBefore<span class="sc">$</span>gdpcap[othersBefore<span class="sc">$</span>year <span class="sc">==</span> <span class="dv">1955</span>]))</span></code></pre></div>
<pre><code>## [1] 0.07147071</code></pre>
<p>These “placebo” checks are closest to zero for diff-in-diff, so we may believe that the most.</p>
<p><em>Thanks to Will Lowe and QSS for providing the foundations for this example</em></p>
</div>
<div id="wrapping-up-causality" class="section level2" number="5.5">
<h2><span class="header-section-number">5.5</span> Wrapping Up Causality</h2>
<p>Do you get this joke?</p>
<p><img src="images/causality-cartoon.png" /></p>
<!--chapter:end:05-Causalityii.Rmd-->
</div>
</div>
<div id="loops" class="section level1" number="6">
<h1><span class="header-section-number">6</span> Loops in R</h1>
<p>In this brief section, we will go over conducting loops in R.</p>
<p>Loops are a tool in R that are useful for situations where we want to do something over and over and over and … over again, where we just change something small each time.</p>
<p>A quick example using the Basque data from the previous section:</p>
<div class="sourceCode" id="cb252"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb252-1"><a href="#cb252-1" aria-hidden="true" tabindex="-1"></a>basque <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;basque.csv&quot;</span>, <span class="at">stringsAsFactors =</span> T)</span></code></pre></div>
<p>Let’s say I wanted to know the GDP for each region for the earliest year they are in the data.</p>
<div class="sourceCode" id="cb253"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb253-1"><a href="#cb253-1" aria-hidden="true" tabindex="-1"></a>regionsubset <span class="ot">&lt;-</span> <span class="fu">subset</span>(basque, region <span class="sc">==</span> <span class="st">&quot;Andalucia&quot;</span>)</span>
<span id="cb253-2"><a href="#cb253-2" aria-hidden="true" tabindex="-1"></a>regionsubset<span class="sc">$</span>gdpcap[regionsubset<span class="sc">$</span>year <span class="sc">==</span> <span class="fu">min</span>(regionsubset<span class="sc">$</span>year)]</span></code></pre></div>
<pre><code>## [1] 1.688732</code></pre>
<div class="sourceCode" id="cb255"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb255-1"><a href="#cb255-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Repeat for a new region</span></span>
<span id="cb255-2"><a href="#cb255-2" aria-hidden="true" tabindex="-1"></a>regionsubset <span class="ot">&lt;-</span> <span class="fu">subset</span>(basque, region <span class="sc">==</span> <span class="st">&quot;Aragon&quot;</span>)</span>
<span id="cb255-3"><a href="#cb255-3" aria-hidden="true" tabindex="-1"></a>regionsubset<span class="sc">$</span>gdpcap[regionsubset<span class="sc">$</span>year <span class="sc">==</span> <span class="fu">min</span>(regionsubset<span class="sc">$</span>year)]</span></code></pre></div>
<pre><code>## [1] 2.288775</code></pre>
<div class="sourceCode" id="cb257"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb257-1"><a href="#cb257-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Repeat for a new region</span></span>
<span id="cb257-2"><a href="#cb257-2" aria-hidden="true" tabindex="-1"></a>regionsubset <span class="ot">&lt;-</span> <span class="fu">subset</span>(basque, region <span class="sc">==</span> <span class="st">&quot;Baleares&quot;</span>)</span>
<span id="cb257-3"><a href="#cb257-3" aria-hidden="true" tabindex="-1"></a>regionsubset<span class="sc">$</span>gdpcap[regionsubset<span class="sc">$</span>year <span class="sc">==</span> <span class="fu">min</span>(regionsubset<span class="sc">$</span>year)]</span></code></pre></div>
<pre><code>## [1] 3.143959</code></pre>
<p>Ughhh can we automate this? we have 17 regions!!!</p>
<div class="sourceCode" id="cb259"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb259-1"><a href="#cb259-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(basque<span class="sc">$</span>region)</span></code></pre></div>
<pre><code>##  [1] Andalucia              Aragon                 Principado De Asturias
##  [4] Baleares               Canarias               Cantabria             
##  [7] Castilla Y Leon        Castilla-La Mancha     Cataluna              
## [10] Comunidad Valenciana   Extremadura            Galicia               
## [13] Madrid                 Murcia                 Navarra               
## [16] Basque Country         Rioja                 
## 17 Levels: Andalucia Aragon Baleares Basque Country Canarias ... Rioja</code></pre>
<p>Where we will be going by the end of this section:</p>
<div class="sourceCode" id="cb261"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb261-1"><a href="#cb261-1" aria-hidden="true" tabindex="-1"></a>gdpminyear <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="dv">17</span>) <span class="co"># empty &quot;container&quot; vector</span></span>
<span id="cb261-2"><a href="#cb261-2" aria-hidden="true" tabindex="-1"></a>regions <span class="ot">&lt;-</span> <span class="fu">unique</span>(basque<span class="sc">$</span>region) <span class="co"># what we iterate through</span></span>
<span id="cb261-3"><a href="#cb261-3" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(gdpminyear) <span class="ot">&lt;-</span> <span class="fu">unique</span>(basque<span class="sc">$</span>region) <span class="co"># labels for our output</span></span>
<span id="cb261-4"><a href="#cb261-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb261-5"><a href="#cb261-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">17</span>){</span>
<span id="cb261-6"><a href="#cb261-6" aria-hidden="true" tabindex="-1"></a>  regionsubset <span class="ot">&lt;-</span> <span class="fu">subset</span>(basque, region <span class="sc">==</span> regions[i])</span>
<span id="cb261-7"><a href="#cb261-7" aria-hidden="true" tabindex="-1"></a>  gdpminyear[i] <span class="ot">&lt;-</span> regionsubset<span class="sc">$</span>gdpcap[regionsubset<span class="sc">$</span>year <span class="sc">==</span> </span>
<span id="cb261-8"><a href="#cb261-8" aria-hidden="true" tabindex="-1"></a>                                         <span class="fu">min</span>(regionsubset<span class="sc">$</span>year)]</span>
<span id="cb261-9"><a href="#cb261-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb261-10"><a href="#cb261-10" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(gdpminyear) <span class="co"># output</span></span></code></pre></div>
<pre><code>##              Andalucia                 Aragon Principado De Asturias 
##               1.688732               2.288775               2.502928 
##               Baleares               Canarias              Cantabria 
##               3.143959               1.914382               2.559412</code></pre>
<p>We got all of the answers with just one chunk of code!</p>
<div id="the-anatomy-of-a-loop" class="section level2" number="6.1">
<h2><span class="header-section-number">6.1</span> The anatomy of a loop</h2>
<p>In many situations, we want to repeat the same calculations with
different inputs. Loops allow you to avoid writing many similar code
chunks.</p>
<ul>
<li>The function <code>for(i in X){}}</code> will create a loop in
your programming code where <code>i</code> is a counter and</li>
<li><code>X</code> is a placeholder for a vector for the possible values of the counter.</li>
</ul>
<p>We use the following syntax:</p>
<p><code>for (i in X) {</code></p>
<p><code>command1...</code></p>
<p><code>command2...</code></p>
<p><code>...</code></p>
<p><code>}</code></p>
<p>to indicate we want to repeat command1 and command2 and …. as many commands as we want, for each <code>i</code> in the set of possible values for <code>i</code> stored in <code>X</code>.</p>
<div id="the-key-parts-of-a-loop" class="section level3" number="6.1.1">
<h3><span class="header-section-number">6.1.1</span> The key parts of a loop</h3>
<p>The meat: the command or set of commands you want to do over and over.</p>
<div class="sourceCode" id="cb263"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb263-1"><a href="#cb263-1" aria-hidden="true" tabindex="-1"></a><span class="do">## the meat</span></span>
<span id="cb263-2"><a href="#cb263-2" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="dv">6</span> <span class="sc">+</span> <span class="dv">2</span></span>
<span id="cb263-3"><a href="#cb263-3" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="dv">8</span> <span class="sc">+</span> <span class="dv">2</span></span>
<span id="cb263-4"><a href="#cb263-4" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="dv">4</span> <span class="sc">+</span> <span class="dv">2</span></span>
<span id="cb263-5"><a href="#cb263-5" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="dv">7</span> <span class="sc">+</span> <span class="dv">2</span></span>
<span id="cb263-6"><a href="#cb263-6" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="dv">11</span> <span class="sc">+</span> <span class="dv">2</span></span></code></pre></div>
<p>Note the pattern: we take some number and + 2 each time.</p>
<ul>
<li>It is the number that is changing -&gt; what we will iterate.</li>
</ul>
<p>For a loop, you want to:</p>
<ol style="list-style-type: decimal">
<li>The Meat: Write down the code for one version.</li>
</ol>
<div class="sourceCode" id="cb264"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb264-1"><a href="#cb264-1" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="dv">6</span> <span class="sc">+</span> <span class="dv">2</span></span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>The Bread: Embed this code in the loop syntax (<code>for(i in X){}</code>)</li>
</ol>
<div class="sourceCode" id="cb265"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb265-1"><a href="#cb265-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> X){</span>
<span id="cb265-2"><a href="#cb265-2" aria-hidden="true" tabindex="-1"></a>    result <span class="ot">&lt;-</span> <span class="dv">6</span> <span class="sc">+</span> <span class="dv">2</span></span>
<span id="cb265-3"><a href="#cb265-3" aria-hidden="true" tabindex="-1"></a>    }</span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Create a vector that contains the values you want to loop through</li>
</ol>
<div class="sourceCode" id="cb266"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb266-1"><a href="#cb266-1" aria-hidden="true" tabindex="-1"></a>somenumbers <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">6</span>, <span class="dv">8</span>, <span class="dv">4</span>, <span class="dv">7</span>, <span class="dv">11</span>)</span></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>Create a storage vector that will contain the results</li>
</ol>
<div class="sourceCode" id="cb267"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb267-1"><a href="#cb267-1" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="fu">length</span>(somenumbers))</span></code></pre></div>
<ol start="5" style="list-style-type: decimal">
<li>Modify the meat and bread to iterate by using <code>[i]</code>, and replace <code>X</code>.</li>
</ol>
<div class="sourceCode" id="cb268"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb268-1"><a href="#cb268-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(somenumbers)){</span>
<span id="cb268-2"><a href="#cb268-2" aria-hidden="true" tabindex="-1"></a>  result[i] <span class="ot">&lt;-</span> somenumbers[i] <span class="sc">+</span> <span class="dv">2</span></span>
<span id="cb268-3"><a href="#cb268-3" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>  where `1:length(somenumbers)` reflects possible values `i` will take </code></pre>
<div class="sourceCode" id="cb270"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb270-1"><a href="#cb270-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(somenumbers)</span></code></pre></div>
<pre><code>## [1] 1 2 3 4 5</code></pre>
</div>
<div id="a-short-example" class="section level3" number="6.1.2">
<h3><span class="header-section-number">6.1.2</span> A short example</h3>
<p>Let’s put these parts together:</p>
<p>Suppose we want to add 2 to a set of numbers <code>c(6, 8, 4, 7, 11)</code></p>
<div class="sourceCode" id="cb272"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb272-1"><a href="#cb272-1" aria-hidden="true" tabindex="-1"></a>somenumbers <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">6</span>, <span class="dv">8</span>, <span class="dv">4</span>, <span class="dv">7</span>, <span class="dv">11</span>) <span class="co"># iteration vector</span></span>
<span id="cb272-2"><a href="#cb272-2" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="fu">length</span>(somenumbers)) <span class="co"># container vector</span></span>
<span id="cb272-3"><a href="#cb272-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb272-4"><a href="#cb272-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(somenumbers)){</span>
<span id="cb272-5"><a href="#cb272-5" aria-hidden="true" tabindex="-1"></a>  result[i] <span class="ot">&lt;-</span> somenumbers[i] <span class="sc">+</span> <span class="dv">2</span></span>
<span id="cb272-6"><a href="#cb272-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb272-7"><a href="#cb272-7" aria-hidden="true" tabindex="-1"></a>result</span></code></pre></div>
<pre><code>## [1]  8 10  6  9 13</code></pre>
<p>How does this work? Every iteration, the value of i changes.</p>
<ul>
<li>For example, when <code>i</code> is 1, we take the first value in our <code>somenumbers</code> vector <code>somenumbers[1]</code>, add 2 to it, and store it in the first position of our container vector <code>result[1]</code>. When <code>i</code> is 2, we switch the number in the brackets to 2, corresponding to the second entry in each vector, and so on.</li>
</ul>
<div class="sourceCode" id="cb274"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb274-1"><a href="#cb274-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Suppose i is 1</span></span>
<span id="cb274-2"><a href="#cb274-2" aria-hidden="true" tabindex="-1"></a>result[<span class="dv">1</span>] <span class="ot">&lt;-</span> somenumbers[<span class="dv">1</span>] <span class="sc">+</span> <span class="dv">2</span></span>
<span id="cb274-3"><a href="#cb274-3" aria-hidden="true" tabindex="-1"></a>result[<span class="dv">1</span>]</span></code></pre></div>
<pre><code>## [1] 8</code></pre>
<div class="sourceCode" id="cb276"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb276-1"><a href="#cb276-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Suppose i is 2</span></span>
<span id="cb276-2"><a href="#cb276-2" aria-hidden="true" tabindex="-1"></a>result[<span class="dv">2</span>] <span class="ot">&lt;-</span> somenumbers[<span class="dv">2</span>] <span class="sc">+</span> <span class="dv">2</span></span>
<span id="cb276-3"><a href="#cb276-3" aria-hidden="true" tabindex="-1"></a>result[<span class="dv">2</span>]</span></code></pre></div>
<pre><code>## [1] 10</code></pre>
<div class="sourceCode" id="cb278"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb278-1"><a href="#cb278-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Suppose i is 3</span></span>
<span id="cb278-2"><a href="#cb278-2" aria-hidden="true" tabindex="-1"></a>result[<span class="dv">3</span>] <span class="ot">&lt;-</span> somenumbers[<span class="dv">3</span>] <span class="sc">+</span> <span class="dv">2</span></span>
<span id="cb278-3"><a href="#cb278-3" aria-hidden="true" tabindex="-1"></a>result[<span class="dv">3</span>]</span></code></pre></div>
<pre><code>## [1] 6</code></pre>
</div>
<div id="troubleshooting-a-loop" class="section level3" number="6.1.3">
<h3><span class="header-section-number">6.1.3</span> Troubleshooting a loop</h3>
<p>The inside part of the loop should run if we set <code>i</code> to a particular value.</p>
<div class="sourceCode" id="cb280"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb280-1"><a href="#cb280-1" aria-hidden="true" tabindex="-1"></a>i <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb280-2"><a href="#cb280-2" aria-hidden="true" tabindex="-1"></a>result[i] <span class="ot">&lt;-</span> somenumbers[i] <span class="sc">+</span> <span class="dv">2</span></span></code></pre></div>
<p>If you get an error here, there is something wrong with the meat! (and not necessarily the loop)</p>
<div class="sourceCode" id="cb281"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb281-1"><a href="#cb281-1" aria-hidden="true" tabindex="-1"></a>result[i]</span></code></pre></div>
<pre><code>## [1] 8</code></pre>
<p>For example, if we had a typo, we’d get an error. Try running the below!</p>
<div class="sourceCode" id="cb283"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb283-1"><a href="#cb283-1" aria-hidden="true" tabindex="-1"></a>i <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb283-2"><a href="#cb283-2" aria-hidden="true" tabindex="-1"></a>result[i] <span class="ot">&lt;-</span> somenumberz[i] <span class="sc">+</span> <span class="dv">2</span></span></code></pre></div>
</div>
<div id="your-turn" class="section level3" number="6.1.4">
<h3><span class="header-section-number">6.1.4</span> Your turn</h3>
<p>Using a loop, for each value in our poll results, add 10 and divide by 100. Store in a vector called <code>adjustedpollresults</code>.</p>
<div class="sourceCode" id="cb284"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb284-1"><a href="#cb284-1" aria-hidden="true" tabindex="-1"></a>pollresults <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">70</span>, <span class="dv">40</span>, <span class="dv">45</span>, <span class="dv">60</span>, <span class="dv">43</span>, <span class="dv">80</span>, <span class="dv">23</span>)</span></code></pre></div>
<p>Remember the steps:</p>
<ol style="list-style-type: decimal">
<li>The Meat: Write down the code for one version.</li>
<li>The Bread: Embed this code in the loop syntax (<code>for(i in X){}</code>)</li>
<li>Create a vector that contains the values you want to loop through (here it’s <code>pollresults</code>)</li>
<li>Create a storage vector that will contain the results (here it’s <code>adjustedpollresults</code>)</li>
<li>Modify the meat and bread to iterate by using <code>[i]</code> and replace <code>X</code>.</li>
</ol>
<details>
<summary>
Try on your own, then expand for the solution.
</summary>
<div class="sourceCode" id="cb285"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb285-1"><a href="#cb285-1" aria-hidden="true" tabindex="-1"></a>pollresults <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">70</span>, <span class="dv">40</span>, <span class="dv">45</span>, <span class="dv">60</span>, <span class="dv">43</span>, <span class="dv">80</span>, <span class="dv">23</span>)</span>
<span id="cb285-2"><a href="#cb285-2" aria-hidden="true" tabindex="-1"></a>adjustedpollresults <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="fu">length</span>(pollresults))</span>
<span id="cb285-3"><a href="#cb285-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb285-4"><a href="#cb285-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(pollresults)){</span>
<span id="cb285-5"><a href="#cb285-5" aria-hidden="true" tabindex="-1"></a>  adjustedpollresults[i] <span class="ot">&lt;-</span> (pollresults[i] <span class="sc">+</span> <span class="dv">10</span>)<span class="sc">/</span><span class="dv">100</span> </span>
<span id="cb285-6"><a href="#cb285-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb285-7"><a href="#cb285-7" aria-hidden="true" tabindex="-1"></a>adjustedpollresults</span></code></pre></div>
<pre><code>## [1] 0.80 0.50 0.55 0.70 0.53 0.90 0.33</code></pre>
</details>
</div>
</div>
<div id="application-u.s.-supreme-court" class="section level2" number="6.2">
<h2><span class="header-section-number">6.2</span> Application: U.S. Supreme Court</h2>
<p>The Court has changed a lot recently in its composition.</p>
<center>
<img src="images/sccourt6.jpeg" style="width:40.0%" /> <img src="images/sccourt.jpg" style="width:35.0%" />
</center>
<center>
<img src="images/sccourt5.jpeg" style="width:40.0%" />
</center>
<p>Ideology on the U.S. Supreme Court: With Kennedy out, Kavanaugh in, did the Court have a Conservative shift?</p>
<p>Many people predicted it would. See this <a href="https://fivethirtyeight.com/features/how-kavanaugh-will-change-the-supreme-court/">FiveThirtyEight article</a> as an example. The graph from the article shows Kavanaugh’s predicted ideology.</p>
<p><img src="images/kav.png" style="width:50.0%" /></p>
<p><img src="images/kavcourt.png" /></p>
<p>We will explore how he changed the Court, with a focus on how the location of the median U.S. Supreme Court Justice shifted over time.</p>
<p>For a video explainer of the code for this application, see below. (Via youtube, you can speed up the playback to 1.5 or 2x speed.)</p>
<div class="vembedr">
<div>
<iframe src="https://www.youtube.com/embed/gA1OZ8-SO9E" width="533" height="300" frameborder="0" allowfullscreen=""></iframe>
</div>
</div>
<p>The link to the video is <a href="https://youtu.be/gA1OZ8-SO9E" class="uri">https://youtu.be/gA1OZ8-SO9E</a>.</p>
<p>Why does the median matter? A refresher on the Court</p>
<ul>
<li>President nominates the justice. Senate must confirm.</li>
<li>Justices serve lifetime appointments.</li>
<li>Trump nominated Gorsuch, following Scalia death, confirmed 2017.</li>
<li>Trump nominated Kavanaugh, following Kennedy retirement, confirmed 2018.</li>
<li>The Court typically has 9 justices, so whichever justice is the median in terms of ideology, can act as the “swing” vote in cases where the Court is divided
<ul>
<li>Anthony Kennedy was often the “swing” justice for a decade.</li>
</ul></li>
<li>With Kennedy out, the prediction is that the Court would return to similar balance as when O’Connor was the median.
<ul>
<li>In 2020, Amy Coney Barrett confirmed to Court, likely shifting the Court again. We can continue to update the data to examine what happened.</li>
</ul></li>
</ul>
<p>Let’s load and explore our data.</p>
<ul>
<li><code>term</code>: is the year of the SC (1991-2019 except for 2005),</li>
<li><code>justiceName</code>: contains the name of the Justice, and<br />
</li>
<li><code>post_mn</code>: includes the “ideal point”– this is the estimated ideology</li>
</ul>
<p>Martin-Quinn Scores assess ideology based on how judges “cluster” together in their voting patterns. Every Justice gets an ideology score, and this score can change each SC term (year) they are on the Court. Higher scores are more conservative justices, and lower, more liberal. More information is available at the <a href="http://mqscores.lsa.umich.edu/measures.php">MQScores website</a></p>
<div class="sourceCode" id="cb287"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb287-1"><a href="#cb287-1" aria-hidden="true" tabindex="-1"></a>justices <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;justices.csv&quot;</span>, <span class="at">stringsAsFactors =</span> T)</span>
<span id="cb287-2"><a href="#cb287-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb287-3"><a href="#cb287-3" aria-hidden="true" tabindex="-1"></a><span class="do">## alternative</span></span>
<span id="cb287-4"><a href="#cb287-4" aria-hidden="true" tabindex="-1"></a>justices <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;https://raw.githubusercontent.com/ktmccabe/teachingdata/main/justices.csv&quot;</span>, <span class="at">stringsAsFactors =</span> T)</span></code></pre></div>
<p>We are going to make the name variable a character class. This will make R treat the names as raw text rather than valued categories. This will be useful later on in the application.</p>
<div class="sourceCode" id="cb288"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb288-1"><a href="#cb288-1" aria-hidden="true" tabindex="-1"></a><span class="do">## justice Name as character</span></span>
<span id="cb288-2"><a href="#cb288-2" aria-hidden="true" tabindex="-1"></a>justices<span class="sc">$</span>justiceName <span class="ot">&lt;-</span> <span class="fu">as.character</span>(justices<span class="sc">$</span>justiceName)</span></code></pre></div>
<p>We can use <code>tapply()</code> to see the median “ideal point” (ideology score) each term in our data.</p>
<div class="sourceCode" id="cb289"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb289-1"><a href="#cb289-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Note: we use tapply like before but replace mean with median</span></span>
<span id="cb289-2"><a href="#cb289-2" aria-hidden="true" tabindex="-1"></a>medians <span class="ot">&lt;-</span> <span class="fu">tapply</span>(justices<span class="sc">$</span>post_mn, justices<span class="sc">$</span>term, median)</span>
<span id="cb289-3"><a href="#cb289-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb289-4"><a href="#cb289-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x =</span><span class="fu">names</span>(medians),</span>
<span id="cb289-5"><a href="#cb289-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">y=</span> medians, </span>
<span id="cb289-6"><a href="#cb289-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span>.<span class="dv">4</span>, <span class="dv">1</span>),</span>
<span id="cb289-7"><a href="#cb289-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">type =</span> <span class="st">&quot;b&quot;</span>,</span>
<span id="cb289-8"><a href="#cb289-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">cex=</span><span class="fl">1.5</span>,</span>
<span id="cb289-9"><a href="#cb289-9" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab=</span><span class="st">&quot;Conservatism&quot;</span>,</span>
<span id="cb289-10"><a href="#cb289-10" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">&quot;Term&quot;</span>,</span>
<span id="cb289-11"><a href="#cb289-11" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="st">&quot;Median of US Supreme Court over Time&quot;</span>)</span></code></pre></div>
<p><img src="datasciforpolisci_files/figure-html/unnamed-chunk-167-1.svg" width="672" /></p>
<p>We see a conservative shift at the end of the plot. However, we cannot tell whether this represents a shift within a particular justice’s ideology or a shift in which justice has become the median, due perhaps, to the change in the Court’s composition.</p>
<p><strong><em>We need to find which justice is the median!</em></strong></p>
<p>Loops to the rescue!</p>
<p>We will start our process by definding the meat of the operation.</p>
<ul>
<li>We want to find the median SC Justice for each term. To get started, let’s pretend we only have to find the median Supreme Court Justice for one term.</li>
</ul>
<div class="sourceCode" id="cb290"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb290-1"><a href="#cb290-1" aria-hidden="true" tabindex="-1"></a>SCterms <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">unique</span>(justices<span class="sc">$</span>term))</span>
<span id="cb290-2"><a href="#cb290-2" aria-hidden="true" tabindex="-1"></a>SCterms</span></code></pre></div>
<pre><code>##  [1] 1991 1992 1993 1994 1995 1996 1997 1998 1999 2000 2001 2002 2003 2004 2006
## [16] 2007 2008 2009 2010 2011 2012 2013 2014 2015 2016 2017 2018 2019</code></pre>
<p>Note that where you have a vector where some entries in the vector are repeated (such as terms on the Supreme Court), you can extract the unique elements of that vector using the <code>unique()</code> function. You can also <code>sort()</code> them in numeric or alphabetical order. This won’t be necessary most times.</p>
<p>First, let’s think about how we would do this for just one of the Supreme Court terms. Well we would first subset our data frame to contain only that one Supreme Court term.</p>
<div class="sourceCode" id="cb292"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb292-1"><a href="#cb292-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Example for the first term</span></span>
<span id="cb292-2"><a href="#cb292-2" aria-hidden="true" tabindex="-1"></a>SCterms[<span class="dv">1</span>]</span></code></pre></div>
<pre><code>## [1] 1991</code></pre>
<div class="sourceCode" id="cb294"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb294-1"><a href="#cb294-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Subset data to include only rows from 1991</span></span>
<span id="cb294-2"><a href="#cb294-2" aria-hidden="true" tabindex="-1"></a>subterm <span class="ot">&lt;-</span> <span class="fu">subset</span>(justices, term <span class="sc">==</span> <span class="dv">1991</span>)</span></code></pre></div>
<p>Then, we would take the median of these ideal points</p>
<div class="sourceCode" id="cb295"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb295-1"><a href="#cb295-1" aria-hidden="true" tabindex="-1"></a>median.ip <span class="ot">&lt;-</span> <span class="fu">median</span>(subterm<span class="sc">$</span>post_mn)</span></code></pre></div>
<p>Finally, we would figure out which justice has this median.</p>
<div class="sourceCode" id="cb296"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb296-1"><a href="#cb296-1" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> subterm<span class="sc">$</span>justiceName[subterm<span class="sc">$</span>post_mn <span class="sc">==</span> median.ip]</span>
<span id="cb296-2"><a href="#cb296-2" aria-hidden="true" tabindex="-1"></a>result</span></code></pre></div>
<pre><code>## [1] &quot;SDOConnor&quot;</code></pre>
<p>Now let’s put it into our loop syntax</p>
<div class="sourceCode" id="cb298"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb298-1"><a href="#cb298-1" aria-hidden="true" tabindex="-1"></a><span class="co"># for(i  in . . . ){</span></span>
<span id="cb298-2"><a href="#cb298-2" aria-hidden="true" tabindex="-1"></a><span class="co">#  subterm &lt;- subset(justices, term == 1991)</span></span>
<span id="cb298-3"><a href="#cb298-3" aria-hidden="true" tabindex="-1"></a><span class="co">#  median.ip &lt;- median(subterm$post_mn)</span></span>
<span id="cb298-4"><a href="#cb298-4" aria-hidden="true" tabindex="-1"></a><span class="co">#  result &lt;- subterm$justiceName[subterm$post_mn == median.ip]</span></span>
<span id="cb298-5"><a href="#cb298-5" aria-hidden="true" tabindex="-1"></a><span class="co">#}</span></span></code></pre></div>
<p>Now, we need our container vector and iteration vectors.</p>
<div class="sourceCode" id="cb299"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb299-1"><a href="#cb299-1" aria-hidden="true" tabindex="-1"></a>SCterms <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">unique</span>(justices<span class="sc">$</span>term))</span>
<span id="cb299-2"><a href="#cb299-2" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="fu">length</span>(SCterms))</span>
<span id="cb299-3"><a href="#cb299-3" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(results) <span class="ot">&lt;-</span> SCterms</span></code></pre></div>
<p>Finally, we would modify our loop syntax with <code>i</code> and <code>[i]</code></p>
<div class="sourceCode" id="cb300"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb300-1"><a href="#cb300-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i  <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(SCterms)){</span>
<span id="cb300-2"><a href="#cb300-2" aria-hidden="true" tabindex="-1"></a>  subterm <span class="ot">&lt;-</span> <span class="fu">subset</span>(justices, term <span class="sc">==</span> SCterms[i])</span>
<span id="cb300-3"><a href="#cb300-3" aria-hidden="true" tabindex="-1"></a>  median.ip <span class="ot">&lt;-</span> <span class="fu">median</span>(subterm<span class="sc">$</span>post_mn)</span>
<span id="cb300-4"><a href="#cb300-4" aria-hidden="true" tabindex="-1"></a>  results[i] <span class="ot">&lt;-</span> subterm<span class="sc">$</span>justiceName[subterm<span class="sc">$</span>post_mn <span class="sc">==</span> median.ip]</span>
<span id="cb300-5"><a href="#cb300-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Did it work?</p>
<div class="sourceCode" id="cb301"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb301-1"><a href="#cb301-1" aria-hidden="true" tabindex="-1"></a>results</span></code></pre></div>
<pre><code>##        1991        1992        1993        1994        1995        1996 
## &quot;SDOConnor&quot; &quot;SDOConnor&quot; &quot;AMKennedy&quot; &quot;SDOConnor&quot; &quot;AMKennedy&quot; &quot;AMKennedy&quot; 
##        1997        1998        1999        2000        2001        2002 
## &quot;AMKennedy&quot; &quot;AMKennedy&quot; &quot;SDOConnor&quot; &quot;SDOConnor&quot; &quot;SDOConnor&quot; &quot;SDOConnor&quot; 
##        2003        2004        2006        2007        2008        2009 
## &quot;SDOConnor&quot; &quot;SDOConnor&quot; &quot;AMKennedy&quot; &quot;AMKennedy&quot; &quot;AMKennedy&quot; &quot;AMKennedy&quot; 
##        2010        2011        2012        2013        2014        2015 
## &quot;AMKennedy&quot; &quot;AMKennedy&quot; &quot;AMKennedy&quot; &quot;AMKennedy&quot; &quot;AMKennedy&quot; &quot;AMKennedy&quot; 
##        2016        2017        2018        2019 
## &quot;AMKennedy&quot; &quot;JGRoberts&quot; &quot;JGRoberts&quot; &quot;JGRoberts&quot;</code></pre>
<div id="troubleshooting-the-loop" class="section level3" number="6.2.1">
<h3><span class="header-section-number">6.2.1</span> Troubleshooting the loop</h3>
<p>Recall, the inside part of the loop should run if we set <code>i</code> to a particular value.</p>
<div class="sourceCode" id="cb303"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb303-1"><a href="#cb303-1" aria-hidden="true" tabindex="-1"></a>  i <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb303-2"><a href="#cb303-2" aria-hidden="true" tabindex="-1"></a>  subterm <span class="ot">&lt;-</span> <span class="fu">subset</span>(justices, term <span class="sc">==</span> SCterms[i])</span>
<span id="cb303-3"><a href="#cb303-3" aria-hidden="true" tabindex="-1"></a>  median.ip <span class="ot">&lt;-</span> <span class="fu">median</span>(subterm<span class="sc">$</span>post_mn)</span>
<span id="cb303-4"><a href="#cb303-4" aria-hidden="true" tabindex="-1"></a>  results[i] <span class="ot">&lt;-</span> subterm<span class="sc">$</span>justiceName[subterm<span class="sc">$</span>post_mn <span class="sc">==</span> median.ip]</span>
<span id="cb303-5"><a href="#cb303-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb303-6"><a href="#cb303-6" aria-hidden="true" tabindex="-1"></a>  results[i]</span></code></pre></div>
<pre><code>##        1991 
## &quot;SDOConnor&quot;</code></pre>
<p>We are in good shape! If we had a typo, we’d get an error message there, and that would be a sign that we need to work on the inside part of the code before putting it back into the loop structure.</p>
</div>
<div id="visualizing-the-results" class="section level3" number="6.2.2">
<h3><span class="header-section-number">6.2.2</span> Visualizing the Results</h3>
<p>To get a bit more practice with plots, let’s visualize the results and make our interpretations.</p>
<div class="sourceCode" id="cb305"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb305-1"><a href="#cb305-1" aria-hidden="true" tabindex="-1"></a>medians <span class="ot">&lt;-</span> <span class="fu">tapply</span>(justices<span class="sc">$</span>post_mn, justices<span class="sc">$</span>term, median)</span>
<span id="cb305-2"><a href="#cb305-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x =</span><span class="fu">names</span>(medians),</span>
<span id="cb305-3"><a href="#cb305-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">y=</span> medians, </span>
<span id="cb305-4"><a href="#cb305-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span>.<span class="dv">4</span>, <span class="dv">1</span>),</span>
<span id="cb305-5"><a href="#cb305-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">type =</span> <span class="st">&quot;b&quot;</span>,</span>
<span id="cb305-6"><a href="#cb305-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">cex=</span><span class="fl">1.5</span>,</span>
<span id="cb305-7"><a href="#cb305-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab=</span><span class="st">&quot;Conservatism&quot;</span>,</span>
<span id="cb305-8"><a href="#cb305-8" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">&quot;Term&quot;</span>,</span>
<span id="cb305-9"><a href="#cb305-9" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="st">&quot;Median of US Supreme Court over Time&quot;</span>)</span>
<span id="cb305-10"><a href="#cb305-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb305-11"><a href="#cb305-11" aria-hidden="true" tabindex="-1"></a><span class="do">## Add the names to the plot</span></span>
<span id="cb305-12"><a href="#cb305-12" aria-hidden="true" tabindex="-1"></a><span class="do">## Note: we want to make sure medians and results are in the same order for this to work</span></span>
<span id="cb305-13"><a href="#cb305-13" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="at">x=</span><span class="fu">names</span>(results), <span class="at">y=</span>(medians <span class="sc">-</span> .<span class="dv">14</span>), <span class="at">labels=</span>results, <span class="at">cex=</span>.<span class="dv">35</span>)</span></code></pre></div>
<p><img src="datasciforpolisci_files/figure-html/unnamed-chunk-177-1.svg" width="672" /></p>
<p>We have now used the <code>text()</code> function. Similar to plot, the <code>text()</code> takes a set of x and y coordinates that tells R the location of where you want to add a piece(s) of text to the plot. The third input is the actual text.</p>
<p>Why did the Court shift more conservative at the end of the time trend?</p>
<ul>
<li>Well we see that Justice Roberts became the median!</li>
</ul>
<p>As <a href="https://fivethirtyeight.com/features/roberts-is-the-new-swing-justice-that-doesnt-mean-hes-becoming-more-liberal/">FiveThirtyEight</a> notes, just because Justice Roberts is the new median, does not mean he has become more liberal. The Court composition is shifting, and the MQ scores also depend on the issues being heard before the Court.</p>
<p><img src="images/sccourt.png" /></p>
<p>Recall, the Martin-Quinn scores measure justice ideology based on voting patterns. What are the strengths and weaknesses of using this type of information to score the ideology of a justice?</p>
</div>
<div id="enhancing-the-plot" class="section level3" number="6.2.3">
<h3><span class="header-section-number">6.2.3</span> Enhancing the plot</h3>
<p>Let’s make the plot more beautiful by color coding.</p>
<div class="sourceCode" id="cb306"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb306-1"><a href="#cb306-1" aria-hidden="true" tabindex="-1"></a>medians <span class="ot">&lt;-</span> <span class="fu">tapply</span>(justices<span class="sc">$</span>post_mn, justices<span class="sc">$</span>term, median)</span>
<span id="cb306-2"><a href="#cb306-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x =</span><span class="fu">names</span>(medians),</span>
<span id="cb306-3"><a href="#cb306-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">y=</span> medians, </span>
<span id="cb306-4"><a href="#cb306-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span>.<span class="dv">4</span>, <span class="dv">1</span>),</span>
<span id="cb306-5"><a href="#cb306-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">type =</span> <span class="st">&quot;b&quot;</span>,</span>
<span id="cb306-6"><a href="#cb306-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab=</span><span class="st">&quot;Conservatism&quot;</span>,</span>
<span id="cb306-7"><a href="#cb306-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">&quot;Term&quot;</span>,</span>
<span id="cb306-8"><a href="#cb306-8" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="st">&quot;Median of US Supreme Court over Time&quot;</span>,</span>
<span id="cb306-9"><a href="#cb306-9" aria-hidden="true" tabindex="-1"></a>     <span class="at">xaxt=</span><span class="st">&quot;n&quot;</span>, <span class="do">## removes the x-axis</span></span>
<span id="cb306-10"><a href="#cb306-10" aria-hidden="true" tabindex="-1"></a>     <span class="at">las=</span><span class="dv">1</span>)</span>
<span id="cb306-11"><a href="#cb306-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb306-12"><a href="#cb306-12" aria-hidden="true" tabindex="-1"></a><span class="do">## Adds text</span></span>
<span id="cb306-13"><a href="#cb306-13" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="at">x=</span><span class="fu">names</span>(results), <span class="at">y=</span>(medians <span class="sc">-</span> .<span class="dv">14</span>), results, <span class="at">cex=</span>.<span class="dv">35</span>)</span>
<span id="cb306-14"><a href="#cb306-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb306-15"><a href="#cb306-15" aria-hidden="true" tabindex="-1"></a><span class="do">## Adds color-coded points on top of existing points</span></span>
<span id="cb306-16"><a href="#cb306-16" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(<span class="at">x =</span><span class="fu">names</span>(medians),</span>
<span id="cb306-17"><a href="#cb306-17" aria-hidden="true" tabindex="-1"></a>     <span class="at">y=</span> medians,</span>
<span id="cb306-18"><a href="#cb306-18" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb306-19"><a href="#cb306-19" aria-hidden="true" tabindex="-1"></a>     <span class="do">## Adds colors according to how results is coded</span></span>
<span id="cb306-20"><a href="#cb306-20" aria-hidden="true" tabindex="-1"></a>     <span class="at">col=</span> <span class="fu">ifelse</span>(results <span class="sc">==</span> <span class="st">&quot;AMKennedy&quot;</span>, <span class="st">&quot;orange&quot;</span>, </span>
<span id="cb306-21"><a href="#cb306-21" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">ifelse</span>(results <span class="sc">==</span><span class="st">&quot;SDOConnor&quot;</span>, <span class="st">&quot;light blue&quot;</span>, </span>
<span id="cb306-22"><a href="#cb306-22" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&quot;purple&quot;</span>)), </span>
<span id="cb306-23"><a href="#cb306-23" aria-hidden="true" tabindex="-1"></a>     <span class="at">pch=</span><span class="dv">15</span>, <span class="co"># point type- squares </span></span>
<span id="cb306-24"><a href="#cb306-24" aria-hidden="true" tabindex="-1"></a>     <span class="at">cex=</span><span class="fl">1.5</span>) <span class="co"># size of points</span></span>
<span id="cb306-25"><a href="#cb306-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb306-26"><a href="#cb306-26" aria-hidden="true" tabindex="-1"></a><span class="do">## Adds custom x-axis at the specific years included in names(medians)</span></span>
<span id="cb306-27"><a href="#cb306-27" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">1</span>, <span class="fu">names</span>(medians), <span class="at">cex.axis=</span>.<span class="dv">6</span>)</span></code></pre></div>
<p><img src="datasciforpolisci_files/figure-html/unnamed-chunk-178-1.svg" width="672" /></p>
<p>We have used the <code>points()</code> function. This adds an additional layer of points to a plot. It works much like the <code>plot</code> function in that in takes a set of x and y coordinates.</p>
<p>We could change the look of the plot even more by adding a legend and altering the borders and look of the plot.</p>
<div class="sourceCode" id="cb307"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb307-1"><a href="#cb307-1" aria-hidden="true" tabindex="-1"></a>medians <span class="ot">&lt;-</span> <span class="fu">tapply</span>(justices<span class="sc">$</span>post_mn, justices<span class="sc">$</span>term, median)</span>
<span id="cb307-2"><a href="#cb307-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x =</span><span class="fu">names</span>(medians),</span>
<span id="cb307-3"><a href="#cb307-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">y=</span> medians, </span>
<span id="cb307-4"><a href="#cb307-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span>.<span class="dv">4</span>, <span class="dv">1</span>),</span>
<span id="cb307-5"><a href="#cb307-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">type =</span> <span class="st">&quot;b&quot;</span>,</span>
<span id="cb307-6"><a href="#cb307-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab=</span><span class="st">&quot;Conservatism&quot;</span>,</span>
<span id="cb307-7"><a href="#cb307-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">&quot;Term&quot;</span>,</span>
<span id="cb307-8"><a href="#cb307-8" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="st">&quot;Median of US Supreme Court over Time&quot;</span>,</span>
<span id="cb307-9"><a href="#cb307-9" aria-hidden="true" tabindex="-1"></a>     <span class="at">xaxt=</span><span class="st">&quot;n&quot;</span>, <span class="co"># removes x axis</span></span>
<span id="cb307-10"><a href="#cb307-10" aria-hidden="true" tabindex="-1"></a>     <span class="at">las=</span><span class="dv">1</span>, <span class="co"># changes the orientation of the axis labels</span></span>
<span id="cb307-11"><a href="#cb307-11" aria-hidden="true" tabindex="-1"></a>     <span class="at">lwd=</span><span class="dv">2</span>, <span class="co"># increases the thickness of the lines</span></span>
<span id="cb307-12"><a href="#cb307-12" aria-hidden="true" tabindex="-1"></a>     <span class="at">tick=</span>F, <span class="co"># removes the tick marks from the axis</span></span>
<span id="cb307-13"><a href="#cb307-13" aria-hidden="true" tabindex="-1"></a>     <span class="at">bty=</span><span class="st">&quot;n&quot;</span>) <span class="co"># removes the plot border</span></span>
<span id="cb307-14"><a href="#cb307-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb307-15"><a href="#cb307-15" aria-hidden="true" tabindex="-1"></a><span class="do">## adds horizontal dashed gray lines</span></span>
<span id="cb307-16"><a href="#cb307-16" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h=</span><span class="fu">seq</span>(<span class="sc">-</span>.<span class="dv">4</span>, <span class="dv">1</span>, .<span class="dv">2</span>), <span class="at">lty=</span><span class="dv">2</span>, <span class="at">col=</span><span class="st">&quot;light gray&quot;</span>)</span>
<span id="cb307-17"><a href="#cb307-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb307-18"><a href="#cb307-18" aria-hidden="true" tabindex="-1"></a><span class="do">## Adds a legend</span></span>
<span id="cb307-19"><a href="#cb307-19" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;bottomleft&quot;</span>, <span class="at">pch=</span><span class="dv">15</span>, <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;orange&quot;</span>, <span class="st">&quot;light blue&quot;</span>, <span class="st">&quot;purple&quot;</span>),</span>
<span id="cb307-20"><a href="#cb307-20" aria-hidden="true" tabindex="-1"></a>       <span class="fu">c</span>(<span class="st">&quot;Kennedy&quot;</span>, <span class="st">&quot;O&#39;Connor&quot;</span>, <span class="st">&quot;Roberts&quot;</span>), <span class="at">bty=</span><span class="st">&quot;n&quot;</span>)</span>
<span id="cb307-21"><a href="#cb307-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb307-22"><a href="#cb307-22" aria-hidden="true" tabindex="-1"></a><span class="do">## Adds the color-coded points</span></span>
<span id="cb307-23"><a href="#cb307-23" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(<span class="at">x =</span><span class="fu">names</span>(medians), <span class="at">y=</span> medians,</span>
<span id="cb307-24"><a href="#cb307-24" aria-hidden="true" tabindex="-1"></a>     <span class="at">col=</span> <span class="fu">ifelse</span>(results <span class="sc">==</span> <span class="st">&quot;AMKennedy&quot;</span>, <span class="st">&quot;orange&quot;</span>, </span>
<span id="cb307-25"><a href="#cb307-25" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">ifelse</span>(results <span class="sc">==</span><span class="st">&quot;SDOConnor&quot;</span>, <span class="st">&quot;light blue&quot;</span>, <span class="st">&quot;purple&quot;</span>)), </span>
<span id="cb307-26"><a href="#cb307-26" aria-hidden="true" tabindex="-1"></a>     <span class="at">pch=</span><span class="dv">15</span>, <span class="at">cex=</span><span class="dv">2</span>)</span>
<span id="cb307-27"><a href="#cb307-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb307-28"><a href="#cb307-28" aria-hidden="true" tabindex="-1"></a><span class="do">## Adds our custom x-axis</span></span>
<span id="cb307-29"><a href="#cb307-29" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">1</span>, <span class="fu">names</span>(medians), <span class="at">cex.axis=</span>.<span class="dv">6</span>, <span class="at">tick=</span>F)</span></code></pre></div>
<p><img src="datasciforpolisci_files/figure-html/unnamed-chunk-179-1.svg" width="672" /></p>
</div>
<div id="wrapping-up" class="section level3" number="6.2.4">
<h3><span class="header-section-number">6.2.4</span> Wrapping Up</h3>
<p>We have calculated and visualized how the median U.S. Supreme Court Justice and Justice’s ideology has changed over the past three decades.</p>
<ul>
<li>This gave us additional practice with loops and visualization</li>
<li>We also gained exposure to an example of how political scientists take a large amount of information– votes on all Supreme Court cases– and try to summarize it using a single number that represents how liberal or conservative a justice is</li>
</ul>
<p>This type of information can be used for many social science goals: 1) To describe trends in the Court 2) To help explain why the Court has voted a particular way on recent cases 3) To predict how the Court will vote in the future as new justices arrive.</p>
<p>With Amy Coney Barrett now on the Court, we can start to see initial changes in the Court composition. The MQ scores will continue to be updated to allow for future exploration of these dynamics.</p>
<div class="figure">
<img src="images/sccourt3.png" alt="" />
<p class="caption"><a href="https://fivethirtyeight.com/features/the-supreme-courts-conservative-supermajority-is-just-beginning-to-flex-its-muscles">FiveThirtyEight</a></p>
</div>
<!--chapter:end:06-Loops.Rmd-->
</div>
</div>
</div>
<div id="prediction" class="section level1" number="7">
<h1><span class="header-section-number">7</span> Prediction</h1>
<p>In this section, we move to our next social science goal</p>
<ul>
<li>Describe</li>
<li>Explain, evaluate, and recommend <span class="math inline">\(\rightarrow\)</span> Causality</li>
<li><strong><em>Predict</em></strong></li>
<li>Discover</li>
</ul>
<p>Most of the tools we have been working on thus far have focused on first describing our data and then conducting tests through different types of comparisons and visualizations, in order to assess a deductive hypothesis, explaining the relationship between two variables.</p>
<p>Now we turn to a different goal.</p>
<p>Recall the difference between Correlation vs. Causality using our graphic showing the popularity of <em>Duck Dynasty</em> in different parts of the country. In 2016, researchers at the <a href="https://www.nytimes.com/interactive/2016/12/26/upshot/duck-dynasty-vs-modern-family-television-maps.html">NY Times</a> noticed that areas in the country where the television show Duck Dynasty was popular also tended to support Donald Trump at higher rates.</p>
<p><img src="images/duckdynasty.png" style="width:70.0%" /></p>
<p>For those used to working with the goal of explanation, shifting to prediction and classification may mean we need to shift what types of information we think is important.</p>
<ul>
<li>Correlation: Areas that watch Duck Dynasty are more likely to support Trump (degree to which two variables ``move together”)</li>
<li>Causality: Watching Duck Dynasty (vs. not watching) causes you to support Trump.</li>
</ul>
<p>If we were interested in the goal of explaining voting decisions (what causes someone to vote a certain way?), we might not care if someone watches the show. However, if we were just interested in predicting vote share or voting decisions, a strong correlation could still be useful. Without spending a single dollar on surveying a community, we might have a general sense of their support for a candidate.</p>
<div id="prediction-overview" class="section level2" number="7.1">
<h2><span class="header-section-number">7.1</span> Prediction Overview</h2>
<p>Our goal: Predict (estimate/guess) some unknown using information we have as accurately and precisely as possible</p>
<ul>
<li>Prediction could involve estimating a numeric outcome. Alternatively, prediction also involves classification– predicting a categorical outcome (e.g., prediction of who wins vs. who loses).</li>
</ul>
<p>Some political science examples of this might include</p>
<ol style="list-style-type: decimal">
<li>Categorizing comments on social media as being toxic/nasty/uncivil</li>
</ol>
<div class="figure">
<img src="images/instagramhate.png" alt="" />
<p class="caption">Wired</p>
</div>
<ol start="2" style="list-style-type: decimal">
<li>Detecting Fake news and misinformation</li>
</ol>
<div class="figure">
<img src="images/fakenewsai.png" alt="" />
<p class="caption">PBS</p>
</div>
<ol start="3" style="list-style-type: decimal">
<li>Forecasting election results</li>
</ol>
<p><img src="images/forecast16.png" /></p>
<p>Other examples</p>
<ul>
<li>Trying to detect hate speech online</li>
<li>Predicting where or when an attack might occur</li>
<li>Trying to classify a large amount of text into subject or topic categories for analysis</li>
</ul>
<p>What other types of things might we try to predict or classify in political science?</p>
</div>
<div id="process-of-prediction" class="section level2" number="7.2">
<h2><span class="header-section-number">7.2</span> Process of Prediction</h2>
<p>Predict (estimate/guess) some unknown using information we have – and do so as accurately and precisely as possible.</p>
<ol style="list-style-type: decimal">
<li>Choose an approach
<ul>
<li>Using an observed (known) measure as a direct proxy to predict an outcome</li>
<li>Using one or more observed (known) measures in a regression model to predict an outcome</li>
<li>(Beyond the course) Using a statistical model to select the measures to use for predicting an outcome</li>
</ul></li>
<li>Assess accuracy and precision
<ul>
<li>Prediction error: <span class="math inline">\(Prediction - Truth\)</span></li>
<li>Bias: Average prediction error: <span class="math inline">\(\text{mean}(Prediction - Truth)\)</span>
<ul>
<li>A prediction is `unbiased’ if the bias is zero (If the prediction is on average true)</li>
</ul></li>
<li>Root-mean squared error: <span class="math inline">\(\sqrt{\text{mean}((Prediction - Truth)^2)}\)</span>
<ul>
<li>Like `absolute’ error– the average magnitude of the prediction error</li>
<li>the typical distance the prediction is from the truth</li>
</ul></li>
<li>Confusion Matrix
<ul>
<li>A cross-tab of predictions you got correct vs. predictions you got wrong (misclassified)</li>
<li>Gives you true positives and true negatives vs. false positives and false negatives</li>
</ul></li>
</ul></li>
<li>Iterate to improve the prediction/classification
<ul>
<li>Often, we repeat steps 1-3 until we are confident in your method for predicting.</li>
</ul></li>
</ol>
<p>Eventually, after you have tested the approach and are satisfied with the accuracy, you may start applying it to new data for which you do not know the right answer.</p>
</div>
<div id="example-forecasting-2020-us-election-based-on-2016-results" class="section level2" number="7.3">
<h2><span class="header-section-number">7.3</span> Example: Forecasting 2020 US Election based on 2016 Results</h2>
<p>Let’s try to predict the 2020 election results using just the 2016 results.</p>
<p><em>For a video explainer of the code for this application, see below. (Via youtube, you can speed up the playback to 1.5 or 2x speed.)</em></p>
<div class="vembedr">
<div>
<iframe src="https://www.youtube.com/embed/zWDxZogRwOs" width="533" height="300" frameborder="0" allowfullscreen=""></iframe>
</div>
</div>
<div class="sourceCode" id="cb308"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb308-1"><a href="#cb308-1" aria-hidden="true" tabindex="-1"></a>results2020 <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;elecresults2020.csv&quot;</span>, <span class="at">stringsAsFactors =</span> T)</span></code></pre></div>
<p>Variables</p>
<ul>
<li><code>state</code>: state or state and district</li>
<li><code>called</code>: result of 2020 election</li>
<li><code>margin2016</code>: two-party margin in 2016. Positive values indicate Democratic win, negative indicate Republican win</li>
<li><code>EV</code>: Electoral votes associated with a state/ district of a state</li>
</ul>
<p><img src="images/result2020.png" style="width:80.0%" /></p>
<div class="sourceCode" id="cb309"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb309-1"><a href="#cb309-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(results2020<span class="sc">$</span>EV[results2020<span class="sc">$</span>called <span class="sc">==</span> <span class="st">&quot;R&quot;</span>])</span></code></pre></div>
<pre><code>## [1] 232</code></pre>
<div class="sourceCode" id="cb311"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb311-1"><a href="#cb311-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(results2020<span class="sc">$</span>EV[results2020<span class="sc">$</span>called <span class="sc">==</span> <span class="st">&quot;D&quot;</span>])</span></code></pre></div>
<pre><code>## [1] 306</code></pre>
<div id="choose-approach" class="section level3" number="7.3.1">
<h3><span class="header-section-number">7.3.1</span> Choose Approach</h3>
<ol style="list-style-type: decimal">
<li>Choose an approach: Using an observed (known) measure as a direct proxy to predict an outcome</li>
</ol>
<ul>
<li>Let’s use the 2016 result as a direct proxy to predict 2020.</li>
</ul>
<div class="sourceCode" id="cb313"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb313-1"><a href="#cb313-1" aria-hidden="true" tabindex="-1"></a>results2020<span class="sc">$</span>predicted2020 <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(results2020<span class="sc">$</span>margin2016 <span class="sc">&lt;</span> <span class="dv">0</span>, <span class="st">&quot;R&quot;</span>, <span class="st">&quot;D&quot;</span>)</span>
<span id="cb313-2"><a href="#cb313-2" aria-hidden="true" tabindex="-1"></a>results2020<span class="sc">$</span>predicted2020 <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(results2020<span class="sc">$</span>predicted2020)</span></code></pre></div>
</div>
<div id="assess-accuracy" class="section level3" number="7.3.2">
<h3><span class="header-section-number">7.3.2</span> Assess Accuracy</h3>
<ol start="2" style="list-style-type: decimal">
<li>Assess accuracy</li>
</ol>
<p>What proportion of states did we get correct?</p>
<div class="sourceCode" id="cb314"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb314-1"><a href="#cb314-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(results2020<span class="sc">$</span>predicted2020 <span class="sc">==</span> results2020<span class="sc">$</span>called)</span></code></pre></div>
<pre><code>## [1] 0.8928571</code></pre>
<p>Classification</p>
<p>We want to correctly predict the winner of each state</p>
<p>Prediction of binary outcome variable = classification problem</p>
<ul>
<li>true positive: correctly predicting Biden to be the
winner</li>
<li>false positive: incorrectly predicting Biden to be
the winner (misclassification)</li>
<li>true negative: correctly predicting Biden to be the
loser</li>
<li>false negative: incorrectly predicting Biden to be
the loser (misclassification)</li>
</ul>
<p>We define one outcome as the “positive” and one as the “negative.” Here we will say a Biden win is the positive and a Trump win is the negative. You could flip this and make a Trump win the positive and a Biden win the negative. This terminology comes from settings where there is a more objective positive vs. negative result (e.g., a positive medical test result) than most social science settings. The key thing is that we are trying to identify different types of correct classifications vs. misclassifications.</p>
<p>Confusion Matrix: Tells us how we went right, how we went wrong.</p>
<div class="sourceCode" id="cb316"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb316-1"><a href="#cb316-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(<span class="at">predicted=</span>results2020<span class="sc">$</span>predicted2020, <span class="at">actual =</span> results2020<span class="sc">$</span>called)</span></code></pre></div>
<pre><code>##          actual
## predicted  D  R
##         D 22  0
##         R  6 28</code></pre>
<p>Which states did we get wrong?</p>
<div class="sourceCode" id="cb318"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb318-1"><a href="#cb318-1" aria-hidden="true" tabindex="-1"></a>results2020<span class="sc">$</span>state[results2020<span class="sc">$</span>predicted2020 <span class="sc">!=</span> results2020<span class="sc">$</span>called]</span></code></pre></div>
<pre><code>## [1] Arizona               Georgia               Michigan             
## [4] Nebraska 2nd District Pennsylvania          Wisconsin            
## 56 Levels: Alabama Alaska Arizona Arkansas California Colorado ... Wyoming</code></pre>
</div>
<div id="iterate-to-improve-predictions" class="section level3" number="7.3.3">
<h3><span class="header-section-number">7.3.3</span> Iterate to improve predictions</h3>
<p>Start back at step one. We continue to repeat steps 1 and 2 until we are confident in our predictions.</p>
<p>How could we improve our predictions of elections? What other information could we use?</p>
</div>
</div>
<div id="example-using-polls-to-predict-the-2020-election-results" class="section level2" number="7.4">
<h2><span class="header-section-number">7.4</span> Example: Using polls to predict the 2020 election results</h2>
<p><em>For a video explainer of the code for this application, see below. (Via youtube, you can speed up the playback to 1.5 or 2x speed.)</em></p>
<div class="vembedr">
<div>
<iframe src="https://www.youtube.com/embed/bDvwgs-F8Ic" width="533" height="300" frameborder="0" allowfullscreen=""></iframe>
</div>
</div>
<p>Many forecasters use pre-election polls in their models to predict election outcomes. In 2016 and 2020, polling-based forecasts received a lot of criticism</p>
<p>Prior to the 2016 elections, forecasts that used polls seemed confident that Hillary Clinton would win the election. <a href="https://www.youtube.com/watch?v=zerWCVpXTr8">Political analysts</a> also seemed to think the polls were favorable to Clinton.</p>
<div class="figure">
<img src="images/clintonupshot.png" alt="" />
<p class="caption"><em>NY Upshot</em></p>
</div>
<p>We all know that afterwards, Clinton did not win.</p>
<div class="figure">
<img src="images/afterpolls.png" style="width:70.0%" alt="" />
<p class="caption"><em>Pew</em></p>
</div>
<p>This led public opinion scholars and practitioners to do a deep investigation into the quality of pre-election polling. Like 2016, following the 2020 election, a similar team investigated the quality of pre-election polling in 2020. Here, while many polls pointed to a favorable outcome for Biden, the results seemed closer than one might have anticipated.</p>
<p><img src="images/aaportitle.png" /></p>
<p>The results of these findings are in the <a href="https://www.aapor.org/AAPOR_Main/media/MainSiteFiles/AAPOR-Task-Force-on-2020-Pre-Election-Polling_Report-FNL.pdf">AAPOR report</a>.</p>
<div id="choose-an-approach-lets-analyze-some-polls" class="section level3" number="7.4.1">
<h3><span class="header-section-number">7.4.1</span> Choose an approach: Let’s analyze some polls</h3>
<p>We are going to do our own analysis of pre-election polls as a prediction of the 2020 election results. We will use a large number of state polls conducted from May-November 2020 that were made available to the public on FiveThirtyEight.</p>
<div class="sourceCode" id="cb320"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb320-1"><a href="#cb320-1" aria-hidden="true" tabindex="-1"></a>polls2020 <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;pollsandresults2020.csv&quot;</span>, <span class="at">stringsAsFactors =</span> T)</span></code></pre></div>
<p>Variables</p>
<ul>
<li><code>TrumpPoll, BidenPoll</code>: Poll-based vote share for Biden or Trump</li>
<li><code>TrumpResult, BidenResult</code>: Actual vote share for Biden or Trump</li>
<li><code>EV</code>: Electoral votes associated with state/CD</li>
<li><code>days_to_election</code>: Days until Election Day</li>
<li><code>stateid</code>: state abbreviation</li>
<li><code>fte_grade</code>: FiveThirtyEight Pollster grade</li>
<li><code>sample_size</code>: Poll sample size</li>
</ul>
<p>Can we predict the outcome of an election using polls?</p>
<p>Let’s create our outcome variables.</p>
<div class="sourceCode" id="cb321"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb321-1"><a href="#cb321-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Biden&#39;s margin of victory (or defeat) in  the polls</span></span>
<span id="cb321-2"><a href="#cb321-2" aria-hidden="true" tabindex="-1"></a>polls2020<span class="sc">$</span>polldiff <span class="ot">&lt;-</span> polls2020<span class="sc">$</span>BidenPoll <span class="sc">-</span> polls2020<span class="sc">$</span>TrumpPoll</span>
<span id="cb321-3"><a href="#cb321-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb321-4"><a href="#cb321-4" aria-hidden="true" tabindex="-1"></a><span class="do">## Biden&#39;s margin of victory (or defeat) in the actual election result</span></span>
<span id="cb321-5"><a href="#cb321-5" aria-hidden="true" tabindex="-1"></a>polls2020<span class="sc">$</span>resultdiff <span class="ot">&lt;-</span> polls2020<span class="sc">$</span>BidenResult <span class="sc">-</span> polls2020<span class="sc">$</span>TrumpResult</span></code></pre></div>
<p>Positive numbers mean Biden was ahead/won. Negative mean Trump was ahead/won.</p>
<p><img src="images/result2020.png" style="width:80.0%" /></p>
<p>Let’s predict the amount of electoral votes for Biden based on polls in each state close to Election Day.</p>
<p>Let’s start with 1 state.</p>
<ul>
<li>Let’s grab all polls within 2 weeks of the election or the most recent day polled (for areas that did not have recent polls)</li>
</ul>
<div class="sourceCode" id="cb322"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb322-1"><a href="#cb322-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Iteration vector</span></span>
<span id="cb322-2"><a href="#cb322-2" aria-hidden="true" tabindex="-1"></a>states <span class="ot">&lt;-</span> <span class="fu">unique</span>(polls2020<span class="sc">$</span>stateid)</span>
<span id="cb322-3"><a href="#cb322-3" aria-hidden="true" tabindex="-1"></a>states[<span class="dv">1</span>]</span></code></pre></div>
<pre><code>## [1] AL
## 55 Levels: AK AL AR AZ CA CO CT DC DE FL GA HI IA ID IL IN KS KY LA MA ... WY</code></pre>
<div class="sourceCode" id="cb324"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb324-1"><a href="#cb324-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Subset to just Alabama</span></span>
<span id="cb324-2"><a href="#cb324-2" aria-hidden="true" tabindex="-1"></a>subdata <span class="ot">&lt;-</span> <span class="fu">subset</span>(polls2020, stateid <span class="sc">==</span> states[<span class="dv">1</span>])</span>
<span id="cb324-3"><a href="#cb324-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb324-4"><a href="#cb324-4" aria-hidden="true" tabindex="-1"></a><span class="do">## Further subset to the &quot;latest polls&quot;</span></span>
<span id="cb324-5"><a href="#cb324-5" aria-hidden="true" tabindex="-1"></a>subdata <span class="ot">&lt;-</span> <span class="fu">subset</span>(subdata, days_to_election <span class="sc">&lt;</span> <span class="dv">15</span> <span class="sc">|</span> </span>
<span id="cb324-6"><a href="#cb324-6" aria-hidden="true" tabindex="-1"></a>                      days_to_election <span class="sc">==</span> <span class="fu">min</span>(subdata<span class="sc">$</span>days_to_election) )</span></code></pre></div>
<p>Now let’s extract the actual margin for Biden, the poll-based predicted margin, and finally, let’s assign electoral votes based on our prediction.</p>
<div class="sourceCode" id="cb325"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb325-1"><a href="#cb325-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Find the margin for the actual result</span></span>
<span id="cb325-2"><a href="#cb325-2" aria-hidden="true" tabindex="-1"></a>result.marginAL <span class="ot">&lt;-</span> <span class="fu">mean</span>(subdata<span class="sc">$</span>resultdiff)</span>
<span id="cb325-3"><a href="#cb325-3" aria-hidden="true" tabindex="-1"></a>result.marginAL</span></code></pre></div>
<pre><code>## [1] -25.4</code></pre>
<div class="sourceCode" id="cb327"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb327-1"><a href="#cb327-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Find the margin for our prediction</span></span>
<span id="cb327-2"><a href="#cb327-2" aria-hidden="true" tabindex="-1"></a>polls.marginAL <span class="ot">&lt;-</span> <span class="fu">mean</span>(subdata<span class="sc">$</span>polldiff)</span>
<span id="cb327-3"><a href="#cb327-3" aria-hidden="true" tabindex="-1"></a>polls.marginAL</span></code></pre></div>
<pre><code>## [1] -21.16667</code></pre>
<div class="sourceCode" id="cb329"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb329-1"><a href="#cb329-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Allocate votes for Biden according to the margin</span></span>
<span id="cb329-2"><a href="#cb329-2" aria-hidden="true" tabindex="-1"></a>bidenvotesAL <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">mean</span>(subdata<span class="sc">$</span>polldiff) <span class="sc">&gt;</span> <span class="dv">0</span>, </span>
<span id="cb329-3"><a href="#cb329-3" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">unique</span>(subdata<span class="sc">$</span>EV), <span class="dv">0</span>)</span>
<span id="cb329-4"><a href="#cb329-4" aria-hidden="true" tabindex="-1"></a>bidenvotesAL</span></code></pre></div>
<pre><code>## [1] 0</code></pre>
<p>We predicted Biden would lose Alabama because the <code>polls.marginAL</code> is negative. Therefore, we assigned Biden 0 electoral votes in this example.</p>
</div>
<div id="loop-through-all-states" class="section level3" number="7.4.2">
<h3><span class="header-section-number">7.4.2</span> Loop through all states</h3>
<div class="sourceCode" id="cb331"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb331-1"><a href="#cb331-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Iteration vector</span></span>
<span id="cb331-2"><a href="#cb331-2" aria-hidden="true" tabindex="-1"></a>states <span class="ot">&lt;-</span> <span class="fu">unique</span>(polls2020<span class="sc">$</span>stateid)</span>
<span id="cb331-3"><a href="#cb331-3" aria-hidden="true" tabindex="-1"></a><span class="do">## Container vector</span></span>
<span id="cb331-4"><a href="#cb331-4" aria-hidden="true" tabindex="-1"></a>polls.margin <span class="ot">&lt;-</span> result.margin <span class="ot">&lt;-</span> bidenvotes <span class="ot">&lt;-</span> </span>
<span id="cb331-5"><a href="#cb331-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="fu">length</span>(states))</span>
<span id="cb331-6"><a href="#cb331-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb331-7"><a href="#cb331-7" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(polls.margin) <span class="ot">&lt;-</span> <span class="fu">names</span>(result.margin) <span class="ot">&lt;-</span> </span>
<span id="cb331-8"><a href="#cb331-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(bidenvotes)  <span class="ot">&lt;-</span><span class="fu">as.character</span>(<span class="fu">unique</span>(states))</span>
<span id="cb331-9"><a href="#cb331-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb331-10"><a href="#cb331-10" aria-hidden="true" tabindex="-1"></a><span class="do">## Loop</span></span>
<span id="cb331-11"><a href="#cb331-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(states)){</span>
<span id="cb331-12"><a href="#cb331-12" aria-hidden="true" tabindex="-1"></a>  subdata <span class="ot">&lt;-</span> <span class="fu">subset</span>(polls2020, stateid <span class="sc">==</span> states[i] )</span>
<span id="cb331-13"><a href="#cb331-13" aria-hidden="true" tabindex="-1"></a>  subdata <span class="ot">&lt;-</span> <span class="fu">subset</span>(subdata, days_to_election <span class="sc">&lt;</span> <span class="dv">15</span> <span class="sc">|</span> </span>
<span id="cb331-14"><a href="#cb331-14" aria-hidden="true" tabindex="-1"></a>                      days_to_election <span class="sc">==</span> <span class="fu">min</span>(subdata<span class="sc">$</span>days_to_election) )</span>
<span id="cb331-15"><a href="#cb331-15" aria-hidden="true" tabindex="-1"></a>  result.margin[i] <span class="ot">&lt;-</span> <span class="fu">mean</span>(subdata<span class="sc">$</span>resultdiff)</span>
<span id="cb331-16"><a href="#cb331-16" aria-hidden="true" tabindex="-1"></a>  polls.margin[i] <span class="ot">&lt;-</span> <span class="fu">mean</span>(subdata<span class="sc">$</span>polldiff)</span>
<span id="cb331-17"><a href="#cb331-17" aria-hidden="true" tabindex="-1"></a>  bidenvotes[i] <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">mean</span>(subdata<span class="sc">$</span>polldiff) <span class="sc">&gt;</span> <span class="dv">0</span>, </span>
<span id="cb331-18"><a href="#cb331-18" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">unique</span>(subdata<span class="sc">$</span>EV), <span class="dv">0</span>)</span>
<span id="cb331-19"><a href="#cb331-19" aria-hidden="true" tabindex="-1"></a> }</span>
<span id="cb331-20"><a href="#cb331-20" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(bidenvotes) <span class="co"># predicted</span></span></code></pre></div>
<pre><code>## [1] 351</code></pre>
</div>
<div id="check-accuracy" class="section level3" number="7.4.3">
<h3><span class="header-section-number">7.4.3</span> Check Accuracy</h3>
<div id="quantitative-measures-of-accuracy" class="section level4" number="7.4.3.1">
<h4><span class="header-section-number">7.4.3.1</span> Quantitative Measures of Accuracy</h4>
<p>Let’s calculate two common measures of prediction error: bias (the average prediction error) and root-mean-squared error (a typical magnitude of the prediction error).</p>
<div class="sourceCode" id="cb333"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb333-1"><a href="#cb333-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Calculate Bias (Predicted Biden - True Biden)</span></span>
<span id="cb333-2"><a href="#cb333-2" aria-hidden="true" tabindex="-1"></a>predictionerror <span class="ot">&lt;-</span> polls.margin <span class="sc">-</span>result.margin </span>
<span id="cb333-3"><a href="#cb333-3" aria-hidden="true" tabindex="-1"></a>bias <span class="ot">&lt;-</span> <span class="fu">mean</span>(predictionerror)</span>
<span id="cb333-4"><a href="#cb333-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb333-5"><a href="#cb333-5" aria-hidden="true" tabindex="-1"></a><span class="do">## Root Mean Squared Error</span></span>
<span id="cb333-6"><a href="#cb333-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sqrt</span>(<span class="fu">mean</span>((predictionerror)<span class="sc">^</span><span class="dv">2</span>))</span></code></pre></div>
<pre><code>## [1] 6.052873</code></pre>
<p>On average, the poll-based prediction was more than 4 points larger for Biden’s margin than the actual result.</p>
<p>We can create a plot similar to the left plot from the AAPOR report.</p>
<p><img src="images/aaporhist20.png" /></p>
<div class="sourceCode" id="cb335"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb335-1"><a href="#cb335-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Histogram of Prediction Errors to Show Bias</span></span>
<span id="cb335-2"><a href="#cb335-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(predictionerror, </span>
<span id="cb335-3"><a href="#cb335-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&quot;Prediction Error (Predicted Biden Margin - Actual)&quot;</span>,</span>
<span id="cb335-4"><a href="#cb335-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">&quot;Histogram of Prediction Error in Latest Polls&quot;</span>)</span>
<span id="cb335-5"><a href="#cb335-5" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span><span class="fu">mean</span>(predictionerror), <span class="at">col=</span><span class="st">&quot;red&quot;</span>)</span>
<span id="cb335-6"><a href="#cb335-6" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span><span class="dv">0</span>)</span></code></pre></div>
<p><img src="datasciforpolisci_files/figure-html/unnamed-chunk-196-1.svg" width="672" /></p>
<p>Another way to visualize the prediction error</p>
<ul>
<li>Let’s create our own version of this AAPOR Plot</li>
</ul>
<p><img src="images/aapor20.png" /></p>
<p>We will plot the prediction error on the x-axis, and list the corresponding states on the y-axis.</p>
<ul>
<li>We will sort the prediction error to make it easier to see the pattern of results.</li>
</ul>
<div class="sourceCode" id="cb336"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb336-1"><a href="#cb336-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x=</span><span class="fu">sort</span>(predictionerror), <span class="at">y=</span><span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(predictionerror),</span>
<span id="cb336-2"><a href="#cb336-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="st">&quot;Average Prediction Error by State </span><span class="sc">\n</span><span class="st"> Biden - Trump Margin&quot;</span>,</span>
<span id="cb336-3"><a href="#cb336-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab=</span><span class="st">&quot;State&quot;</span>,</span>
<span id="cb336-4"><a href="#cb336-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">&quot;Prediction Error (Predicted Biden Margin - Actual Margin)&quot;</span>,</span>
<span id="cb336-5"><a href="#cb336-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">yaxt=</span><span class="st">&quot;n&quot;</span>,</span>
<span id="cb336-6"><a href="#cb336-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">bty=</span><span class="st">&quot;n&quot;</span>,</span>
<span id="cb336-7"><a href="#cb336-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">5</span>, <span class="dv">15</span>)) </span>
<span id="cb336-8"><a href="#cb336-8" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span><span class="dv">0</span>, <span class="at">lty=</span><span class="dv">2</span>)</span>
<span id="cb336-9"><a href="#cb336-9" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">2</span>, <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(predictionerror), <span class="at">labels=</span><span class="fu">names</span>(<span class="fu">sort</span>(predictionerror)), <span class="at">las=</span><span class="dv">1</span>, </span>
<span id="cb336-10"><a href="#cb336-10" aria-hidden="true" tabindex="-1"></a>     <span class="at">cex.axis=</span>.<span class="dv">5</span>,<span class="at">tick=</span>F)</span>
<span id="cb336-11"><a href="#cb336-11" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">1</span>, <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">5</span>, <span class="dv">15</span>, <span class="dv">5</span>), <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">5</span>, <span class="dv">15</span>, <span class="dv">5</span>))</span>
<span id="cb336-12"><a href="#cb336-12" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="dv">15</span>, <span class="st">&quot;Poll Margin </span><span class="sc">\n</span><span class="st"> Skewed Toward Trump&quot;</span>, <span class="at">cex=</span>.<span class="dv">7</span>)</span>
<span id="cb336-13"><a href="#cb336-13" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="dv">8</span>, <span class="dv">15</span>, <span class="st">&quot;Poll Margin </span><span class="sc">\n</span><span class="st"> Skewed Toward Biden&quot;</span>, <span class="at">cex=</span>.<span class="dv">7</span>)</span></code></pre></div>
<p><img src="datasciforpolisci_files/figure-html/unnamed-chunk-197-1.svg" width="672" /></p>
</div>
<div id="classification" class="section level4" number="7.4.3.2">
<h4><span class="header-section-number">7.4.3.2</span> Classification</h4>
<p>Instead of quantifying how far we were off, let’s see where we were right vs. where we were wrong.</p>
<p>Classification</p>
<ul>
<li>true positive: correctly predicting Biden to be the winner</li>
<li>false positive: incorrectly predicting Biden to be the winner</li>
<li>true negative: correctly predicting Biden to be the
loser</li>
<li>false negative: incorrectly predicting Biden to be
the loser</li>
</ul>
<p>Confusion Matrix</p>
<p>Let’s classify our predictions.</p>
<div class="sourceCode" id="cb337"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb337-1"><a href="#cb337-1" aria-hidden="true" tabindex="-1"></a>actualwins <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(result.margin <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="st">&quot;Biden Won&quot;</span>, <span class="st">&quot;Trump Won&quot;</span>)</span>
<span id="cb337-2"><a href="#cb337-2" aria-hidden="true" tabindex="-1"></a>predictedwins <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(polls.margin <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="st">&quot;Biden Won&quot;</span>, <span class="st">&quot;Trump Won&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb338"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb338-1"><a href="#cb338-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(predictedwins, actualwins)</span></code></pre></div>
<pre><code>##              actualwins
## predictedwins Biden Won Trump Won
##     Biden Won        28         3
##     Trump Won         0        24</code></pre>
<p>Where did the polls get it wrong?</p>
<div class="sourceCode" id="cb340"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb340-1"><a href="#cb340-1" aria-hidden="true" tabindex="-1"></a>actualwins[actualwins <span class="sc">!=</span> predictedwins]</span></code></pre></div>
<pre><code>##          FL         ME2          NC 
## &quot;Trump Won&quot; &quot;Trump Won&quot; &quot;Trump Won&quot;</code></pre>
<p>What’s your conclusion?</p>
<ul>
<li>Are the polls alright?</li>
<li>How could you improve the prediction?</li>
<li>Wait a second… why even poll?</li>
</ul>
<!--chapter:end:07-Prediction.Rmd-->
</div>
</div>
</div>
</div>
<div id="regression" class="section level1" number="8">
<h1><span class="header-section-number">8</span> Prediction with Regression</h1>
<p>We are continuing our topic of prediction, this time adding a new tool: linear regression.</p>
<p>Recall that we predict (estimate/guess) some unknown using information we have – and do so as accurately and precisely as possible.</p>
<ol style="list-style-type: decimal">
<li>Choose an approach
<ul>
<li>Using an observed (known) measure as a direct proxy to predict an outcome</li>
<li><strong><em>Using one or more observed (known) measures in a regression model to predict an outcome</em></strong></li>
<li>(Beyond the course) Using a statistical model to select the measures to use for predicting an outcome</li>
</ul></li>
<li>Assess accuracy and precision</li>
<li>Iterate to improve the prediction/classification
<ul>
<li>Often, we <a href="https://www.youtube.com/watch?v=rXPfovXw2tw">repeat steps 1-3</a> until we are confident in your method for predicting.</li>
</ul></li>
</ol>
<p>Eventually, after you have tested the approach and are satisfied with the accuracy, you may start applying it to new data for which you do not know the right answer.</p>
<div id="regression-in-the-wild." class="section level2" number="8.1">
<h2><span class="header-section-number">8.1</span> Regression in the wild.</h2>
<p>Regression is used across many domains for prediction and classification, from fantasy football to making club soccer predictions, or even predicting how far a contestant will go on <em>The Bachelor</em> or <em>The Bachelorette</em>.</p>
<p><img src="images/fantasy1.png" /></p>
<p>Club Soccer Predictions on FiveThirtyEight</p>
<p><img src="images/clubsoccer.png" style="width:70.0%" /></p>
<p>Using data to predict reality TV outcomes.</p>
<p><img src="images/bach1.png" style="width:40.0%" /> <img src="images/bach2.jpeg" style="width:40.0%" /></p>
<p>In politics, we might use regression to build campaign models– predicting which voters are persuadable, which supporters will volunteer at campaign events, which supporters will turn out to vote, etc.</p>
<p><img src="images/polcampaign.png" /></p>
</div>
<div id="application-baseball-predictions" class="section level2" number="8.2">
<h2><span class="header-section-number">8.2</span> Application: Baseball Predictions</h2>
<p>For our first example, we will stay outside of politics and use regression to predict the success of a baseball team.</p>
<p><a href="https://www.youtube.com/watch?v=-4QPVo0UIzc">Moneyball</a> is a $100 million Hollywood movie that is all about linear regression… and some baseball… and Brad Pitt, but really… it’s MOSTLY about linear regression</p>
<p><img src="images/moneyball.jpeg" /></p>
<p>The movie describes the Oakland A’s shift to start using data to build their team. They make two observations 1) To win baseball games, you need runs. 2) To score runs, you need to get on base. We can estimate what on base percentage we would need as a team to score enough runs to make the playoffs in a typical season.</p>
<p>We will use regression to make these predictions.</p>
<p><em>For a video explainer of the code for this application, see below. (Via youtube, you can speed up the playback to 1.5 or 2x speed.)</em></p>
<div class="vembedr">
<div>
<iframe src="https://www.youtube.com/embed/wtn-W8Uv32E" width="533" height="300" frameborder="0" allowfullscreen=""></iframe>
</div>
</div>
<p>We use <code>baseball.csv</code> data</p>
<ul>
<li><code>RS</code>: runs scored;</li>
<li><code>RA</code>: runs allowed;</li>
<li><code>W</code>: wins;</li>
<li><code>Playoffs</code>: whether team made playoffs;</li>
<li><code>OBP</code>: on base percentage;</li>
<li><code>BA</code>: batting average;</li>
<li><code>SLG</code>: Slugging Percentage</li>
</ul>
<div class="sourceCode" id="cb342"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb342-1"><a href="#cb342-1" aria-hidden="true" tabindex="-1"></a>baseball <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;baseball.csv&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb343"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb343-1"><a href="#cb343-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(baseball)</span></code></pre></div>
<pre><code>##   Team League Year  RS  RA  W   OBP   SLG    BA Playoffs RankSeason
## 1  ARI     NL 2012 734 688 81 0.328 0.418 0.259        0         NA
## 2  ATL     NL 2012 700 600 94 0.320 0.389 0.247        1          4
## 3  BAL     AL 2012 712 705 93 0.311 0.417 0.247        1          5
## 4  BOS     AL 2012 734 806 69 0.315 0.415 0.260        0         NA
## 5  CHC     NL 2012 613 759 61 0.302 0.378 0.240        0         NA
## 6  CHW     AL 2012 748 676 85 0.318 0.422 0.255        0         NA
##   RankPlayoffs   G  OOBP  OSLG
## 1           NA 162 0.317 0.415
## 2            5 162 0.306 0.378
## 3            4 162 0.315 0.403
## 4           NA 162 0.331 0.428
## 5           NA 162 0.335 0.424
## 6           NA 162 0.319 0.405</code></pre>
<p>Below we can see the first observation made: Runs scored are highly correlated with team wins
<img src="datasciforpolisci_files/figure-html/unnamed-chunk-205-1.svg" width="672" /></p>
<p>What the A’s noticed is that a team’s On Base Percentage is also highly correlated with runs scored. This aligns with conventional wisdom. Players get a lot of hype when they achieve a high OBP.</p>
<p><img src="images/kih.png" /></p>
<p>Hernandez is hitting .500 (16-for-32) with five homers, four doubles, nine RBI, nine runs scored and a .514 on-base percentage in seven postseason games.- NBC Boston</p>
<p>This correlation shows up in our data, too.</p>
<p><img src="datasciforpolisci_files/figure-html/unnamed-chunk-206-1.svg" width="672" /></p>
</div>
<div id="step-1-approach--regression-in-r" class="section level2" number="8.3">
<h2><span class="header-section-number">8.3</span> Step 1: Approach- Regression in R</h2>
<p>A regression draws a “best fit line” between the points. This allows us – for any given OBP – to estimate the number of runs scored.</p>
<ul>
<li>Our best prediction of the number of runs scored would be the spot on the purple line directly above a given OBP.</li>
</ul>
<p><img src="datasciforpolisci_files/figure-html/unnamed-chunk-207-1.svg" width="672" /></p>
<p>The regression model is <span class="math inline">\(Y = \alpha + \beta X + \epsilon\)</span>. Let’s demystify this.</p>
<ul>
<li>A regression model describes the relationship between one or more independent variables <span class="math inline">\(X\)</span> (explanatory variables) and an outcome variable <span class="math inline">\(Y\)</span> (dependent variable)
<ul>
<li>For example, the relationship between our independent variable, On Base Percentage, and our dependent variable, Runs Scored</li>
</ul></li>
<li>We want to know what happens with our dependent variable <span class="math inline">\(Y\)</span> if our independent variable <span class="math inline">\(X\)</span> increases.
<ul>
<li>As we increase our On Base Percentage, a regression model will help us estimate how much we should expect our Runs Scored to increase (or decrease)</li>
</ul></li>
<li><span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span> are considered “parameters” – things we don’t know but want to estimate. These two numbers will define exactly how we think <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> are related.</li>
<li>No two variables are perfectly related, so we also have the <span class="math inline">\(\epsilon\)</span> term, which describes the error in the model</li>
</ul>
<p>When we have data, we estimate <span class="math inline">\(Y\)</span>, <span class="math inline">\(\alpha\)</span>, and <span class="math inline">\(\beta\)</span>: <span class="math inline">\(\hat Y = \hat \alpha + \hat \beta X\)</span>.</p>
<ul>
<li>The <span class="math inline">\({\hat{hat}}\)</span> over the letters means those are our estimated values.</li>
</ul>
<p>In R, the regression syntax is <code>fit &lt;- lm(y ~ x, data = mydata)</code></p>
<ul>
<li><code>fit</code> is just whatever you want to call the output of the model,</li>
<li><code>y</code> is the name of the dependent variable,</li>
<li><code>x</code> is the name of the independent variable, and</li>
<li><code>mydata</code> is whatever you have called your dataframe. E.g.:</li>
</ul>
<div class="sourceCode" id="cb345"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb345-1"><a href="#cb345-1" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(RS <span class="sc">~</span> OBP, <span class="at">data =</span> baseball)</span></code></pre></div>
<p>When we have data, we estimate <span class="math inline">\(Y\)</span>, <span class="math inline">\(\alpha\)</span>, and <span class="math inline">\(\beta\)</span>: <span class="math inline">\(\hat Y = \hat \alpha + \hat \beta X\)</span>.</p>
<ul>
<li>Our model gives us the “coefficient” estimates for <span class="math inline">\(\hat \alpha\)</span> and <span class="math inline">\(\hat \beta\)</span>.</li>
</ul>
<div class="sourceCode" id="cb346"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb346-1"><a href="#cb346-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(fit)</span></code></pre></div>
<pre><code>## (Intercept)         OBP 
##   -1076.602    5490.386</code></pre>
<p>The first coefficient is <span class="math inline">\(\hat \alpha\)</span>, this represents the intercept – the estimated value our dependent variable will take if our independent variable is 0.</p>
<ul>
<li>The value the estimated runs scored would be if a team had a 0.000 on base percentage. In our case, this value is estimated to be negative, which is impossible (but it would also be unusual for a team to have a 0.000 on base percentage). Therefore, the intercept isn’t inherently substantively interesting to us.</li>
</ul>
<p>The second coefficient is <span class="math inline">\(\hat \beta\)</span> is the slope This represents the expected change in our dependent variable for a 1-unit increase in our independent variable.</p>
<ul>
<li>For example, if we go from a 0.000 on base percentage to a 1.000 on base percentage, we would expect a 5490.4 increase in runs scored.</li>
<li>Note: slope can be positive or negative similar to correlation.</li>
<li>Note: slope is in the units of the dependent variable (e.g., runs). It is not constrained to be between -1 and 1.</li>
<li>It is telling us that the greater the OBP, the better!</li>
</ul>
<div id="visualizing-a-regression" class="section level3" number="8.3.1">
<h3><span class="header-section-number">8.3.1</span> Visualizing a regression</h3>
<p>We can plot the regression using a scatterplot and <code>abline()</code>.</p>
<div class="sourceCode" id="cb348"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb348-1"><a href="#cb348-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x=</span>baseball<span class="sc">$</span>OBP, <span class="at">y=</span>baseball<span class="sc">$</span>RS, </span>
<span id="cb348-2"><a href="#cb348-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">&quot;Runs Scored&quot;</span>,</span>
<span id="cb348-3"><a href="#cb348-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span>  <span class="st">&quot;On Base Percentage&quot;</span>, </span>
<span id="cb348-4"><a href="#cb348-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="st">&quot;Runs Scored by On Base Percentage&quot;</span>,</span>
<span id="cb348-5"><a href="#cb348-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">pch=</span><span class="dv">20</span>)</span>
<span id="cb348-6"><a href="#cb348-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb348-7"><a href="#cb348-7" aria-hidden="true" tabindex="-1"></a><span class="do">## Add regression line</span></span>
<span id="cb348-8"><a href="#cb348-8" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(fit, <span class="at">lwd=</span><span class="dv">3</span>, <span class="at">col =</span> <span class="st">&quot;purple&quot;</span>) <span class="co"># add line</span></span></code></pre></div>
<p><img src="datasciforpolisci_files/figure-html/unnamed-chunk-210-1.svg" width="672" /></p>
</div>
<div id="making-predictions-with-regression" class="section level3" number="8.3.2">
<h3><span class="header-section-number">8.3.2</span> Making predictions with regression</h3>
<p>A regression model allows us to estimate or “predict” values of our dependent variable for a given value of our independent variable.</p>
<p><img src="datasciforpolisci_files/figure-html/unnamed-chunk-211-1.svg" width="672" /></p>
<p>The red dot represents our estimate (best prediction) of the number of runs scored if a team has an on base percentage of .300. In R, we can calculate this value using <code>predict()</code>.</p>
<ul>
<li>The syntax is <code>predict(fit, data.frame(x = value))</code> where <code>fit</code> is the name of the model, <code>x</code> is the name of the independent variable, and <code>value</code> represents the value for the independent variable for which you want to predict your outcome (e.g., .300).</li>
</ul>
<div class="sourceCode" id="cb349"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb349-1"><a href="#cb349-1" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(fit, <span class="fu">data.frame</span>(<span class="at">OBP=</span>.<span class="dv">300</span>))</span></code></pre></div>
<pre><code>##        1 
## 570.5137</code></pre>
<p>Under the hood, this is just using the regression formula described above. For example, to estimate the number of runs scored for a .300 on base percentage, we take <span class="math inline">\(\hat \alpha + \hat \beta * .300\)</span></p>
<ul>
<li>Note that below we compare the output of the predict function to our output if we manually calculated the estimated value.</li>
</ul>
<div class="sourceCode" id="cb351"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb351-1"><a href="#cb351-1" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(fit, <span class="fu">data.frame</span>(<span class="at">OBP=</span>.<span class="dv">300</span>))</span></code></pre></div>
<pre><code>##        1 
## 570.5137</code></pre>
<div class="sourceCode" id="cb353"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb353-1"><a href="#cb353-1" aria-hidden="true" tabindex="-1"></a><span class="co"># a + b*.300</span></span>
<span id="cb353-2"><a href="#cb353-2" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(fit)[<span class="dv">1</span>] <span class="sc">+</span>  <span class="fu">coef</span>(fit)[<span class="dv">2</span>]<span class="sc">*</span>.<span class="dv">300</span></span></code></pre></div>
<pre><code>## (Intercept) 
##    570.5137</code></pre>
<p>Let’s say a team thought they needed about 900 runs scored to get to the playoffs, and they were pretty sure they could get a team on base percentage of .500. How many runs would they be expected to score with that OBP? Do you think they will make the playoffs?</p>
<details>
<summary>
Try on your own, then expand for the solution.
</summary>
<div class="sourceCode" id="cb355"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb355-1"><a href="#cb355-1" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(fit, <span class="fu">data.frame</span>(<span class="at">OBP=</span>.<span class="dv">500</span>))</span></code></pre></div>
<pre><code>##        1 
## 1668.591</code></pre>
<p>It’s greater than 900, so we should feel good about our chances.</p>
</details>
</div>
</div>
<div id="step-2-checking-accuracy-of-model" class="section level2" number="8.4">
<h2><span class="header-section-number">8.4</span> Step 2: Checking accuracy of model</h2>
<p>Understanding prediction error: Where do <span class="math inline">\(\hat \alpha\)</span> and <span class="math inline">\(\hat \beta\)</span> come from? Recall that a regression tries to draw a “best fit line” between the points of data.</p>
<p>Under the hood of the regression function, we are searching for the values of <span class="math inline">\(\hat \alpha\)</span> and <span class="math inline">\(\hat \beta\)</span> that try to minimize the distance between the individual points and the regression line.</p>
<p><img src="images/residual.png" style="width:80.0%" /></p>
<p>This distance is called the residual: <span class="math inline">\(\hat \epsilon_i = Y_i - \hat Y_i\)</span>.</p>
<ul>
<li>This is our <strong><em>prediction error</em></strong>: How far off our estimate of Y is (<span class="math inline">\(\hat Y_i\)</span>) from the true value of Y (<span class="math inline">\(Y_i\)</span>)</li>
<li>Linear regressions choose <span class="math inline">\(\hat \alpha\)</span> and <span class="math inline">\(\hat \beta\)</span> to minimize the “squared distance” of this error (think of this as the magnitude of the distance). This is why we tend to call this type of linear regression ordinary least squares (OLS regression).</li>
</ul>
<p>If instead we chose the red line in the image below to be the regression line, you can see that the typical prediction error would be much larger. That’s why we end up with the purple line.</p>
<p><img src="images/bestfit.png" style="width:80.0%" /></p>
<div id="root-mean-squared-error" class="section level3" number="8.4.1">
<h3><span class="header-section-number">8.4.1</span> Root Mean Squared Error</h3>
<p>Just like we had root mean squared error in our poll predictions, we can calculate this for our regression.</p>
<ul>
<li>Just like with the polls, this is the square root of the mean of our squared prediction errors, or “residuals” in the case of regression
<ul>
<li>R will give us this output automatically for a regression using <code>sigma()</code></li>
</ul></li>
</ul>
<div class="sourceCode" id="cb357"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb357-1"><a href="#cb357-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sigma</span>(fit)</span></code></pre></div>
<pre><code>## [1] 39.82189</code></pre>
<ul>
<li>In our case, using on based percentage to predict runs scored, our estimates are off typically, by about 40 runs scored.</li>
<li>On the graph, this means that the typical distance between a black point and the purple line is about 40.</li>
</ul>
</div>
</div>
<div id="step-3-iterate-and-compare-models" class="section level2" number="8.5">
<h2><span class="header-section-number">8.5</span> Step 3: Iterate and Compare Models</h2>
<p>When building predictive models, often researchers want to minimize this Root-Mean Squared Error – minimizing the magnitude of the typical prediction error (the distance between the actual value of our outcome, and the true value)</p>
<p>Example: Let’s compare the RMSE from two different models:</p>
<div class="sourceCode" id="cb359"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb359-1"><a href="#cb359-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Predicting Runs Scored with OBP</span></span>
<span id="cb359-2"><a href="#cb359-2" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(RS <span class="sc">~</span> OBP, <span class="at">data =</span> baseball)</span>
<span id="cb359-3"><a href="#cb359-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sigma</span>(fit)</span></code></pre></div>
<pre><code>## [1] 39.82189</code></pre>
<div class="sourceCode" id="cb361"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb361-1"><a href="#cb361-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Predicting Runs Scored with Batting Average</span></span>
<span id="cb361-2"><a href="#cb361-2" aria-hidden="true" tabindex="-1"></a>fit2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(RS <span class="sc">~</span> BA, <span class="at">data =</span> baseball)</span>
<span id="cb361-3"><a href="#cb361-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sigma</span>(fit2)</span></code></pre></div>
<pre><code>## [1] 51.48172</code></pre>
<p>The Oakland A’s noticed that OBP was a more precise predictor than BA, and RMSE gives us one way to assess this.</p>
<div id="regression-with-multiple-predictors" class="section level3" number="8.5.1">
<h3><span class="header-section-number">8.5.1</span> Regression with Multiple Predictors</h3>
<p>You can also add more than 1 predictor to a regression using the <code>+</code> sign.</p>
<div class="sourceCode" id="cb363"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb363-1"><a href="#cb363-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Predicting Runs Scored with OBP and Slugging Percentage</span></span>
<span id="cb363-2"><a href="#cb363-2" aria-hidden="true" tabindex="-1"></a>fit3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(RS <span class="sc">~</span> OBP <span class="sc">+</span> SLG, <span class="at">data =</span> baseball)</span>
<span id="cb363-3"><a href="#cb363-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sigma</span>(fit3)</span></code></pre></div>
<pre><code>## [1] 25.12196</code></pre>
<p>Look how the RMSE dropped again, improving our prediction.</p>
</div>
</div>
<div id="application-predicting-campaign-donations" class="section level2" number="8.6">
<h2><span class="header-section-number">8.6</span> Application: Predicting Campaign Donations</h2>
<p>Can we predict campaign donations?</p>
<p><img src="images/moneymoney.jpeg" /></p>
<p>Data from Barber, Michael J., Brandice Canes‐Wrone, and Sharece Thrower. “Ideologically sophisticated donors: Which candidates do individual contributors finance?.” American Journal of Political Science 61.2 (2017): 271-288</p>
<div class="sourceCode" id="cb365"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb365-1"><a href="#cb365-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">&quot;donationdata.RData&quot;</span>)</span></code></pre></div>
<p>Variables</p>
<ul>
<li><code>donation</code>: 1=made donation to senator, 0=no donation made</li>
<li><code>total_donation</code>: Dollar amount of donation made by donor to Senator</li>
<li><code>sameparty</code>: 1=self-identifies as being in the candidate’s party; 0 otherwise</li>
<li><code>NetWorth</code>: Donor’s net worth. 1=less than 250k, 2=250-500k; 3=500k-1m; 4=1-2.5m; 5=2.5-5m; 6=5-10m; 7=more than 10m</li>
<li><code>IncomeLastYear</code>: Donor’s household annual income in 2013. 1=less than 50k; 2=50-100k; 3=100-125k; 4=125-150k; 5=150-250k; 6=250-300k; 7=300-350k; 8=350-400k; 9=400-500k; 10=more than 500k</li>
<li><code>peragsen</code>: percent issue agreement between donor and senator</li>
<li><code>per2agchal</code>: percent issue agreement between donor and the senator’s challenger</li>
<li><code>cook</code>: Cook competitiveness score for the senator’s race. 1 = Solid Dem or Solid Rep; 2 = Likely</li>
<li><code>matchcommf</code>: 1=Senator committee matches donor’s profession as reported in FEC file; 0=otherwise</li>
<li><code>Edsum</code>: Donor’s self-described educational attainment. 1=less than high school; 2=high school; 3=some college; 4=2-year college degree; 5=4-year college degree; 6=graduate degree</li>
</ul>
<p>Data represent information on past donors to campaigns across different states. The key dependent variable that we want to predict is <code>total_donation</code>: the total dollar amount a particular person in the data gave to their senator in the 2012 election campaign.</p>
<p>Can we predict how much someone donates to a U.S. Senate campaign?</p>
<ol style="list-style-type: decimal">
<li>Choose approach: regression of donations on donor characteristics</li>
<li>Check accuracy: calculate root-mean-squared error</li>
<li>Iterate: try different regression model specifications</li>
</ol>
<p>Let’s try a prediction based on a person’s income.</p>
<div class="sourceCode" id="cb366"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb366-1"><a href="#cb366-1" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(total_donation <span class="sc">~</span> IncomeLastYear, <span class="at">data =</span> donationdata)</span></code></pre></div>
<p>From this, we can</p>
<ul>
<li>Plot the relationship</li>
<li>Make specific predictions at different levels of income</li>
<li>Check accuracy by calculating the prediction errors and RMSE</li>
</ul>
<div id="visualizing-the-results-1" class="section level3" number="8.6.1">
<h3><span class="header-section-number">8.6.1</span> Visualizing the results</h3>
<p>Note that the correlation is a bit weaker here.</p>
<div class="sourceCode" id="cb367"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb367-1"><a href="#cb367-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x=</span>donationdata<span class="sc">$</span>IncomeLastYear, </span>
<span id="cb367-2"><a href="#cb367-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">y=</span>donationdata<span class="sc">$</span>total_donation,</span>
<span id="cb367-3"><a href="#cb367-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab=</span> <span class="st">&quot;Total Donation ($)&quot;</span>,</span>
<span id="cb367-4"><a href="#cb367-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&quot;Income Last Year&quot;</span>,</span>
<span id="cb367-5"><a href="#cb367-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">&quot;Predicting Total Donations Using Income&quot;</span>)</span>
<span id="cb367-6"><a href="#cb367-6" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(fit, <span class="at">col=</span><span class="st">&quot;green4&quot;</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span></code></pre></div>
<p><img src="datasciforpolisci_files/figure-html/unnamed-chunk-221-1.svg" width="672" /></p>
</div>
<div id="step-1-calculate-predictions" class="section level3" number="8.6.2">
<h3><span class="header-section-number">8.6.2</span> Step 1: Calculate Predictions</h3>
<p>We can calculate predictions based on a level of income. Example: Level 5 of income represents an income of $150k-250k. What level of donation would we expect?</p>
<div class="sourceCode" id="cb368"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb368-1"><a href="#cb368-1" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(fit, <span class="fu">data.frame</span>(<span class="at">IncomeLastYear =</span> <span class="dv">5</span>))</span></code></pre></div>
<pre><code>##        1 
## 348.8581</code></pre>
<div class="sourceCode" id="cb370"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb370-1"><a href="#cb370-1" aria-hidden="true" tabindex="-1"></a><span class="do">## alternative using coef()</span></span>
<span id="cb370-2"><a href="#cb370-2" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(fit)[<span class="dv">1</span>] <span class="sc">+</span> <span class="fu">coef</span>(fit)[<span class="st">&quot;IncomeLastYear&quot;</span>]<span class="sc">*</span><span class="dv">5</span></span></code></pre></div>
<pre><code>## (Intercept) 
##    348.8581</code></pre>
</div>
<div id="step-2-check-accuracy" class="section level3" number="8.6.3">
<h3><span class="header-section-number">8.6.3</span> Step 2: Check Accuracy</h3>
<p>We can calculate the Root Mean Squared Error</p>
<div class="sourceCode" id="cb372"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb372-1"><a href="#cb372-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sigma</span>(fit)</span></code></pre></div>
<pre><code>## [1] 915.2528</code></pre>
</div>
<div id="step-3-iterate" class="section level3" number="8.6.4">
<h3><span class="header-section-number">8.6.4</span> Step 3: Iterate</h3>
<p>YOUR TURN: Change the model and see if it improves the prediction using RMSE using <code>sigma</code>.</p>
</div>
<div id="adding-model-predictors" class="section level3" number="8.6.5">
<h3><span class="header-section-number">8.6.5</span> Adding Model Predictors</h3>
<p>New Model Example</p>
<div class="sourceCode" id="cb374"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb374-1"><a href="#cb374-1" aria-hidden="true" tabindex="-1"></a>fitnew <span class="ot">&lt;-</span> <span class="fu">lm</span>(total_donation <span class="sc">~</span> IncomeLastYear <span class="sc">+</span> NetWorth <span class="sc">+</span> sameparty, </span>
<span id="cb374-2"><a href="#cb374-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">data=</span>donationdata)</span></code></pre></div>
<p>New Predictions: note how we add more variables</p>
<div class="sourceCode" id="cb375"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb375-1"><a href="#cb375-1" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(fitnew, <span class="fu">data.frame</span>(<span class="at">IncomeLastYear =</span> <span class="dv">5</span>, <span class="at">NetWorth =</span> <span class="dv">4</span>, <span class="at">sameparty =</span> <span class="dv">1</span>))</span></code></pre></div>
<pre><code>##        1 
## 406.9705</code></pre>
<div class="sourceCode" id="cb377"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb377-1"><a href="#cb377-1" aria-hidden="true" tabindex="-1"></a><span class="do">## alternative using coef()</span></span>
<span id="cb377-2"><a href="#cb377-2" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(fitnew)[<span class="dv">1</span>] <span class="sc">+</span> <span class="fu">coef</span>(fitnew)[<span class="st">&quot;IncomeLastYear&quot;</span>]<span class="sc">*</span><span class="dv">5</span> <span class="sc">+</span> </span>
<span id="cb377-3"><a href="#cb377-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coef</span>(fitnew)[<span class="st">&quot;NetWorth&quot;</span>]<span class="sc">*</span><span class="dv">4</span> <span class="sc">+</span> <span class="fu">coef</span>(fitnew)[<span class="st">&quot;sameparty&quot;</span>]<span class="sc">*</span><span class="dv">1</span></span></code></pre></div>
<pre><code>## (Intercept) 
##    406.9705</code></pre>
<p>Root Mean Squared Error</p>
<div class="sourceCode" id="cb379"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb379-1"><a href="#cb379-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sigma</span>(fitnew)</span></code></pre></div>
<pre><code>## [1] 910.4256</code></pre>
<p>When we have multiple predictors, this changes our interpretation of the coefficients slightly.</p>
<ul>
<li>We now interpret the slope as the change in the outcome expected with a 1-unit change in the independent variable– holding all other variables constant (or ``controlling” for all other variables)</li>
<li>For example, for a 1-unit change in Income, we would expect about a $68 increase in estimated donations, holding constant Net Worth and whether the person shared partisanship with the senator.</li>
</ul>
<div class="sourceCode" id="cb381"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb381-1"><a href="#cb381-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(fitnew)</span></code></pre></div>
<pre><code>##    (Intercept) IncomeLastYear       NetWorth      sameparty 
##     -242.02780       67.96825       29.55847      190.92323</code></pre>
<p>Think of this like a set of light switches. How does adjusting one light switch affect the light in the room– holding constant all other switches.</p>
<p><img src="images/lightswitch.jpeg" style="width:60.0%" /></p>
<p>When we make predictions with multiple variables, we have to tell R where we want to set each variable’s value.</p>
<div class="sourceCode" id="cb383"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb383-1"><a href="#cb383-1" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(fitnew, <span class="fu">data.frame</span>(<span class="at">IncomeLastYear =</span> <span class="dv">5</span>, <span class="at">NetWorth =</span> <span class="dv">4</span>, <span class="at">sameparty =</span> <span class="dv">1</span>))</span></code></pre></div>
<pre><code>##        1 
## 406.9705</code></pre>
<p>See how the prediction changes if you shift <code>IncomeLastYear</code> but keep Net Worth and partisanship where they are. That’s the idea of “controlling” for the other variables!</p>
<p>How could we keep improving the predictions?</p>
<p>Eventually, we would want to apply this prediction model in a real-world setting.</p>
<ul>
<li>How could campaigns use these types of prediction models?</li>
</ul>
</div>
</div>
<div id="uncertainty-with-prediction" class="section level2" number="8.7">
<h2><span class="header-section-number">8.7</span> Uncertainty with Prediction</h2>
<p>Regression (and other prediction algorithms) give us our best guess</p>
<ul>
<li>But any guess has some uncertainty, prediction error, and potential outliers</li>
<li>Sometimes these errors can be systematic</li>
<li>Even when we use more advanced statistical models</li>
<li>A “best guess” is often better than a random guess– but shouldn’t necessarily be treated as “ground truth.”</li>
</ul>
<p>Prediction helps us guess unknowns with observed data, but MUST PROCEED WITH CAUTION</p>
<div id="example-butterfly-ballot-in-florida" class="section level3" number="8.7.1">
<h3><span class="header-section-number">8.7.1</span> Example: Butterfly Ballot in Florida</h3>
<p>In the U.S. 2000 presidential election, the race came down to Florida, which was extremely close. As part of the contest, different counties in Florida came under a microscope. One result that seemed unusual was the amount of votes Buchanan received in certain areas, which seemed to be a result of an odd ballot design choice. In this exercise, we examine voting patterns in Florida during the 2000 election.</p>
<p>For more on the 2000 race, you can watch this <a href="https://www.youtube.com/watch?v=D-nR_hmS6V0&amp;ab_channel=HISTORY">video</a>.</p>
<p>Load the data and explore the variables</p>
<ul>
<li><code>county</code>: county name</li>
<li><code>Clinton96</code>: Clinton’s votes in 1996</li>
<li><code>Dole96</code>: Dole’s votes in 1996</li>
<li><code>Perot96</code>: Perot’s votes in 1996</li>
<li><code>Bush00</code>: Bush’s votes in 2000</li>
<li><code>Gore00</code>: Gore’s votes in 2000</li>
<li><code>Buchanan00</code>: Buchanan’s votes in 2000</li>
</ul>
<div class="sourceCode" id="cb385"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb385-1"><a href="#cb385-1" aria-hidden="true" tabindex="-1"></a>florida <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;florida.csv&quot;</span>)</span></code></pre></div>
<p>Chapter 4 in QSS also discusses this example.</p>
<p>Using what you learned from the last section, try to complete the following steps:</p>
<ul>
<li>Regress Buchanan 2000 votes (your Y) on Perot 1996 (your X) votes</li>
<li>Create a scatterplot of the two variables and add the regression line</li>
<li>Find and interpret the slope coefficient for the relationship between Perot and Buchanan votes</li>
<li>Calculate the root-mean-squared error for the regression and interpret this</li>
</ul>
<details>
<summary>
Try on your own, then expand for the solution.
</summary>
<p>For every 1 additional vote Perot received in 1996, we expect Buchanan to receive .036 additional votes in 2000.</p>
<div class="sourceCode" id="cb386"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb386-1"><a href="#cb386-1" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(Buchanan00 <span class="sc">~</span> Perot96, <span class="at">data =</span> florida)</span>
<span id="cb386-2"><a href="#cb386-2" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(fit)</span></code></pre></div>
<pre><code>## (Intercept)     Perot96 
##  1.34575212  0.03591504</code></pre>
<p>In 1996, Perot received 8 million votes as a third-party candidate. Buchanan received less than 1/2 a million. Overall Perot received more votes, but where Perot received votes in 1996 was positively correlated with where Buchanan received votes in 2000.</p>
<div class="sourceCode" id="cb388"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb388-1"><a href="#cb388-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x=</span>florida<span class="sc">$</span>Perot96,</span>
<span id="cb388-2"><a href="#cb388-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">y=</span>florida<span class="sc">$</span>Buchanan00,</span>
<span id="cb388-3"><a href="#cb388-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab=</span><span class="st">&quot;Buchanan Votes 2000&quot;</span>,</span>
<span id="cb388-4"><a href="#cb388-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">&quot;Perot Votes 1996&quot;</span>,  </span>
<span id="cb388-5"><a href="#cb388-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">pch=</span><span class="dv">20</span>)</span>
<span id="cb388-6"><a href="#cb388-6" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(fit, <span class="at">lwd=</span><span class="dv">3</span>, <span class="at">col=</span><span class="st">&quot;purple&quot;</span>)</span></code></pre></div>
<p><img src="datasciforpolisci_files/figure-html/unnamed-chunk-232-1.svg" width="672" /></p>
<div class="sourceCode" id="cb389"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb389-1"><a href="#cb389-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sigma</span>(fit)</span></code></pre></div>
<pre><code>## [1] 316.3765</code></pre>
<p>A typical prediction error is about 316.4 votes above or below the Buchanan total.</p>
</details>
</div>
<div id="multiple-predictors" class="section level3" number="8.7.2">
<h3><span class="header-section-number">8.7.2</span> Multiple Predictors</h3>
<p>Can we reduce the error by adding more variables?</p>
<div class="sourceCode" id="cb391"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb391-1"><a href="#cb391-1" aria-hidden="true" tabindex="-1"></a>fitnew <span class="ot">&lt;-</span> <span class="fu">lm</span>(Buchanan00 <span class="sc">~</span> Perot96 <span class="sc">+</span> Dole96 <span class="sc">+</span> Clinton96, <span class="at">data =</span> florida)</span>
<span id="cb391-2"><a href="#cb391-2" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(fitnew)</span></code></pre></div>
<pre><code>##  (Intercept)      Perot96       Dole96    Clinton96 
## 20.572650070  0.030663207 -0.001559196  0.001865809</code></pre>
<p>Again, when we have multiple predictors, this changes our interpretation of the coefficients slightly.</p>
<ul>
<li>We now interpret the slope as the change in the outcome expected with a 1-unit change in the independent variable– holding all other variables constant (or ``controlling” for all other variables)</li>
<li>For example, a 1-unit increase (a 1-vote increase) in the number of Perot voters in 1996 is associated with a 0.03 vote increase in the number of Buchanan votes in 2000, holding constant the number of Clinton and Dole votes a county received.</li>
</ul>
<p>When we make predictions with multiple variables, we have to tell R where we want to set each variable’s value.</p>
<div class="sourceCode" id="cb393"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb393-1"><a href="#cb393-1" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(fitnew, <span class="fu">data.frame</span>(<span class="at">Perot96=</span><span class="dv">20000</span>, <span class="at">Clinton96=</span><span class="dv">300000</span>, <span class="at">Dole96=</span><span class="dv">300000</span>))</span></code></pre></div>
<pre><code>##        1 
## 725.8208</code></pre>
<p>See how the prediction changes if you shift <code>Perot96</code> but keep the other variables where they are. That’s the idea of “controlling” for the other variables!</p>
<p>The addition of the new variables, in this case, made very little difference in the RMSE.</p>
<div class="sourceCode" id="cb395"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb395-1"><a href="#cb395-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sigma</span>(fit)</span></code></pre></div>
<pre><code>## [1] 316.3765</code></pre>
<div class="sourceCode" id="cb397"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb397-1"><a href="#cb397-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sigma</span>(fitnew)</span></code></pre></div>
<pre><code>## [1] 318.3798</code></pre>
<p>Note: the value R generates through <code>sigma</code> is the residual standard error, which penalizes the RMSE for the number of variables included in the model. You could also calculate it without this penalty by manually taking the square root of the mean of the squared residuals.</p>
<p>With little change from the addition of predictors, let’s stick with the more simple model and explore the prediction errors.</p>
<div class="sourceCode" id="cb399"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb399-1"><a href="#cb399-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x=</span><span class="fu">fitted</span>(fit), <span class="co"># predicted outcome</span></span>
<span id="cb399-2"><a href="#cb399-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">y=</span><span class="fu">resid</span>(fit),  <span class="co"># prediction error</span></span>
<span id="cb399-3"><a href="#cb399-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">type=</span><span class="st">&quot;n&quot;</span>, <span class="co"># makes the plot blank</span></span>
<span id="cb399-4"><a href="#cb399-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1500</span>), </span>
<span id="cb399-5"><a href="#cb399-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">750</span>, <span class="dv">2500</span>), </span>
<span id="cb399-6"><a href="#cb399-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&quot;Predicted Buchanan Votes&quot;</span>, </span>
<span id="cb399-7"><a href="#cb399-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">&quot;Prediction Error&quot;</span>)</span>
<span id="cb399-8"><a href="#cb399-8" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">0</span>) <span class="co"># adds horizontal line</span></span>
<span id="cb399-9"><a href="#cb399-9" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="at">x=</span><span class="fu">fitted</span>(fit), <span class="at">y=</span><span class="fu">resid</span>(fit), <span class="at">labels =</span> florida<span class="sc">$</span>county, <span class="at">cex=</span>.<span class="dv">8</span>)</span></code></pre></div>
<p><img src="datasciforpolisci_files/figure-html/unnamed-chunk-237-1.svg" width="672" /></p>
<p>How does the prediction error change if we remove Palm Beach County?</p>
<div class="sourceCode" id="cb400"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb400-1"><a href="#cb400-1" aria-hidden="true" tabindex="-1"></a>florida.pb <span class="ot">&lt;-</span> <span class="fu">subset</span>(florida, <span class="at">subset =</span> (county <span class="sc">!=</span> <span class="st">&quot;PalmBeach&quot;</span>))</span>
<span id="cb400-2"><a href="#cb400-2" aria-hidden="true" tabindex="-1"></a>fit2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(Buchanan00 <span class="sc">~</span> Perot96, <span class="at">data =</span> florida.pb)</span>
<span id="cb400-3"><a href="#cb400-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sigma</span>(fit2)</span></code></pre></div>
<pre><code>## [1] 87.74994</code></pre>
<p>My, oh my, our RMSE also goes way down if we remove Palm Beach. Something unique seems to be happening in that county. See this <a href="http://sekhon.berkeley.edu/papers/butterfly.pdf">academic paper</a> for an elaboration of the evidence that “The Butterfly [ballot] Did it.”</p>
</div>
<div id="confidence-intervals" class="section level3" number="8.7.3">
<h3><span class="header-section-number">8.7.3</span> Confidence Intervals</h3>
<p>Social scientists like to characterize the uncertainty in their predictions using what is called a “confidence interval.”</p>
<ul>
<li>Confidence intervals show a range of values that are likely to contain the true value</li>
</ul>
<div class="sourceCode" id="cb402"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb402-1"><a href="#cb402-1" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(fit, <span class="fu">data.frame</span>(<span class="at">Perot96 =</span> <span class="dv">13600</span>), <span class="at">interval =</span> <span class="st">&quot;confidence&quot;</span>)</span></code></pre></div>
<pre><code>##        fit      lwr      upr
## 1 489.7903 394.8363 584.7443</code></pre>
<p>By default, R supplies the 95% confidence interval.</p>
<ul>
<li>For example, our estimate is for a county with 13,600 votes for Perot in 1996, the expected Buchanan vote is 489.79 votes.
<ul>
<li>The confidence interval is 394.84 to 584.74 votes, which means we believe there is a 95% chance that this interval contains the true value of the Buchanan 2000 vote share.</li>
</ul></li>
<li>Instead of thinking about our prediction as just 489.79, we should think about the entire interval as having a good chance of including the true value.</li>
</ul>
<p>Similarly, our coefficients also have uncertainty.</p>
<div class="sourceCode" id="cb404"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb404-1"><a href="#cb404-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(fit)</span></code></pre></div>
<pre><code>## (Intercept)     Perot96 
##  1.34575212  0.03591504</code></pre>
<div class="sourceCode" id="cb406"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb406-1"><a href="#cb406-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(fit)</span></code></pre></div>
<pre><code>##                    2.5 %       97.5 %
## (Intercept) -98.03044506 100.72194929
## Perot96       0.02724733   0.04458275</code></pre>
<p>For every 1 vote increase in the Perot 1996 vote, we expect a <span class="math inline">\(\hat \beta =.036\)</span> increase in Buchanan votes. However, the confidence interval is 0.027 to 0.045.</p>
<ul>
<li>We think there is a 95% chance that this interval 0.027 to 0.045 includes the true <span class="math inline">\(\beta\)</span>, describing the rate of change in Buchanan votes for a given change in Perot 1996 votes</li>
</ul>
</div>
</div>
<div id="cross-validation" class="section level2" number="8.8">
<h2><span class="header-section-number">8.8</span> Cross-Validation</h2>
<p>So far, we’ve been “cheating.” We’ve been analyzing a prediction in cases where we know the right answer. Now we will focus more squarely on how to develop an “out-of-sample” prediction.</p>
<p>Problem: Models that fit our existing (“in-sample”) data might not be the best for predicting out-of-sample data.</p>
<p>Example: Compare regression line with vs. without Palm Beach included in the sample.</p>
<ul>
<li>Outliers “in-sample” can lead to overfitting to weird, idiosyncratic data points</li>
</ul>
<p><img src="images/overfit.png" /></p>
<p>Example: Error Rates in Speech Recognition. See study <a href="https://news.stanford.edu/2020/03/23/automated-speech-recognition-less-accurate-blacks/">here</a></p>
<ul>
<li>Predictions/Classification that works well for one group might not work well for all groups</li>
</ul>
<p><img src="images/speecherrors.png" /></p>
<p>Problem: Models that fit our existing (“in-sample”) data might not be the best for predicting out-of-sample data. Approaches to diagnose the problem or help address it:</p>
<ul>
<li>Detect potential outliers within existing data by exploring the prediction errors</li>
<li>Make sure the training (in-sample) data is as representative as possible</li>
<li>Incorporate out-of-sample testing in prediction process</li>
</ul>
<div id="cross-validation-process" class="section level3" number="8.8.1">
<h3><span class="header-section-number">8.8.1</span> Cross-Validation Process</h3>
<p>Cross-validation incorporates the idea of out-of-sample testing into the process of how we evaluate the accuracy of prediction and classification approaches.</p>
<p>Cross-validation (train vs. test data)</p>
<ol style="list-style-type: decimal">
<li>Subset your data into two portions: Training and Test data.</li>
<li>Run a model based on the training data.</li>
<li>Make a prediction and test the accuracy on the test data.</li>
<li>Repeat process training and testing on different portions of the data.</li>
<li>Summarize the results and choose a preferred model
<ul>
<li>Eventually: Apply this model to entirely new data</li>
</ul></li>
</ol>
<p>Goal: Test accuracy in a way that can help detect overfitting. See how well our model will generalize to new data (data the model hasn’t seen).</p>
</div>
<div id="application-forecasting-election-results" class="section level3" number="8.8.2">
<h3><span class="header-section-number">8.8.2</span> Application: Forecasting Election Results</h3>
<p>Macro political and economic fundamentals are sometimes used for early forecasting of an election. We will build a version of this model and test its accuracy using a process of “Leave-one-out” cross-validation.</p>
<p>Below is a video explainer of this application, which uses cross-validation.</p>
<div class="vembedr">
<div>
<iframe src="https://www.youtube.com/embed/Wqj9Jm8heAA" width="533" height="300" frameborder="0" allowfullscreen=""></iframe>
</div>
</div>
<p>The data and model are based on the <a href="Based%20on%20the%20FAIR%20model%20for%20forecasting%20elections%20\url%7Bhttps://fairmodel.econ.yale.edu/vote2016/computev.htm%7D">FAIR model</a> of forecasting.</p>
<div class="sourceCode" id="cb408"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb408-1"><a href="#cb408-1" aria-hidden="true" tabindex="-1"></a>fair <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;fair.csv&quot;</span>)</span></code></pre></div>
<p>Key Variables:</p>
<ul>
<li><code>VP</code>: Democratic share of the two-party presidential vote</li>
<li><code>t</code>: Year (presidential years only)</li>
<li><code>G</code>: growth rate of real per capita GDP in the first 3 quarters</li>
<li><code>P</code>: growth rate of the GDP deflator in the first 15 quarters of the recent administration</li>
<li><code>Z</code>: number of quarters in the first 15 quarters of recent administration in which the growth rate of real per capita GDP is greater than 3.2 percent at an annual rate</li>
<li><code>I</code>: 1 if Democrats in WH and -1 if Republicans in WH</li>
<li><code>WAR</code>: 1 if 1920, 1944, 1948 (denoting the ``WAR” elections, which are believed to be particular)</li>
<li><code>DUR</code>: indicating how many consecutive terms Democrats/Republicans have been office (e.g., in 2020 it will be 0 because Republicans will have been in office for only 1 term.)</li>
</ul>
<p>Let’s propose a model</p>
<div class="sourceCode" id="cb409"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb409-1"><a href="#cb409-1" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(VP <span class="sc">~</span> DUR, <span class="at">data =</span> fair)</span></code></pre></div>
<p>Let’s propose an alternative model and see which one we think is better.</p>
<div class="sourceCode" id="cb410"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb410-1"><a href="#cb410-1" aria-hidden="true" tabindex="-1"></a>fit2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(VP <span class="sc">~</span> G<span class="sc">*</span>I <span class="sc">+</span>  DUR, <span class="at">data =</span> fair)</span></code></pre></div>
<p>Note: The asterisk represents an “interaction.” See QSS Chapter 4. We use this when we think the effect of one variable (growth) may depend on the values of another variable (the party of who is in office).</p>
<div id="steps-1-and-2" class="section level4" number="8.8.2.1">
<h4><span class="header-section-number">8.8.2.1</span> Steps 1 and 2</h4>
<p>We are going to run a model where each time we `leave out’ one row of data (in our case, one election). Let’s try this once:</p>
<div class="sourceCode" id="cb411"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb411-1"><a href="#cb411-1" aria-hidden="true" tabindex="-1"></a>years <span class="ot">&lt;-</span> fair<span class="sc">$</span>t</span>
<span id="cb411-2"><a href="#cb411-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb411-3"><a href="#cb411-3" aria-hidden="true" tabindex="-1"></a><span class="do">## Step 1: Subset data into two portions</span></span>
<span id="cb411-4"><a href="#cb411-4" aria-hidden="true" tabindex="-1"></a>traindata <span class="ot">&lt;-</span> <span class="fu">subset</span>(fair, t <span class="sc">!=</span> years[<span class="dv">1</span>])</span>
<span id="cb411-5"><a href="#cb411-5" aria-hidden="true" tabindex="-1"></a>testdata <span class="ot">&lt;-</span> <span class="fu">subset</span>(fair, t <span class="sc">==</span> years[<span class="dv">1</span>])</span>
<span id="cb411-6"><a href="#cb411-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb411-7"><a href="#cb411-7" aria-hidden="true" tabindex="-1"></a><span class="do">## Step 2: Run model on training data</span></span>
<span id="cb411-8"><a href="#cb411-8" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(VP <span class="sc">~</span> DUR, <span class="at">data =</span> traindata)</span>
<span id="cb411-9"><a href="#cb411-9" aria-hidden="true" tabindex="-1"></a>fit2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(VP <span class="sc">~</span>  G<span class="sc">*</span>I <span class="sc">+</span>  DUR, <span class="at">data =</span> traindata)</span></code></pre></div>
</div>
<div id="step-3-predict-and-assess-accuracy-with-test-data" class="section level4" number="8.8.2.2">
<h4><span class="header-section-number">8.8.2.2</span> Step 3: Predict and assess accuracy with test data</h4>
<p>Out-of-Sample prediction</p>
<div class="sourceCode" id="cb412"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb412-1"><a href="#cb412-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Step 3: Make a Prediction using test data and</span></span>
<span id="cb412-2"><a href="#cb412-2" aria-hidden="true" tabindex="-1"></a>yhat.fit <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit, testdata)</span>
<span id="cb412-3"><a href="#cb412-3" aria-hidden="true" tabindex="-1"></a>yhat.fit2 <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit2, testdata)</span></code></pre></div>
<p>Prediction error (Truth - Prediction)</p>
<div class="sourceCode" id="cb413"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb413-1"><a href="#cb413-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Step 3: Test accuracy of prediction</span></span>
<span id="cb413-2"><a href="#cb413-2" aria-hidden="true" tabindex="-1"></a>error.fit <span class="ot">&lt;-</span> testdata<span class="sc">$</span>VP <span class="sc">-</span> yhat.fit</span>
<span id="cb413-3"><a href="#cb413-3" aria-hidden="true" tabindex="-1"></a>error.fit2 <span class="ot">&lt;-</span> testdata<span class="sc">$</span>VP <span class="sc">-</span> yhat.fit2</span></code></pre></div>
</div>
<div id="step-4-repeat-process-across-all-data" class="section level4" number="8.8.2.3">
<h4><span class="header-section-number">8.8.2.3</span> Step 4: Repeat process across all data</h4>
<p>Step 4: Let’s do this for each row, storing the prediction errors.</p>
<div class="sourceCode" id="cb414"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb414-1"><a href="#cb414-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Iteration vector</span></span>
<span id="cb414-2"><a href="#cb414-2" aria-hidden="true" tabindex="-1"></a>years <span class="ot">&lt;-</span> fair<span class="sc">$</span>t</span>
<span id="cb414-3"><a href="#cb414-3" aria-hidden="true" tabindex="-1"></a><span class="do">## Empty container vectors</span></span>
<span id="cb414-4"><a href="#cb414-4" aria-hidden="true" tabindex="-1"></a>errors.fit <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="fu">length</span>(years))</span>
<span id="cb414-5"><a href="#cb414-5" aria-hidden="true" tabindex="-1"></a>errors.fit2 <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="fu">length</span>(years))</span>
<span id="cb414-6"><a href="#cb414-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb414-7"><a href="#cb414-7" aria-hidden="true" tabindex="-1"></a><span class="do">## Loop (copy paste meat from  above)</span></span>
<span id="cb414-8"><a href="#cb414-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span>  <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(years)){</span>
<span id="cb414-9"><a href="#cb414-9" aria-hidden="true" tabindex="-1"></a>  traindata <span class="ot">&lt;-</span> <span class="fu">subset</span>(fair, t <span class="sc">!=</span> years[i])</span>
<span id="cb414-10"><a href="#cb414-10" aria-hidden="true" tabindex="-1"></a>  testdata <span class="ot">&lt;-</span> <span class="fu">subset</span>(fair, t <span class="sc">==</span> years[i])</span>
<span id="cb414-11"><a href="#cb414-11" aria-hidden="true" tabindex="-1"></a>  fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(VP <span class="sc">~</span>  DUR, <span class="at">data =</span> traindata)</span>
<span id="cb414-12"><a href="#cb414-12" aria-hidden="true" tabindex="-1"></a>  fit2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(VP <span class="sc">~</span> G<span class="sc">*</span>I <span class="sc">+</span>  DUR , <span class="at">data =</span> traindata)</span>
<span id="cb414-13"><a href="#cb414-13" aria-hidden="true" tabindex="-1"></a>  yhat.fit <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit, testdata)</span>
<span id="cb414-14"><a href="#cb414-14" aria-hidden="true" tabindex="-1"></a>  yhat.fit2 <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit2, testdata)</span>
<span id="cb414-15"><a href="#cb414-15" aria-hidden="true" tabindex="-1"></a>  errors.fit[i] <span class="ot">&lt;-</span> testdata<span class="sc">$</span>VP <span class="sc">-</span> yhat.fit</span>
<span id="cb414-16"><a href="#cb414-16" aria-hidden="true" tabindex="-1"></a>  errors.fit2[i] <span class="ot">&lt;-</span> testdata<span class="sc">$</span>VP <span class="sc">-</span> yhat.fit2</span>
<span id="cb414-17"><a href="#cb414-17" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="step-5-summarize-performance" class="section level4" number="8.8.2.4">
<h4><span class="header-section-number">8.8.2.4</span> Step 5: Summarize performance</h4>
<p>Step 5: Summarize the model performance</p>
<div class="sourceCode" id="cb415"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb415-1"><a href="#cb415-1" aria-hidden="true" tabindex="-1"></a><span class="do">## RMSE</span></span>
<span id="cb415-2"><a href="#cb415-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sqrt</span>(<span class="fu">mean</span>((errors.fit)<span class="sc">^</span><span class="dv">2</span>))</span></code></pre></div>
<pre><code>## [1] 7.170149</code></pre>
<div class="sourceCode" id="cb417"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb417-1"><a href="#cb417-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sqrt</span>(<span class="fu">mean</span>((errors.fit2)<span class="sc">^</span><span class="dv">2</span>))</span></code></pre></div>
<pre><code>## [1] 3.793135</code></pre>
<div class="sourceCode" id="cb419"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb419-1"><a href="#cb419-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Mean Absolute Error</span></span>
<span id="cb419-2"><a href="#cb419-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(<span class="fu">abs</span>(errors.fit))</span></code></pre></div>
<pre><code>## [1] 5.937542</code></pre>
<div class="sourceCode" id="cb421"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb421-1"><a href="#cb421-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(<span class="fu">abs</span>(errors.fit2))</span></code></pre></div>
<pre><code>## [1] 3.363163</code></pre>
<p>Which model tends to have less error?</p>
</div>
<div id="applying-model-to-new-data" class="section level4" number="8.8.2.5">
<h4><span class="header-section-number">8.8.2.5</span> Applying Model to New Data</h4>
<p>Eventually, you might further test the model on data that has been “held out”– data that neither your train/test has seen. How good was our model? We can do this for the 2016 election, which was not in the data.</p>
<p>Truth: 2016 VP was 51.1 Democratic “two-party” vote share.</p>
<div class="sourceCode" id="cb423"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb423-1"><a href="#cb423-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Let&#39;s use the winner of our two models</span></span>
<span id="cb423-2"><a href="#cb423-2" aria-hidden="true" tabindex="-1"></a>fit2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(VP <span class="sc">~</span> G<span class="sc">*</span>I <span class="sc">+</span>  DUR, <span class="at">data =</span> fair)</span>
<span id="cb423-3"><a href="#cb423-3" aria-hidden="true" tabindex="-1"></a><span class="fl">51.1</span><span class="sc">-</span><span class="fu">predict</span>(fit2, <span class="fu">data.frame</span>(<span class="at">G=</span><span class="fl">0.97</span>, <span class="at">I=</span><span class="dv">1</span>, <span class="at">DUR=</span><span class="dv">1</span>))</span></code></pre></div>
<pre><code>##        1 
## 2.472147</code></pre>
<p>2016 values based on the FAIR <a href="https://fairmodel.econ.yale.edu/vote2016/index2.htm">site</a></p>
</div>
<div id="challenge" class="section level4" number="8.8.2.6">
<h4><span class="header-section-number">8.8.2.6</span> Challenge</h4>
<p>Can you build a better model? What would your prediction for 2020 be?</p>
<ul>
<li>-5.07: growth rate of real per capita GDP in the first 3 quarters of 2020 (annual rate) (G)</li>
<li>1.80: growth rate of the GDP deflator in the first 15 quarters of the Trump administration, (annual rate) (P)</li>
<li>3: number of quarters in the first 15 quarters of the Trump administration in which the growth rate of real per capita GDP is greater than 3.2 percent at an annual rate (Z)</li>
<li>DUR=0</li>
<li>I = -1</li>
</ul>
<p>Values based on the FAIR <a href="https://fairmodel.econ.yale.edu/vote2020/computev.htm">site</a></p>
<!--chapter:end:08-Regression.Rmd-->
</div>
</div>
</div>
</div>
<div id="fairness" class="section level1" number="9">
<h1><span class="header-section-number">9</span> Fairness and Ethics</h1>
<p>In this section, we dicuss some issues with fairness in prediction/classification, as well as broader ethical issues confronting the intersection of data science and social science.</p>
<p><strong><em>Fairness in Machine Learning</em></strong></p>
<p>Machine learning comes with a bundle of potential ethical issues. Hold on– we are doing machine learning? Yes, in our prediction/classification sections, we have done a type of it.</p>
<ul>
<li>We have used a statistical model (in this case, regression) to learn and make inferences about patterns in data.
<ul>
<li>A regression can be considered a type of algorithm</li>
</ul></li>
<li>We then apply the model to new data to make predictions and classify new data into categories.</li>
<li>The models we have used are a type of “supervised machine learning” because our outcomes are pre-defined (vote share for Biden, a person donates vs. does not donate)
<ul>
<li>Other types of machine learning may be fully ``unsupervised,” such as searching data to come up with outputs, such as topics in books of text</li>
</ul></li>
</ul>
<div id="application-criminal-justice" class="section level2" number="9.1">
<h2><span class="header-section-number">9.1</span> Application: Criminal Justice</h2>
<p>This application is based on Dressel, Julia, and Hany Farid. “<a href="https://www.science.org/doi/10.1126/sciadv.aao5580">The accuracy, fairness, and limits of predicting recidivism</a>.” Science advances 4.1 (2018): eaao5580.</p>
<p>Prediction and classification models are used all of the time in public policy, including in the criminal justice system: “where crimes will most likely occur, who is most likely to commit a violent crime, who is likely to fail to appear at their court hearing, and who is likely to reoffend at some point in the future” (Dressel and Farid)</p>
<p>Dressel and Farid develop and examine models that predict whether someone will recidivate– based on a measure of rearrest. They compare their own models to COMPAS (a well-known proprietary algorithm that generates risk scores) and to human-based predictions</p>
<p>We will develop a model similar to the one Dressel and Farid use in their paper, which seems to closely approximate COMPAS predictions.</p>
<p>Note: These algorithms have generated a lot of debate, concern and controversy, which we will discuss.</p>
<div id="load-data" class="section level3" number="9.1.1">
<h3><span class="header-section-number">9.1.1</span> Load data</h3>
<p>Below is a video explainer of this application, which uses classification and cross-validation.</p>
<div class="vembedr">
<div>
<iframe src="https://www.youtube.com/embed/vpNnUR0V1hA" width="533" height="300" frameborder="0" allowfullscreen=""></iframe>
</div>
</div>
<p>Data include information about 7214 arrests in Broward County Florida in 2013-2014</p>
<div class="sourceCode" id="cb425"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb425-1"><a href="#cb425-1" aria-hidden="true" tabindex="-1"></a>broward <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;browardsub.csv&quot;</span>)</span></code></pre></div>
<p>Variables</p>
<ul>
<li><code>sex</code>: 0 male; 1: female</li>
<li><code>age</code></li>
<li><code>juv_fel_count</code>: total number of juvenile felony criminal charges</li>
<li><code>juv_ misd_count</code>: total number of juvenile misdemeanor criminal charges</li>
<li><code>priors_count</code>: total number of non-juvenile criminal charges</li>
<li><code>charge_degree</code>: a numeric indicator of the degree of the charge: 0: misdemeanor; 1: felony</li>
<li><code>two_year_recid</code>: a numeric indicator of whether the defendant recidivated two years after previous charge: 0: no, did not recidivate; 1: yes, did recidivate</li>
</ul>
</div>
<div id="predictionclassification-process" class="section level3" number="9.1.2">
<h3><span class="header-section-number">9.1.2</span> Prediction/Classification process</h3>
<p>Recall the steps for prediction/classification</p>
<ol style="list-style-type: decimal">
<li>Choose Approach
<ul>
<li>We will use a regression to try to classify subjects as those who will / will not recidivate</li>
</ul></li>
<li>Check accuracy
<ul>
<li>We will calculate false positive rates and false negative rates</li>
<li>We will use cross-validation to do so</li>
</ul></li>
<li>Iterate</li>
</ol>
</div>
<div id="step-1-regression-model" class="section level3" number="9.1.3">
<h3><span class="header-section-number">9.1.3</span> Step 1: Regression Model</h3>
<p>Step 1: Choose Approach</p>
<div class="sourceCode" id="cb426"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb426-1"><a href="#cb426-1" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(two_year_recid <span class="sc">~</span> age <span class="sc">+</span> sex <span class="sc">+</span> juv_misd_count <span class="sc">+</span> juv_fel_count <span class="sc">+</span> </span>
<span id="cb426-2"><a href="#cb426-2" aria-hidden="true" tabindex="-1"></a>            priors_count <span class="sc">+</span> charge_degree, </span>
<span id="cb426-3"><a href="#cb426-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">data =</span> broward)</span></code></pre></div>
<p>Note: our outcome is binary</p>
<div class="sourceCode" id="cb427"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb427-1"><a href="#cb427-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(broward<span class="sc">$</span>two_year_recid)</span></code></pre></div>
<pre><code>## 
##    0    1 
## 3963 3251</code></pre>
<p>When you use linear regression with a binary outcome, it is called a linear probability model. We estimate the probability of recidivism– a number between 0 and 1.</p>
<ul>
<li>There are downsides to using linear regression with this type of outcome. Data scientists may often use a different model called logistic regression for this.</li>
</ul>
<p>Make Prediction.</p>
<div class="sourceCode" id="cb429"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb429-1"><a href="#cb429-1" aria-hidden="true" tabindex="-1"></a><span class="do">## estimates a predicted probability of recidivism for each subject</span></span>
<span id="cb429-2"><a href="#cb429-2" aria-hidden="true" tabindex="-1"></a>broward<span class="sc">$</span>predictedrec <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit)</span>
<span id="cb429-3"><a href="#cb429-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb429-4"><a href="#cb429-4" aria-hidden="true" tabindex="-1"></a><span class="do">## Range of predicted probabilities</span></span>
<span id="cb429-5"><a href="#cb429-5" aria-hidden="true" tabindex="-1"></a><span class="fu">range</span>(broward<span class="sc">$</span>predictedrec)</span></code></pre></div>
<pre><code>## [1] -0.1463835  1.6059606</code></pre>
<p>Note: One downside of linear models is they can generate probabilities below 0 or above 1. Logistic regression will constrain these due to a transformation it makes when estimating the coefficients.</p>
<div id="detour-logistic-regression" class="section level4" number="9.1.3.1">
<h4><span class="header-section-number">9.1.3.1</span> Detour: Logistic Regression</h4>
<p>As an alternative, you could use logistic regression, which data scientists may often use when trying to do a classification task– predicting which category a subject belongs to (e.g., recidivate vs. not recidivate; turned out to vote vs. did not turn out to vote). We won’t focus on logistic regression in this class, but you can know it is out there for future study.</p>
<p>Step 1: Choose Approach- Let’s try logistic regression instead</p>
<details>
<summary>
For details, expand.
</summary>
<div class="sourceCode" id="cb431"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb431-1"><a href="#cb431-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Logistic regression</span></span>
<span id="cb431-2"><a href="#cb431-2" aria-hidden="true" tabindex="-1"></a>fitl <span class="ot">&lt;-</span> <span class="fu">glm</span>(two_year_recid <span class="sc">~</span> age <span class="sc">+</span> sex <span class="sc">+</span> juv_misd_count <span class="sc">+</span> juv_fel_count <span class="sc">+</span> </span>
<span id="cb431-3"><a href="#cb431-3" aria-hidden="true" tabindex="-1"></a>            priors_count <span class="sc">+</span> charge_degree, </span>
<span id="cb431-4"><a href="#cb431-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">data =</span> broward, </span>
<span id="cb431-5"><a href="#cb431-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">family=</span><span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">&quot;logit&quot;</span>))</span>
<span id="cb431-6"><a href="#cb431-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb431-7"><a href="#cb431-7" aria-hidden="true" tabindex="-1"></a><span class="do">## estimates a predicted probability of recidivism for each subject</span></span>
<span id="cb431-8"><a href="#cb431-8" aria-hidden="true" tabindex="-1"></a>broward<span class="sc">$</span>predictedrecl <span class="ot">&lt;-</span> <span class="fu">predict</span>(fitl, <span class="at">type=</span><span class="st">&quot;response&quot;</span>) <span class="co"># need type=&quot;response&quot; to make them probabilities</span></span>
<span id="cb431-9"><a href="#cb431-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb431-10"><a href="#cb431-10" aria-hidden="true" tabindex="-1"></a><span class="do">## Range of predicted probabilities of recidivism</span></span>
<span id="cb431-11"><a href="#cb431-11" aria-hidden="true" tabindex="-1"></a><span class="fu">range</span>(broward<span class="sc">$</span>predictedrecl)</span></code></pre></div>
<pre><code>## [1] 0.04176846 0.99891808</code></pre>
<p>Logistic regression keeps probabilities between 0 and 1 due to a transformation it applies to our standard regression formula. As a result, our coefficient units (<code>coef(fitl)</code>) are in log-odds units, which are hard to interpret. We can transform our predictions of the model into probabilities using the <code>predict()</code> function with <code>type = "response"</code>.</p>
</details>
<p>We can compare the predictions of the probability of recidivism between the linear and logistic regression models. Note how the linear model blows past 0 and 1, while the logistic-based predictions can keep them within those bounds.</p>
<p><img src="datasciforpolisci_files/figure-html/unnamed-chunk-259-1.svg" width="672" /></p>
<p>We don’t have time to go into the math of logistic regression in this course, but know that it is a desirable option for classification.</p>
<p>For now, let’s stick with the linear model.</p>
</div>
<div id="change-prediction-into-a-classification" class="section level4" number="9.1.3.2">
<h4><span class="header-section-number">9.1.3.2</span> Change Prediction into a Classification</h4>
<p>Recall: we are trying to <strong>classify</strong></p>
<ul>
<li>We need to make our estimates of the probability of recidivism categorical, into simply a prediction of recidivate vs. not recidivate</li>
</ul>
<p>For now, we will use .5 as a threshold (a probability of more than .5)</p>
<div class="sourceCode" id="cb433"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb433-1"><a href="#cb433-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Need to make prediction binary.</span></span>
<span id="cb433-2"><a href="#cb433-2" aria-hidden="true" tabindex="-1"></a><span class="co"># We use .5, but there are other methods for choosing this threshold</span></span>
<span id="cb433-3"><a href="#cb433-3" aria-hidden="true" tabindex="-1"></a>broward<span class="sc">$</span>predictedrecclass <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(broward<span class="sc">$</span>predictedrec <span class="sc">&gt;</span> .<span class="dv">5</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span></code></pre></div>
<p>Predicted Recidivism</p>
<div class="sourceCode" id="cb434"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb434-1"><a href="#cb434-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(<span class="at">predicted=</span>broward<span class="sc">$</span>predictedrecclass)</span></code></pre></div>
<pre><code>## predicted
##    0    1 
## 4683 2531</code></pre>
</div>
</div>
<div id="step-2-check-accuracy-1" class="section level3" number="9.1.4">
<h3><span class="header-section-number">9.1.4</span> Step 2: Check Accuracy</h3>
<p>We are going to get extra practice with cross-validation as a way to check accuracy. Recall:</p>
<p>Cross-validation (train vs. test data)</p>
<ol style="list-style-type: decimal">
<li>Subset your data into two portions: Training and Test data.</li>
<li>Run a model based on the training data.</li>
<li>Make a prediction and test the accuracy on the test data.</li>
<li>Repeat process training and testing on different portions of the data.</li>
<li>Summarize the results and choose a preferred model
<ul>
<li>Eventually: Apply this model to entirely new data</li>
</ul></li>
</ol>
<p>Goal: Test accuracy in a way that can help detect overfitting. See how well our model will generalize to new data (data the model hasn’t seen).</p>
<p>We will use leave-one-out cross-validation again, but there are other methods, such as splitting data into “folds” of multiple observations at once (i.e., leaving out 100 or 1000 observations for testing instead of just 1).</p>
<div class="sourceCode" id="cb436"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb436-1"><a href="#cb436-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Step 1: Subset Data</span></span>
<span id="cb436-2"><a href="#cb436-2" aria-hidden="true" tabindex="-1"></a>traindata <span class="ot">&lt;-</span> broward[<span class="sc">-</span><span class="dv">1</span>,] <span class="co"># all but first row</span></span>
<span id="cb436-3"><a href="#cb436-3" aria-hidden="true" tabindex="-1"></a>testdata <span class="ot">&lt;-</span> broward[<span class="dv">1</span>,] <span class="co"># just the first row</span></span>
<span id="cb436-4"><a href="#cb436-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb436-5"><a href="#cb436-5" aria-hidden="true" tabindex="-1"></a><span class="do">## Step 2: Run model on training data</span></span>
<span id="cb436-6"><a href="#cb436-6" aria-hidden="true" tabindex="-1"></a>fittrain <span class="ot">&lt;-</span> <span class="fu">lm</span>(two_year_recid <span class="sc">~</span> age <span class="sc">+</span> sex <span class="sc">+</span> juv_misd_count </span>
<span id="cb436-7"><a href="#cb436-7" aria-hidden="true" tabindex="-1"></a>               <span class="sc">+</span> juv_fel_count <span class="sc">+</span> </span>
<span id="cb436-8"><a href="#cb436-8" aria-hidden="true" tabindex="-1"></a>            priors_count <span class="sc">+</span> charge_degree, </span>
<span id="cb436-9"><a href="#cb436-9" aria-hidden="true" tabindex="-1"></a>          <span class="at">data =</span> traindata)</span>
<span id="cb436-10"><a href="#cb436-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb436-11"><a href="#cb436-11" aria-hidden="true" tabindex="-1"></a><span class="do">## Step 3: Predict with test data</span></span>
<span id="cb436-12"><a href="#cb436-12" aria-hidden="true" tabindex="-1"></a>predictedrec <span class="ot">&lt;-</span> <span class="fu">predict</span>(fittrain, testdata)</span>
<span id="cb436-13"><a href="#cb436-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb436-14"><a href="#cb436-14" aria-hidden="true" tabindex="-1"></a><span class="do">## Step 3: Change predicted probability into a classification</span></span>
<span id="cb436-15"><a href="#cb436-15" aria-hidden="true" tabindex="-1"></a>cvpredictions <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(predictedrec <span class="sc">&gt;</span> .<span class="dv">5</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span></code></pre></div>
<p>Step 4: Repeat across all observations and summarize accuracy.</p>
<p>We want to repeat this process for every row of our data– leaving out a different row each time. To construct our loop, we embed the above process in the loop syntax.</p>
<div class="sourceCode" id="cb437"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb437-1"><a href="#cb437-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Iteration vector</span></span>
<span id="cb437-2"><a href="#cb437-2" aria-hidden="true" tabindex="-1"></a><span class="do">## 1:nrow(broward)</span></span>
<span id="cb437-3"><a href="#cb437-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb437-4"><a href="#cb437-4" aria-hidden="true" tabindex="-1"></a><span class="do">## Container vector</span></span>
<span id="cb437-5"><a href="#cb437-5" aria-hidden="true" tabindex="-1"></a>broward<span class="sc">$</span>cvpredictions <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb437-6"><a href="#cb437-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb437-7"><a href="#cb437-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(broward)){</span>
<span id="cb437-8"><a href="#cb437-8" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Step 1: Subset Data</span></span>
<span id="cb437-9"><a href="#cb437-9" aria-hidden="true" tabindex="-1"></a>  traindata <span class="ot">&lt;-</span> broward[<span class="sc">-</span>i,] <span class="co"># all but ith row</span></span>
<span id="cb437-10"><a href="#cb437-10" aria-hidden="true" tabindex="-1"></a>  testdata <span class="ot">&lt;-</span> broward[i,] <span class="co"># just the ith row</span></span>
<span id="cb437-11"><a href="#cb437-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb437-12"><a href="#cb437-12" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Step 2: Run model on training data</span></span>
<span id="cb437-13"><a href="#cb437-13" aria-hidden="true" tabindex="-1"></a>  fittrain <span class="ot">&lt;-</span> <span class="fu">lm</span>(two_year_recid <span class="sc">~</span> age <span class="sc">+</span> sex <span class="sc">+</span> juv_misd_count </span>
<span id="cb437-14"><a href="#cb437-14" aria-hidden="true" tabindex="-1"></a>                 <span class="sc">+</span> juv_fel_count <span class="sc">+</span> </span>
<span id="cb437-15"><a href="#cb437-15" aria-hidden="true" tabindex="-1"></a>            priors_count <span class="sc">+</span> charge_degree, </span>
<span id="cb437-16"><a href="#cb437-16" aria-hidden="true" tabindex="-1"></a>          <span class="at">data =</span> traindata)</span>
<span id="cb437-17"><a href="#cb437-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb437-18"><a href="#cb437-18" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Step 3: Predict with test data</span></span>
<span id="cb437-19"><a href="#cb437-19" aria-hidden="true" tabindex="-1"></a>  predictedrec <span class="ot">&lt;-</span> <span class="fu">predict</span>(fittrain, testdata)</span>
<span id="cb437-20"><a href="#cb437-20" aria-hidden="true" tabindex="-1"></a>  broward<span class="sc">$</span>cvpredictions[i] <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(predictedrec <span class="sc">&gt;</span> .<span class="dv">5</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb437-21"><a href="#cb437-21" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div id="confusion-matrix" class="section level4" number="9.1.4.1">
<h4><span class="header-section-number">9.1.4.1</span> Confusion Matrix</h4>
<p>Check Accuracy: Confusion Matrix</p>
<div class="sourceCode" id="cb438"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb438-1"><a href="#cb438-1" aria-hidden="true" tabindex="-1"></a>confmatrix <span class="ot">&lt;-</span> <span class="fu">table</span>(<span class="at">actual =</span> broward<span class="sc">$</span>two_year_recid, </span>
<span id="cb438-2"><a href="#cb438-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">predicted =</span> broward<span class="sc">$</span>cvpredictions)</span>
<span id="cb438-3"><a href="#cb438-3" aria-hidden="true" tabindex="-1"></a>confmatrix</span></code></pre></div>
<pre><code>##       predicted
## actual    0    1
##      0 3156  807
##      1 1528 1723</code></pre>
<p>How should we interpret each cell?</p>
<ul>
<li>Let’s Consider 1 = Recidivate = Positive outcome; 0 = Not Recidivate = Negative Outcome</li>
<li>What is a false positive? false negative? true positive? true negative?</li>
</ul>
</div>
<div id="false-positive-rate" class="section level4" number="9.1.4.2">
<h4><span class="header-section-number">9.1.4.2</span> False Positive Rate</h4>
<p>False Positive Rate: <span class="math inline">\(\frac{\text{False Positive}}{\text{(False Positive + True Negative)}}\)</span></p>
<ul>
<li>Out of those who do not recidivate, how often did we predict recidivate?</li>
</ul>
<div class="sourceCode" id="cb440"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb440-1"><a href="#cb440-1" aria-hidden="true" tabindex="-1"></a><span class="do">## One Approach</span></span>
<span id="cb440-2"><a href="#cb440-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(broward<span class="sc">$</span>cvpredictions <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> broward<span class="sc">$</span>two_year_recid <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">/</span> </span>
<span id="cb440-3"><a href="#cb440-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sum</span>(broward<span class="sc">$</span>two_year_recid <span class="sc">==</span> <span class="dv">0</span>)</span></code></pre></div>
<pre><code>## [1] 0.2036336</code></pre>
<div class="sourceCode" id="cb442"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb442-1"><a href="#cb442-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Alternative Approach</span></span>
<span id="cb442-2"><a href="#cb442-2" aria-hidden="true" tabindex="-1"></a><span class="do">## predicted recidivism, actual not</span></span>
<span id="cb442-3"><a href="#cb442-3" aria-hidden="true" tabindex="-1"></a>fp <span class="ot">&lt;-</span> confmatrix[<span class="dv">1</span>, <span class="dv">2</span>]</span>
<span id="cb442-4"><a href="#cb442-4" aria-hidden="true" tabindex="-1"></a><span class="co"># predicted not, actual not</span></span>
<span id="cb442-5"><a href="#cb442-5" aria-hidden="true" tabindex="-1"></a>tn <span class="ot">&lt;-</span> confmatrix[<span class="dv">1</span>, <span class="dv">1</span>]</span>
<span id="cb442-6"><a href="#cb442-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb442-7"><a href="#cb442-7" aria-hidden="true" tabindex="-1"></a><span class="do">## False Positive Rate</span></span>
<span id="cb442-8"><a href="#cb442-8" aria-hidden="true" tabindex="-1"></a>fp <span class="sc">/</span> (fp <span class="sc">+</span> tn)</span></code></pre></div>
<pre><code>## [1] 0.2036336</code></pre>
</div>
<div id="false-negative-rate" class="section level4" number="9.1.4.3">
<h4><span class="header-section-number">9.1.4.3</span> False Negative Rate</h4>
<p>False Negative Rate: <span class="math inline">\(\frac{\text{False Negative}}{\text{(False Negative + True Positive)}}\)</span></p>
<ul>
<li>Out of those who did recidivate, how often did we predict not recidivate?</li>
</ul>
<div class="sourceCode" id="cb444"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb444-1"><a href="#cb444-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Out of those who recidivate, how often does it predict not recidivate?</span></span>
<span id="cb444-2"><a href="#cb444-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(broward<span class="sc">$</span>cvpredictions<span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> broward<span class="sc">$</span>two_year_recid <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">/</span> </span>
<span id="cb444-3"><a href="#cb444-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sum</span>(broward<span class="sc">$</span>two_year_recid <span class="sc">==</span> <span class="dv">1</span>)</span></code></pre></div>
<pre><code>## [1] 0.4700092</code></pre>
<div class="sourceCode" id="cb446"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb446-1"><a href="#cb446-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Alternative Approach</span></span>
<span id="cb446-2"><a href="#cb446-2" aria-hidden="true" tabindex="-1"></a><span class="do">##  predicted to not recidivate, actual yes</span></span>
<span id="cb446-3"><a href="#cb446-3" aria-hidden="true" tabindex="-1"></a>fn <span class="ot">&lt;-</span> confmatrix[<span class="dv">2</span>, <span class="dv">1</span>]</span>
<span id="cb446-4"><a href="#cb446-4" aria-hidden="true" tabindex="-1"></a>tp <span class="ot">&lt;-</span> confmatrix[<span class="dv">2</span>, <span class="dv">2</span>]</span>
<span id="cb446-5"><a href="#cb446-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb446-6"><a href="#cb446-6" aria-hidden="true" tabindex="-1"></a><span class="do">## False Negative Rate</span></span>
<span id="cb446-7"><a href="#cb446-7" aria-hidden="true" tabindex="-1"></a>fn <span class="sc">/</span> (fn <span class="sc">+</span> tp)</span></code></pre></div>
<pre><code>## [1] 0.4700092</code></pre>
</div>
</div>
</div>
<div id="taking-fairness-seriously" class="section level2" number="9.2">
<h2><span class="header-section-number">9.2</span> Taking Fairness Seriously</h2>
<p>Recall the steps for prediction/classification</p>
<ol style="list-style-type: decimal">
<li>Choose Approach
<ul>
<li>We will use a regression to try to classify subjects as those who will / will not recidivate</li>
</ul></li>
<li>Check accuracy
<ul>
<li>We will calculate false positive rates and false negative rates</li>
<li>We will use cross-validation to do so</li>
<li><strong><em>What about fairness?</em></strong></li>
</ul></li>
<li>Iterate</li>
</ol>
<p>The performance of a prediction/classification may be different for different groups in the population. Dressel and Farid point to this when it comes to different racial groups.</p>
<div class="figure">
<img src="images/fair1.png" alt="" />
<p class="caption"><em>Dressel and Farid</em></p>
</div>
<p>Let’s see how our predictions perform across racial groups</p>
<p><code>race</code>: 1: White (Caucasian); 2: Black (African American); 3: Hispanic; 4: Asian; 5: Native American; 6: Other</p>
<p>Wait a second– we didn’t use race in our model. Why could the performance still differ across racial groups?</p>
<ul>
<li>Think about how the inputs in our regression model could be correlated with race.</li>
<li>Think about how existing human biases and inequalities that lead to differential arrest rates by racial groups could be reproduced in our model.</li>
<li>Even if a model does not have the intent to include race, its impact may nonetheless vary according to race. This could be true for any number of characteristics depending on the application.</li>
</ul>
<p>We will subset our data by race.</p>
<div class="sourceCode" id="cb448"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb448-1"><a href="#cb448-1" aria-hidden="true" tabindex="-1"></a>black <span class="ot">&lt;-</span> <span class="fu">subset</span>(broward, race <span class="sc">==</span> <span class="dv">2</span>)</span>
<span id="cb448-2"><a href="#cb448-2" aria-hidden="true" tabindex="-1"></a>white <span class="ot">&lt;-</span> <span class="fu">subset</span>(broward, race <span class="sc">==</span> <span class="dv">1</span>)</span></code></pre></div>
<p>We can first check overall accuracy</p>
<div class="sourceCode" id="cb449"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb449-1"><a href="#cb449-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(black<span class="sc">$</span>cvpredictions <span class="sc">==</span> black<span class="sc">$</span>two_year_recid)</span></code></pre></div>
<pre><code>## [1] 0.6696429</code></pre>
<div class="sourceCode" id="cb451"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb451-1"><a href="#cb451-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(white<span class="sc">$</span>cvpredictions <span class="sc">==</span> white<span class="sc">$</span>two_year_recid)</span></code></pre></div>
<pre><code>## [1] 0.6805216</code></pre>
<p>But are we making the same types of errors?</p>
<div class="sourceCode" id="cb453"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb453-1"><a href="#cb453-1" aria-hidden="true" tabindex="-1"></a><span class="do">## False positive rate- Black</span></span>
<span id="cb453-2"><a href="#cb453-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Out of those who do not recidivate, how often did we predict recidivate?</span></span>
<span id="cb453-3"><a href="#cb453-3" aria-hidden="true" tabindex="-1"></a>fprate.black <span class="ot">&lt;-</span> <span class="fu">sum</span>(black<span class="sc">$</span>cvpredictions <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> black<span class="sc">$</span>two_year_recid <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">/</span> </span>
<span id="cb453-4"><a href="#cb453-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sum</span>(black<span class="sc">$</span>two_year_recid <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb453-5"><a href="#cb453-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb453-6"><a href="#cb453-6" aria-hidden="true" tabindex="-1"></a><span class="do">## False negative rate- Black</span></span>
<span id="cb453-7"><a href="#cb453-7" aria-hidden="true" tabindex="-1"></a><span class="do">## Out of those who recidivate, how often does it predict not recidivate?</span></span>
<span id="cb453-8"><a href="#cb453-8" aria-hidden="true" tabindex="-1"></a>fnrate.black <span class="ot">&lt;-</span><span class="fu">sum</span>(black<span class="sc">$</span>cvpredictions<span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> black<span class="sc">$</span>two_year_recid <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">/</span> </span>
<span id="cb453-9"><a href="#cb453-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sum</span>(black<span class="sc">$</span>two_year_recid <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb453-10"><a href="#cb453-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb453-11"><a href="#cb453-11" aria-hidden="true" tabindex="-1"></a><span class="do">## False positive rate- white</span></span>
<span id="cb453-12"><a href="#cb453-12" aria-hidden="true" tabindex="-1"></a>fprate.white <span class="ot">&lt;-</span> <span class="fu">sum</span>(white<span class="sc">$</span>cvpredictions <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> white<span class="sc">$</span>two_year_recid <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">/</span> </span>
<span id="cb453-13"><a href="#cb453-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sum</span>(white<span class="sc">$</span>two_year_recid <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb453-14"><a href="#cb453-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb453-15"><a href="#cb453-15" aria-hidden="true" tabindex="-1"></a><span class="do">## False negative rate- white</span></span>
<span id="cb453-16"><a href="#cb453-16" aria-hidden="true" tabindex="-1"></a>fnrate.white <span class="ot">&lt;-</span><span class="fu">sum</span>(white<span class="sc">$</span>cvpredictions<span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> white<span class="sc">$</span>two_year_recid <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">/</span> </span>
<span id="cb453-17"><a href="#cb453-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sum</span>(white<span class="sc">$</span>two_year_recid <span class="sc">==</span> <span class="dv">1</span>)</span></code></pre></div>
<p>Let’s see how our predictions perform across racial groups</p>
<div class="sourceCode" id="cb454"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb454-1"><a href="#cb454-1" aria-hidden="true" tabindex="-1"></a><span class="do">## False positive rates</span></span>
<span id="cb454-2"><a href="#cb454-2" aria-hidden="true" tabindex="-1"></a>fprate.black</span></code></pre></div>
<pre><code>## [1] 0.2846797</code></pre>
<div class="sourceCode" id="cb456"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb456-1"><a href="#cb456-1" aria-hidden="true" tabindex="-1"></a>fprate.white </span></code></pre></div>
<pre><code>## [1] 0.1323925</code></pre>
<div class="sourceCode" id="cb458"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb458-1"><a href="#cb458-1" aria-hidden="true" tabindex="-1"></a><span class="do">## False negative rates</span></span>
<span id="cb458-2"><a href="#cb458-2" aria-hidden="true" tabindex="-1"></a>fnrate.black</span></code></pre></div>
<pre><code>## [1] 0.3734876</code></pre>
<div class="sourceCode" id="cb460"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb460-1"><a href="#cb460-1" aria-hidden="true" tabindex="-1"></a>fnrate.white </span></code></pre></div>
<pre><code>## [1] 0.6076605</code></pre>
<p>We see asymmetries in the types of errors the model is making across racial groups. Black subjects have higher false positives– more likely as being predicted to recidivate (a predicted “positive”) when they do not (the “false” in false positive). White subjects have higher false negatives– predicted not to recidivate (the negative) when they do (the false in false negative).</p>
<p>Based on these results, reflect on the following:</p>
<ul>
<li>Should we use this type of algorithm in public policy?
<ul>
<li>What might be desirable about this process over alternatives?</li>
<li>What are possible concerns?</li>
<li>Does your answer depend on accuracy or other considerations?</li>
</ul></li>
<li>What should we care more about? False positives or false negatives?</li>
<li>What measures of fairness should be considered?</li>
<li>Are there ways to avoid an unfair/biased model?</li>
</ul>
<div id="extended-learning" class="section level3" number="9.2.1">
<h3><span class="header-section-number">9.2.1</span> Extended Learning</h3>
<p>Note: There are many debates about the use of these algorithms</p>
<ul>
<li>Example of Initial Critique from <a href="https://www.propublica.org/article/machine-bias-risk-assessments-in-criminal-sentencing">ProPublica</a></li>
<li>Example of <a href="https://www.uscourts.gov/federal-probation-journal/2016/09/false-positives-false-negatives-and-false-analyses-rejoinder">Rejoinder</a></li>
<li>Discussion of what fairness means: J. Kleinberg, S. Mullainathan, M. Raghavan, <a href="https://arxiv.org/abs/1609.05807v2">Inherent trade-offs in the fair determination of risk scores.</a> (2016).
<ul>
<li>Notes that goals of fairness can be in competition:</li>
<li>Well-calibrated: if the algorithm identifies a set of people as having a probability z of constituting positive instances, then approximately a z fraction of this set should indeed be positive instances</li>
<li>Balance for positive and negative instances across groups: the chance of making a mistake on should not depend on which group they belong to.</li>
</ul></li>
</ul>
<p>For more on fairness and machine learning</p>
<ul>
<li>FAIRNESS AND MACHINE LEARNING: <a href="https://fairmlbook.org/">Limitations and Opportunities by Solon Barocas, Moritz Hardt, Arvind Narayanan</a>.</li>
<li>Vivek Singh’s <a href="http://behavioralinformatics.org/">Research Lab</a></li>
<li>Rutgers <a href="https://sites.rutgers.edu/critical-ai/event-details/">Critical AI group</a></li>
<li>See the “Gender Shades” project from <a href="https://www.youtube.com/watch?v=TWWsW1w-BVo">Joy Buolamwini</a></li>
<li>See Brookings Report on <a href="https://www.brookings.edu/research/algorithmic-bias-detection-and-mitigation-best-practices-and-policies-to-reduce-consumer-harms/">Bias in AI</a></li>
</ul>
<!--chapter:end:09-Fairness.Rmd-->
</div>
</div>
</div>
<div id="uncertainty" class="section level1" number="10">
<h1><span class="header-section-number">10</span> Uncertainty</h1>
<p>In this section, we bring in some statistical concepts of uncertainty in data analysis.</p>
<p>Throughout the course, we have come up with estimates:</p>
<ul>
<li>Are perceived black job applicants less likely to receive call backs for interviews than applicants perceived as white?</li>
<li>Are job applicants with criminal records less likely to receive call backs for interviews than applicants without criminal records?</li>
<li>Are higher levels of education associated with lower levels of tolerance toward domestic violence?
Do wind turbines cause backlash in voting behavior?</li>
</ul>
<p>Each time, we come up with a positive or negative number to summarize the effect. But when should we consider it a reliable effect or big effect? By what criteria? That’s where we are going now.</p>
<div id="hypothesis-testing-overview-of-process" class="section level2" number="10.1">
<h2><span class="header-section-number">10.1</span> Hypothesis Testing Overview of Process</h2>
<p>Process for Hypothesis Testing</p>
<ol style="list-style-type: decimal">
<li>Start with a research question: Are job applicants with criminal records less likely to receive call backs for interviews than applicants without criminal records?</li>
<li>Develop a theory of how the world works
<ul>
<li>E.g., “Job prospects are, in part, a function of someone’s criminal record.”</li>
</ul></li>
<li>Construct “null” and “alternative” hypotheses
<ul>
<li>E.g., <span class="math inline">\(H_o\)</span>: “Applicants with a criminal record will receive call backs at similar rates as those without a criminal record” (I.e., no difference)</li>
<li>E.g., <span class="math inline">\(H_A\)</span>: “Applicants with a criminal record will be less likely to receive call backs than those without a criminal record” or “Applicants with a criminal record will receive call backs at different rates than those without a criminal record” (I.e., some nonzero difference)</li>
</ul></li>
</ol>
<p><strong><em>Example of Implied Framework</em></strong></p>
<p>Health Savings Experiment (Dupas and Robinson 2013): Researchers conducted a field experiment in rural Kenya in which they randomly varied access to four innovative saving technologies and observed the impact on asset accumulation. Participants who were given a box locked with a padlock and key saved about 150 Kenyan Shillings more after 12 months relative to those who were simply encouraged to save money for health. Did the lock box work?</p>
<ul>
<li>What are the implied null and alternative hypotheses?</li>
</ul>
<p>Process for Hypothesis Testing</p>
<ol start="4" style="list-style-type: decimal">
<li>Carry out a test of the hypothesis, such as a difference-in-means.
<ul>
<li>Applicants with a criminal record receive 12.5 percentage points fewer call backs than those without a criminal record</li>
</ul></li>
<li>Calculate the uncertainty around this estimate.</li>
<li>Decide whether you can reject or fail to reject the hypothesis of no difference</li>
</ol>
</div>
<div id="sampling-and-uncertainty" class="section level2" number="10.2">
<h2><span class="header-section-number">10.2</span> Sampling and Uncertainty</h2>
<p>Flip a coin 10 times <a href="https://flipsimu.com/">here</a>. Report how many times it lands on heads.</p>
<ul>
<li>Imagine repeating this process over and over again.</li>
<li>We know that a fair coin should land on heads 50% of the time- 5 out of 10 times or 50 out of 100 times.</li>
<li>However, in any given sample of coin flips, you might get a slightly different result. If you repeated the sample a bunch of times, sometimes you might get 4 heads, 5 heads, 6 heads, 3 heads, etc.</li>
</ul>
<p>This does not mean the coin is unfair. Instead, just due to chance, we ended up with 6 out of 10 heads in a world where the true proportion of times that coin would land on heads is .5.</p>
<p>How much evidence would we need to reject the idea that the coin is unfair? What if we got 90 heads out of 100 coin flips? Would that be enough to make us skeptical of the coin?</p>
<ul>
<li>This is the idea of null hypothesis testing. We gather evidence and make a judgment about whether we can reject a null hypothesis. How likely would it be that by chance we could flip 90 heads in a world where that coin was actually fair?
<ul>
<li>For example, when we find a relationship between two variables (e.g., a correlation, a difference-in-means, a regression coefficient), this could be due to chance in a single sample.</li>
</ul></li>
</ul>
<p>When we conduct an experiment and find that applicants with a criminal record were called back 12.5 percentage points less often than those without a criminal record, we want to know…</p>
<ul>
<li>Is that a real difference, or is the real difference 0, and we just happened to get our 12.5-point difference in our sample due to chance?</li>
</ul>
<p>In statistical hypothesis testing, what we will try to do is quantify how likely it is that we could observe a difference as big as 12.5 in a given sample if, in fact, the real difference is 0. We want to be able to make a judgment about how likely the relationship we observed in a sample of applications/hiring decisions could exist in a world where criminal records really have no impact on job prospects.</p>
<p>We are going to use this example help us break down a few concepts.</p>
<div id="sampling-distribution" class="section level3" number="10.2.1">
<h3><span class="header-section-number">10.2.1</span> Sampling Distribution</h3>
<p>The number of heads you generate over repeated samples is the “sampling distribution.”</p>
<p><img src="datasciforpolisci_files/figure-html/unnamed-chunk-271-1.svg" width="672" /></p>
<p>The higher the curve, the more likely we would observe that number of heads. For example, if you flip a coin 100 times, it is likely you will get close to 50 heads (50%), and very unlikely you will flip more than 80 heads (80% heads).</p>
<ul>
<li>So if you flip a coin and get 55 heads, we might still think the coin is fair, but once you start moving to the tails of this curve . . .</li>
<li>It is highly unlikely we could flip a coin 100 times and get 80 heads just by random chance i.e., if the coin were fair.</li>
<li>The “bell” shape of this distribution isn’t an anomaly. The “Central Limit Theorem” tells us that over repeated samples (so long as your sample is sufficiently large), the distribution of “means” will be normal
<ul>
<li>This is incredibly important because we know a lot about normal distributions, such as that 95% of the sample mean estimates fall within two (technically: 1.96) standard errors of the mean.</li>
<li>Only if we observe a number of heads outside those lines would we think perhaps it is not a fair coin.</li>
</ul></li>
</ul>
<p>Let’s now imagine our study on criminal records and job prospects. <strong><em>In a world where the true difference in call back rates between those with and without criminal records is 0</em></strong>, in any given sample, we might end up with a 3 percentage point difference, -5 percentage point difference, 2 point difference, -1 point difference, and so on.</p>
<ul>
<li>The shape of the bell curve would be centered on 0 difference (Central Limit Theorem), meaning on average, over repeated samples of applicants/hiring decisions, there would be 0 difference, but occasionally we would still find some differences across samples.</li>
<li>What we want to know is if a 12.5 point difference is within two standard errors of 0 or if it is pretty unusual. (Is it more like 55 heads or 80 heads?)</li>
</ul>
<div id="details-standard-errors" class="section level4" number="10.2.1.1">
<h4><span class="header-section-number">10.2.1.1</span> Details: Standard Errors</h4>
<p>A standard error is the standard deviation of the sampling distribution</p>
<ul>
<li>Where a standard deviation is the typical distance between a given observation and the mean.</li>
<li>Compare the two photos below showing 0 standard deviation vs. a large standard deviation</li>
</ul>
<p><img src="images/spread1.png" style="width:40.0%" /> <img src="images/spread2.jpg" style="width:42.0%" /></p>
<p><em>From the Cartoon Guide to Statistics</em></p>
<p>In real life studies, we don’t know the actual sampling distribution because we only have 1 sample (we only had one study of applications/hiring decisions).</p>
<p>So we estimate our standard error using the standard deviation of our sample (<span class="math inline">\(S\)</span>) and sample size (<span class="math inline">\(N\)</span>).</p>
<p><span class="math inline">\({\hat {SE}} = \frac{S}{\sqrt{N}}\)</span></p>
<p>The bigger the sample, the SMALLER the standard error (which is good) because it means less uncertainty.</p>
</div>
</div>
</div>
<div id="z-scores-and-p-values" class="section level2" number="10.3">
<h2><span class="header-section-number">10.3</span> Z-scores and p-values</h2>
<p>Recall the Overview of Hypothesis Testing. Now, we are going to add details to help us make a final decision about the null hypothesis.</p>
<ol start="4" style="list-style-type: decimal">
<li>Carry out a test of the hypothesis, such as a difference-in-means.
<ul>
<li>Applicants with a criminal record receive 12.5 percentage points fewer call backs than those without a criminal record</li>
</ul></li>
<li>Calculate the uncertainty around this estimate.
<ul>
<li>We will estimate the standard error of the estimate using the sample size and sample spread (standard deviation)</li>
<li>We can also estimate the confidence intervals</li>
</ul></li>
<li>Decide whether you can reject or fail to reject the hypothesis of no difference
<ul>
<li>Standarize the estimate and find the z-score (or t-statistic, which is similar)
<ul>
<li>The z score is an example of a “test statistic.” The type of statistic might vary across applications, but its purpose will remain similar. Others include t-statistics and Chi-squared statistics.</li>
</ul></li>
<li>How likely is it you would observe the z-score you found under this null distribution? (p-value)</li>
<li>If the p-value is small (<span class="math inline">\(&lt; 0.05\)</span>), reject the null.</li>
</ul></li>
</ol>
<p>A z-score helps us standardize the size of estimates across any units of study by quantifying the size of the estimate in terms of standard errors.</p>
<p>z-score = <span class="math inline">\(\frac{\text{Estimate - Null}}{\hat{SE}} = \frac{\text{Estimate - 0}}{\hat{SE}}\)</span></p>
<p>The z-score represents the number of standard errors away that the estimate is from the null. We can visualize the distribution of z-scores in the image below.</p>
<p><img src="images/zscore.png" /></p>
<p>The bell curve is centered on 0 and represents our null distribution. The z-score represents how many standard errors away our estimate is from the null.</p>
<ul>
<li>Instead of the axis being the number of heads out of 100 coin flips, centered on the null hypothesis of 50 heads for a fair coin, the standardized scale is centered on 0. We can then visualize how far 80 coin flips is away from 50 by measuring how many standard errors 80 is away from the null of 50.</li>
</ul>
<p>Recall, we asked: When we conduct an experiment and find that applicants with a criminal record were called back 12.5 percentage points less often than those without a criminal record, we want to know…</p>
<ul>
<li>Is that a real difference, or is the real difference 0, and we just happened to get our 12.5-point difference in our sample due to random chance?</li>
</ul>
<p>It so happens that our 12.5 percentage difference represents more than z=7 standard errors away from the null of z=0 difference.</p>
<p>We can visualize where z=7 is in our distribution below with the dashed purple line:</p>
<p><img src="images/zscore2.png" /></p>
<p>It is well outside of the red lines representing 1.96 standard errors.</p>
<p>Interpretation: It is really unlikely we would have observed this extreme in magnitude of difference if the true difference were 0.</p>
<ul>
<li>This likelihood represents the p-value, which is essentially 0 in this case. There is essentially 0 chance we would have observed a difference as large or larger than 12.5 (or -12.5) in a world where the true difference is 0.</li>
<li>If a p-value is &lt; 0.05, we reject the null hypothesis.</li>
<li>If instead, the p-value is larger than 0.05, we fail to reject the null. That would mean that we think it is reasonably possible to have observed a difference as big as 12.5 if in fact the true difference is 0.</li>
</ul>
<p>We are going to focus on two-sided p-values, which focus on the magnitude of the z-score in either direction, instead of whether it is a positive or negative p-value. In other classes, you may also cover one-sided p-values.</p>
<div id="relationship-to-confidence-intervals" class="section level3" number="10.3.1">
<h3><span class="header-section-number">10.3.1</span> Relationship to Confidence Intervals</h3>
<p>Relationship to Confidence Intervals: Our 12.5 percentage difference has a 95% confidence interval of 6.8 to 18.3</p>
<ul>
<li>It is constructed by taking <span class="math inline">\(12.5 - 1.96*SE\)</span> and <span class="math inline">\(12.5 + 1.96*SE\)</span></li>
<li>This means there is a 95% chance that this interval contains the true population difference.</li>
</ul>
<p>It gives us another way of describing our estimate that includes our uncertainty. We recognize that over repeated samples, we are not always going to get a 12.5 point difference. In any given sample, this estimate will differ a bit over the “sampling distribution.”</p>
</div>
</div>
<div id="wrapping-up-the-process" class="section level2" number="10.4">
<h2><span class="header-section-number">10.4</span> Wrapping up the Process</h2>
<p>Let’s Review the Process</p>
<ol style="list-style-type: decimal">
<li>Start with a research question: Are job applicants with criminal records less likely to receive call backs for interviews than applicants without criminal records?</li>
<li>Develop a theory of how the world works
<ul>
<li>E.g., “Job prospects are, in part, a function of someone’s criminal record.”</li>
</ul></li>
<li>Construct “null” and “alternative” hypotheses
<ul>
<li>E.g., <span class="math inline">\(H_o\)</span>: “Applicants with a criminal record will receive call backs at similar rates as those without a criminal record” (I.e., no difference)</li>
<li>E.g., <span class="math inline">\(H_A\)</span>: “Applicants with a criminal record will be less likely to receive call backs than those without a criminal record” or “Applicants with a criminal record will receive call backs at different rates than those without a criminal record” (I.e., some nonzero difference)</li>
</ul></li>
<li>Carry out a test of the hypothesis, such as a difference-in-means.
<ul>
<li>Applicants with a criminal record receive 12.5 percentage points fewer call backs than those without a criminal record</li>
</ul></li>
<li>Calculate the uncertainty around this estimate.
<ul>
<li>We could estimate the standard error with the sample standard deviation and sample size</li>
<li>We could also estimate the confidence intervals.</li>
</ul></li>
<li>Decide whether the result is significant. Can you reject or do you fail to reject the hypothesis of no difference?
<ul>
<li>Use the z-score/t-statistic and p-value</li>
<li>The z score is an example of a “test statistic.” The type of statistic might vary across applications, but its purpose will remain similar. Others include t-statistics and Chi-squared statistics.</li>
</ul></li>
</ol>
</div>
<div id="application-health-savings-study" class="section level2" number="10.5">
<h2><span class="header-section-number">10.5</span> Application: Health Savings Study</h2>
<p><em>For a video explainer of the code in this section, see below. (Via youtube, you can speed up the playback to 1.5 or 2x speed.)</em></p>
<div class="vembedr">
<div>
<iframe src="https://www.youtube.com/embed/kJlonC8AI6w" width="533" height="300" frameborder="0" allowfullscreen=""></iframe>
</div>
</div>
<p>Health Savings Experiment (Dupas and Robinson 2013): Field experiment in rural Kenya in which they randomly varied access to four innovative saving technologies and observed the impact on asset accumulation.</p>
<p><strong><em>1. Start with a research question</em></strong></p>
<p>Can savings technologies help people accumulate assets?</p>
<p><strong><em>2. Develop a theory of how the world works</em></strong></p>
<p>Providing people with a safe place to store money will help them save.</p>
<p><strong><em>3. Construct “null” and “alternative” hypotheses</em></strong></p>
<p>What are our null/alternative hypotheses?</p>
<p><strong><em>4. Carry out a test of the hypothesis, such as a difference-in-means.</em></strong></p>
<ul>
<li>Individuals in all study arms were encouraged to save for health and were asked to set a health goal for themselves at the beginning of the study.<br />
</li>
<li>In the first treatment group (Safe Box), respondents were given a box locked with a padlock and the key</li>
<li>The dependent variable is the amount saved after 12 months <code>fol2_amtinvest</code></li>
</ul>
<p>We will compare average savings between treatment conditions (a difference in means).</p>
<div class="sourceCode" id="cb462"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb462-1"><a href="#cb462-1" aria-hidden="true" tabindex="-1"></a>rosca <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;https://raw.githubusercontent.com/ktmccabe/teachingdata/main/rosca.csv&quot;</span>,</span>
<span id="cb462-2"><a href="#cb462-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">stringsAsFactors =</span> T)</span></code></pre></div>
<div class="sourceCode" id="cb463"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb463-1"><a href="#cb463-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Compare means</span></span>
<span id="cb463-2"><a href="#cb463-2" aria-hidden="true" tabindex="-1"></a>mean.safebox <span class="ot">&lt;-</span> <span class="fu">mean</span>(rosca<span class="sc">$</span>fol2_amtinvest[rosca<span class="sc">$</span>safe_box <span class="sc">==</span> <span class="dv">1</span>], <span class="at">na.rm=</span>T)</span>
<span id="cb463-3"><a href="#cb463-3" aria-hidden="true" tabindex="-1"></a>mean.encouragement <span class="ot">&lt;-</span> <span class="fu">mean</span>(rosca<span class="sc">$</span>fol2_amtinvest[rosca<span class="sc">$</span>encouragement<span class="sc">==</span> <span class="dv">1</span>], </span>
<span id="cb463-4"><a href="#cb463-4" aria-hidden="true" tabindex="-1"></a>                           <span class="at">na.rm=</span>T)</span>
<span id="cb463-5"><a href="#cb463-5" aria-hidden="true" tabindex="-1"></a>diff.means <span class="ot">&lt;-</span> mean.safebox <span class="sc">-</span> mean.encouragement</span>
<span id="cb463-6"><a href="#cb463-6" aria-hidden="true" tabindex="-1"></a>diff.means</span></code></pre></div>
<pre><code>## [1] 150.3816</code></pre>
<p><strong><em>5. Calculate the uncertainty around this estimate.</em></strong></p>
<p>To get uncertainty when calculating a difference in means, we can use the <code>t.test</code> function in R.</p>
<ul>
<li>The first input is the vector of values from one group.</li>
<li>The second input is the vector of values from the other group.</li>
</ul>
<p>To get the t-statistic, underneath the hood of the function, R is estimating the standard error by calculating the standard deviation in the sample and the sample size (the number of people in each condition).</p>
<div class="sourceCode" id="cb465"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb465-1"><a href="#cb465-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Compare amount saved for those in Safe Box vs. </span></span>
<span id="cb465-2"><a href="#cb465-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Encouragement Only conditions</span></span>
<span id="cb465-3"><a href="#cb465-3" aria-hidden="true" tabindex="-1"></a>test <span class="ot">&lt;-</span> <span class="fu">t.test</span>(rosca<span class="sc">$</span>fol2_amtinvest[rosca<span class="sc">$</span>safe_box <span class="sc">==</span> <span class="dv">1</span>],</span>
<span id="cb465-4"><a href="#cb465-4" aria-hidden="true" tabindex="-1"></a>               rosca<span class="sc">$</span>fol2_amtinvest[rosca<span class="sc">$</span>encouragement<span class="sc">==</span> <span class="dv">1</span>])</span>
<span id="cb465-5"><a href="#cb465-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb465-6"><a href="#cb465-6" aria-hidden="true" tabindex="-1"></a>test</span></code></pre></div>
<pre><code>## 
##  Welch Two Sample t-test
## 
## data:  rosca$fol2_amtinvest[rosca$safe_box == 1] and rosca$fol2_amtinvest[rosca$encouragement == 1]
## t = 2.1083, df = 150.38, p-value = 0.03666
## alternative hypothesis: true difference in means is not equal to 0
## 95 percent confidence interval:
##    9.445604 291.317636
## sample estimates:
## mean of x mean of y 
##  408.2150  257.8333</code></pre>
<p><strong><em>6. Decide whether you can reject or fail to reject the hypothesis of no difference</em></strong></p>
<p>We can extract the group means, the p-value of the difference and confidence interval of the difference.</p>
<div class="sourceCode" id="cb467"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb467-1"><a href="#cb467-1" aria-hidden="true" tabindex="-1"></a>test<span class="sc">$</span>estimate</span></code></pre></div>
<pre><code>## mean of x mean of y 
##  408.2150  257.8333</code></pre>
<div class="sourceCode" id="cb469"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb469-1"><a href="#cb469-1" aria-hidden="true" tabindex="-1"></a>test<span class="sc">$</span>conf.int</span></code></pre></div>
<pre><code>## [1]   9.445604 291.317636
## attr(,&quot;conf.level&quot;)
## [1] 0.95</code></pre>
<div class="sourceCode" id="cb471"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb471-1"><a href="#cb471-1" aria-hidden="true" tabindex="-1"></a>test<span class="sc">$</span>p.value</span></code></pre></div>
<pre><code>## [1] 0.03666403</code></pre>
<p>Was the treatment significant? We say something is significant if the p-value is small, such as less than 0.05. We also use this criteria to assess if we should reject the null hypothesis.</p>
<ul>
<li>In a “t test”, the t-statistic serves as the z-score. It counts the number of standard errors away from the null. The t-statistic and z-scores differ slightly in how we calculate the corresponding p-value, but with a large enough sample size, these are also very similar. The <code>t.test</code> function in R calculates the p-value for you.</li>
</ul>
</div>
<div id="additional-applications" class="section level2" number="10.6">
<h2><span class="header-section-number">10.6</span> Additional Applications</h2>
<p>We will carry out the same type of hypothesis testing process for a range of different scenarios. Though the process will remain very similar, the underlying statistical test/calculation/R function will change.</p>
<ul>
<li>If dependent variable is numeric / continuous, can use regression and <code>lm()</code> (type of independent variable does not matter)</li>
<li>If dependent variable is numeric and want to compare between two specific groups, can use <code>t.test()</code></li>
<li>If dependent variable is binary, such as assessing the proportion of call back rates, and want to compare between two specific groups, can use <code>prop.test()</code></li>
</ul>
<p>Other tests exist for different situations</p>
<div id="example-using-regression" class="section level3" number="10.6.1">
<h3><span class="header-section-number">10.6.1</span> Example Using Regression</h3>
<p><strong><em>1. Start with a research question</em></strong></p>
<p>Do past election results help explain future election results?</p>
<p><strong><em>2. Develop a theory of how the world works</em></strong></p>
<p>A third-party candidate’s performance in one election will help us predict the success of a future third-party candidate.</p>
<p><strong><em>3. Construct “null” and “alternative” hypotheses and 4. Carry out a test of the hypothesis, such as a regression.</em></strong></p>
<p>In a regression, our key hypothesis test is about whether there is a significant, non-zero relationship between an independent variable and the outcome.</p>
<ul>
<li>The null hypothesis is that <span class="math inline">\(\beta = 0\)</span>. The alternative is that <span class="math inline">\(\beta \neq 0\)</span>.</li>
</ul>
<p>Going back to our Florida example: The null hypothesis would be the 1996 Perot vote does not help us explain the Buchanan 2000 vote (that <span class="math inline">\(\beta = 0\)</span>). Our alternative is <span class="math inline">\(\beta \neq 0\)</span>, that there is some relationship between 1996 Perot votes and the 2000 Buchanan vote in Florida counties.</p>
<div class="sourceCode" id="cb473"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb473-1"><a href="#cb473-1" aria-hidden="true" tabindex="-1"></a>florida <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;https://raw.githubusercontent.com/ktmccabe/teachingdata/main/florida.csv&quot;</span>)</span></code></pre></div>
<p>We estimate <span class="math inline">\(\hat \beta\)</span>: for every 1 additional vote Perot received in 1996, we expect Buchanan to receive .036 additional votes in 2000.</p>
<div class="sourceCode" id="cb474"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb474-1"><a href="#cb474-1" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(Buchanan00 <span class="sc">~</span> Perot96, <span class="at">data =</span> florida)</span>
<span id="cb474-2"><a href="#cb474-2" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(fit)</span></code></pre></div>
<pre><code>## (Intercept)     Perot96 
##  1.34575212  0.03591504</code></pre>
<p>Is that relationship significant? In other words, is it helpful to know the Perot 1996 vote to help explain the Buchanan 2000 vote? Or should we treat the 0.036 number as essentially 0, just noise?</p>
<p>Recall that the <span class="math inline">\(\hat \beta\)</span> represents the estimated slope of the relationship.</p>
<p><img src="datasciforpolisci_files/figure-html/unnamed-chunk-279-1.svg" width="672" /></p>
<p>We ask: Is that relationship (the slope) significant (i.e., statistically different from 0 slope)?</p>
<p><strong><em>5. Calculate the uncertainty around this estimate.</em></strong></p>
<p>Our regression <code>lm</code> function will also generate estimates of uncertainty related to hypothesis testing</p>
<div class="sourceCode" id="cb476"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb476-1"><a href="#cb476-1" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">summary</span>(fit)<span class="sc">$</span>coefficients, <span class="at">digits=</span><span class="dv">4</span>)</span></code></pre></div>
<pre><code>##             Estimate Std. Error t value Pr(&gt;|t|)
## (Intercept)   1.3458    49.7593  0.0270   0.9785
## Perot96       0.0359     0.0043  8.2752   0.0000</code></pre>
<p><strong><em>6. Decide whether you can reject or fail to reject the hypothesis of no difference</em></strong></p>
<p>We see the p-value for Perot96 is essentially 0– well less than 0.05. Therefore, it is highly unlikely we would observe a slope as big or bigger (in magnitude) as 0.0359 if Perot96 and Buchanan00 were actually unrelated.</p>
<ul>
<li>We consider the effect “statistically significant.”</li>
<li>We reject a null hypothesis that the Perot 1996 vote is unrelated to the Buchanan 2000 vote.</li>
</ul>
<p>In social science papers, regressions are often presented in tables:</p>
<pre><code>## 
## =======================
##              Model 1   
## -----------------------
## (Intercept)    1.35    
##              (49.76)   
## Perot96        0.04 ***
##               (0.00)   
## -----------------------
## R^2            0.51    
## Adj. R^2       0.51    
## Num. obs.     67       
## =======================
## *** p &lt; 0.001; ** p &lt; 0.01; * p &lt; 0.05</code></pre>
</div>
<div id="example-using-prop.test" class="section level3" number="10.6.2">
<h3><span class="header-section-number">10.6.2</span> Example Using prop.test()</h3>
<p>Sometimes our outcomes are 0 vs. 1 variables, which become proportions when we take the mean()</p>
<ul>
<li>For example, applicants who get a call back vs. do not</li>
<li>For example, voters who turn out to vote vs. do not</li>
</ul>
<p>When you have this type of outcome variable, you may want to use a test designed specifically for testing the differences in proportions of two groups.</p>
<p>Experimental Example: Going Back to Resume and Race study</p>
<p><strong><em>1. Start with a research question</em></strong></p>
<p>Does race influence hiring decisions?</p>
<p><strong><em>2. Develop a theory of how the world works</em></strong></p>
<p>Theory: Black applicants face discrimination in hiring.</p>
<p><strong><em>3. Construct “null” and “alternative” hypotheses</em></strong></p>
<p>We can conduct a two-sided hypothesis test</p>
<ul>
<li><span class="math inline">\(H_o\)</span>: No difference in call back rates for Black and white applicants</li>
<li><span class="math inline">\(H_a\)</span>: Some difference in call back rates for Black and white applicants</li>
</ul>
<p>The two-sided means we aren’t specifying a direction of our alternative hypothesis. Instead, we are conducting test just trying to reject the idea of no difference between racial groups. Sometimes researchers may specify the alternative hypothesis in a directional way, such as Black applicants will have a lower call back rate than white applicants. However, it is more common to use a two-sided test, even if researchers have a theoretical hypothesis in a particular direction.</p>
<div class="sourceCode" id="cb479"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb479-1"><a href="#cb479-1" aria-hidden="true" tabindex="-1"></a>resume <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;https://raw.githubusercontent.com/ktmccabe/teachingdata/main/resume.csv&quot;</span>)</span>
<span id="cb479-2"><a href="#cb479-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb479-3"><a href="#cb479-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(resume)</span></code></pre></div>
<pre><code>##   firstname    sex  race call
## 1   Allison female white    0
## 2   Kristen female white    0
## 3   Lakisha female black    0
## 4   Latonya female black    0
## 5    Carrie female white    0
## 6       Jay   male white    0</code></pre>
<p><strong><em>4. Carry out a test of the hypothesis, such as a test of proportions.</em></strong></p>
<p>Does being black (vs. white) decrease call backs?</p>
<div class="sourceCode" id="cb481"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb481-1"><a href="#cb481-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(resume<span class="sc">$</span>race, resume<span class="sc">$</span>call)</span></code></pre></div>
<pre><code>##        
##            0    1
##   black 2278  157
##   white 2200  235</code></pre>
<div class="sourceCode" id="cb483"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb483-1"><a href="#cb483-1" aria-hidden="true" tabindex="-1"></a>test <span class="ot">&lt;-</span> <span class="fu">prop.test</span>(<span class="at">x=</span><span class="fu">c</span>(<span class="dv">157</span>, <span class="dv">235</span>), <span class="at">n=</span><span class="fu">c</span>(<span class="dv">157</span><span class="sc">+</span><span class="dv">2278</span>, <span class="dv">235</span><span class="sc">+</span><span class="dv">2200</span>))</span></code></pre></div>
<ul>
<li>The <code>prop.test()</code> function includes 4 inputs</li>
<li>The number of 1’s from the first group, the number of 1’s in the second group <code>c(n1, n2)</code></li>
<li>The total observations from the first group, the total observations in the second group <code>c(total1, total2)</code></li>
</ul>
<p><strong><em>5. Calculate the uncertainty around this estimate.</em></strong></p>
<div class="sourceCode" id="cb484"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb484-1"><a href="#cb484-1" aria-hidden="true" tabindex="-1"></a>test</span></code></pre></div>
<pre><code>## 
##  2-sample test for equality of proportions with continuity correction
## 
## data:  c(157, 235) out of c(157 + 2278, 235 + 2200)
## X-squared = 16.449, df = 1, p-value = 4.998e-05
## alternative hypothesis: two.sided
## 95 percent confidence interval:
##  -0.04769866 -0.01636705
## sample estimates:
##     prop 1     prop 2 
## 0.06447639 0.09650924</code></pre>
<p>You can extract the p.value for the difference in proportions and confidence interval</p>
<p><strong><em>6. Decide whether you can reject or fail to reject the hypothesis of no difference</em></strong></p>
<p>In the <code>prop.test</code> function, you see a X-squared statistic. You can treat this like the z-score. When you are doing a test of two groups, the X-squared is essentially the z-score squared. The X-squared refers to a Chi-squared test. In our case, the equivalent z-score would be about 4– well more than 2 standard errors.</p>
<div class="sourceCode" id="cb486"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb486-1"><a href="#cb486-1" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(test<span class="sc">$</span>p.value, <span class="at">digits=</span><span class="dv">3</span>)</span></code></pre></div>
<pre><code>## [1] 0</code></pre>
<p>What do you conclude about the hypothesis? Is it significant?</p>
</div>
</div>
<div id="in-class-exercise-questions" class="section level2" number="10.7">
<h2><span class="header-section-number">10.7</span> In-Class Exercise Questions</h2>
<p>Do negative ads increase voter turnout? In an experiment, suppose researchers found that a negative political ad intending to make voters angry toward the opposing candidate increased voter turnout by 5 percentage points relative to a control condition in which a non-political ad was shown. The difference between treatment and control had a p-value of 0.25, and the confidence interval was -1 to 11 percentage points.</p>
<ol style="list-style-type: decimal">
<li>What are the implied null and alternative hypotheses?</li>
<li>What is the difference in voter turnout between the groups?</li>
<li>What do you conclude about the results? Is it significant? Do you reject or fail to reject the null hypothesis?</li>
<li>How do you interpret the p-value?</li>
</ol>
<p>If we imagine that we could conduct the negative advertising study over and over again, estimating voter turnout each time. The set of estimates of voter turnout across these hypothetical studies would be called the (circle one):</p>
<ol style="list-style-type: upper-alpha">
<li>Standard error</li>
<li>Sampling distribution</li>
<li>Confidence Interval</li>
<li>Standard deviation</li>
</ol>
<p>Are natural resources like oil negatively related to how democratic a country is? In a study, researchers looked at the correlation between the amount of oil available to a country and how democratic the country is according to expert ratings of democracy. The researchers ran a regression analysis and found that for every one-unit increase in the amount of oil a country has, the country has a b=.3 decrease in its democracy rating. The standard error of the coefficient is se = 0.05. The t-statistic is 6, with a p-value &lt; 0.001.</p>
<ol style="list-style-type: decimal">
<li>What are the implied null and alternative hypotheses?</li>
<li>What do you conclude about the results? Is it significant? Do you reject or fail to reject the null hypothesis?</li>
</ol>
<!--chapter:end:10-Uncertainty.Rmd-->
</div>
</div>
<div id="text" class="section level1" number="11">
<h1><span class="header-section-number">11</span> Text as Data</h1>
<p>Recall that we said, four primary goals of social science include:</p>
<ul>
<li><strong>Describe</strong> and measure
<ul>
<li>Has the U.S. population increased?</li>
</ul></li>
<li><strong>Explain</strong>, evaluate, and recommend (study of causation)
<ul>
<li>Does expanding Medicaid improve health outcomes?</li>
</ul></li>
<li><strong>Predict</strong>
<ul>
<li>Who will win the next election?</li>
</ul></li>
<li><strong>Discover</strong>
<ul>
<li>How do policies diffuse across states?</li>
</ul></li>
</ul>
<p>In this section, we start to explore the goal of discovery, seeing what we can learn from text as data.</p>
<div id="why-text" class="section level2" number="11.1">
<h2><span class="header-section-number">11.1</span> Why text?</h2>
<p>Words (can) matter. Patterns of word usage can be suggestive of deeper divides.</p>
<p><img src="images/deadspin.png" style="width:80.0%" /></p>
<p>Article from <a href="https://deadspin.com/which-words-are-used-to-describe-white-and-black-nfl-pr-1573683214">Deadspin</a></p>
<p><img src="images/wordsmass.png" /></p>
<p>Article from <a href="https://www.nytimes.com/interactive/2016/06/13/us/politics/politicians-respond-to-orlando-nightclub-attack.html">NY Times</a></p>
<p><strong><em>Why Use R to analyze text?</em></strong></p>
<ul>
<li>Assist in reading large amounts of text</li>
</ul>
<p><img src="images/greg1.png" style="width:40.0%" /> <img src="images/greg2.png" style="width:40.0%" /></p>
<ul>
<li>Efficiently summarize text through quantifying text attributes</li>
<li>(Can) remove some subjectivity in coding text, allow to discover aspects of text unknown a priori</li>
</ul>
</div>
<div id="r-packages-for-text" class="section level2" number="11.2">
<h2><span class="header-section-number">11.2</span> R Packages for text</h2>
<p>Packages are like apps on your phone. They give you additional functionality. To use the tools in a package you first have to install it.</p>
<div class="sourceCode" id="cb488"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb488-1"><a href="#cb488-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;sotu&quot;</span>, <span class="at">dependencies =</span> T)</span>
<span id="cb488-2"><a href="#cb488-2" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;tm&quot;</span>, <span class="at">dependencies =</span> T)</span>
<span id="cb488-3"><a href="#cb488-3" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;SnowballC&quot;</span>, <span class="at">dependencies =</span> T)</span>
<span id="cb488-4"><a href="#cb488-4" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;wordcloud&quot;</span>, <span class="at">dependencies =</span> T)</span>
<span id="cb488-5"><a href="#cb488-5" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;stringr&quot;</span>, <span class="at">dependencies =</span> T)</span></code></pre></div>
<p>After you install it, just like on a phone, anytime you want to use the app, you need to open it. In R, we do that with <code>library()</code>.</p>
<div class="sourceCode" id="cb489"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb489-1"><a href="#cb489-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sotu)</span>
<span id="cb489-2"><a href="#cb489-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tm)</span>
<span id="cb489-3"><a href="#cb489-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(SnowballC)</span>
<span id="cb489-4"><a href="#cb489-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(wordcloud)</span>
<span id="cb489-5"><a href="#cb489-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span></code></pre></div>
</div>
<div id="application-state-of-the-union" class="section level2" number="11.3">
<h2><span class="header-section-number">11.3</span> Application: State of the Union</h2>
<p><em>For a video explainer of the code for the State of the Union application on pre-processing text and dictionary analysis, see below. (Via youtube, you can speed up the playback to 1.5 or 2x speed.)</em></p>
<div class="vembedr">
<div>
<iframe src="https://www.youtube.com/embed/-9rB6uOih34" width="533" height="300" frameborder="0" allowfullscreen=""></iframe>
</div>
</div>
<p>The <code>sotu</code> package includes a dataset with the text of every U.S. State of the Union speech. It also includes second dataset with information about the speech. When datasets are stored in a package, you can add them to your environment through the <code>data()</code> function.</p>
<div class="sourceCode" id="cb490"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb490-1"><a href="#cb490-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(sotu_meta)</span>
<span id="cb490-2"><a href="#cb490-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(sotu_text)</span></code></pre></div>
<p>We are going to “bind” these together into a new dataframe. That way, the <code>sotu_text</code> is a variable inside of our <code>speeches</code> dataframe.</p>
<div class="sourceCode" id="cb491"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb491-1"><a href="#cb491-1" aria-hidden="true" tabindex="-1"></a>speeches <span class="ot">&lt;-</span> <span class="fu">cbind</span>(sotu_meta, sotu_text)</span>
<span id="cb491-2"><a href="#cb491-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(speeches)</span></code></pre></div>
<pre><code>## [1] &quot;president&quot;    &quot;year&quot;         &quot;years_active&quot; &quot;party&quot;        &quot;sotu_type&quot;   
## [6] &quot;sotu_text&quot;</code></pre>
<div id="cleaning-text" class="section level3" number="11.3.1">
<h3><span class="header-section-number">11.3.1</span> Cleaning Text</h3>
<p>Note that when working with raw text data, we usually do want our variables to be character variables and not factor variables. Here, every cell is not a category. Instead, it is a speech!</p>
<div class="sourceCode" id="cb493"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb493-1"><a href="#cb493-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(speeches<span class="sc">$</span>sotu_text)</span></code></pre></div>
<pre><code>## [1] &quot;character&quot;</code></pre>
<p>Text is messy data. We may want to spruce it up a bit by removing some of the non-essential characters and words, and moving everything to lowercase.</p>
<div class="sourceCode" id="cb495"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb495-1"><a href="#cb495-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Example of speech</span></span>
<span id="cb495-2"><a href="#cb495-2" aria-hidden="true" tabindex="-1"></a>speeches<span class="sc">$</span>sotu_text[<span class="dv">1</span>]</span></code></pre></div>
<pre><code>## [1] &quot;Fellow-Citizens of the Senate and House of Representatives: \n\nI embrace with great satisfaction the opportunity which now presents itself of congratulating you on the present favorable prospects of our public affairs. The recent accession of the important state of North Carolina to the Constitution of the United States (of which official information has been received), the rising credit and respectability of our country, the general and increasing good will toward the government of the Union, and the concord, peace, and plenty with which we are blessed are circumstances auspicious in an eminent degree to our national prosperity.\n\nIn resuming your consultations for the general good you can not but derive encouragement from the reflection that the measures of the last session have been as satisfactory to your constituents as the novelty and difficulty of the work allowed you to hope. Still further to realize their expectations and to secure the blessings which a gracious Providence has placed within our reach will in the course of the present important session call for the cool and deliberate exertion of your patriotism, firmness, and wisdom.\n\nAmong the many interesting objects which will engage your attention that of providing for the common defense will merit particular regard. To be prepared for war is one of the most effectual means of preserving peace.\n\nA free people ought not only to be armed, but disciplined; to which end a uniform and well-digested plan is requisite; and their safety and interest require that they should promote such manufactories as tend to render them independent of others for essential, particularly military, supplies.\n\nThe proper establishment of the troops which may be deemed indispensable will be entitled to mature consideration. In the arrangements which may be made respecting it it will be of importance to conciliate the comfortable support of the officers and soldiers with a due regard to economy.\n\nThere was reason to hope that the pacific measures adopted with regard to certain hostile tribes of Indians would have relieved the inhabitants of our southern and western frontiers from their depredations, but you will perceive from the information contained in the papers which I shall direct to be laid before you (comprehending a communication from the Commonwealth of Virginia) that we ought to be prepared to afford protection to those parts of the Union, and, if necessary, to punish aggressors.\n\nThe interests of the United States require that our intercourse with other nations should be facilitated by such provisions as will enable me to fulfill my duty in that respect in the manner which circumstances may render most conducive to the public good, and to this end that the compensation to be made to the persons who may be employed should, according to the nature of their appointments, be defined by law, and a competent fund designated for defraying the expenses incident to the conduct of foreign affairs.\n\nVarious considerations also render it expedient that the terms on which foreigners may be admitted to the rights of citizens should be speedily ascertained by a uniform rule of naturalization.\n\nUniformity in the currency, weights, and measures of the United States is an object of great importance, and will, I am persuaded, be duly attended to.\n\nThe advancement of agriculture, commerce, and manufactures by all proper means will not, I trust, need recommendation; but I can not forbear intimating to you the expediency of giving effectual encouragement as well to the introduction of new and useful inventions from abroad as to the exertions of skill and genius in producing them at home, and of facilitating the intercourse between the distant parts of our country by a due attention to the post-office and post-roads.\n\nNor am I less persuaded that you will agree with me in opinion that there is nothing which can better deserve your patronage than the promotion of science and literature. Knowledge is in every country the surest basis of public happiness. In one in which the measures of government receive their impressions so immediately from the sense of the community as in ours it is proportionably essential.\n\nTo the security of a free constitution it contributes in various ways - by convincing those who are intrusted with the public administration that every valuable end of government is best answered by the enlightened confidence of the people, and by teaching the people themselves to know and to value their own rights; to discern and provide against invasions of them; to distinguish between oppression and the necessary exercise of lawful authority; between burthens proceeding from a disregard to their convenience and those resulting from the inevitable exigencies of society; to discriminate the spirit of liberty from that of licentiousness - cherishing the first, avoiding the last - and uniting a speedy but temperate vigilance against encroachments, with an inviolable respect to the laws.\n\nWhether this desirable object will be best promoted by affording aids to seminaries of learning already established, by the institution of a national university, or by any other expedients will be well worthy of a place in the deliberations of the legislature.\n\nGentlemen of the House of Representatives: \n\nI saw with peculiar pleasure at the close of the last session the resolution entered into by you expressive of your opinion that an adequate provision for the support of the public credit is a matter of high importance to the national honor and prosperity. In this sentiment I entirely concur; and to a perfect confidence in your best endeavors to devise such a provision as will be truly with the end I add an equal reliance on the cheerful cooperation of the other branch of the legislature.\n\nIt would be superfluous to specify inducements to a measure in which the character and interests of the United States are so obviously so deeply concerned, and which has received so explicit a sanction from your declaration. \n\nGentlemen of the Senate and House of Representatives: \n\nI have directed the proper officers to lay before you, respectively, such papers and estimates as regard the affairs particularly recommended to your consideration, and necessary to convey to you that information of the state of the Union which it is my duty to afford.\n\nThe welfare of our country is the great object to which our cares and efforts ought to be directed, and I shall derive great satisfaction from a cooperation with you in the pleasing though arduous task of insuring to our fellow citizens the blessings which they have a right to expect from a free, efficient, and equal government. GEORGE WASHINGTON\n&quot;</code></pre>
<div class="sourceCode" id="cb497"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb497-1"><a href="#cb497-1" aria-hidden="true" tabindex="-1"></a><span class="do">## clean text</span></span>
<span id="cb497-2"><a href="#cb497-2" aria-hidden="true" tabindex="-1"></a>speeches<span class="sc">$</span>sotu_text <span class="ot">&lt;-</span> <span class="fu">tolower</span>(speeches<span class="sc">$</span>sotu_text)</span>
<span id="cb497-3"><a href="#cb497-3" aria-hidden="true" tabindex="-1"></a>speeches<span class="sc">$</span>sotu_text <span class="ot">&lt;-</span> <span class="fu">stripWhitespace</span>(speeches<span class="sc">$</span>sotu_text)</span>
<span id="cb497-4"><a href="#cb497-4" aria-hidden="true" tabindex="-1"></a>speeches<span class="sc">$</span>sotu_text <span class="ot">&lt;-</span> <span class="fu">removeWords</span>(speeches<span class="sc">$</span>sotu_text, <span class="fu">stopwords</span>(<span class="at">kind=</span><span class="st">&quot;en&quot;</span>))</span>
<span id="cb497-5"><a href="#cb497-5" aria-hidden="true" tabindex="-1"></a>speeches<span class="sc">$</span>sotu_text <span class="ot">&lt;-</span> <span class="fu">removePunctuation</span>(speeches<span class="sc">$</span>sotu_text)</span>
<span id="cb497-6"><a href="#cb497-6" aria-hidden="true" tabindex="-1"></a>speeches<span class="sc">$</span>sotu_text <span class="ot">&lt;-</span> <span class="fu">removeNumbers</span>(speeches<span class="sc">$</span>sotu_text)</span>
<span id="cb497-7"><a href="#cb497-7" aria-hidden="true" tabindex="-1"></a><span class="co">#speeches$sotu_text &lt;- stemDocument(speeches$sotu_text) # we will hold off</span></span></code></pre></div>
<p>Note: What you might consider non-essential could differ depending on your application. Maybe you want to keep numbers in your text, for example.</p>
</div>
<div id="preparing-a-corpus" class="section level3" number="11.3.2">
<h3><span class="header-section-number">11.3.2</span> Preparing a Corpus</h3>
<div class="sourceCode" id="cb498"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb498-1"><a href="#cb498-1" aria-hidden="true" tabindex="-1"></a><span class="do">## turn text into corpus</span></span>
<span id="cb498-2"><a href="#cb498-2" aria-hidden="true" tabindex="-1"></a>sotu.corpus <span class="ot">&lt;-</span> <span class="fu">Corpus</span>(<span class="fu">VectorSource</span>(speeches<span class="sc">$</span>sotu_text))</span>
<span id="cb498-3"><a href="#cb498-3" aria-hidden="true" tabindex="-1"></a><span class="do">## turn into Document-Term-Matrix</span></span>
<span id="cb498-4"><a href="#cb498-4" aria-hidden="true" tabindex="-1"></a>sotu.dtm <span class="ot">&lt;-</span> <span class="fu">DocumentTermMatrix</span>(sotu.corpus)</span></code></pre></div>
<div class="sourceCode" id="cb499"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb499-1"><a href="#cb499-1" aria-hidden="true" tabindex="-1"></a><span class="do">## preview</span></span>
<span id="cb499-2"><a href="#cb499-2" aria-hidden="true" tabindex="-1"></a><span class="fu">inspect</span>(sotu.dtm[,<span class="dv">10</span><span class="sc">:</span><span class="dv">20</span>])</span></code></pre></div>
<pre><code>## &lt;&lt;DocumentTermMatrix (documents: 236, terms: 11)&gt;&gt;
## Non-/sparse entries: 1386/1210
## Sparsity           : 47%
## Maximal term length: 11
## Weighting          : term frequency (tf)
## Sample             :
##      Terms
## Docs  affairs afford affording agree agriculture aids allowed already also
##   113       2      5         0     0           7    0       1      16   23
##   117       3      9         1     0           2    1       8      17   23
##   119       2      2         0     2           8    2       3      21   16
##   124       8      1         0     3           6    3       2      13   25
##   158       8      5         0     1          22    5       2      25   44
##   188       6      1         0     3           2    0       0      13   94
##   190       6      7         0     0           6    0       1      23   89
##   197       2      2         0     0           8    0       2      11   44
##   199       4      8         0     0           9    0       1      23   82
##   201       8      3         0     0           9    0       4      11   72
##      Terms
## Docs  among
##   113    12
##   117    23
##   119    11
##   124    10
##   158    12
##   188     6
##   190     8
##   197     9
##   199    14
##   201    17</code></pre>
</div>
<div id="word-frequency" class="section level3" number="11.3.3">
<h3><span class="header-section-number">11.3.3</span> Word Frequency</h3>
<p>Convert the “Document-Term-Matrix” into a matrix using <code>as.matrix()</code></p>
<div class="sourceCode" id="cb501"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb501-1"><a href="#cb501-1" aria-hidden="true" tabindex="-1"></a>sotu.dtm.mat <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(sotu.dtm)</span>
<span id="cb501-2"><a href="#cb501-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb501-3"><a href="#cb501-3" aria-hidden="true" tabindex="-1"></a><span class="do">## Most frequent words</span></span>
<span id="cb501-4"><a href="#cb501-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">sort</span>(sotu.dtm.mat[<span class="dv">1</span>,], <span class="at">decreasing=</span>T), <span class="at">n=</span><span class="dv">10</span>)</span></code></pre></div>
<pre><code>##       will        may     public    country        end government      great 
##         14          5          5          4          4          4          4 
##   measures     regard     states 
##          4          4          4</code></pre>
<div class="sourceCode" id="cb503"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb503-1"><a href="#cb503-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">sort</span>(sotu.dtm.mat[<span class="dv">236</span>,], <span class="at">decreasing=</span>T), <span class="at">n=</span><span class="dv">10</span>)</span></code></pre></div>
<pre><code>##  america      now   people     will     just     work american    world 
##       28       27       27       26       25       22       22       22 
##     make      can 
##       20       19</code></pre>
<p>Note: these are somewhat generic words.</p>
<p><strong><em>Word Cloud</em></strong></p>
<div class="sourceCode" id="cb505"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb505-1"><a href="#cb505-1" aria-hidden="true" tabindex="-1"></a><span class="fu">wordcloud</span>(<span class="at">words=</span><span class="fu">names</span>(sotu.dtm.mat[<span class="dv">1</span>,]),</span>
<span id="cb505-2"><a href="#cb505-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">freq=</span>sotu.dtm.mat[<span class="dv">1</span>,], <span class="at">max.words =</span> <span class="dv">20</span>)</span></code></pre></div>
<p><img src="datasciforpolisci_files/figure-html/unnamed-chunk-297-1.svg" width="672" /></p>
</div>
</div>
<div id="word-importance" class="section level2" number="11.4">
<h2><span class="header-section-number">11.4</span> Word Importance</h2>
<p>We use tf-idf (term frequency - inverse document frequency) as a way to pull out uniquely important/relevant words for a given character.</p>
<ul>
<li>Relative frequency of a term inversely weighted by the number of documents in which the term appears.</li>
<li>Functionally, if everyone uses the word “know,” then it’s not very important for distinguishing characters/documents from each other.</li>
<li>We want words that a speech used frequently, that other speeches use less frequently</li>
</ul>
<div class="sourceCode" id="cb506"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb506-1"><a href="#cb506-1" aria-hidden="true" tabindex="-1"></a><span class="do">## words uniquely important to a character</span></span>
<span id="cb506-2"><a href="#cb506-2" aria-hidden="true" tabindex="-1"></a>sotu.tfidf <span class="ot">&lt;-</span> <span class="fu">weightTfIdf</span>(sotu.dtm)</span>
<span id="cb506-3"><a href="#cb506-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb506-4"><a href="#cb506-4" aria-hidden="true" tabindex="-1"></a><span class="do">## convert to matrix</span></span>
<span id="cb506-5"><a href="#cb506-5" aria-hidden="true" tabindex="-1"></a>sotu.tfidf.mat <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(sotu.tfidf)</span></code></pre></div>
<p>We can summarize the uniquely relevant words for each speech</p>
<div class="sourceCode" id="cb507"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb507-1"><a href="#cb507-1" aria-hidden="true" tabindex="-1"></a>Gw1790.tfidf <span class="ot">&lt;-</span><span class="fu">head</span>(<span class="fu">sort</span>(sotu.tfidf.mat[<span class="dv">1</span>,], <span class="at">decreasing=</span>T), <span class="at">n=</span><span class="dv">8</span>)</span>
<span id="cb507-2"><a href="#cb507-2" aria-hidden="true" tabindex="-1"></a>BO2016.tfidf <span class="ot">&lt;-</span><span class="fu">head</span>(<span class="fu">sort</span>(sotu.tfidf.mat[<span class="dv">236</span>,], <span class="at">decreasing=</span>T), <span class="at">n=</span><span class="dv">8</span>)</span></code></pre></div>
<div class="sourceCode" id="cb508"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb508-1"><a href="#cb508-1" aria-hidden="true" tabindex="-1"></a>Gw1790.tfidf</span></code></pre></div>
<pre><code>##     intimating licentiousness        discern     inviolable         derive 
##     0.01527644     0.01527644     0.01333846     0.01220481     0.01172350 
##      persuaded     cherishing  comprehending 
##     0.01172350     0.01077658     0.01077658</code></pre>
<div class="sourceCode" id="cb510"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb510-1"><a href="#cb510-1" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(Gw1790.tfidf, <span class="at">cex.axis=</span>.<span class="dv">7</span>,</span>
<span id="cb510-2"><a href="#cb510-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">cex.names=</span>.<span class="dv">7</span>,</span>
<span id="cb510-3"><a href="#cb510-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">main=</span> <span class="st">&quot;Most `Important&#39; 1790 SOTU Words (tf-idf)&quot;</span>, </span>
<span id="cb510-4"><a href="#cb510-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">horiz =</span> T, <span class="at">las=</span><span class="dv">2</span>)</span></code></pre></div>
<p><img src="datasciforpolisci_files/figure-html/unnamed-chunk-301-1.svg" width="672" /></p>
<div class="sourceCode" id="cb511"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb511-1"><a href="#cb511-1" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(BO2016.tfidf,</span>
<span id="cb511-2"><a href="#cb511-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">cex.names=</span>.<span class="dv">7</span>, <span class="at">cex.axis=</span>.<span class="dv">7</span>,</span>
<span id="cb511-3"><a href="#cb511-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">main=</span> <span class="st">&quot;Most `Important&#39; 2016 SOTU Words (tf-idf)&quot;</span>, </span>
<span id="cb511-4"><a href="#cb511-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">horiz=</span>T, <span class="at">las=</span><span class="dv">2</span>)</span></code></pre></div>
<p><img src="datasciforpolisci_files/figure-html/unnamed-chunk-301-2.svg" width="672" /></p>
</div>
<div id="additional-descriptive-statistics" class="section level2" number="11.5">
<h2><span class="header-section-number">11.5</span> Additional Descriptive Statistics</h2>
<p>Are the length of speeches changing? The <code>nchar()</code> function tells you the number of characters in a “string.”</p>
<div class="sourceCode" id="cb512"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb512-1"><a href="#cb512-1" aria-hidden="true" tabindex="-1"></a>speeches<span class="sc">$</span>speechlength <span class="ot">&lt;-</span> <span class="fu">nchar</span>(speeches<span class="sc">$</span>sotu_text)</span></code></pre></div>
<p>Let’s plot the length of speeches over time and annotate with informative colors and labels.</p>
<p>Is the length of speeches changing?</p>
<div class="sourceCode" id="cb513"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb513-1"><a href="#cb513-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">236</span>, <span class="at">y=</span> speeches<span class="sc">$</span>speechlength, </span>
<span id="cb513-2"><a href="#cb513-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">pch=</span><span class="dv">15</span>,</span>
<span id="cb513-3"><a href="#cb513-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">xaxt=</span><span class="st">&quot;n&quot;</span>,</span>
<span id="cb513-4"><a href="#cb513-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">&quot;&quot;</span>, </span>
<span id="cb513-5"><a href="#cb513-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">&quot;Number of Characters&quot;</span>)</span>
<span id="cb513-6"><a href="#cb513-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb513-7"><a href="#cb513-7" aria-hidden="true" tabindex="-1"></a><span class="do">## add x axis</span></span>
<span id="cb513-8"><a href="#cb513-8" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">1</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">236</span>, <span class="at">labels=</span>speeches<span class="sc">$</span>year, <span class="at">las=</span><span class="dv">3</span>, <span class="at">cex.axis=</span>.<span class="dv">7</span>)</span></code></pre></div>
<p><img src="datasciforpolisci_files/figure-html/unnamed-chunk-303-1.svg" width="672" /></p>
<p>We can add color to distinguish written vs. spoken speeches</p>
<div class="sourceCode" id="cb514"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb514-1"><a href="#cb514-1" aria-hidden="true" tabindex="-1"></a>speechcolor <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(speeches<span class="sc">$</span>sotu_type <span class="sc">==</span> <span class="st">&quot;written&quot;</span>, <span class="st">&quot;black&quot;</span>, <span class="st">&quot;green3&quot;</span>)</span>
<span id="cb514-2"><a href="#cb514-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">236</span>, <span class="at">y=</span> speeches<span class="sc">$</span>speechlength, </span>
<span id="cb514-3"><a href="#cb514-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">xaxt=</span><span class="st">&quot;n&quot;</span>, <span class="at">pch=</span><span class="dv">15</span>,</span>
<span id="cb514-4"><a href="#cb514-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">&quot;&quot;</span>, </span>
<span id="cb514-5"><a href="#cb514-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">&quot;Number of Characters&quot;</span>,</span>
<span id="cb514-6"><a href="#cb514-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">col =</span> speechcolor)</span>
<span id="cb514-7"><a href="#cb514-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb514-8"><a href="#cb514-8" aria-hidden="true" tabindex="-1"></a><span class="do">## add x axis</span></span>
<span id="cb514-9"><a href="#cb514-9" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">1</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">236</span>, <span class="at">labels=</span>speeches<span class="sc">$</span>year, <span class="at">las=</span><span class="dv">3</span>, <span class="at">cex.axis=</span>.<span class="dv">7</span>)</span>
<span id="cb514-10"><a href="#cb514-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb514-11"><a href="#cb514-11" aria-hidden="true" tabindex="-1"></a><span class="do">## add legend</span></span>
<span id="cb514-12"><a href="#cb514-12" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;topleft&quot;</span>, <span class="fu">c</span>(<span class="st">&quot;spoken&quot;</span>, <span class="st">&quot;written&quot;</span>), </span>
<span id="cb514-13"><a href="#cb514-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">pch=</span><span class="dv">15</span>, </span>
<span id="cb514-14"><a href="#cb514-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">col=</span><span class="fu">c</span>(<span class="st">&quot;green3&quot;</span>, <span class="st">&quot;black&quot;</span>), <span class="at">bty=</span><span class="st">&quot;n&quot;</span>)</span></code></pre></div>
<p><img src="datasciforpolisci_files/figure-html/unnamed-chunk-304-1.svg" width="672" /></p>
<div id="dictionary-analysis" class="section level3" number="11.5.1">
<h3><span class="header-section-number">11.5.1</span> Dictionary Analysis</h3>
<p>We can characterize the content of speeches in different ways. For example, we can see if speeches mention specific words, such as `“terrorism.”</p>
<ul>
<li>The function <code>grepl()</code> lets you search for a pattern of text in a character string</li>
<li>The function <code>str_detect()</code> works similarly with the opposite order of inputs</li>
</ul>
<div class="sourceCode" id="cb515"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb515-1"><a href="#cb515-1" aria-hidden="true" tabindex="-1"></a>speeches<span class="sc">$</span>terrorism <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">grepl</span>(<span class="st">&quot;terror&quot;</span>, speeches<span class="sc">$</span>sotu_text), <span class="dv">1</span>,<span class="dv">0</span>)</span>
<span id="cb515-2"><a href="#cb515-2" aria-hidden="true" tabindex="-1"></a>speeches<span class="sc">$</span>terrorism2 <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">str_detect</span>(speeches<span class="sc">$</span>sotu_text,<span class="st">&quot;terror&quot;</span>), <span class="dv">1</span>,<span class="dv">0</span>)</span></code></pre></div>
<div class="sourceCode" id="cb516"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb516-1"><a href="#cb516-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sort</span>(<span class="fu">tapply</span>(speeches<span class="sc">$</span>terrorism, speeches<span class="sc">$</span>president, sum), </span>
<span id="cb516-2"><a href="#cb516-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">decreasing=</span>T)[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span></code></pre></div>
<pre><code>##        George W. Bush    William J. Clinton          Barack Obama 
##                     8                     8                     7 
##         Ronald Reagan Franklin D. Roosevelt        Andrew Jackson 
##                     6                     4                     2 
##     Chester A. Arthur      Grover Cleveland        Harry S Truman 
##                     2                     2                     2 
##          Jimmy Carter 
##                     2</code></pre>
<p>We can characterize the content of speeches in different ways. For example, we can see if speeches mention specific words, such as “terrorism.”</p>
<ul>
<li>The function <code>str_count()</code> counts the number of times a piece of text appears in a character string</li>
</ul>
<div class="sourceCode" id="cb518"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb518-1"><a href="#cb518-1" aria-hidden="true" tabindex="-1"></a>speeches<span class="sc">$</span>terrorismcount <span class="ot">&lt;-</span> <span class="fu">str_count</span>(speeches<span class="sc">$</span>sotu_text, <span class="st">&quot;terror&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb519"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb519-1"><a href="#cb519-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sort</span>(<span class="fu">tapply</span>(speeches<span class="sc">$</span>terrorismcount, speeches<span class="sc">$</span>president, sum), </span>
<span id="cb519-2"><a href="#cb519-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">decreasing=</span>T)[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span></code></pre></div>
<pre><code>##        George W. Bush          Barack Obama    William J. Clinton 
##                   171                    37                    29 
##         Ronald Reagan Franklin D. Roosevelt     Lyndon B. Johnson 
##                    10                     6                     5 
##        Harry S Truman          Jimmy Carter        Andrew Jackson 
##                     3                     3                     2 
##     Chester A. Arthur 
##                     2</code></pre>
<p>We can add multiple words with the | operator. This is often called a “dictionary analysis.”</p>
<div class="sourceCode" id="cb521"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb521-1"><a href="#cb521-1" aria-hidden="true" tabindex="-1"></a>speeches<span class="sc">$</span>warcount <span class="ot">&lt;-</span> <span class="fu">str_count</span>(speeches<span class="sc">$</span>sotu_text, </span>
<span id="cb521-2"><a href="#cb521-2" aria-hidden="true" tabindex="-1"></a>                               <span class="st">&quot;terror|war|military|drone&quot;</span>)</span>
<span id="cb521-3"><a href="#cb521-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sort</span>(<span class="fu">tapply</span>(speeches<span class="sc">$</span>warcount, speeches<span class="sc">$</span>president, sum), <span class="at">decreasing=</span>T)[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span></code></pre></div>
<pre><code>##        Harry S Truman    Theodore Roosevelt Franklin D. Roosevelt 
##                   554                   481                   441 
##         James K. Polk          Jimmy Carter  Dwight D. Eisenhower 
##                   390                   348                   332 
##      William McKinley        George W. Bush      Grover Cleveland 
##                   324                   323                   257 
##      Ulysses S. Grant 
##                   233</code></pre>
<p>What are possible limitations of this analysis?</p>
</div>
</div>
<div id="application-programming-interfaces" class="section level2" number="11.6">
<h2><span class="header-section-number">11.6</span> Application Programming Interfaces</h2>
<p>Application programming interfaces (APIs) are tools that allow you to search a large database to extract specific types of information. Social scientists often work with APIs to extract data from social media platforms, government agencies (e.g., U.S. Census), and news sites, among others.</p>
<p>Organizations that develop these APIs can control what types of information researchers can access. Often, they set limits on the types and quantities of information someone can collect. Companies also often monitor who accesses the information by requiring people to sign up for access, apply for access, and/or pay for access.</p>
<p><strong><em>Example: Census API</em></strong>
As an example of an API, the U.S. Census has an API that allows researchers to extract nicely formatted data summaries of different geographic units (e.g., all zip codes in the U.S.).</p>
<ul>
<li>Researchers can sign up <a href="https://api.census.gov/data/key_signup.html">here</a> for an API “key” which allows the organization to monitor who is accessing what information.</li>
</ul>
<p>Researchers Kyle Walker and Matt Herman have made an R package that makes working with the API easier.</p>
<ul>
<li>Example: <code>tidycensus</code> found <a href="https://walker-data.com/tidycensus/articles/basic-usage.html">here</a> allows you to search Census data by providing the variables you want to extract</li>
</ul>
<p><img src="images/tidycensus.png" style="width:45.0%" /></p>
<p>APIs can make a social scientist’s life easier by providing an efficient way to collect data. Without an API, researchers might have to resort to manually extracting information from online or writing an ad hoc set of code to “scrape” the information off of websites. This can be time consuming, against an organization or company’s policy, or even impossible in some cases. APIs are powerful and efficient.</p>
<p>However, because researchers cannot control the API, the downside is at any given time, an organization could change or remove API access. Researchers might also not have the full details of what information is included in the API, potentially leading to biased conclusions from the data. APIs are great, but we should use them with caution.</p>
<p><strong><em>Because the APIs require you to sign up for access (giving away your information), this course will not require that you gain access or use the APIs</em></strong></p>
<div id="twitter-api-v1" class="section level3" number="11.6.1">
<h3><span class="header-section-number">11.6.1</span> Twitter API v1</h3>
<p>Let’s try an example working with a Twitter API. To use this version of the Twitter API with R, you need</p>
<ol style="list-style-type: decimal">
<li>To create a Twitter account (you don’t need to tweet from the account, just need an account)</li>
<li>An internet connection</li>
<li>To install the <code>rtweet</code> package</li>
</ol>
<div class="sourceCode" id="cb523"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb523-1"><a href="#cb523-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;rtweet&quot;</span>)</span></code></pre></div>
<p>Let’s open the package</p>
<div class="sourceCode" id="cb524"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb524-1"><a href="#cb524-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rtweet)</span></code></pre></div>
<p>The API sets guidelines about what and how much information a person can collect from Twitter over a particular duration of time. With the version of the API we are working with, we can collect a few thousand of the most recent tweets of any public user and search recent tweets (past few days) on Twitter that include keywords.</p>
<ul>
<li>Twitter has other versions of the API that academic researchers can apply to for broader access, including access to older tweets (e.g., if you wanted to study tweets during the 2020 election). Researchers have developed a separate R package for working with this broader API.</li>
</ul>
<div id="searching-tweets-for-keywords." class="section level4" number="11.6.1.1">
<h4><span class="header-section-number">11.6.1.1</span> Searching tweets for keywords.</h4>
<p>The first time you use a function from <code>rtweet</code>, R will prompt you to authenticate and authorize an “app” through your Twitter account. Essentially, a web browser on your computer should automatically open to a Twitter landing page asking you to hit the “authorize” button. Once you do this, then you should be able to return to R and work with the R functions. (This is why you need a Twitter account and an internet connection to work with this package.)</p>
<p>We can use the <code>search_tweets</code> function to search recent tweets that contain keywords. We can specify the number of tweets to extract with the <code>n</code> argument. We can also filter tweets with additional arguments, such as by limiting tweets to English tweets or omitting retweets.</p>
<div class="sourceCode" id="cb525"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb525-1"><a href="#cb525-1" aria-hidden="true" tabindex="-1"></a><span class="do">## simple keyword search</span></span>
<span id="cb525-2"><a href="#cb525-2" aria-hidden="true" tabindex="-1"></a>taylortweets <span class="ot">&lt;-</span><span class="fu">search_tweets</span>(<span class="st">&quot;taylorsversion&quot;</span>, <span class="at">n=</span><span class="dv">1000</span>)</span>
<span id="cb525-3"><a href="#cb525-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb525-4"><a href="#cb525-4" aria-hidden="true" tabindex="-1"></a><span class="do">## use &#39; &#39; to search for exact phrase</span></span>
<span id="cb525-5"><a href="#cb525-5" aria-hidden="true" tabindex="-1"></a>simmonstweets <span class="ot">&lt;-</span><span class="fu">search_tweets</span>(<span class="st">&#39;&quot;ben simmons&quot;&#39;</span>, <span class="at">n=</span><span class="dv">1000</span>)</span>
<span id="cb525-6"><a href="#cb525-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb525-7"><a href="#cb525-7" aria-hidden="true" tabindex="-1"></a><span class="do">## use OR between words to search for tweets with at least one of the key words</span></span>
<span id="cb525-8"><a href="#cb525-8" aria-hidden="true" tabindex="-1"></a>f1tweets <span class="ot">&lt;-</span> <span class="fu">search_tweets</span>(<span class="st">&#39;&quot;daniel ricciardo&quot; OR &quot;lando norris&quot;&#39;</span>, <span class="at">n=</span><span class="dv">500</span>)</span>
<span id="cb525-9"><a href="#cb525-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb525-10"><a href="#cb525-10" aria-hidden="true" tabindex="-1"></a><span class="do">## just keep a space between words, no extra quotes to search for tweets that include both words somewhere</span></span>
<span id="cb525-11"><a href="#cb525-11" aria-hidden="true" tabindex="-1"></a>bachtweets <span class="ot">&lt;-</span> <span class="fu">search_tweets</span>(<span class="st">&quot;bachelorette michelle&quot;</span>, <span class="at">n=</span><span class="dv">400</span>)</span>
<span id="cb525-12"><a href="#cb525-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb525-13"><a href="#cb525-13" aria-hidden="true" tabindex="-1"></a><span class="do">## limit tweets to include only english tweets</span></span>
<span id="cb525-14"><a href="#cb525-14" aria-hidden="true" tabindex="-1"></a>coronatweets <span class="ot">&lt;-</span> <span class="fu">search_tweets</span>(<span class="st">&quot;coronavirus OR COVID&quot;</span>, <span class="at">n=</span><span class="dv">200</span>, <span class="at">lang =</span> <span class="st">&quot;en&quot;</span>)</span>
<span id="cb525-15"><a href="#cb525-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb525-16"><a href="#cb525-16" aria-hidden="true" tabindex="-1"></a><span class="do">## omit retweets, may affect total n extracted</span></span>
<span id="cb525-17"><a href="#cb525-17" aria-hidden="true" tabindex="-1"></a>rittenhousetweets <span class="ot">&lt;-</span> <span class="fu">search_tweets</span>(<span class="st">&quot;rittenhouse&quot;</span>, <span class="at">n=</span><span class="dv">200</span>, <span class="at">include_rts =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p>The resulting object we created with the first search, <code>taylortweets</code>, is a dataframe and includes the 1000 tweets we requested to extract along with 90 variables of information about those tweets. A few notable variables:</p>
<ul>
<li><code>screen_name</code>: the screen name of the twitter user</li>
<li><code>text</code>: the text of the tweet</li>
<li><code>is_retweet</code>: an indiactor TRUE or FALSE indicating if the tweet was a retweet</li>
<li><code>favorite_count</code>: the number of times the tweet was favorited (liked)</li>
<li><code>followers_count</code>: number of followers the user has</li>
<li><code>friends_count</code>: number of users that the tweeter follows</li>
<li><code>statuses_count</code>: the number of tweets from the user</li>
<li><code>verified</code>: an indicator TRUE or FALSE indicating if the user is verified</li>
<li><code>lang</code>: language of the tweet</li>
</ul>
</div>
<div id="extracting-user-timeline" class="section level4" number="11.6.1.2">
<h4><span class="header-section-number">11.6.1.2</span> Extracting user timeline</h4>
<p>Here is an example of extracting tweets from a particular user. You cane extract up to 3200 recent tweets of a specified public user. If you try to extract tweets from several users at once, you might hit a “rate limit” indicating that you requested more information than allowed over a particular period of time.</p>
<div class="sourceCode" id="cb526"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb526-1"><a href="#cb526-1" aria-hidden="true" tabindex="-1"></a><span class="do">## extracting tweets from potus</span></span>
<span id="cb526-2"><a href="#cb526-2" aria-hidden="true" tabindex="-1"></a>bidentweets <span class="ot">&lt;-</span> <span class="fu">get_timeline</span>(<span class="st">&quot;potus&quot;</span>, <span class="at">n=</span><span class="dv">3200</span>)</span>
<span id="cb526-3"><a href="#cb526-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb526-4"><a href="#cb526-4" aria-hidden="true" tabindex="-1"></a><span class="do">## extracting tweets from potus</span></span>
<span id="cb526-5"><a href="#cb526-5" aria-hidden="true" tabindex="-1"></a>polleaders <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;potus&quot;</span>, <span class="st">&quot;vp&quot;</span>)</span>
<span id="cb526-6"><a href="#cb526-6" aria-hidden="true" tabindex="-1"></a>poltweets <span class="ot">&lt;-</span> <span class="fu">get_timeline</span>(polleaders, <span class="at">n=</span><span class="dv">3200</span>)</span></code></pre></div>
<p>Similar to the keyword tweets, the object created will provide the text of the tweets and information about the reactions to the tweets.</p>
</div>
</div>
<div id="saving-r-objects" class="section level3" number="11.6.2">
<h3><span class="header-section-number">11.6.2</span> Saving R Objects</h3>
<p>After you extract an tweets from online, you may want to save them as a hard data file on your computer. This way if you close RStudio, you can recover the tweets without needing to extract new tweets from Twitter.</p>
<p>R allows you to save any R object as an .RData file that can be opened with the <code>load()</code> command. This is discussed on pg. 24 of QSS <a href="https://assets.press.princeton.edu/chapters/s11025.pdf">Chapter 1</a>.</p>
<p>We can demonstrate this now by saving <code>taylortweets</code> as an RData object. It will automatically save to your working directory, but you can also add a subfolder or alternative file path.</p>
<div class="sourceCode" id="cb527"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb527-1"><a href="#cb527-1" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(taylortweets, <span class="at">file =</span> <span class="st">&quot;taylortweets.RData&quot;</span>)</span></code></pre></div>
<p>Prior to saving the file, you could consider limiting the number of variables you want to save if you didn’t want to store 90 variables. Example of keeping only 5 variables:</p>
<div class="sourceCode" id="cb528"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb528-1"><a href="#cb528-1" aria-hidden="true" tabindex="-1"></a>taylortweets <span class="ot">&lt;-</span> taylortweets[, <span class="fu">c</span>(<span class="st">&quot;user_id&quot;</span>, <span class="st">&quot;screen_name&quot;</span>, <span class="st">&quot;text&quot;</span>, <span class="st">&quot;created_at&quot;</span>, <span class="st">&quot;is_retweet&quot;</span>)]</span>
<span id="cb528-2"><a href="#cb528-2" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(taylortweets, <span class="at">file =</span> <span class="st">&quot;taylortweets.RData&quot;</span>)</span></code></pre></div>
<p>Then, you can load the file (if you happen to close R/RStudio, restart your computer, etc.) with the load command.</p>
<div class="sourceCode" id="cb529"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb529-1"><a href="#cb529-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">&quot;taylortweets.RData&quot;</span>)</span></code></pre></div>
</div>
</div>
<div id="application-sentiment-analysis" class="section level2" number="11.7">
<h2><span class="header-section-number">11.7</span> Application: Sentiment Analysis</h2>
<p>In this example we will conduct a sentiment analysis of tweets extracted through the Twitter API.</p>
<ul>
<li>You can use dataset provided on Canvas or extract your own tweets</li>
<li>To extract your own, you need a Twitter account and <code>rtweet</code> installed.</li>
</ul>
<p>Using tweets in political science?</p>
<p>Research on Twitter is actually pretty common in the social sciences, including political science. Part of the reason for this is the access Twitter provides via API, which makes it an easier platform to study.</p>
<p>Below are some examples of uses of Twitter data in social science research.</p>
<ul>
<li>Scholars are often interested in characterizing the tone, such as incivility or toxicity, in online political discussions.</li>
<li>They may also use Twitter as a mechanism to study interactions between the public and elected officials and other public figures, as well as studying how politicians use Twitter as a form of strategic communication.</li>
<li>Political communications scholars have studied the extent to which journalists use Twitter to interpret public opinion, as well as study how media can control and set the agenda of what people discuss on Twitter.</li>
</ul>
<p>When doing political science research on Twitter, we should be careful about how we generalize the results to other settings. There is some evidence from Bor and Peterson that those who demonstrate incivility in offline discussions carry that behavior to online settings, there are other ways that someone’s behavior on Twitter will not match their behavior in other settings or represent their underlying throughts or beliefs.</p>
<p><img src="images/polinciv.png" style="width:45.0%" /> <img src="images/brevity.png" style="width:45.0%" /></p>
<p><img src="images/hatedisc.png" style="width:45.0%" /> <img src="images/poljourn.png" style="width:45.0%" /></p>
<p><img src="images/borpet.png" style="width:45.0%" /> <img src="images/attention.png" style="width:45.0%" /></p>
<p><em>For a video explainer of the code in this section, see below. (Via youtube, you can speed up the playback to 1.5 or 2x speed.)</em></p>
<div class="vembedr">
<div>
<iframe src="https://www.youtube.com/embed/XYc82CFjDWU" width="533" height="300" frameborder="0" allowfullscreen=""></iframe>
</div>
</div>
<p>For this example, we need the <code>rtweet</code> and <code>syuzhet</code> packages.</p>
<div class="sourceCode" id="cb530"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb530-1"><a href="#cb530-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;rtweet&quot;</span>) <span class="co"># for extracting tweets</span></span>
<span id="cb530-2"><a href="#cb530-2" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;syuzhet&quot;</span>) <span class="co"># for late sentiment analysis</span></span></code></pre></div>
<p>In R, we open the packages with <code>library()</code>.</p>
<div class="sourceCode" id="cb531"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb531-1"><a href="#cb531-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rtweet)</span>
<span id="cb531-2"><a href="#cb531-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(syuzhet)</span></code></pre></div>
<div id="searching-tweets-for-keywords" class="section level3" number="11.7.1">
<h3><span class="header-section-number">11.7.1</span> Searching tweets for keywords</h3>
<p>We will first <code>search</code> recent tweets for keywords. The first time you use the package, it will open up an authentication browser asking you to “authorize” the Twitter app. This is giving you access to the API.</p>
<ul>
<li>See the details above in the course notes for the syntax of this function.</li>
</ul>
<div class="sourceCode" id="cb532"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb532-1"><a href="#cb532-1" aria-hidden="true" tabindex="-1"></a>politicstweets <span class="ot">&lt;-</span> <span class="fu">search_tweets</span>(<span class="st">&quot;political OR partisan&quot;</span>, <span class="at">n=</span><span class="dv">2000</span>)</span>
<span id="cb532-2"><a href="#cb532-2" aria-hidden="true" tabindex="-1"></a>thanksgivingtweets <span class="ot">&lt;-</span> <span class="fu">search_tweets</span>(<span class="st">&quot;thanksgiving&quot;</span>, <span class="at">n=</span><span class="dv">2000</span>)</span></code></pre></div>
<p>After you create the tweets, you can save them as an RData file on your computer so that you don’t lose them when you close R.</p>
<div class="sourceCode" id="cb533"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb533-1"><a href="#cb533-1" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(politicstweets, <span class="at">file=</span><span class="st">&quot;politicstweets.RData&quot;</span>)</span>
<span id="cb533-2"><a href="#cb533-2" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(thanksgivingtweets, <span class="at">file=</span><span class="st">&quot;thanksgivingtweets.RData&quot;</span>)</span></code></pre></div>
<p>These can then be loaded back into R at anytime.</p>
<div class="sourceCode" id="cb534"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb534-1"><a href="#cb534-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">&quot;data/politicstweets.RData&quot;</span>)</span>
<span id="cb534-2"><a href="#cb534-2" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">&quot;data/thanksgivingtweets.RData&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb535"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb535-1"><a href="#cb535-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">&quot;politicstweets.RData&quot;</span>)</span>
<span id="cb535-2"><a href="#cb535-2" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">&quot;thanksgivingtweets.RData&quot;</span>)</span></code></pre></div>
</div>
<div id="sentiment-analysis-overview" class="section level3" number="11.7.2">
<h3><span class="header-section-number">11.7.2</span> Sentiment Analysis Overview</h3>
<p>Oftentimes, beyond characterizing the length or topic of a set of text, we might want to know the tone of the text. There are many ways to measure tone or “sentiment.” One approach extends what we did with dictionary analysis.</p>
<ul>
<li>Researchers have developed dictionaries of words that are typically associated with positive or negative sentiment. We will use the <code>bing</code> dictionary.</li>
<li>Sometimes, researchers go so far as to create dictionaries for discrete emotions (e.g., happiness) or other types of measures, such as toxicity levels or hate speech.</li>
<li>Using these pre-existing dictionaries, we can then count how many words in a body of text have positive vs. negative tone to summarize the sentiment of a document.</li>
</ul>
<p>Like any dictionary analysis, there are limitations to this “bag of words” approach– looking at the words individually without considering the context in which they are mentioned.</p>
</div>
<div id="implementing-sentiment-analysis" class="section level3" number="11.7.3">
<h3><span class="header-section-number">11.7.3</span> Implementing sentiment analysis</h3>
<p>The <code>get_sentiment()</code> function will calculate the net positive - negative score of a piece of text according to a specified dictionary. We can store this as a new variable.</p>
<div class="sourceCode" id="cb536"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb536-1"><a href="#cb536-1" aria-hidden="true" tabindex="-1"></a>politicstweets<span class="sc">$</span>sentiment <span class="ot">&lt;-</span> <span class="fu">get_sentiment</span>(politicstweets<span class="sc">$</span>text, </span>
<span id="cb536-2"><a href="#cb536-2" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">method=</span><span class="st">&quot;bing&quot;</span>)</span>
<span id="cb536-3"><a href="#cb536-3" aria-hidden="true" tabindex="-1"></a>thanksgivingtweets<span class="sc">$</span>sentiment <span class="ot">&lt;-</span> <span class="fu">get_sentiment</span>(thanksgivingtweets<span class="sc">$</span>text, </span>
<span id="cb536-4"><a href="#cb536-4" aria-hidden="true" tabindex="-1"></a>                                              <span class="at">method=</span><span class="st">&quot;bing&quot;</span>)</span>
<span id="cb536-5"><a href="#cb536-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb536-6"><a href="#cb536-6" aria-hidden="true" tabindex="-1"></a><span class="do">## Example output</span></span>
<span id="cb536-7"><a href="#cb536-7" aria-hidden="true" tabindex="-1"></a>politicstweets<span class="sc">$</span>sentiment[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span></code></pre></div>
<pre><code>##  [1] -2 -3  4  1 -7 -2 -3 -3 -4  0</code></pre>
<p>Let’s compare the sentiment of these sets of tweets to help answer the question: Should we talk about politics at Thanksgiving dinner?</p>
<p>We add a plotting concept: Plotting multiple plots.</p>
<div class="sourceCode" id="cb538"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb538-1"><a href="#cb538-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Set par</span></span>
<span id="cb538-2"><a href="#cb538-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>)) <span class="co"># 1 row with 2 plots</span></span>
<span id="cb538-3"><a href="#cb538-3" aria-hidden="true" tabindex="-1"></a><span class="do">## Plot just the first object</span></span>
<span id="cb538-4"><a href="#cb538-4" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(politicstweets<span class="sc">$</span>sentiment, </span>
<span id="cb538-5"><a href="#cb538-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">&quot;Sentiment (bing score)&quot;</span>,</span>
<span id="cb538-6"><a href="#cb538-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="st">&quot;Sentiment Scores for Politics Tweets&quot;</span>,</span>
<span id="cb538-7"><a href="#cb538-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">cex.main=</span>.<span class="dv">7</span>,</span>
<span id="cb538-8"><a href="#cb538-8" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">800</span>),</span>
<span id="cb538-9"><a href="#cb538-9" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">8</span>, <span class="dv">8</span>),</span>
<span id="cb538-10"><a href="#cb538-10" aria-hidden="true" tabindex="-1"></a>     <span class="at">border=</span> F)</span>
<span id="cb538-11"><a href="#cb538-11" aria-hidden="true" tabindex="-1"></a><span class="do">## Add lines for the mean sentiment</span></span>
<span id="cb538-12"><a href="#cb538-12" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span><span class="fu">mean</span>(politicstweets<span class="sc">$</span>sentiment), <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb538-13"><a href="#cb538-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb538-14"><a href="#cb538-14" aria-hidden="true" tabindex="-1"></a><span class="do">## Second plot</span></span>
<span id="cb538-15"><a href="#cb538-15" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(thanksgivingtweets<span class="sc">$</span>sentiment, </span>
<span id="cb538-16"><a href="#cb538-16" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">&quot;Sentiment (bing score)&quot;</span>,</span>
<span id="cb538-17"><a href="#cb538-17" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="st">&quot;Sentiment Scores for Thanksgiving Tweets&quot;</span>,</span>
<span id="cb538-18"><a href="#cb538-18" aria-hidden="true" tabindex="-1"></a>     <span class="at">cex.main =</span> .<span class="dv">7</span>, <span class="at">col=</span><span class="st">&quot;pink&quot;</span>,</span>
<span id="cb538-19"><a href="#cb538-19" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">800</span>),</span>
<span id="cb538-20"><a href="#cb538-20" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">8</span>, <span class="dv">8</span>),</span>
<span id="cb538-21"><a href="#cb538-21" aria-hidden="true" tabindex="-1"></a>     <span class="at">border=</span> F)</span>
<span id="cb538-22"><a href="#cb538-22" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span><span class="fu">mean</span>(thanksgivingtweets<span class="sc">$</span>sentiment), <span class="at">lwd=</span><span class="dv">2</span>)</span></code></pre></div>
<p><img src="datasciforpolisci_files/figure-html/unnamed-chunk-325-1.svg" width="672" /></p>
</div>
<div id="your-twitter-analysis" class="section level3" number="11.7.4">
<h3><span class="header-section-number">11.7.4</span> Your Twitter Analysis</h3>
<p>As mentioned above We can also search the most recent 3200 tweets of a given user.</p>
<p>Here we extract tweets from AOC’s Twitter account</p>
<div class="sourceCode" id="cb539"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb539-1"><a href="#cb539-1" aria-hidden="true" tabindex="-1"></a>aoctweets <span class="ot">&lt;-</span> <span class="fu">get_timeline</span>(<span class="st">&quot;aoc&quot;</span>, <span class="at">n=</span><span class="dv">3200</span>)</span></code></pre></div>
<p>As a challenge, conduct your own analysis of the congresswoman’s tweets. It could be a sentiment analysis, or you could use one or more tools from the previous sections on text analysis.</p>
<!--chapter:end:11-TextasData.Rmd-->
</div>
</div>
</div>
<div id="maps" class="section level1" number="12">
<h1><span class="header-section-number">12</span> Mapping</h1>
<p>In this section, we continue with the goal of discovery, this time using maps to visualize data.</p>
<ul>
<li><strong>Describe</strong> and measure
<ul>
<li>Has the U.S. population increased?</li>
</ul></li>
<li><strong>Explain</strong>, evaluate, and recommend (study of causation)
<ul>
<li>Does expanding Medicaid improve health outcomes?</li>
</ul></li>
<li><strong>Predict</strong>
<ul>
<li>Who will win the next election?</li>
</ul></li>
<li><strong>Discover</strong>
<ul>
<li>How do policies diffuse across states?</li>
</ul></li>
</ul>
<p>Our goals</p>
<ul>
<li>Visually communicate social science information using maps</li>
<li>Learn how to use the <code>library(maps)</code> package with <code>library(ggplot)</code> (QSS 5.3.2)
<ul>
<li>Our code also builds on Kieran Healy’s <a href="https://socviz.co/maps.html#maps">book</a> and the tidyverse version of QSS from Jeffrey Arnold <a href="https://jrnold.github.io/qss-tidy/discovery.html">here</a></li>
</ul></li>
<li>Discover patterns in our spatial world!!</li>
</ul>
<p>Along the way, we will learn to merge data and use the <code>%in%</code> function.</p>
<div id="why-maps" class="section level2" number="12.1">
<h2><span class="header-section-number">12.1</span> Why maps</h2>
<p>How might maps be useful for political scientists? What are examples of questions maps can help answer?</p>
<p>“The visualization of spatial data through maps enables researchers to discover previously unknown patterns and present their findings in a convincing manner.” - Kosuke Imai, Chap 5 QSS</p>
<p><img src="images/snowmap.jpeg" style="width:70.0%" /></p>
<p><em>National Geographic. Mapping fatal cholera cases helped John Snow uncover the source of a cholera outbreak in London to an infected water pump in 1854.</em></p>
<p>Why are maps used in political science</p>
<ul>
<li>Show diffusion of a disease, policies, political power</li>
<li>Show demographic patterns</li>
<li>Examine clustering, regional patterns of different policies, events, etc.</li>
<li>Shift analysis away from an individual person or political unit to instead think about the broader social and political context</li>
<li>Convey a lot of information efficiently, and in an engaging way, using intuitive heuristics of commonly known geographic locations</li>
</ul>
<p>Most maps are also inherently political! (e.g., historical trends in political boundaries, which geographic entities are recognized, etc.)</p>
<p>Maps themselves may be the subject of interest. For example, we are currently in redistricting to determine the boundaries used for different elections in the U.S.</p>
<div class="figure">
<img src="images/gerrym.png" style="width:70.0%" alt="" />
<p class="caption">Washington Post</p>
</div>
<div id="to-map-or-not-to-map" class="section level3" number="12.1.1">
<h3><span class="header-section-number">12.1.1</span> To map or not to map?</h3>
<p>If I wanted to track COVID vaccinations by state, what are the pros and cons of using a table vs. a map? See this example from the Mayo Clinic.</p>
<p><img src="images/covidvaccmap.png" style="width:40.0%" /> <img src="images/covidvacctab.png" style="width:40.0%" /></p>
<p>Can maps be misleading? See this discussion from Kieran Healy in <a href="https://socviz.co/maps.html#maps">Chap. 7</a>: Each of these maps shows data for the same event, but the impressions they convey are very different … Often, a map is like a weird grid that you are forced to conform to even though you know it systematically misrepresents what you want to show.”</p>
<div class="figure">
<img src="images/healymap.png" style="width:70.0%" alt="" />
<p class="caption">Healy Chapter 7</p>
</div>
</div>
</div>
<div id="mapping-in-r" class="section level2" number="12.2">
<h2><span class="header-section-number">12.2</span> Mapping in R</h2>
<p>Install maps package. You only need to do this one time.</p>
<div class="sourceCode" id="cb540"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb540-1"><a href="#cb540-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;maps&quot;</span>)</span></code></pre></div>
<p>All subsequent times, you just need to use <code>library()</code></p>
<div class="sourceCode" id="cb541"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb541-1"><a href="#cb541-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(maps)</span></code></pre></div>
<p>The map command is like a plot. It maps a particular entry from a database. Below are a few examples of types of maps that come readymade in the package.</p>
<div class="sourceCode" id="cb542"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb542-1"><a href="#cb542-1" aria-hidden="true" tabindex="-1"></a><span class="fu">map</span>(<span class="at">database =</span> <span class="st">&quot;world&quot;</span>)</span></code></pre></div>
<p><img src="datasciforpolisci_files/figure-html/unnamed-chunk-329-1.svg" width="672" /></p>
<div class="sourceCode" id="cb543"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb543-1"><a href="#cb543-1" aria-hidden="true" tabindex="-1"></a><span class="fu">map</span>(<span class="at">database =</span> <span class="st">&quot;usa&quot;</span>)</span></code></pre></div>
<p><img src="datasciforpolisci_files/figure-html/unnamed-chunk-330-1.svg" width="672" /></p>
<div class="sourceCode" id="cb544"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb544-1"><a href="#cb544-1" aria-hidden="true" tabindex="-1"></a><span class="fu">map</span>(<span class="at">database =</span> <span class="st">&quot;state&quot;</span>)</span></code></pre></div>
<p><img src="datasciforpolisci_files/figure-html/unnamed-chunk-331-1.svg" width="672" /></p>
<div class="sourceCode" id="cb545"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb545-1"><a href="#cb545-1" aria-hidden="true" tabindex="-1"></a><span class="fu">map</span>(<span class="at">database=</span><span class="st">&quot;county&quot;</span>)</span></code></pre></div>
<p><img src="datasciforpolisci_files/figure-html/unnamed-chunk-332-1.svg" width="672" /></p>
<p>You can also map particular regions within a database.</p>
<div class="sourceCode" id="cb546"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb546-1"><a href="#cb546-1" aria-hidden="true" tabindex="-1"></a><span class="fu">map</span>(<span class="at">database =</span> <span class="st">&quot;state&quot;</span>, <span class="at">regions=</span> <span class="fu">c</span>(<span class="st">&quot;New Jersey&quot;</span>, <span class="st">&quot;New York&quot;</span> ))</span></code></pre></div>
<p><img src="datasciforpolisci_files/figure-html/unnamed-chunk-333-1.svg" width="672" /></p>
<div class="sourceCode" id="cb547"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb547-1"><a href="#cb547-1" aria-hidden="true" tabindex="-1"></a><span class="fu">map</span>(<span class="at">database=</span><span class="st">&quot;county&quot;</span>, <span class="at">regions =</span> <span class="st">&quot;Nebraska&quot;</span>)</span></code></pre></div>
<p><img src="datasciforpolisci_files/figure-html/unnamed-chunk-334-1.svg" width="672" /></p>
<div class="sourceCode" id="cb548"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb548-1"><a href="#cb548-1" aria-hidden="true" tabindex="-1"></a><span class="fu">map</span>(<span class="at">database =</span> <span class="st">&quot;world&quot;</span>, <span class="at">regions=</span> <span class="st">&quot;Italy&quot;</span>)</span></code></pre></div>
<p><img src="datasciforpolisci_files/figure-html/unnamed-chunk-335-1.svg" width="672" /></p>
<div id="using-ggplot2-with-maps" class="section level3" number="12.2.1">
<h3><span class="header-section-number">12.2.1</span> Using ggplot2 with maps</h3>
<p>We may want to embed <code>map</code> in another plotting device that more easily adds informative labels, colors, and other information.</p>
<ul>
<li>While the plotting tools we have worked with before can do this, the function <code>ggplot</code> has a better interface that will more easily help us avoid mistakes, such as putting a label in the wrong place.</li>
</ul>
<div class="sourceCode" id="cb549"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb549-1"><a href="#cb549-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;ggplot2&quot;</span>)</span></code></pre></div>
<p>Open the packages each time you want to use them.</p>
<div class="sourceCode" id="cb550"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb550-1"><a href="#cb550-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span></code></pre></div>
<p>The “gg” stands for “grammar of graphics.” The <code>ggplot2</code> package has a very general function <code>ggplot()</code> that provides another system of visualizing data in R.</p>
<ul>
<li>It can be used to plot all kinds of visuals, including scatterplots, barplots, histograms, etc.</li>
<li>We are going to focus on its utility for plotting maps, as many new developments in mapping and GIS (geographic information systems) in R use this interface.</li>
<li>In <code>ggplot()</code> you add layers to a plot by using <code>+</code> between lines</li>
<li>While <code>ggplot()</code> can be applied very widely, we will focus on a more narrow set of applications for mapping.</li>
</ul>
<p>We will create a map of New Jersey. Similar to before, we will first use a function to pull up map data about U.S. states. The <code>map_data</code> function pulls up just the data instead of making the map itself.</p>
<div class="sourceCode" id="cb551"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb551-1"><a href="#cb551-1" aria-hidden="true" tabindex="-1"></a>nj_map <span class="ot">&lt;-</span> <span class="fu">map_data</span>(<span class="st">&quot;state&quot;</span>,<span class="at">regions=</span> <span class="fu">c</span>(<span class="st">&quot;New Jersey&quot;</span>))</span></code></pre></div>
<p>We also directly integrate the data into the plotting function</p>
<div class="sourceCode" id="cb552"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb552-1"><a href="#cb552-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Begin plot</span></span>
<span id="cb552-2"><a href="#cb552-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> <span class="co">#Note the use of the + sign between each line</span></span>
<span id="cb552-3"><a href="#cb552-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb552-4"><a href="#cb552-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_polygon</span>(nj_map, <span class="at">mapping=</span><span class="fu">aes</span>(<span class="at">x=</span>long, <span class="at">y=</span>lat, <span class="at">group=</span>group), </span>
<span id="cb552-5"><a href="#cb552-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">colour=</span><span class="st">&quot;black&quot;</span>)<span class="sc">+</span></span>
<span id="cb552-6"><a href="#cb552-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb552-7"><a href="#cb552-7" aria-hidden="true" tabindex="-1"></a>  <span class="do">## add title</span></span>
<span id="cb552-8"><a href="#cb552-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Map of New Jersey&quot;</span>)<span class="sc">+</span></span>
<span id="cb552-9"><a href="#cb552-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb552-10"><a href="#cb552-10" aria-hidden="true" tabindex="-1"></a>  <span class="do">## adjust projection</span></span>
<span id="cb552-11"><a href="#cb552-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_quickmap</span>() <span class="sc">+</span></span>
<span id="cb552-12"><a href="#cb552-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb552-13"><a href="#cb552-13" aria-hidden="true" tabindex="-1"></a>  <span class="do">## remove background</span></span>
<span id="cb552-14"><a href="#cb552-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="co"># note: last line does not end with a +</span></span></code></pre></div>
<p><img src="datasciforpolisci_files/figure-html/unnamed-chunk-339-1.svg" width="672" /></p>
</div>
</div>
<div id="choropleth-maps" class="section level2" number="12.3">
<h2><span class="header-section-number">12.3</span> Choropleth Maps</h2>
<p>Sometimes maps use shading of polygons to display quantitative information about a geographic unit or qualitative information about what geographical units belong to different categories of a variable. We provide an example of this here.</p>
<ul>
<li>We are going to add a variable to our mapping data that we want to visualize</li>
<li>We <code>fill</code> the plot using <code>geom_polygon</code> and can (optionally) indicate specific colors</li>
</ul>
<div class="sourceCode" id="cb553"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb553-1"><a href="#cb553-1" aria-hidden="true" tabindex="-1"></a>usmap <span class="ot">&lt;-</span> <span class="fu">map_data</span>(<span class="st">&quot;state&quot;</span>)</span>
<span id="cb553-2"><a href="#cb553-2" aria-hidden="true" tabindex="-1"></a>usmap<span class="sc">$</span>nj <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(usmap<span class="sc">$</span>region <span class="sc">==</span> <span class="st">&quot;new jersey&quot;</span>, <span class="st">&quot;Cannot turn left&quot;</span>, </span>
<span id="cb553-3"><a href="#cb553-3" aria-hidden="true" tabindex="-1"></a>                   <span class="st">&quot;Can turn left&quot;</span>)</span>
<span id="cb553-4"><a href="#cb553-4" aria-hidden="true" tabindex="-1"></a>usmap<span class="sc">$</span>nj <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(usmap<span class="sc">$</span>nj)</span>
<span id="cb553-5"><a href="#cb553-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb553-6"><a href="#cb553-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb553-7"><a href="#cb553-7" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Note the fill= nj</span></span>
<span id="cb553-8"><a href="#cb553-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_polygon</span>(<span class="at">data=</span>usmap, <span class="fu">aes</span>(<span class="at">x=</span>long, <span class="at">y=</span>lat, <span class="at">group=</span>group, <span class="at">fill=</span>nj))<span class="sc">+</span></span>
<span id="cb553-9"><a href="#cb553-9" aria-hidden="true" tabindex="-1"></a>  <span class="do">## we can indicate colors for each category of the nj variable</span></span>
<span id="cb553-10"><a href="#cb553-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;gray&quot;</span>, <span class="st">&quot;red3&quot;</span>), <span class="at">name=</span><span class="st">&quot;Left Turns&quot;</span>)<span class="sc">+</span></span>
<span id="cb553-11"><a href="#cb553-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb553-12"><a href="#cb553-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Geography of Left Turns&quot;</span>)<span class="sc">+</span></span>
<span id="cb553-13"><a href="#cb553-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_quickmap</span>()</span></code></pre></div>
<p><img src="datasciforpolisci_files/figure-html/unnamed-chunk-340-1.svg" width="672" /></p>
</div>
<div id="application-2021-nj-election-results" class="section level2" number="12.4">
<h2><span class="header-section-number">12.4</span> Application: 2021 NJ Election Results</h2>
<p>We sometimes get data from an outside source. We then need to figure out how to connect it to the mapping data.</p>
<div class="sourceCode" id="cb554"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb554-1"><a href="#cb554-1" aria-hidden="true" tabindex="-1"></a>njcounties <span class="ot">&lt;-</span> <span class="fu">map_data</span>(<span class="st">&quot;county&quot;</span>, <span class="at">region=</span><span class="st">&quot;New Jersey&quot;</span>)</span>
<span id="cb554-2"><a href="#cb554-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb554-3"><a href="#cb554-3" aria-hidden="true" tabindex="-1"></a><span class="do">## 2021 county election results</span></span>
<span id="cb554-4"><a href="#cb554-4" aria-hidden="true" tabindex="-1"></a>murphyvote <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">county =</span> <span class="fu">unique</span>(njcounties<span class="sc">$</span>subregion),</span>
<span id="cb554-5"><a href="#cb554-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">murphy =</span> <span class="fu">c</span>(<span class="fl">43.92</span>, <span class="fl">52.52</span>, <span class="fl">53.28</span>, <span class="fl">61.69</span>, <span class="fl">36.69</span>, <span class="fl">43.64</span>, </span>
<span id="cb554-6"><a href="#cb554-6" aria-hidden="true" tabindex="-1"></a>                      <span class="fl">73.96</span>, <span class="fl">44.63</span>, <span class="fl">73.56</span>, <span class="fl">40.19</span>, <span class="fl">65.09</span>,</span>
<span id="cb554-7"><a href="#cb554-7" aria-hidden="true" tabindex="-1"></a>                      <span class="fl">55.74</span>, <span class="fl">40.31</span>, <span class="fl">44.06</span>, <span class="fl">31.79</span>, <span class="fl">51.47</span>, </span>
<span id="cb554-8"><a href="#cb554-8" aria-hidden="true" tabindex="-1"></a>                      <span class="fl">35.01</span>, <span class="fl">51.54</span>, <span class="fl">31.93</span>, <span class="fl">61.56</span>, <span class="fl">34.56</span>))</span></code></pre></div>
<p>We can use <code>merge()</code> to do so by indicating a shared unique identifier that the dataframes have in common. Note that <code>subregion</code> is the name of the county variable in the first dataframe (the x) and <code>county</code> is the name of the county variable in the second dataframe (the y). For this to work, we had to first make sure the county names are formatted exactly the same way in both dataframes. For example, R won’t known “camden” and “Camden” are the same. They have to <strong>exactly</strong> match for R to be able to properly join the data together. With messier data, you might have to rename some variable values prior to joining data in a merge, such as by changing the case of letters or adjusting punctuation, etc.</p>
<ul>
<li>For more information on merging, see QSS chapter 4.2.5 or this <a href="https://sejdemyr.github.io/r-tutorials/statistics/tutorial5.html">explainer</a>.</li>
</ul>
<div class="sourceCode" id="cb555"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb555-1"><a href="#cb555-1" aria-hidden="true" tabindex="-1"></a>njcounties <span class="ot">&lt;-</span> <span class="fu">merge</span>(njcounties, murphyvote, </span>
<span id="cb555-2"><a href="#cb555-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">by.x=</span><span class="st">&quot;subregion&quot;</span>, <span class="at">by.y =</span> <span class="st">&quot;county&quot;</span>, </span>
<span id="cb555-3"><a href="#cb555-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">all.x=</span><span class="cn">TRUE</span>, <span class="at">all.y=</span>F)</span></code></pre></div>
<p>Now that the data are merged, we can add Murphy’s vote share as a color.</p>
<div class="sourceCode" id="cb556"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb556-1"><a href="#cb556-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb556-2"><a href="#cb556-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb556-3"><a href="#cb556-3" aria-hidden="true" tabindex="-1"></a>  <span class="do">## create an nj county-level plot</span></span>
<span id="cb556-4"><a href="#cb556-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_polygon</span>(<span class="at">data=</span>njcounties, <span class="fu">aes</span>(<span class="at">x=</span>long, <span class="at">y=</span>lat, </span>
<span id="cb556-5"><a href="#cb556-5" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">group=</span>group, </span>
<span id="cb556-6"><a href="#cb556-6" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">fill=</span>murphy),</span>
<span id="cb556-7"><a href="#cb556-7" aria-hidden="true" tabindex="-1"></a>               <span class="at">colour=</span><span class="st">&quot;white&quot;</span>)<span class="sc">+</span></span>
<span id="cb556-8"><a href="#cb556-8" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Shade the map according to the vote share</span></span>
<span id="cb556-9"><a href="#cb556-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(<span class="at">name=</span><span class="st">&quot;Murphy&#39;s Vote Share %&quot;</span>, <span class="at">low=</span><span class="st">&quot;red&quot;</span>, <span class="at">high=</span><span class="st">&quot;blue&quot;</span>)<span class="sc">+</span></span>
<span id="cb556-10"><a href="#cb556-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb556-11"><a href="#cb556-11" aria-hidden="true" tabindex="-1"></a>  <span class="do">## remove background</span></span>
<span id="cb556-12"><a href="#cb556-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()<span class="sc">+</span></span>
<span id="cb556-13"><a href="#cb556-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb556-14"><a href="#cb556-14" aria-hidden="true" tabindex="-1"></a>  <span class="co">#borders(&quot;county&quot;, region=&quot;New Jersey&quot;, colour=&quot;white&quot;, size=1)+</span></span>
<span id="cb556-15"><a href="#cb556-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;2021 NJ Governor Results by County&quot;</span>)<span class="sc">+</span></span>
<span id="cb556-16"><a href="#cb556-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_quickmap</span>()</span></code></pre></div>
<p><img src="datasciforpolisci_files/figure-html/unnamed-chunk-343-1.svg" width="672" /></p>
</div>
<div id="application-voter-identification-laws" class="section level2" number="12.5">
<h2><span class="header-section-number">12.5</span> Application: Voter Identification Laws</h2>
<p>According to the NCSL, 35 states have laws requesting or requiring voters to show some form of identification at the polls.</p>
<ul>
<li>The presence of voter ID laws and the strictness of these laws has accelerated over the past decade.</li>
<li>We will look at the geography of these laws to see if there are regional or other political patterns to these</li>
</ul>
<div class="figure">
<img src="images/voteridc.png" style="width:65.0%" alt="" />
<p class="caption">NCSL</p>
</div>
<div id="using-the-in-function" class="section level3" number="12.5.1">
<h3><span class="header-section-number">12.5.1</span> Using the <code>%in%</code> function</h3>
<p>Detecting if something is contained within a vector: The function <code>%in%</code> asks: is this contained in the vector? Yes/No</p>
<div class="sourceCode" id="cb557"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb557-1"><a href="#cb557-1" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;new jersey&quot;</span> <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;new jersey&quot;</span>, <span class="st">&quot;california&quot;</span>, <span class="st">&quot;nebraska&quot;</span>)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb559"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb559-1"><a href="#cb559-1" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;florida&quot;</span> <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;new jersey&quot;</span>, <span class="st">&quot;california&quot;</span>, <span class="st">&quot;nebraska&quot;</span>)</span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<div class="sourceCode" id="cb561"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb561-1"><a href="#cb561-1" aria-hidden="true" tabindex="-1"></a>(<span class="sc">!</span> <span class="st">&quot;florida&quot;</span> <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;new jersey&quot;</span>, <span class="st">&quot;california&quot;</span>, <span class="st">&quot;nebraska&quot;</span>)) <span class="co"># not in</span></span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>We will augment our map data with a new variable that classifies states according to their voter ID laws.</p>
<div class="sourceCode" id="cb563"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb563-1"><a href="#cb563-1" aria-hidden="true" tabindex="-1"></a>usmap <span class="ot">&lt;-</span> <span class="fu">map_data</span>(<span class="st">&quot;state&quot;</span>)</span>
<span id="cb563-2"><a href="#cb563-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb563-3"><a href="#cb563-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(usmap)</span></code></pre></div>
<pre><code>##        long      lat group order  region subregion
## 1 -87.46201 30.38968     1     1 alabama      &lt;NA&gt;
## 2 -87.48493 30.37249     1     2 alabama      &lt;NA&gt;
## 3 -87.52503 30.37249     1     3 alabama      &lt;NA&gt;
## 4 -87.53076 30.33239     1     4 alabama      &lt;NA&gt;
## 5 -87.57087 30.32665     1     5 alabama      &lt;NA&gt;
## 6 -87.58806 30.32665     1     6 alabama      &lt;NA&gt;</code></pre>
<div class="sourceCode" id="cb565"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb565-1"><a href="#cb565-1" aria-hidden="true" tabindex="-1"></a><span class="do">## create variable as NA</span></span>
<span id="cb565-2"><a href="#cb565-2" aria-hidden="true" tabindex="-1"></a>usmap<span class="sc">$</span>photoidlaws <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb565-3"><a href="#cb565-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb565-4"><a href="#cb565-4" aria-hidden="true" tabindex="-1"></a><span class="do">## Fill in vaariable with state categories</span></span>
<span id="cb565-5"><a href="#cb565-5" aria-hidden="true" tabindex="-1"></a>usmap<span class="sc">$</span>photoidlaws[usmap<span class="sc">$</span>region <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;arkansas&quot;</span>,<span class="st">&quot;georgia&quot;</span>, <span class="st">&quot;indiana&quot;</span>, <span class="st">&quot;kansas&quot;</span>,<span class="st">&quot;mississippi&quot;</span>, <span class="st">&quot;tennessee&quot;</span>, <span class="st">&quot;wisconsin&quot;</span>)] <span class="ot">&lt;-</span> <span class="st">&quot;Strict Photo ID&quot;</span></span>
<span id="cb565-6"><a href="#cb565-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb565-7"><a href="#cb565-7" aria-hidden="true" tabindex="-1"></a>usmap<span class="sc">$</span>photoidlaws[usmap<span class="sc">$</span>region <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;alabama&quot;</span>, <span class="st">&quot;florida&quot;</span>, <span class="st">&quot;idaho&quot;</span>, <span class="st">&quot;louisiana&quot;</span>, </span>
<span id="cb565-8"><a href="#cb565-8" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">&quot;michigan&quot;</span>, <span class="st">&quot;montana&quot;</span>, <span class="st">&quot;rhode island&quot;</span>, <span class="st">&quot;south carolina&quot;</span>, </span>
<span id="cb565-9"><a href="#cb565-9" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">&quot;south dakota&quot;</span>, <span class="st">&quot;texas&quot;</span>)] <span class="ot">&lt;-</span> <span class="st">&quot;Non-Strict Photo ID&quot;</span></span>
<span id="cb565-10"><a href="#cb565-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb565-11"><a href="#cb565-11" aria-hidden="true" tabindex="-1"></a>usmap<span class="sc">$</span>photoidlaws[usmap<span class="sc">$</span>region <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;arizona&quot;</span>, <span class="st">&quot;north dakota&quot;</span>, </span>
<span id="cb565-12"><a href="#cb565-12" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">&quot;ohio&quot;</span>, <span class="st">&quot;wyoming&quot;</span>)]<span class="ot">&lt;-</span> <span class="st">&quot;Strict Non-Photo ID&quot;</span></span>
<span id="cb565-13"><a href="#cb565-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb565-14"><a href="#cb565-14" aria-hidden="true" tabindex="-1"></a>usmap<span class="sc">$</span>photoidlaws[usmap<span class="sc">$</span>region <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;alaska&quot;</span>, <span class="st">&quot;colorado&quot;</span>, <span class="st">&quot;connecticut&quot;</span>, </span>
<span id="cb565-15"><a href="#cb565-15" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">&quot;delaware&quot;</span>, <span class="st">&quot;hawaii&quot;</span>, <span class="st">&quot;iowa&quot;</span>, <span class="st">&quot;kentucky&quot;</span>, <span class="st">&quot;missouri&quot;</span>, </span>
<span id="cb565-16"><a href="#cb565-16" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">&quot;new hampshire&quot;</span>, <span class="st">&quot;oklahoma&quot;</span>, <span class="st">&quot;utah&quot;</span>, <span class="st">&quot;virginia&quot;</span>, </span>
<span id="cb565-17"><a href="#cb565-17" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">&quot;washington&quot;</span>, <span class="st">&quot;west virginia&quot;</span>)] <span class="ot">&lt;-</span> <span class="st">&quot;Non-Strict Non-Photo ID&quot;</span></span>
<span id="cb565-18"><a href="#cb565-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb565-19"><a href="#cb565-19" aria-hidden="true" tabindex="-1"></a>usmap<span class="sc">$</span>photoidlaws[usmap<span class="sc">$</span>region <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;oregon&quot;</span>, <span class="st">&quot;nevada&quot;</span>,<span class="st">&quot;california&quot;</span>, </span>
<span id="cb565-20"><a href="#cb565-20" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">&quot;new mexico&quot;</span>, <span class="st">&quot;nebraska&quot;</span>, <span class="st">&quot;minnesota&quot;</span>, </span>
<span id="cb565-21"><a href="#cb565-21" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">&quot;illinois&quot;</span>, <span class="st">&quot;north carolina&quot;</span>, <span class="st">&quot;pennsylvania&quot;</span>, </span>
<span id="cb565-22"><a href="#cb565-22" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">&quot;new york&quot;</span>, <span class="st">&quot;new jersey&quot;</span>, <span class="st">&quot;massachusetts&quot;</span>,</span>
<span id="cb565-23"><a href="#cb565-23" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">&quot;vermont&quot;</span>, <span class="st">&quot;maryland&quot;</span>, <span class="st">&quot;north carolina&quot;</span>, </span>
<span id="cb565-24"><a href="#cb565-24" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">&quot;district of columbia&quot;</span>, </span>
<span id="cb565-25"><a href="#cb565-25" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">&quot;maine&quot;</span>)] <span class="ot">&lt;-</span> <span class="st">&quot;No Document Required&quot;</span></span>
<span id="cb565-26"><a href="#cb565-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb565-27"><a href="#cb565-27" aria-hidden="true" tabindex="-1"></a><span class="do">## Make it a factor categorical variable</span></span>
<span id="cb565-28"><a href="#cb565-28" aria-hidden="true" tabindex="-1"></a>usmap<span class="sc">$</span>photoidlaws <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(usmap<span class="sc">$</span>photoidlaws)</span></code></pre></div>
<p>Let’s create a map of the U.S. We will then annotate the map with information about voter identification laws.</p>
<div class="sourceCode" id="cb566"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb566-1"><a href="#cb566-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb566-2"><a href="#cb566-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_polygon</span>(<span class="at">data=</span>usmap, <span class="fu">aes</span>(<span class="at">x=</span>long, <span class="at">y=</span>lat, <span class="at">group=</span>group, </span>
<span id="cb566-3"><a href="#cb566-3" aria-hidden="true" tabindex="-1"></a>                               <span class="at">fill=</span>photoidlaws),</span>
<span id="cb566-4"><a href="#cb566-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">colour=</span><span class="st">&quot;black&quot;</span>)<span class="sc">+</span></span>
<span id="cb566-5"><a href="#cb566-5" aria-hidden="true" tabindex="-1"></a>  <span class="do">## palette lets you pick a color scheme without specifics</span></span>
<span id="cb566-6"><a href="#cb566-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette=</span><span class="st">&quot;Greens&quot;</span>, <span class="at">name=</span><span class="st">&quot;Photo ID Laws&quot;</span>)<span class="sc">+</span></span>
<span id="cb566-7"><a href="#cb566-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb566-8"><a href="#cb566-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb566-9"><a href="#cb566-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Map of U.S. Voter ID Laws&quot;</span>)<span class="sc">+</span></span>
<span id="cb566-10"><a href="#cb566-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_quickmap</span>()</span></code></pre></div>
<p><img src="datasciforpolisci_files/figure-html/unnamed-chunk-346-1.svg" width="672" /></p>
</div>
</div>
<div id="your-turn-to-map" class="section level2" number="12.6">
<h2><span class="header-section-number">12.6</span> Your turn to map</h2>
<p>Make a choropleth plot of the United States or some other geographic unit.</p>
<ul>
<li>Create a map of a geographic area of interest (e.g., a map of U.S. states)</li>
<li>Shade the states according to a numeric or categorical variable you add to the data
<ul>
<li>Has a particular state/set of states adopted a policy?</li>
<li>Does a particular state/set of states embody a certain characteristic?</li>
</ul></li>
<li>Share the map on Piazza</li>
</ul>
</div>
<div id="application-terrorist-attacks-in-france" class="section level2" number="12.7">
<h2><span class="header-section-number">12.7</span> Application: Terrorist Attacks in France</h2>
<p>Political scientists study a wide range of questions related to terrorism, including how <a href="https://doi.org/10.1080/19361610902929990">targets end up being selected</a>, how to predict and defend against attacks, what <a href="https://doi.org/10.1111/ajps.12329">types of incidents the public considers to be terrorism</a>, how <a href="https://static1.squarespace.com/static/5da3488403dd2c4493a888d0/t/61600a72d794ed74cf58e0f3/1633684109226/Godefroidt_2021_Manuscript.pdf">attacks influence public attitudes</a>, and responses to terrorism from government and other actors.</p>
<ul>
<li>Why might mapping visualizations and spatial data be useful to political scientists for these questions?</li>
</ul>
<div id="adding-points-to-a-map" class="section level3" number="12.7.1">
<h3><span class="header-section-number">12.7.1</span> Adding points to a map</h3>
<p>In this application, we use the <a href="https://www.start.umd.edu/gtd/">Global Terrorism Database</a> to visualize where terrorist attacks (including failed attacks) have occurred in recent years in France.</p>
<ul>
<li>We will make a map of France using <code>map_data</code> to get the polygon information</li>
</ul>
<div class="sourceCode" id="cb567"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb567-1"><a href="#cb567-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(maps)</span>
<span id="cb567-2"><a href="#cb567-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb567-3"><a href="#cb567-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb567-4"><a href="#cb567-4" aria-hidden="true" tabindex="-1"></a><span class="do">## get france data (not available for all countries)</span></span>
<span id="cb567-5"><a href="#cb567-5" aria-hidden="true" tabindex="-1"></a>france <span class="ot">&lt;-</span> <span class="fu">map_data</span>(<span class="st">&quot;france&quot;</span>)</span>
<span id="cb567-6"><a href="#cb567-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb567-7"><a href="#cb567-7" aria-hidden="true" tabindex="-1"></a><span class="do">## Plot France</span></span>
<span id="cb567-8"><a href="#cb567-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb567-9"><a href="#cb567-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_polygon</span>(<span class="at">data=</span>france, <span class="fu">aes</span>(<span class="at">x=</span>long, <span class="at">y=</span>lat, <span class="at">group=</span>group), <span class="at">fill=</span><span class="st">&quot;white&quot;</span>, <span class="at">colour=</span><span class="st">&quot;gray&quot;</span>)<span class="sc">+</span></span>
<span id="cb567-10"><a href="#cb567-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb567-11"><a href="#cb567-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Terrorist Attacks in France 2000-2019&quot;</span>)<span class="sc">+</span></span>
<span id="cb567-12"><a href="#cb567-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_quickmap</span>()<span class="sc">+</span></span>
<span id="cb567-13"><a href="#cb567-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span></code></pre></div>
<p><img src="datasciforpolisci_files/figure-html/unnamed-chunk-347-1.svg" width="672" /></p>
<ul>
<li>We load separate data that includes the latitude and longitude of attacks</li>
</ul>
<div class="sourceCode" id="cb568"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb568-1"><a href="#cb568-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">&quot;gtb.RData&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb569"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb569-1"><a href="#cb569-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Let&#39;s look at only recent attacks </span></span>
<span id="cb569-2"><a href="#cb569-2" aria-hidden="true" tabindex="-1"></a>gtbfrance <span class="ot">&lt;-</span> <span class="fu">subset</span>(gtb, iyear <span class="sc">&gt;</span> <span class="dv">2000</span> <span class="sc">&amp;</span> country_txt<span class="sc">==</span><span class="st">&quot;France&quot;</span>)</span></code></pre></div>
<ul>
<li>We use <code>geom_point</code> to add a layer of points from this dataset
<ul>
<li>We can colour or size the points by additional variables in the data</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb570"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb570-1"><a href="#cb570-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb570-2"><a href="#cb570-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_polygon</span>(<span class="at">data=</span>france, <span class="fu">aes</span>(<span class="at">x=</span>long, <span class="at">y=</span>lat, <span class="at">group=</span>group), <span class="at">fill=</span><span class="st">&quot;white&quot;</span>, <span class="at">colour=</span><span class="st">&quot;gray&quot;</span>)<span class="sc">+</span></span>
<span id="cb570-3"><a href="#cb570-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb570-4"><a href="#cb570-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb570-5"><a href="#cb570-5" aria-hidden="true" tabindex="-1"></a>  <span class="do">## add points with size in proportion to fatalities</span></span>
<span id="cb570-6"><a href="#cb570-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data=</span>gtbfrance, <span class="fu">aes</span>(<span class="at">x=</span>longitude, <span class="at">y=</span>latitude, <span class="at">size=</span>nkill), </span>
<span id="cb570-7"><a href="#cb570-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha=</span>.<span class="dv">4</span>, <span class="at">colour=</span><span class="st">&quot;red&quot;</span>)<span class="sc">+</span> <span class="co"># alpha makes points transparent</span></span>
<span id="cb570-8"><a href="#cb570-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb570-9"><a href="#cb570-9" aria-hidden="true" tabindex="-1"></a>  <span class="do">## range specifies how big or small you want points to be</span></span>
<span id="cb570-10"><a href="#cb570-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_size</span>(<span class="at">name=</span><span class="st">&quot;Number of Fatalities&quot;</span>, <span class="at">range=</span><span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">10</span>))<span class="sc">+</span></span>
<span id="cb570-11"><a href="#cb570-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb570-12"><a href="#cb570-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb570-13"><a href="#cb570-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Terrorist Attacks in France 2000-2019&quot;</span>)<span class="sc">+</span></span>
<span id="cb570-14"><a href="#cb570-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_quickmap</span>()<span class="sc">+</span></span>
<span id="cb570-15"><a href="#cb570-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span></code></pre></div>
<p><img src="datasciforpolisci_files/figure-html/unnamed-chunk-351-1.svg" width="672" /></p>
<ul>
<li>We can also add labels to the plot with <code>geom_text_repel</code> from the <code>ggrepel</code> package
<ul>
<li>Note that we can use labels from yet another object so long as we have the right lat and long</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb571"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb571-1"><a href="#cb571-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;ggrepel&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb572"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb572-1"><a href="#cb572-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggrepel)</span>
<span id="cb572-2"><a href="#cb572-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Let&#39;s add labels for the biggest attacks only</span></span>
<span id="cb572-3"><a href="#cb572-3" aria-hidden="true" tabindex="-1"></a>gtbmajorfrance <span class="ot">&lt;-</span> <span class="fu">subset</span>(gtbfrance, nkill <span class="sc">&gt;</span> <span class="dv">75</span>)</span>
<span id="cb572-4"><a href="#cb572-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb572-5"><a href="#cb572-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb572-6"><a href="#cb572-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb572-7"><a href="#cb572-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_polygon</span>(<span class="at">data=</span>france, <span class="fu">aes</span>(<span class="at">x=</span>long, <span class="at">y=</span>lat, <span class="at">group=</span>group), <span class="at">fill=</span><span class="st">&quot;white&quot;</span>, <span class="at">colour=</span><span class="st">&quot;gray&quot;</span>)<span class="sc">+</span></span>
<span id="cb572-8"><a href="#cb572-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb572-9"><a href="#cb572-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb572-10"><a href="#cb572-10" aria-hidden="true" tabindex="-1"></a>  <span class="do">## add points with size in proportion to fatalities</span></span>
<span id="cb572-11"><a href="#cb572-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data=</span>gtbfrance, <span class="fu">aes</span>(<span class="at">x=</span>longitude, <span class="at">y=</span>latitude, <span class="at">size=</span>nkill), </span>
<span id="cb572-12"><a href="#cb572-12" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha=</span>.<span class="dv">4</span>, <span class="at">colour=</span><span class="st">&quot;red&quot;</span>)<span class="sc">+</span></span>
<span id="cb572-13"><a href="#cb572-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_size</span>(<span class="at">name=</span><span class="st">&quot;Number of Fatalities&quot;</span>, <span class="at">range=</span><span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">10</span>))<span class="sc">+</span></span>
<span id="cb572-14"><a href="#cb572-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb572-15"><a href="#cb572-15" aria-hidden="true" tabindex="-1"></a>  <span class="do">## add labels from gtbmajorfrance</span></span>
<span id="cb572-16"><a href="#cb572-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text_repel</span>(<span class="at">data=</span>gtbmajorfrance, <span class="fu">aes</span>(<span class="at">x=</span>longitude, <span class="at">y=</span>latitude, </span>
<span id="cb572-17"><a href="#cb572-17" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">label=</span>city), <span class="at">size=</span><span class="dv">4</span>,</span>
<span id="cb572-18"><a href="#cb572-18" aria-hidden="true" tabindex="-1"></a>                  <span class="at">max.overlaps =</span> <span class="dv">30</span>)<span class="sc">+</span></span>
<span id="cb572-19"><a href="#cb572-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb572-20"><a href="#cb572-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb572-21"><a href="#cb572-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Terrorist Attacks in France 2000-2019&quot;</span>)<span class="sc">+</span></span>
<span id="cb572-22"><a href="#cb572-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_quickmap</span>()<span class="sc">+</span></span>
<span id="cb572-23"><a href="#cb572-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span></code></pre></div>
<p><img src="datasciforpolisci_files/figure-html/unnamed-chunk-353-1.svg" width="672" /></p>
</div>
</div>
<div id="animating-data" class="section level2" number="12.8">
<h2><span class="header-section-number">12.8</span> Animating Data</h2>
<p>With R, we can go a step further to make our maps more interactive. RStudio and R allow for the ability to turn graphics into interactive applications, as well as animate visualizations to reveal or change the visual over the course of different frames. We will take a brief look at these applications.</p>
<p>Why would we want to do this? An engaging way to reveal changes over time or other states. Adding a bit of drama to presentations.</p>
<p><img src="images/giphy.gif" /></p>
<p>We will use the package <code>gganimate</code> for this. Install and load the package.</p>
<div class="sourceCode" id="cb573"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb573-1"><a href="#cb573-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;gganimate&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb574"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb574-1"><a href="#cb574-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gganimate)</span></code></pre></div>
<p>To animate a ggplot, we just add an argument to indicate the variable that dictates the transition between different states, in this case, the date variable, <code>iyear</code>. The other parts of the plot stay very similar to before.</p>
<div class="sourceCode" id="cb575"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb575-1"><a href="#cb575-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb575-2"><a href="#cb575-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_polygon</span>(<span class="at">data=</span>france, <span class="fu">aes</span>(<span class="at">x=</span>long, <span class="at">y=</span>lat, <span class="at">group=</span>group), <span class="at">fill=</span><span class="st">&quot;white&quot;</span>, <span class="at">colour=</span><span class="st">&quot;gray&quot;</span>)<span class="sc">+</span></span>
<span id="cb575-3"><a href="#cb575-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb575-4"><a href="#cb575-4" aria-hidden="true" tabindex="-1"></a>  <span class="do">## add points with size in proportion to fatalities</span></span>
<span id="cb575-5"><a href="#cb575-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data=</span>gtbfrance, <span class="fu">aes</span>(<span class="at">x=</span>longitude, <span class="at">y=</span>latitude, <span class="at">size=</span>nkill), <span class="at">alpha=</span>.<span class="dv">4</span>, <span class="at">colour=</span><span class="st">&quot;red&quot;</span>)<span class="sc">+</span></span>
<span id="cb575-6"><a href="#cb575-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_size</span>(<span class="at">name=</span><span class="st">&quot;Number of Fatalities&quot;</span>, <span class="at">range=</span><span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">10</span>))<span class="sc">+</span></span>
<span id="cb575-7"><a href="#cb575-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb575-8"><a href="#cb575-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Terrorist Attacks in France 2000-2019&quot;</span>)<span class="sc">+</span></span>
<span id="cb575-9"><a href="#cb575-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_quickmap</span>()<span class="sc">+</span></span>
<span id="cb575-10"><a href="#cb575-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()<span class="sc">+</span></span>
<span id="cb575-11"><a href="#cb575-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb575-12"><a href="#cb575-12" aria-hidden="true" tabindex="-1"></a>  <span class="do">## add the transition and a label for the plot</span></span>
<span id="cb575-13"><a href="#cb575-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transition_states</span>(iyear, <span class="at">state_length =</span> <span class="dv">8</span>)<span class="sc">+</span></span>
<span id="cb575-14"><a href="#cb575-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;Current map: {closest_state}&quot;</span>)</span>
<span id="cb575-15"><a href="#cb575-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb575-16"><a href="#cb575-16" aria-hidden="true" tabindex="-1"></a><span class="fu">anim_save</span>(<span class="st">&quot;gtbplot.gif&quot;</span>)</span></code></pre></div>
<p><img src="gtbplot.gif" /></p>
</div>
<div id="application-spread-of-coronavirus" class="section level2" number="12.9">
<h2><span class="header-section-number">12.9</span> Application: Spread of Coronavirus</h2>
<p>Mapping isn’t the only application where we might want to show an animation. Here is a brief example using ggplot in a different way to reveal trends over time.</p>
<p>We are going to map the spread of confirmed COVID cases based on data from <a href="https://github.com/CSSEGISandData/COVID-19">John Hopkins University</a>.</p>
<div class="sourceCode" id="cb576"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb576-1"><a href="#cb576-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">&quot;covidlongfmt.RData&quot;</span>)</span></code></pre></div>
<p>We have variables <code>case_count</code> and <code>Country.Region</code> along with <code>date_fmt</code>. Let’s compare trends in confirmed cases between Italy and France.</p>
<div class="sourceCode" id="cb577"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb577-1"><a href="#cb577-1" aria-hidden="true" tabindex="-1"></a>italyspain <span class="ot">&lt;-</span> <span class="fu">subset</span>(covidlongfmt, Country.Region <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;Italy&quot;</span>, <span class="st">&quot;Spain&quot;</span>))</span></code></pre></div>
<p>Let’s divide cases by 1000 to make it easier to visualize.</p>
<div class="sourceCode" id="cb578"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb578-1"><a href="#cb578-1" aria-hidden="true" tabindex="-1"></a>italyspain<span class="sc">$</span>case_count_thousands <span class="ot">&lt;-</span> italyspain<span class="sc">$</span>case_count <span class="sc">/</span><span class="dv">1000</span></span></code></pre></div>
<p>With ggplot, this time instead of using <code>geom_polygon</code>, we will use <code>geom_line</code>. Our x-axis will be time, and our y-axis will be the case count.</p>
<p>Again, to animate a ggplot, we just add an argument to indicate the variable that dictates the transition between different states, in this case, the date variable, <code>date_fmt</code>. The other parts of the plot stay very similar to before.</p>
<div class="sourceCode" id="cb579"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb579-1"><a href="#cb579-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb579-2"><a href="#cb579-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data=</span>italyspain, <span class="fu">aes</span>(<span class="at">x=</span>date_fmt, <span class="at">y=</span>case_count_thousands, </span>
<span id="cb579-3"><a href="#cb579-3" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">colour=</span>Country.Region))<span class="sc">+</span></span>
<span id="cb579-4"><a href="#cb579-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb579-5"><a href="#cb579-5" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Add labels with exact case count</span></span>
<span id="cb579-6"><a href="#cb579-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text_repel</span>(<span class="at">data=</span>italyspain, <span class="fu">aes</span>(<span class="at">x=</span>date_fmt,  </span>
<span id="cb579-7"><a href="#cb579-7" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">y=</span>case_count_thousands,</span>
<span id="cb579-8"><a href="#cb579-8" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">colour=</span>Country.Region,</span>
<span id="cb579-9"><a href="#cb579-9" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">label=</span>case_count_thousands))<span class="sc">+</span></span>
<span id="cb579-10"><a href="#cb579-10" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb579-11"><a href="#cb579-11" aria-hidden="true" tabindex="-1"></a>  <span class="do">## axis and title labels</span></span>
<span id="cb579-12"><a href="#cb579-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Cases (thousands)&quot;</span>)<span class="sc">+</span></span>
<span id="cb579-13"><a href="#cb579-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Confirmed Cases in Italy and Spain&quot;</span>)<span class="sc">+</span></span>
<span id="cb579-14"><a href="#cb579-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()<span class="sc">+</span></span>
<span id="cb579-15"><a href="#cb579-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb579-16"><a href="#cb579-16" aria-hidden="true" tabindex="-1"></a>  <span class="do">## We use transition_reveal to slowly reveal the trend</span></span>
<span id="cb579-17"><a href="#cb579-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transition_reveal</span>(date_fmt)<span class="sc">+</span></span>
<span id="cb579-18"><a href="#cb579-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Date: {frame_along}&quot;</span>)</span>
<span id="cb579-19"><a href="#cb579-19" aria-hidden="true" tabindex="-1"></a><span class="fu">anim_save</span>(<span class="st">&quot;italyspain.gif&quot;</span>)</span></code></pre></div>
<p><img src="italyspain.gif" /></p>
<div id="mapping-animation-with-world-map" class="section level3" number="12.9.1">
<h3><span class="header-section-number">12.9.1</span> Mapping Animation with World Map</h3>
<p>Just like with the terrorism data, we can make a map with the data, too.</p>
<p>To illustrate the process, let’s create a plot for just one day: 2020-03-01.</p>
<div class="sourceCode" id="cb580"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb580-1"><a href="#cb580-1" aria-hidden="true" tabindex="-1"></a>covidmarch <span class="ot">&lt;-</span> <span class="fu">subset</span>(covidlongfmt, date_fmt <span class="sc">==</span> <span class="st">&quot;2020-03-01&quot;</span>)</span></code></pre></div>
<p>We create a world map and add points to indicate the case count, with the size proportionate to the count. We include <code>alpha</code> to make the points transparent.</p>
<div class="sourceCode" id="cb581"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb581-1"><a href="#cb581-1" aria-hidden="true" tabindex="-1"></a>world <span class="ot">&lt;-</span> <span class="fu">map_data</span>(<span class="st">&quot;world&quot;</span>)</span>
<span id="cb581-2"><a href="#cb581-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb581-3"><a href="#cb581-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb581-4"><a href="#cb581-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb581-5"><a href="#cb581-5" aria-hidden="true" tabindex="-1"></a>  <span class="do">## create the world map</span></span>
<span id="cb581-6"><a href="#cb581-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_polygon</span>(<span class="at">data=</span>world, <span class="fu">aes</span>(<span class="at">x=</span>long, <span class="at">y=</span>lat, <span class="at">group=</span>group), <span class="at">colour=</span><span class="st">&quot;black&quot;</span>, <span class="at">fill=</span><span class="st">&quot;white&quot;</span>)<span class="sc">+</span></span>
<span id="cb581-7"><a href="#cb581-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb581-8"><a href="#cb581-8" aria-hidden="true" tabindex="-1"></a>  <span class="do">## add points</span></span>
<span id="cb581-9"><a href="#cb581-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data=</span>covidmarch, <span class="fu">aes</span>(<span class="at">x=</span>Long, <span class="at">y=</span>Lat, <span class="at">size=</span>case_count), <span class="at">alpha=</span>.<span class="dv">4</span>, <span class="at">colour=</span><span class="st">&quot;red&quot;</span>)<span class="sc">+</span></span>
<span id="cb581-10"><a href="#cb581-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_size</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">10</span>)) <span class="sc">+</span></span>
<span id="cb581-11"><a href="#cb581-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb581-12"><a href="#cb581-12" aria-hidden="true" tabindex="-1"></a>  <span class="do">## aesthetics</span></span>
<span id="cb581-13"><a href="#cb581-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;COVID-19 Confirmed Cases on March 1, 2020&quot;</span>)<span class="sc">+</span></span>
<span id="cb581-14"><a href="#cb581-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_quickmap</span>()<span class="sc">+</span></span>
<span id="cb581-15"><a href="#cb581-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span></code></pre></div>
<pre><code>## Warning: Removed 2 rows containing missing values (geom_point).</code></pre>
<p><img src="datasciforpolisci_files/figure-html/unnamed-chunk-363-1.svg" width="672" /></p>
<p>Now, we use the full data and transition through the date variable. We then “render” and save the animation.</p>
<div class="sourceCode" id="cb583"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb583-1"><a href="#cb583-1" aria-hidden="true" tabindex="-1"></a>world <span class="ot">&lt;-</span> <span class="fu">map_data</span>(<span class="st">&quot;world&quot;</span>)</span>
<span id="cb583-2"><a href="#cb583-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb583-3"><a href="#cb583-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb583-4"><a href="#cb583-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb583-5"><a href="#cb583-5" aria-hidden="true" tabindex="-1"></a>  <span class="do">## create the world map</span></span>
<span id="cb583-6"><a href="#cb583-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_polygon</span>(<span class="at">data=</span>world, <span class="fu">aes</span>(<span class="at">x=</span>long, <span class="at">y=</span>lat, <span class="at">group=</span>group), <span class="at">colour=</span><span class="st">&quot;black&quot;</span>, <span class="at">fill=</span><span class="st">&quot;white&quot;</span>)<span class="sc">+</span></span>
<span id="cb583-7"><a href="#cb583-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb583-8"><a href="#cb583-8" aria-hidden="true" tabindex="-1"></a>  <span class="do">## add points</span></span>
<span id="cb583-9"><a href="#cb583-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data=</span>covidlongfmt, <span class="fu">aes</span>(<span class="at">x=</span>Long, <span class="at">y=</span>Lat, <span class="at">size=</span>case_count), <span class="at">alpha=</span>.<span class="dv">4</span>, <span class="at">colour=</span><span class="st">&quot;red&quot;</span>)<span class="sc">+</span></span>
<span id="cb583-10"><a href="#cb583-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_size</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">15</span>)) <span class="sc">+</span></span>
<span id="cb583-11"><a href="#cb583-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb583-12"><a href="#cb583-12" aria-hidden="true" tabindex="-1"></a>  <span class="do">## aesthetics</span></span>
<span id="cb583-13"><a href="#cb583-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;COVID-19 Confirmed Cases&quot;</span>)<span class="sc">+</span></span>
<span id="cb583-14"><a href="#cb583-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_quickmap</span>()<span class="sc">+</span></span>
<span id="cb583-15"><a href="#cb583-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb583-16"><a href="#cb583-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb583-17"><a href="#cb583-17" aria-hidden="true" tabindex="-1"></a>  <span class="do">## add the transition and a label for the plot</span></span>
<span id="cb583-18"><a href="#cb583-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transition_time</span>(date_fmt)<span class="sc">+</span></span>
<span id="cb583-19"><a href="#cb583-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">&quot;Date: {frame_time}&quot;</span>)</span>
<span id="cb583-20"><a href="#cb583-20" aria-hidden="true" tabindex="-1"></a><span class="do">## save animation as a gif</span></span>
<span id="cb583-21"><a href="#cb583-21" aria-hidden="true" tabindex="-1"></a><span class="fu">anim_save</span>(<span class="st">&quot;covidplot.gif&quot;</span>)</span></code></pre></div>
<p><img src="covidplot.gif" /></p>
<p>How could we improve this visualization?</p>
</div>
</div>
<div id="application-territorial-control-of-syria" class="section level2" number="12.10">
<h2><span class="header-section-number">12.10</span> Application: Territorial Control of Syria</h2>
<p>In this <a href="https://onlinelibrary.wiley.com/doi/abs/10.1111/ajps.12509">article</a>, Anita Gohdes uses data from the Syria Conflict Mapping Project (SCMP), which tracks local communities and determines which conflict party is in control. The author maps which group is in control of different communities in 2014 and 2015, including: opposition forces, Islamic State forces, government forces, and Kurdish forces.</p>
<p>Among other findings, the author shows that group presence influences the degree of targeted repressive violence.</p>
<p>We are going to map the territorial control of Syria at these two time points using the author’s data. Note: the mapping data we use does not come directly from the <code>maps</code> package. Instead the author used “shape files” from an external source, which then can be converted into a dataframe like we get when using <code>map_data</code>.</p>
<p>Let’s load the data. The data have already been converted into the dataframe.</p>
<div class="sourceCode" id="cb584"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb584-1"><a href="#cb584-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">&quot;SYmapd.RData&quot;</span>)</span></code></pre></div>
<p>A second dataset includes information about territorial control. Let’s also load that data.</p>
<div class="sourceCode" id="cb585"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb585-1"><a href="#cb585-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">&quot;mapdata.RData&quot;</span>)</span></code></pre></div>
<p>We can create a map.</p>
<div class="sourceCode" id="cb586"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb586-1"><a href="#cb586-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb586-2"><a href="#cb586-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb586-3"><a href="#cb586-3" aria-hidden="true" tabindex="-1"></a>  <span class="do">## use shape data</span></span>
<span id="cb586-4"><a href="#cb586-4" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_polygon</span>(<span class="at">data=</span>SYmapd, <span class="fu">aes</span>(<span class="at">x=</span>long, <span class="at">y=</span>lat, <span class="at">group=</span>group),</span>
<span id="cb586-5"><a href="#cb586-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">fill=</span><span class="st">&quot;white&quot;</span>, <span class="at">color=</span><span class="st">&quot;gray&quot;</span>) <span class="sc">+</span>  </span>
<span id="cb586-6"><a href="#cb586-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb586-7"><a href="#cb586-7" aria-hidden="true" tabindex="-1"></a>  <span class="do">## add points with map data</span></span>
<span id="cb586-8"><a href="#cb586-8" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_point</span>(<span class="at">data=</span>mapdata, <span class="fu">aes</span>(<span class="at">x=</span>longitude, <span class="at">y=</span>latitude, <span class="at">color=</span>group), <span class="at">alpha=</span>.<span class="dv">3</span>)<span class="sc">+</span></span>
<span id="cb586-9"><a href="#cb586-9" aria-hidden="true" tabindex="-1"></a>   <span class="fu">scale_color_manual</span>(<span class="st">&quot;&quot;</span>,<span class="at">values=</span><span class="fu">c</span>(<span class="st">&quot;red&quot;</span>, <span class="st">&quot;black&quot;</span>, <span class="st">&quot;purple&quot;</span>, <span class="st">&quot;blue&quot;</span>))<span class="sc">+</span></span>
<span id="cb586-10"><a href="#cb586-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb586-11"><a href="#cb586-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb586-12"><a href="#cb586-12" aria-hidden="true" tabindex="-1"></a>   <span class="fu">theme_void</span>()<span class="sc">+</span> </span>
<span id="cb586-13"><a href="#cb586-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb586-14"><a href="#cb586-14" aria-hidden="true" tabindex="-1"></a>  <span class="do">## add animation</span></span>
<span id="cb586-15"><a href="#cb586-15" aria-hidden="true" tabindex="-1"></a>   <span class="fu">transition_states</span>(date, <span class="at">transition_length =</span> .<span class="dv">25</span>, <span class="at">state_length =</span> <span class="dv">3</span>)<span class="sc">+</span></span>
<span id="cb586-16"><a href="#cb586-16" aria-hidden="true" tabindex="-1"></a>   <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Current map: {closest_state}&quot;</span>)</span>
<span id="cb586-17"><a href="#cb586-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb586-18"><a href="#cb586-18" aria-hidden="true" tabindex="-1"></a><span class="fu">anim_save</span>(<span class="st">&quot;syriamap.gif&quot;</span>)</span></code></pre></div>
<p><img src="syriamap.gif" /></p>
<!--chapter:end:12-Maps.Rmd-->
</div>
</div>
<div id="choose" class="section level1" number="13">
<h1><span class="header-section-number">13</span> Choose Your Own Adventure</h1>
<p>For the final project, you are creating a research project independently.</p>
<p>Below are some tips for working with new data.</p>
<div id="get-to-know-new-data" class="section level2" number="13.1">
<h2><span class="header-section-number">13.1</span> Get to know new data</h2>
<p>How to explore new data</p>
<ol style="list-style-type: decimal">
<li>When you encounter a new dataset, try to also identify the codebook that goes along with it.
<ul>
<li>This should have information describing what the variables are in the data and what the values mean.</li>
<li>It should also help clarify what unit is in each row of a dataset (e.g., is each row a survey respondent, an election, a Member of Congress, a country in a particular year)</li>
</ul></li>
<li>When you download data, identify the file type (e.g., .csv, .dta, .RData)
<ul>
<li>Recall that chapter 1 of <a href="https://assets.press.princeton.edu/chapters/s11025.pdf">QSS section 1.3.5 (pg. 20)</a> goes over how to read in different file types in R with functions like <code>read.csv</code>, <code>read.dta</code> with the <code>library(foreign)</code> package, etc.</li>
</ul></li>
<li>When you load in the data in RStudio, explore it.
<ul>
<li>How many rows? <code>nrow</code>, How many columns? <code>ncol</code></li>
<li>You can <code>View()</code> the data or look at the first few rows with <code>head()</code>
<ul>
<li>Are most variables numeric? Or, does it seem like you have factor and character variables?</li>
</ul></li>
<li>See if the data seem to match up with what the codebook suggests should be there.</li>
</ul></li>
</ol>
<p>How to investigate new variables</p>
<ol style="list-style-type: decimal">
<li>Real-world data may often require some cleaning or “wrangling”</li>
</ol>
<p>So you have some data…. AND it’s a mess!!!</p>
<p>A lot of the data we may encounter in courses has been simplified to allow students to focus on other concepts. We may have data that look like the following:</p>
<div class="sourceCode" id="cb587"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb587-1"><a href="#cb587-1" aria-hidden="true" tabindex="-1"></a>nicedata <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">gender =</span> <span class="fu">c</span>(<span class="st">&quot;Male&quot;</span>, <span class="st">&quot;Female&quot;</span>, <span class="st">&quot;Female&quot;</span>, <span class="st">&quot;Male&quot;</span>),</span>
<span id="cb587-2"><a href="#cb587-2" aria-hidden="true" tabindex="-1"></a>           <span class="at">age =</span> <span class="fu">c</span>(<span class="dv">16</span>, <span class="dv">20</span>, <span class="dv">66</span>, <span class="dv">44</span>),</span>
<span id="cb587-3"><a href="#cb587-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">voterturnout =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>))</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">gender</th>
<th align="right">age</th>
<th align="right">voterturnout</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Male</td>
<td align="right">16</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">Female</td>
<td align="right">20</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">Female</td>
<td align="right">66</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">Male</td>
<td align="right">44</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<p>In the real world, our data may hit us like a ton of bricks, like the below:</p>
<div class="sourceCode" id="cb588"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb588-1"><a href="#cb588-1" aria-hidden="true" tabindex="-1"></a>uglydata <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">VV160002 =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="cn">NA</span>, <span class="dv">1</span>, <span class="dv">2</span>),</span>
<span id="cb588-2"><a href="#cb588-2" aria-hidden="true" tabindex="-1"></a>           <span class="at">VV1400068 =</span> <span class="fu">c</span>(<span class="dv">16</span>, <span class="dv">20</span>, <span class="dv">66</span>, <span class="dv">44</span>),</span>
<span id="cb588-3"><a href="#cb588-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">VV20000 =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="cn">NA</span>, <span class="dv">1</span>, <span class="cn">NA</span>))</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">VV160002</th>
<th align="right">VV1400068</th>
<th align="right">VV20000</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">2</td>
<td align="right">16</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">NA</td>
<td align="right">20</td>
<td align="right">NA</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="right">66</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">44</td>
<td align="right">NA</td>
</tr>
</tbody>
</table>
<p>A lot of common datasets we use in the social sciences are messy, uninformative, sprawling, misshaped, and/or incomplete. What do I mean by this?</p>
<ul>
<li>The data might have a lot of missing values. For example, we may have <code>NA</code> values in R, or perhaps a research firm has used some other notation for missing data, such as a <code>99</code>.</li>
<li>The variable names may be uninformative.
<ul>
<li>For example, there may be no way to know by looking at the data, which variable represents gender. We have to look at a codebook.</li>
</ul></li>
<li>Even if we can tell what a variable is, its categories may not be coded in a way that aligns with how we want to use the data for our research question.
<ul>
<li>For example, perhaps you are interested in the effect of a policy on people below vs. 65 and over in age. Well, your age variables might just be a numeric variable. You will have to create a new variable that aligns with your theoretical interest.</li>
</ul></li>
<li>Datasets are often sprawling. Some datasets may have more than 1000 variables. It is hard to sort through all of them. Likewise, datasets may have millions of observations. We cannot practically look through all the values of a column to know what is there.</li>
</ul>
<div id="dealing-with-uninformative-variable-names" class="section level3" number="13.1.1">
<h3><span class="header-section-number">13.1.1</span> Dealing with Uninformative Variable Names</h3>
<p>Hopefully, there is an easy fix for dealing with uninformative variable names. I say “hopefully” because hopefully when you encounter a dataset with uninformative variable names, the place where you downloaded the data will also include a codebook telling you what each variable name means, and how the corresponding values are coded.</p>
<p>Unfortunately, this may not always be the case. One thing you can do as a researcher is when you create a dataset for your own work, keep a record (in written form, on a word document or in a pdf or code file) of what each variable means (e.g., the survey question it corresponds to or the exact economic measure), as well as how the values of the variables are coded. This good practice will help you in the short-term, as you pause and come back to working on a project over the course of a year, as well as benefit other researchers in the long run after you publish your research.</p>
<p>For examples of large codebooks, you can view the <a href="https://electionstudies.org/data-center/2016-time-series-study/">2016 American National Election Study Survey</a> and click on a codebook.</p>
<p>I recommend that once you locate the definition of a variable of interest, rename the variable in your dataset to be informative. You can do this by creating a new variable or overwriting the name of the existing variable. You might also comment a note for yourself of what the values mean.</p>
<div class="sourceCode" id="cb589"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb589-1"><a href="#cb589-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Option 1: create new variable</span></span>
<span id="cb589-2"><a href="#cb589-2" aria-hidden="true" tabindex="-1"></a><span class="do">## gender 2=Male, 1=Female</span></span>
<span id="cb589-3"><a href="#cb589-3" aria-hidden="true" tabindex="-1"></a>uglydata<span class="sc">$</span>gender <span class="ot">&lt;-</span> uglydata<span class="sc">$</span>VV160002</span>
<span id="cb589-4"><a href="#cb589-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb589-5"><a href="#cb589-5" aria-hidden="true" tabindex="-1"></a><span class="do">## Option 2: Overwrite</span></span>
<span id="cb589-6"><a href="#cb589-6" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(uglydata)[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="st">&quot;gender2&quot;</span></span></code></pre></div>
</div>
<div id="dealing-with-missing-data" class="section level3" number="13.1.2">
<h3><span class="header-section-number">13.1.2</span> Dealing with Missing Data</h3>
<p>When we have a column with missing data, it is best to do a few things:</p>
<ul>
<li>Try to quantify how much missing data there is and poke at the reason why data are missing.
<ul>
<li>Is it minor non-response data?</li>
<li>Or is it indicative of a more systematic issue? For example, maybe data from a whole group of people or countries is missing for certain variables.</li>
</ul></li>
<li>If the data are missing at a very minor rate and/or there is a logical explanation for the missing data that should not affect your research question, you may choose to “ignore” the missing data when performing common analyses, such as taking the mean or running a regression.</li>
</ul>
<p>If we want to figure out how much missing data we have in a variable, we have a couple of approaches:</p>
<div class="sourceCode" id="cb590"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb590-1"><a href="#cb590-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Summarize this variable</span></span>
<span id="cb590-2"><a href="#cb590-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(uglydata<span class="sc">$</span>gender)</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA&#39;s 
##   1.000   1.500   2.000   1.667   2.000   2.000       1</code></pre>
<div class="sourceCode" id="cb592"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb592-1"><a href="#cb592-1" aria-hidden="true" tabindex="-1"></a><span class="do">## What is the length of the subset of the variable where the data are missing</span></span>
<span id="cb592-2"><a href="#cb592-2" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(uglydata<span class="sc">$</span>gender[<span class="fu">is.na</span>(uglydata<span class="sc">$</span>gender) <span class="sc">==</span> T])</span></code></pre></div>
<pre><code>## [1] 1</code></pre>
<p>If we choose to ignore missing data, this can often be easily accomplished in common operations. For example, when taking the <code>mean</code> we just add an argument <code>na.rm = T</code>:</p>
<div class="sourceCode" id="cb594"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb594-1"><a href="#cb594-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(uglydata<span class="sc">$</span>VV1400068, <span class="at">na.rm=</span>T)</span></code></pre></div>
<pre><code>## [1] 36.5</code></pre>
<p>We should always be careful with missing data to understand how R is treating it in a particular scenario.</p>
</div>
<div id="dealing-with-variable-codings-that-arent-quite-right" class="section level3" number="13.1.3">
<h3><span class="header-section-number">13.1.3</span> Dealing with Variable Codings that Aren’t Quite Right</h3>
<p>Often times the ways that variables are coded in datasets we get off-the-shelf are not coded exactly as how we were dreaming up operationalizing our concepts. Instead, we are going to have to wrangle the data to get them into shape.</p>
<p>This may involve creating new variables that recode certain values, creating new variables that collapse some values into a smaller number of categories, combining multiple variables into a single variable (e.g., representing the average), or setting some of the variable values to be missing (<code>NA</code>). All of these scenarios may come up when you are dealing with real data.</p>
</div>
<div id="dealing-with-parts-of-datasets" class="section level3" number="13.1.4">
<h3><span class="header-section-number">13.1.4</span> Dealing with Parts of Datasets</h3>
<p>We may also want to limit our analysis to just small parts of datsets instead of the entire dataset. Recall the function <code>subset</code> to do this.</p>
<!--chapter:end:13-ChooseYourOwnAdventure.Rmd-->
</div>
</div>
</div>
<!--bookdown:body:end-->
            </section>

          </div>
        </div>
      </div>
<!--bookdown:link_prev-->
<!--bookdown:link_next-->
    </div>
  </div>
<!--bookdown:config-->

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
